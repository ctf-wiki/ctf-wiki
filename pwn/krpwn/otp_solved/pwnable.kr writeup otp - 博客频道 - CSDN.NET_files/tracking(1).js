(function(c,b,d){function a(){this.advs=[];this.advFlag={};this.dataArr=[];this.dataTimer=null;this.swapImgSet=false;this.init()}a.prototype={constructor:"Track",init:function(){var g=this;var f=(function(){var h=null;return function(){if(h){return false}h=setTimeout(function(){h=null;g.insertData()},100)}})();var e=function(){if(g.dataArr.length===0){return false}for(var j=0,h=g.dataArr.length;j<h;j++){g.sendData(g.dataArr[j])}g.dataArr=[]}},addAdvs:function(n,f){var m=this,n=n||".J_adv",f=typeof f==="object"?f:{},e=b(n),l=e.length,j=document.referrer||"-";if(l===0){return false}for(var h=0;h<l;h++){var g={};var k=b(e[h]).data("mod");if(this.advFlag[k]){return false}g.ele=b(e[h]);g.top=b(e[h]).offset().top;g.height=b(e[h]).height()?b(e[h]).height():b(e[h]).find("img").height();g.view=typeof b(e[h]).data("view")==="undefined"?true:b(e[h]).data("view");g.viewed=false;g.data={uid:"-",ref:j,mod:g.ele.data("mod")||"-",mtp:f.mtp||g.ele.data("mtp")||1,con:m.exportData(g),ck:"-"};if(g.ele.data("swapimg")&&!this.swapImgSet){csdn.SwapImage.swap({swapRoot:b(".hot")});this.swapImgSet=true}if(this.posTest(g)&&g.view){if(b(e[h]).data("swapimg")){if(b(e[h]).hasClass("curSwap")){g.viewed=true;this.sendData(g)}}else{g.viewed=true;this.sendData(g)}}this.advs.push(g);this.linkNodes(g);this.advFlag[k]=true}},insertData:function(){var e=this;if(e.advs.length===0){return false}for(var f=0;f<e.advs.length;f++){if(e.advs[f].view&&e.posTest(e.advs[f])){if(e.advs[f].ele.data("swapimg")&&!e.advs[f].ele.hasClass("curSwap")){continue}e.advs[f].viewed=true;e.sendData(e.advs[f])}}},discreteSend:function(){var e=this;var f=function(){if(e.dataArr.length===0){clearInterval(e.dataTimer);e.dataTimer=null;return false}var g=0;while(g<1){if(e.dataArr[0]){e.sendData(e.dataArr[0]);e.dataArr.shift();g++}else{clearInterval(e.dataTimer);e.dataTimer=null;break}}};this.dataTimer=setInterval(f,20)},exportData:function(f){var e=f.ele.data("con")||"-";return !!f.ele.data("order")?e+",ad_order_"+f.ele.data("order"):e+"-"},posTest:function(e){if(e.viewed){return false}else{return true}},linkNodes:function(f){var g=this;var e=f.ele.find("a");var h=f.ele.find("iframe");if(e.length===0&&h.length===0){return false}e.each(function(){if(b(this).attr("target")==d){b(this).attr("target","_blank")}b(this).on("click",function(){con=g.linkData(this);g.sendData(f,con)})})},linkData:function(g){var f=""+g.href;var e;if(b(g).find("img").length){e=b(g).find("img").eq(0).attr("title")||b(g).find("img").eq(0).attr("alt")}else{e=b(g).html()}f+=e?";"+e:"";return f},getUserId:function(){var e=/(; )?(UserName|_javaeye_cookie_id_)=([^;]+)/.exec(c.document.cookie);var f=(e!=null?e[3]:void 0)||"-";return f},sendData:function(f,e){f.data.uid=this.getUserId();protocol="http:";if(typeof e==="string"){f.data.ck=e}var h=this.paramData(f.data);var g=new Image();g.onload=g.onerror=function(){g.onload=g.onerror=null;g=null};if(typeof e==="string"){g.src=protocol+"//dc.csdn.net/re?"+h}},paramData:function(g){var f=[];for(var e in g){var h=e+"="+g[e];h.replace(/^\s+|\s+$/g,"");f.push(h)}return f.join("&")}};c.CSDN=c.CSDN?c.CSDN:{};return window.CSDN.track=new a()})(window,jQuery);