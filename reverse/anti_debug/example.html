


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_CN">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Anti debug的例题 &#8212; CTF Wiki </title>
    <link rel="stylesheet" href="../../_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../../_static/cloud.base.js"></script>
    <script type="text/javascript" src="../../_static/cloud.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="Linux RE" href="../linux/index.html" />
    <link rel="prev" title="NtQueryInformationProcess" href="ntqueryinformationprocess.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../index.html" title="內容目录"
             accesskey="C">toc</a></li>
        <li class="right" >
          <a href="../linux/index.html" title="Linux RE"
             accesskey="N">下一页</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="ntqueryinformationprocess.html" title="NtQueryInformationProcess"
             accesskey="P">上一页</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">CTF Wiki </a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Anti Debug Tech</a> &#187;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="anti-debug">
<h1>Anti debug的例题<a class="headerlink" href="#anti-debug" title="永久链接至标题">¶</a></h1>
<p>我们现在来分析一道2016年SecCon的<code class="docutils literal"><span class="pre">anti-debugging</span></code>题, 题目下载链接:
<a class="reference external" href="https://github.com/ctf-wiki/ctf-wiki/blob/master/reverse/anti_debug/example/2016_seccon/anti_debugging_100/bin.exe">bin.exe</a></p>
<p>这是一个32位的PE文件, 是一个控制台程序, 我们直接运行,
会要求输入<code class="docutils literal"><span class="pre">password</span></code>.
当你输入一个错误的<code class="docutils literal"><span class="pre">password</span></code>时则会提示你<code class="docutils literal"><span class="pre">password</span> <span class="pre">is</span> <span class="pre">wrong</span></code>.</p>
<div class="figure" id="id4">
<img alt="run.png" src="../../_images/run.png" />
<p class="caption"><span class="caption-text">run.png</span></p>
</div>
<p>我们用IDA打开来看下, 最快速的方式就是直接查看字符串,
根据<code class="docutils literal"><span class="pre">password</span> <span class="pre">is</span> <span class="pre">wrong</span></code>找到关键代码. IDA显示的结果如下图:</p>
<div class="figure" id="id5">
<img alt="ida_strings.png" src="../../_images/ida_strings.png" />
<p class="caption"><span class="caption-text">ida_strings.png</span></p>
</div>
<p>显然, 字符串表明程序中可能有各种检测, 比如检测进程名<code class="docutils literal"><span class="pre">ollydbg.exe</span></code>,
<code class="docutils literal"><span class="pre">ImmunityDebugger.exe</span></code>, <code class="docutils literal"><span class="pre">idaq.exe</span></code>和<code class="docutils literal"><span class="pre">Wireshark.exe</span></code>.
然后也有其他的检测.
我们也看到了字符串<code class="docutils literal"><span class="pre">password</span> <span class="pre">is</span> <span class="pre">wrong</span></code>和<code class="docutils literal"><span class="pre">You</span> <span class="pre">password</span> <span class="pre">is</span> <span class="pre">correct</span></code>的字样.
同时还发现了一个很有可能就是待解密的flag的字符串.
那么我们就先根据<code class="docutils literal"><span class="pre">password</span> <span class="pre">is</span> <span class="pre">wrong</span></code>的交叉引用来到关键函数处.</p>
<p>如下所示: 程序果然使用了大量的反调试技巧.</p>
<div class="code c highlight-default"><div class="highlight"><pre><span></span>int __cdecl main(int argc, const char **argv, const char **envp)
{
  v23 = 0;
  memset(&amp;v24, 0, 0x3Fu);
  v22 = 1;
  printf(&quot;Input password &gt;&quot;);
  v3 = (FILE *)sub_40223D();
  fgets(&amp;v23, 64, v3);
  strcpy(v21, &quot;I have a pen.&quot;);
  v22 = strncmp(&amp;v23, v21, 0xDu); // 1. 直接比较明文字符串与输入字符串
  if ( !v22 )
  {
    puts(&quot;Your password is correct.&quot;);
    if ( IsDebuggerPresent() == 1 )     // 2. API: IsDebuggerPresent()
    {
      puts(&quot;But detected debugger!&quot;);
      exit(1);
    }
    if ( sub_401120() == 0x70 )         // 3. 检测PEB的0x68偏移处是否为0x70. 检测NtGlobalFlag()
    {
      puts(&quot;But detected NtGlobalFlag!&quot;);
      exit(1);
    }

    /*  BOOL WINAPI CheckRemoteDebuggerPresent(
     *    _In_    HANDLE hProcess,
     *    _Inout_ PBOOL  pbDebuggerPresent
     *  );
     */
    v4 = GetCurrentProcess();
    CheckRemoteDebuggerPresent(v4, &amp;pbDebuggerPresent);
    if ( pbDebuggerPresent )            // 4. API: CheckRemoteDebuggerPresent()
    {
      printf(&quot;But detected remotedebug.\n&quot;);
      exit(1);
    }
    v13 = GetTickCount();
    for ( i = 0; i == 100; ++i )
      Sleep(1u);
    v16 = 1000;
    if ( GetTickCount() - v13 &gt; 1000 )  // 5. 检测时间差
    {
      printf(&quot;But detected debug.\n&quot;);
      exit(1);
    }
    lpFileName = &quot;\\\\.\\Global\\ProcmonDebugLogger&quot;;
    if ( CreateFileA(&quot;\\\\.\\Global\\ProcmonDebugLogger&quot;, 0x80000000, 7u, 0, 3u, 0x80u, 0) != (HANDLE)-1 )
    {
      printf(&quot;But detect %s.\n&quot;, &amp;lpFileName);      // 6. 检测ProcessMonitor
      exit(1);
    }
    v11 = sub_401130();     // 7. API: CreateToolhelp32Snapshot()检测进程
    if ( v11 == 1 )
    {
      printf(&quot;But detected Ollydbg.\n&quot;);
      exit(1);
    }
    if ( v11 == 2 )
    {
      printf(&quot;But detected ImmunityDebugger.\n&quot;);
      exit(1);
    }
    if ( v11 == 3 )
    {
      printf(&quot;But detected IDA.\n&quot;);
      exit(1);
    }
    if ( v11 == 4 )
    {
      printf(&quot;But detected WireShark.\n&quot;);
      exit(1);
    }
    if ( sub_401240() == 1 )    // 8. 通过vmware的I/O端口进行检测
    {
      printf(&quot;But detected VMware.\n&quot;);
      exit(1);
    }
    v17 = 1;
    v20 = 1;
    v12 = 0;
    v19 = 1 / 0;
    ms_exc.registration.TryLevel = -2;  // 9. SEH
    printf(&quot;But detected Debugged.\n&quot;);
    exit(1);
  }
  printf(&quot;password is wrong.\n&quot;);
  return 0;
}
</pre></div>
</div>
<p>我在代码里写了注释, 列出了其中所使用的9个保护技术部分.
我们来逐一分析一下吧.</p>
<div class="section" id="id1">
<h2>比较明文字符串<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<div class="code c highlight-default"><div class="highlight"><pre><span></span>printf(&quot;Input password &gt;&quot;);
v3 = (FILE *)sub_40223D();
fgets(&amp;v23, 64, v3);
strcpy(v21, &quot;I have a pen.&quot;);
v22 = strncmp(&amp;v23, v21, 0xDu); // 1. 直接比较明文字符串与输入字符串
if ( !v22 )  {
    ......
}
</pre></div>
</div>
<p>这里就是输出<code class="docutils literal"><span class="pre">Input</span> <span class="pre">password</span> <span class="pre">&gt;</span></code>.
然后用<code class="docutils literal"><span class="pre">fgets()</span></code>获取用户输入的字符串,
将<code class="docutils literal"><span class="pre">I</span> <span class="pre">have</span> <span class="pre">a</span> <span class="pre">pen.</span></code>复制到<code class="docutils literal"><span class="pre">v21</span></code>的缓冲区中,
然后用<code class="docutils literal"><span class="pre">strncmp</span></code>比对用户输入与<code class="docutils literal"><span class="pre">I</span> <span class="pre">have</span> <span class="pre">a</span> <span class="pre">pen.</span></code>的内容,
并将比较结果返回给<code class="docutils literal"><span class="pre">v22</span></code>. 以下会根据<code class="docutils literal"><span class="pre">v22</span></code>,
也就是根据输入的<code class="docutils literal"><span class="pre">password</span></code>是否正确, 而进行跳转.</p>
</div>
<div class="section" id="isdebuggerpresent">
<h2>IsDebuggerPresent()<a class="headerlink" href="#isdebuggerpresent" title="永久链接至标题">¶</a></h2>
<div class="code c highlight-default"><div class="highlight"><pre><span></span><span class="n">puts</span><span class="p">(</span><span class="s2">&quot;Your password is correct.&quot;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">IsDebuggerPresent</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>     <span class="o">//</span> <span class="mf">2.</span> <span class="n">API</span><span class="p">:</span> <span class="n">IsDebuggerPresent</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">puts</span><span class="p">(</span><span class="s2">&quot;But detected debugger!&quot;</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>显然, 输入的<code class="docutils literal"><span class="pre">password</span></code>正确,
就会输出提示<code class="docutils literal"><span class="pre">Your</span> <span class="pre">password</span> <span class="pre">is</span> <span class="pre">correct.</span></code>. ??? 不觉得奇怪吗.
难道<code class="docutils literal"><span class="pre">I</span> <span class="pre">have</span> <span class="pre">a</span> <span class="pre">pen.</span></code>就是我们的flag了吗? 不不不当然不是.
这其实是一个陷阱,
既然你知道了<code class="docutils literal"><span class="pre">I</span> <span class="pre">have</span> <span class="pre">a</span> <span class="pre">pen.</span></code>那么就肯定有通过某种逆向手段在对程序进行分析.
所以接下来的部分就开始进行一些反调试或其他的检测手段(实际中也可以出现这样的陷阱).</p>
<p>一开始的是<code class="docutils literal"><span class="pre">IsDebuggerPresent()</span></code>,
根据返回结果判断是否存在调试.如果不太清楚的话,
可以返回去看<a class="reference external" href="https://ctf-wiki.github.io/ctf-wiki/reverse/anti_debug/isdebuggerpresent.html">IsDebuggerPresent()篇</a></p>
</div>
<div class="section" id="ntglobalflag">
<h2>NtGlobalFlag<a class="headerlink" href="#ntglobalflag" title="永久链接至标题">¶</a></h2>
<p>接下来是检测<code class="docutils literal"><span class="pre">NtGlobalFlag</span></code>这个字段的标志位.
通过检测PEB的字段值是否为<code class="docutils literal"><span class="pre">0x70</span></code>来检测调试器, 如果不太清楚的话,
可以返回去看<a class="reference external" href="https://ctf-wiki.github.io/ctf-wiki/reverse/anti_debug/ntglobalflag.html">NtGlobalFlag篇</a></p>
<div class="code c highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="n">sub_401120</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0x70</span> <span class="p">)</span>         <span class="o">//</span> <span class="mf">3.</span> <span class="n">检测PEB的0x68偏移处是否为0x70</span><span class="o">.</span> <span class="n">检测NtGlobalFlag</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">puts</span><span class="p">(</span><span class="s2">&quot;But detected NtGlobalFlag!&quot;</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>那我们来简单看一下<code class="docutils literal"><span class="pre">sub_401120()</span></code>好了</p>
<div class="code c highlight-default"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">sub_401120</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">__readfsdword</span><span class="p">(</span><span class="mi">48</span><span class="p">)</span> <span class="o">+</span> <span class="mh">0x68</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x70</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">0x68</span></code>是PEB的<code class="docutils literal"><span class="pre">NtGlobalFlag</span></code>字段对应偏移值.
<code class="docutils literal"><span class="pre">0x70</span></code>是<code class="docutils literal"><span class="pre">FLG_HEAP_ENABLE_TAIL_CHECK</span> <span class="pre">(0x10)</span></code>,
<code class="docutils literal"><span class="pre">FLG_HEAP_ENABLE_FREE_CHECK</span> <span class="pre">(0x20)</span></code>
和<code class="docutils literal"><span class="pre">FLG_HEAP_VALIDATE_PARAMETERS</span> <span class="pre">(0x40)</span></code>这三个标志</p>
</div>
<div class="section" id="checkremotedebuggerpresent">
<h2>CheckRemoteDebuggerPresent<a class="headerlink" href="#checkremotedebuggerpresent" title="永久链接至标题">¶</a></h2>
<div class="code cpp highlight-default"><div class="highlight"><pre><span></span><span class="o">/*</span>  <span class="n">BOOL</span> <span class="n">WINAPI</span> <span class="n">CheckRemoteDebuggerPresent</span><span class="p">(</span>
 <span class="o">*</span>    <span class="n">_In_</span>    <span class="n">HANDLE</span> <span class="n">hProcess</span><span class="p">,</span>
 <span class="o">*</span>    <span class="n">_Inout_</span> <span class="n">PBOOL</span>  <span class="n">pbDebuggerPresent</span>
 <span class="o">*</span>  <span class="p">);</span>
 <span class="o">*/</span>
<span class="n">v4</span> <span class="o">=</span> <span class="n">GetCurrentProcess</span><span class="p">();</span>
<span class="n">CheckRemoteDebuggerPresent</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pbDebuggerPresent</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">pbDebuggerPresent</span> <span class="p">)</span>            <span class="o">//</span> <span class="mf">4.</span> <span class="n">API</span><span class="p">:</span> <span class="n">CheckRemoteDebuggerPresent</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;But detected remotedebug.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>这里我顺便在注释里列出了<code class="docutils literal"><span class="pre">CheckRemoteDebuggerPresent()</span></code>这个API的函数原型.
如果检测到调试器的存在, 会将<code class="docutils literal"><span class="pre">pbDebuggerPresent</span></code>设置为一个非零值.
根据其值检测调试器(<a class="reference external" href="https://ctf-wiki.github.io/ctf-wiki/reverse/anti_debug/checkremotedebuggerpresent.html">CheckRemoteDebuggerPresent()篇</a>)</p>
</div>
<div class="section" id="id2">
<h2>时间差检测<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<div class="code c highlight-default"><div class="highlight"><pre><span></span><span class="n">v13</span> <span class="o">=</span> <span class="n">GetTickCount</span><span class="p">();</span>
<span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">100</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>    <span class="o">//</span> <span class="n">睡眠</span>
    <span class="n">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="n">u</span><span class="p">);</span>
<span class="n">v16</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">GetTickCount</span><span class="p">()</span> <span class="o">-</span> <span class="n">v13</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="p">)</span>  <span class="o">//</span> <span class="mf">5.</span> <span class="n">检测时间差</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;But detected debug.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">GetTickCount</span></code>会返回启动到现在的毫秒数,
循环里光是<code class="docutils literal"><span class="pre">sleep(1)</span></code>就进行了100次, 也就是100毫秒.
两次得到的时间作差如果大于1000毫秒, 时差明显大于所耗的时间,
也就间接检测到了调试.</p>
</div>
<div class="section" id="processmonitor">
<h2>ProcessMonitor<a class="headerlink" href="#processmonitor" title="永久链接至标题">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">lpFileName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">Global</span><span class="se">\\</span><span class="s2">ProcmonDebugLogger&quot;</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">CreateFileA</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">Global</span><span class="se">\\</span><span class="s2">ProcmonDebugLogger&quot;</span><span class="p">,</span> <span class="mh">0x80000000</span><span class="p">,</span> <span class="mi">7</span><span class="n">u</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="n">u</span><span class="p">,</span> <span class="mh">0x80</span><span class="n">u</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">HANDLE</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;But detect </span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lpFileName</span><span class="p">);</span>      <span class="o">//</span> <span class="mf">6.</span> <span class="n">检测ProcessMonitor</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>这里通过检测设备文件<code class="docutils literal"><span class="pre">\\\\.\\Global\\ProcmonDebugLogger</span></code>来检测<code class="docutils literal"><span class="pre">ProcessMonitor</span></code></p>
</div>
<div class="section" id="id3">
<h2>检测进程名<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>这里通过执行<code class="docutils literal"><span class="pre">sub_401130()</span></code>函数来检测进程, 并根据检测到的不同进程,
返回相应的值.</p>
<div class="code c highlight-default"><div class="highlight"><pre><span></span><span class="n">v11</span> <span class="o">=</span> <span class="n">sub_401130</span><span class="p">();</span>     <span class="o">//</span> <span class="mf">7.</span> <span class="n">API</span><span class="p">:</span> <span class="n">CreateToolhelp32Snapshot</span><span class="p">()</span><span class="n">检测进程</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">v11</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;But detected Ollydbg.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">v11</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;But detected ImmunityDebugger.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">v11</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;But detected IDA.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span> <span class="n">v11</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;But detected WireShark.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>我们就来看一下<code class="docutils literal"><span class="pre">sub_401130()</span></code>函数</p>
<div class="code c highlight-default"><div class="highlight"><pre><span></span>signed int sub_401130()
{
  PROCESSENTRY32 pe; // [sp+0h] [bp-138h]@1
  HANDLE hSnapshot; // [sp+130h] [bp-8h]@1
  int i; // [sp+134h] [bp-4h]@1

  pe.dwSize = 296;
  memset(&amp;pe.cntUsage, 0, 0x124u);
  hSnapshot = CreateToolhelp32Snapshot(2u, 0);
  for ( i = Process32First(hSnapshot, &amp;pe); i == 1; i = Process32Next(hSnapshot, &amp;pe) )
  {
    if ( !_stricmp(pe.szExeFile, &quot;ollydbg.exe&quot;) )
      return 1;
    if ( !_stricmp(pe.szExeFile, &quot;ImmunityDebugger.exe&quot;) )
      return 2;
    if ( !_stricmp(pe.szExeFile, &quot;idaq.exe&quot;) )
      return 3;
    if ( !_stricmp(pe.szExeFile, &quot;Wireshark.exe&quot;) )
      return 4;
  }
  return 0;
}
</pre></div>
</div>
<p>这里使用了API: <code class="docutils literal"><span class="pre">CreateToolhelp32Snapshot</span></code>来获取当前的进程信息.
并在for循环里依次比对. 如果找到指定的进程名, 就直接返回相应的值.
然后根据返回值跳转到不同的分支里.</p>
</div>
<div class="section" id="vmware">
<h2>检测VMware<a class="headerlink" href="#vmware" title="永久链接至标题">¶</a></h2>
<p>检测VMware也是检测一些特征. 根据检测的结果进行判断.</p>
<div class="code c highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="n">sub_401240</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>    <span class="o">//</span> <span class="mf">8.</span> <span class="n">通过vmware的I</span><span class="o">/</span><span class="n">O端口进行检测</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;But detected VMware.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>来看<code class="docutils literal"><span class="pre">sub_401240()</span></code>函数.</p>
<div class="code c highlight-default"><div class="highlight"><pre><span></span><span class="n">signed</span> <span class="nb">int</span> <span class="n">sub_401240</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">unsigned</span> <span class="n">__int32</span> <span class="n">v0</span><span class="p">;</span> <span class="o">//</span> <span class="n">eax</span><span class="nd">@1</span>

  <span class="n">v0</span> <span class="o">=</span> <span class="n">__indword</span><span class="p">(</span><span class="mh">0x5658</span><span class="n">u</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>这是VMware的一个“后门”I/O端口, <code class="docutils literal"><span class="pre">0x5658</span> <span class="pre">=</span> <span class="pre">&quot;VX&quot;</span></code>.
如果程序在VMware内运行,
程序使用<code class="docutils literal"><span class="pre">In</span></code>指令通过<code class="docutils literal"><span class="pre">0x5658</span></code>端口读取数据时,
<code class="docutils literal"><span class="pre">EBX</span></code>寄存器的值就会变为<code class="docutils literal"><span class="pre">0x564D5868</span></code>(<code class="docutils literal"><span class="pre">0x564D5868</span> <span class="pre">==</span> <span class="pre">&quot;VMXh&quot;</span></code>)</p>
<p>看IDA反编译出的伪C代码并不很直观地体现这点, 我们看汇编代码就清楚了</p>
<div class="code asm highlight-default"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">0040127</span><span class="n">A</span>                 <span class="n">push</span>    <span class="n">edx</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">0040127</span><span class="n">B</span>                 <span class="n">push</span>    <span class="n">ecx</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">0040127</span><span class="n">C</span>                 <span class="n">push</span>    <span class="n">ebx</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">0040127</span><span class="n">D</span>                 <span class="n">mov</span>     <span class="n">eax</span><span class="p">,</span> <span class="mi">564</span><span class="n">D5868h</span>   <span class="o">//</span>  <span class="o">&lt;------</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00401282</span>                 <span class="n">mov</span>     <span class="n">ebx</span><span class="p">,</span> <span class="mi">0</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00401287</span>                 <span class="n">mov</span>     <span class="n">ecx</span><span class="p">,</span> <span class="mi">0</span><span class="n">Ah</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">0040128</span><span class="n">C</span>                 <span class="n">mov</span>     <span class="n">edx</span><span class="p">,</span> <span class="mi">5658</span><span class="n">h</span>   <span class="o">//</span>  <span class="o">&lt;------</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00401291</span>                 <span class="ow">in</span>      <span class="n">eax</span><span class="p">,</span> <span class="n">dx</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00401292</span>                 <span class="n">pop</span>     <span class="n">ebx</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00401293</span>                 <span class="n">pop</span>     <span class="n">ecx</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00401294</span>                 <span class="n">pop</span>     <span class="n">edx</span>
</pre></div>
</div>
<p>更多阅读: <a class="reference external" href="https://isc.sans.edu/diary/E-cards+don%3Ft+like+virtual+environments/3190">E-cards don?t like virtual
environments</a></p>
</div>
<div class="section" id="seh">
<h2>SEH<a class="headerlink" href="#seh" title="永久链接至标题">¶</a></h2>
<div class="code c highlight-default"><div class="highlight"><pre><span></span><span class="n">v17</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">v20</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">v12</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">v19</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span><span class="p">;</span>    <span class="o">//</span> <span class="mf">9.</span> <span class="n">SEH</span>
<span class="n">ms_exc</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">TryLevel</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
<span class="n">printf</span><span class="p">(</span><span class="s2">&quot;But detected Debugged.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>接下来这一段, 很奇怪不是吗. 这里<code class="docutils literal"><span class="pre">v19</span> <span class="pre">=</span> <span class="pre">1</span> <span class="pre">/</span> <span class="pre">0;</span></code>明显是不合常理的,
会产生一个除零异常.
而后面的<code class="docutils literal"><span class="pre">ms_exc.registration.TryLevel</span> <span class="pre">=</span> <span class="pre">-2;</span></code>这是解除异常,
<code class="docutils literal"><span class="pre">TryLevel=TRYLEVEL_NONE</span> <span class="pre">(-2)</span></code> . 来看汇编代码.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">004015</span><span class="n">B8</span>                 <span class="n">mov</span>     <span class="p">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">var_88</span><span class="p">],</span> <span class="mi">1</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">004015</span><span class="n">C2</span>                 <span class="n">mov</span>     <span class="p">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">var_7C</span><span class="p">],</span> <span class="mi">1</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">004015</span><span class="n">C9</span>                 <span class="n">mov</span>     <span class="p">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">var_9C</span><span class="p">],</span> <span class="mi">0</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">004015</span><span class="n">D3</span>                 <span class="n">mov</span>     <span class="p">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">ms_exc</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">TryLevel</span><span class="p">],</span> <span class="mi">0</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">004015</span><span class="n">DA</span>                 <span class="n">mov</span>     <span class="n">eax</span><span class="p">,</span> <span class="p">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">var_7C</span><span class="p">]</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">004015</span><span class="n">DD</span>                 <span class="n">cdq</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">004015</span><span class="n">DE</span>                 <span class="n">idiv</span>    <span class="p">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">var_9C</span><span class="p">]</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mf">004015E4</span>                 <span class="n">mov</span>     <span class="p">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">var_80</span><span class="p">],</span> <span class="n">eax</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mf">004015E7</span>                 <span class="n">mov</span>     <span class="p">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">ms_exc</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">TryLevel</span><span class="p">],</span> <span class="mi">0</span><span class="n">FFFFFFFEh</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">004015</span><span class="n">EE</span>                 <span class="n">jmp</span>     <span class="n">short</span> <span class="n">loc_40160A</span>
</pre></div>
</div>
<p>在这里的<code class="docutils literal"><span class="pre">idiv</span> <span class="pre">[ebp+var_9C]</span></code>触发异常后就由程序注册的异常处理函数接管,
而如果没有在异常处理程序入口设下断点的话, 程序就容易跑飞.</p>
</div>
<div class="section" id="flag">
<h2>获取flag<a class="headerlink" href="#flag" title="永久链接至标题">¶</a></h2>
<p>但整个看下了. 怎么感觉关flag一点事都没有了呢?
还有没有记起之前在字符串窗口看到的疑似是那个待解密的flag的字符串?
实际上由于IDA反编译的限制, 使得反编译出的伪C代码并不正确.
比如在最后一段的<code class="docutils literal"><span class="pre">printf(&quot;But</span> <span class="pre">detected</span> <span class="pre">Debugged.\n&quot;);</span></code>这里,
我们来看具体的汇编代码.</p>
<div class="code asm highlight-default"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00401627</span>                 <span class="n">call</span>    <span class="n">sub_4012E0</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">0040162</span><span class="n">C</span>                 <span class="n">movzx</span>   <span class="n">eax</span><span class="p">,</span> <span class="n">ax</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">0040162</span><span class="n">F</span>                 <span class="n">mov</span>     <span class="p">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">var_A8</span><span class="p">],</span> <span class="n">eax</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00401635</span>                 <span class="nb">cmp</span>     <span class="p">[</span><span class="n">ebp</span><span class="o">+</span><span class="n">var_A8</span><span class="p">],</span> <span class="mi">0</span>      <span class="o">//</span> <span class="o">&lt;------</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">0040163</span><span class="n">C</span>                 <span class="n">jz</span>      <span class="n">short</span> <span class="n">loc_401652</span>     <span class="o">//</span> <span class="o">&lt;------</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">0040163</span><span class="n">E</span>                 <span class="n">push</span>    <span class="n">offset</span> <span class="n">aButDetectedD_2</span> <span class="p">;</span> <span class="s2">&quot;But detected Debugged.</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00401643</span>                 <span class="n">call</span>    <span class="n">_printf</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">00401648</span>                 <span class="n">add</span>     <span class="n">esp</span><span class="p">,</span> <span class="mi">4</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">0040164</span><span class="n">B</span>                 <span class="n">push</span>    <span class="mi">1</span>               <span class="p">;</span> <span class="nb">int</span>
<span class="o">.</span><span class="n">text</span><span class="p">:</span><span class="mi">0040164</span><span class="n">D</span>                 <span class="n">call</span>    <span class="n">_exit</span>
</pre></div>
</div>
<p>实际上这一段代码并没有被IDA反编译出来.
而<code class="docutils literal"><span class="pre">loc_401652</span></code>位置则是一串代码,
亮点在于使用了一个<code class="docutils literal"><span class="pre">MessageBoxA</span></code>的函数.
而且函数参数之一就是我们的待解密flag.
那么我们就可以在输入<code class="docutils literal"><span class="pre">I</span> <span class="pre">have</span> <span class="pre">a</span> <span class="pre">pen.</span></code>后,
在<code class="docutils literal"><span class="pre">if</span> <span class="pre">(</span> <span class="pre">!v22</span> <span class="pre">)</span></code>跳转的汇编代码部分,
将其手动改为跳转到flag解密及弹出<code class="docutils literal"><span class="pre">messagebox</span></code>的部分运行,
让程序自己帮忙解密并输出, 就可以了.</p>
<p>操作如下图所示:</p>
<div class="figure" id="id6">
<img alt="jmp.png" src="../../_images/jmp.png" />
<p class="caption"><span class="caption-text">jmp.png</span></p>
</div>
<p>这里是输入<code class="docutils literal"><span class="pre">I</span> <span class="pre">have</span> <span class="pre">a</span> <span class="pre">pen.</span></code>后的跳转部分, 因为正常跳转到的部分,
全是一些检测调试的内容, 所以我们直接跳到代码解密的部分.
也就是<code class="docutils literal"><span class="pre">00401663</span></code>的位置.</p>
<div class="figure" id="id7">
<img alt="target.png" src="../../_images/target.png" />
<p class="caption"><span class="caption-text">target.png</span></p>
</div>
<p>在<code class="docutils literal"><span class="pre">00401663</span></code>以上的<code class="docutils literal"><span class="pre">mov-cmp-jnz</span></code>也是一个验证部分, 就不管了,
直接跳到<code class="docutils literal"><span class="pre">00401663</span></code>这里的<code class="docutils literal"><span class="pre">mov</span> <span class="pre">ecx,</span> <span class="pre">7</span></code>这里运行解密代码,
并顺着执行<code class="docutils literal"><span class="pre">MessageBoxA()</span></code>弹出消息框, 拿到flag</p>
<div class="figure" id="id8">
<img alt="flag.png" src="../../_images/flag.png" />
<p class="caption"><span class="caption-text">flag.png</span></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>快速搜索</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="转向" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div class="sphinx-toc sphinxglobaltoc">
<h3><a href="../../index.html">內容目录</a></h3>
<p class="caption"><span class="caption-text">CTF 介绍</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/history.html">CTF 竞赛的历史</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/mode.html">CTF 竞赛模式简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/content.html">CTF 竞赛内容</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/experience.html">线下攻防经验小结</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/cgc.html">CGC 网络超级挑战赛</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction/resources.html">学习资源</a></li>
</ul>
<p class="caption"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../misc/about.html">杂项简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/recon.html">信息搜集技术</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/encode/index.html">编码分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/prefix.html">取证隐写</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/picture/index.html">图片分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/traffic/index.html">流量包分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/archive/index.html">压缩包分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/audio/index.html">音频分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/disk_memory/index.html">磁盘 / 内存分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/others.html">其他</a></li>
</ul>
<p class="caption"><span class="caption-text">Crypto</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/introduction.html">密码学简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/classical/index.html">古典密码</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/symmetric/index.html">对称加密</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/asymmetric/index.html">非对称密码</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/hash/index.html">哈希函数</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/signature/index.html">数字签名</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/others/others.html">证书格式</a></li>
</ul>
<p class="caption"><span class="caption-text">Web</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../web/index.html">WEB 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/sqli.html">SQL 注入</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/xss.html">XSS 跨站脚本攻击</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/csrf.html">CSRF 跨站请求伪造</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/ssrf.html">SSRF 服务端请求伪造</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/php.html">PHP 代码审计</a></li>
</ul>
<p class="caption"><span class="caption-text">Reverse</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">软件逆向工程简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unpack/index.html">Unpack Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unicorn/index.html">Unicorn Engine</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Anti Debug Tech</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ntglobalflag.html">NtGlobalFlag</a></li>
<li class="toctree-l2"><a class="reference internal" href="heap_flags.html">Heap flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="the_heap.html">The Heap</a></li>
<li class="toctree-l2"><a class="reference internal" href="int_3.html">Interrupt 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="isdebuggerpresent.html">IsDebuggerPresent</a></li>
<li class="toctree-l2"><a class="reference internal" href="checkremotedebuggerpresent.html">CheckRemoteDebuggerPresent</a></li>
<li class="toctree-l2"><a class="reference internal" href="ntqueryinformationprocess.html">NtQueryInformationProcess</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Anti debug的例题</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">比较明文字符串</a></li>
<li class="toctree-l3"><a class="reference internal" href="#isdebuggerpresent">IsDebuggerPresent()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ntglobalflag">NtGlobalFlag</a></li>
<li class="toctree-l3"><a class="reference internal" href="#checkremotedebuggerpresent">CheckRemoteDebuggerPresent</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">时间差检测</a></li>
<li class="toctree-l3"><a class="reference internal" href="#processmonitor">ProcessMonitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">检测进程名</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vmware">检测VMware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#seh">SEH</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flag">获取flag</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../linux/index.html">Linux RE</a></li>
</ul>
<p class="caption"><span class="caption-text">Pwn</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pwn/stackoverflow/index.html">栈溢出</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pwn/fmtstr/index.html">格式化字符串漏洞</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pwn/heap/index.html">堆利用</a></li>
</ul>
<p class="caption"><span class="caption-text">Executable</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../executable/elf/index.html">ELF文件</a></li>
</ul>
</div>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../index.html" title="內容目录"
             >toc</a></li>
        <li class="right" >
          <a href="../linux/index.html" title="Linux RE"
             >下一页</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="ntqueryinformationprocess.html" title="NtQueryInformationProcess"
             >上一页</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">CTF Wiki </a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >Anti Debug Tech</a> &#187;</li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2017, CTF Wiki.
      由 <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7 创建。
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>