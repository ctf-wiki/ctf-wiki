

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ç»¼åˆé¢˜ç›® &mdash; CTF Wiki  æ–‡æ¡£</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="ç´¢å¼•"
              href="../../../genindex.html"/>
        <link rel="search" title="æœç´¢" href="../../../search.html"/>
    <link rel="top" title="CTF Wiki  æ–‡æ¡£" href="../../../index.html"/>
        <link rel="up" title="RSA" href="rsa_index.html"/>
        <link rel="next" title="èƒŒåŒ…åŠ å¯†" href="../knapsack/knapsack_intro.html"/>
        <link rel="prev" title="Bleichenbacherâ€™s attack" href="rsa_pkcs_attack.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> CTF Wiki
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">CTF ä»‹ç»</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/history.html">CTF ç«èµ›çš„å†å²</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/mode.html">CTF ç«èµ›æ¨¡å¼ç®€ä»‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/content.html">CTF ç«èµ›å†…å®¹</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/experience.html">çº¿ä¸‹æ”»é˜²ç»éªŒå°ç»“</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/cgc.html">CGC ç½‘ç»œè¶…çº§æŒ‘æˆ˜èµ›</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/resources.html">å­¦ä¹ èµ„æº</a></li>
</ul>
<p class="caption"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/recon.html">ä¿¡æ¯æœé›†æŠ€æœ¯</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/encode/index.html">ç¼–ç åˆ†æ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/picture/index.html">å›¾ç‰‡åˆ†æ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/archive/index.html">å‹ç¼©åŒ…åˆ†æ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/audio/index.html">éŸ³é¢‘åˆ†æ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/disk_memory/index.html">ç£ç›˜ / å†…å­˜åˆ†æ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/cap.html">æµé‡åˆ†æ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/others.html">å…¶ä»–</a></li>
</ul>
<p class="caption"><span class="caption-text">Crypto</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">å¯†ç å­¦ç®€ä»‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../classical/index.html">å¤å…¸å¯†ç </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symmetric/index.html">å¯¹ç§°åŠ å¯†</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">éå¯¹ç§°å¯†ç </a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="rsa_index.html">RSA</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="rsa_theory.html">RSA åŸºæœ¬ä»‹ç»</a></li>
<li class="toctree-l3"><a class="reference internal" href="rsa_module_attack.html">æ¨¡æ•°</a></li>
<li class="toctree-l3"><a class="reference internal" href="rsa_e_attack.html">å…¬é’¥æŒ‡æ•°æ”»å‡»</a></li>
<li class="toctree-l3"><a class="reference internal" href="rsa_d_attack.html">ç§é’¥ d æ”»å‡»</a></li>
<li class="toctree-l3"><a class="reference internal" href="rsa_chosen_cipher.html">é€‰æ‹©å¯†æ–‡æ”»å‡»</a></li>
<li class="toctree-l3"><a class="reference internal" href="rsa_coppersmith_attack.html">Coppersmith Related Attack</a></li>
<li class="toctree-l3"><a class="reference internal" href="rsa_side_channel.html">ä¾§ä¿¡é“æ”»å‡»</a></li>
<li class="toctree-l3"><a class="reference internal" href="rsa_pkcs_attack.html">Bleichenbacherâ€™s attack</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">ç»¼åˆé¢˜ç›®</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">ä¾‹ 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">ä¾‹ 2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">ä¾‹3</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../knapsack/knapsack_intro.html">èƒŒåŒ…åŠ å¯†</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discrete_log/discrete_log_intro.html">ç¦»æ•£å¯¹æ•°ç›¸å…³</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../hash/index.html">å“ˆå¸Œå‡½æ•°</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../signature/index.html">æ•°å­—ç­¾å</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../others/others.html">è¯ä¹¦æ ¼å¼</a></li>
</ul>
<p class="caption"><span class="caption-text">Web</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../web/index.html">WEB ç®€ä»‹</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/sqli.html">SQL æ³¨å…¥</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/xss.html">XSS è·¨ç«™è„šæœ¬æ”»å‡»</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/csrf.html">CSRF è·¨ç«™è¯·æ±‚ä¼ªé€ </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/ssrf.html">SSRF æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/php.html">PHP ä»£ç å®¡è®¡</a></li>
</ul>
<p class="caption"><span class="caption-text">Reverse</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reverse/index.html">Reverse Engineering</a></li>
</ul>
<p class="caption"><span class="caption-text">Pwn</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../pwn/stackoverflow/index.html">æ ˆæº¢å‡º</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pwn/fmtstr/index.html">æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pwn/heap/index.html">å †åˆ©ç”¨</a></li>
</ul>
<p class="caption"><span class="caption-text">Executable</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../executable/elf/index.html">ELFæ–‡ä»¶</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">CTF Wiki</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">éå¯¹ç§°å¯†ç </a> &raquo;</li>
        
          <li><a href="rsa_index.html">RSA</a> &raquo;</li>
        
      <li>ç»¼åˆé¢˜ç›®</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/crypto/asymmetric/rsa/rsa_complex.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>ç»¼åˆé¢˜ç›®<a class="headerlink" href="#id1" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h1>
<div class="section" id="id2">
<h2>ä¾‹ 1<a class="headerlink" href="#id2" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>è¿™é‡Œæˆ‘ä»¬ä»¥ASIS 2016 çº¿ä¸Šèµ›ä¸­Find the flagä¸ºä¾‹è¿›è¡Œä»‹ç»ã€‚</p>
<p>æ–‡ä»¶è§£å‹å‡ºæ¥ï¼Œæœ‰ä¸€ä¸ªå¯†æ–‡ï¼Œä¸€ä¸ªå…¬é’¥ï¼Œä¸€ä¸ª py è„šæœ¬ã€‚çœ‹ä¸€ä¸‹å…¬é’¥ã€‚</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>âœ  RSA openssl rsa -pubin -in pubkey.pem -text -modulus
Public-Key: (256 bit)
Modulus:
    00:d8:e2:4c:12:b7:b9:9e:fe:0a:9b:c0:4a:6a:3d:
    f5:8a:2a:94:42:69:b4:92:b7:37:6d:f1:29:02:3f:
    20:61:b9
Exponent: 12405943493775545863 (0xac2ac3e0ca0f5607)
Modulus=D8E24C12B7B99EFE0A9BC04A6A3DF58A2A944269B492B7376DF129023F2061B9
</pre></div>
</div>
<p>è¿™ä¹ˆå°çš„ä¸€ä¸ª <span class="math">\(N\)</span> ï¼Œå…ˆåˆ†è§£ä¸€ä¸‹ã€‚</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="mi">311155972145869391293781528370734636009</span>
<span class="n">q</span> <span class="o">=</span> <span class="mi">315274063651866931016337573625089033553</span>
</pre></div>
</div>
<p>å†çœ‹ç»™çš„ py è„šæœ¬ã€‚</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="kn">import</span> <span class="nn">gmpy</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="k">import</span> <span class="n">RSA</span>
<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="k">import</span> <span class="n">PKCS1_v1_5</span>

<span class="n">flag</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">*</span> <span class="mi">30</span>

<span class="k">def</span> <span class="nf">ext_rsa_encrypt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
            <span class="n">pubkey</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">((</span><span class="n">long</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">long</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">PKCS1_v1_5</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">pubkey</span><span class="p">)</span>
            <span class="n">enc</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;base64&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">enc</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">gmpy</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">q</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">gmpy</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="n">q</span><span class="p">)</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">gmpy</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
<span class="n">pubkey</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">((</span><span class="n">long</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">long</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;pubkey.pem&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pubkey</span><span class="o">.</span><span class="n">exportKey</span><span class="p">())</span>
<span class="n">g</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag.enc&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ext_rsa_encrypt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">flag</span><span class="p">))</span>
</pre></div>
</div>
<p>é€»è¾‘å¾ˆç®€å•ï¼Œè¯»å– flagï¼Œé‡å¤ 30 éä¸ºå¯†æ–‡ã€‚éšæœºå– <span class="math">\(p\)</span> å’Œ
<span class="math">\(q\)</span> ï¼Œç”Ÿæˆä¸€ä¸ªå…¬é’¥ï¼Œå†™å…¥ <code class="docutils literal"><span class="pre">pubkey.pem</span></code> ï¼Œå†ç”¨è„šæœ¬ä¸­çš„
<code class="docutils literal"><span class="pre">ext_rsa_encrypt</span></code> å‡½æ•°è¿›è¡ŒåŠ å¯†ï¼Œæœ€åå°†å¯†æ–‡å†™å…¥ <code class="docutils literal"><span class="pre">flag.enc</span></code> ã€‚</p>
<p>å°è¯•ä¸€ä¸‹è§£å¯†ï¼Œæç¤ºå¯†æ–‡è¿‡é•¿ï¼Œå†çœ‹åŠ å¯†å‡½æ•°ï¼ŒåŸæ¥å½“åŠ å¯†å¤±è´¥æ—¶ï¼Œå‡½æ•°ä¼šè·³åˆ°å¼‚å¸¸å¤„ç†ï¼Œä»¥ä¸€å®šç®—æ³•é‡æ–°å–æ›´å¤§çš„
<span class="math">\(p\)</span> å’Œ <span class="math">\(q\)</span> ï¼Œç›´åˆ°åŠ å¯†æˆåŠŸã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬åªè¦ä¹Ÿå†™ä¸€ä¸ªç›¸åº”çš„è§£å¯†å‡½æ•°å³å¯ã€‚</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="kn">import</span> <span class="nn">gmpy</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="k">import</span> <span class="n">RSA</span>
<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="k">import</span> <span class="n">PKCS1_v1_5</span>

<span class="k">def</span> <span class="nf">ext_rsa_decrypt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
            <span class="n">privatekey</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">((</span><span class="n">long</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">long</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">long</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">long</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">long</span><span class="p">(</span><span class="n">q</span><span class="p">)))</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">PKCS1_v1_5</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">privatekey</span><span class="p">)</span>
            <span class="n">de_error</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">enc</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;base64&#39;</span><span class="p">),</span> <span class="n">de_error</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">enc</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="nb">print</span> <span class="n">error</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">gmpy</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">q</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">gmpy</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="n">q</span><span class="p">)</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">gmpy</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">p</span> <span class="o">=</span> <span class="mi">311155972145869391293781528370734636009</span>
<span class="n">q</span> <span class="o">=</span> <span class="mi">315274063651866931016337573625089033553</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">12405943493775545863</span>
<span class="c1"># pubkey = RSA.construct((long(n), long(e)))</span>
<span class="c1"># f = open(&#39;pubkey.pem&#39;, &#39;w&#39;)</span>
<span class="c1"># f.write(pubkey.exportKey())</span>
<span class="n">g</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag.enc&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">msg</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">flag</span> <span class="o">=</span> <span class="n">ext_rsa_decrypt</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">flag</span>
</pre></div>
</div>
<p>æ‹¿åˆ° flag</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ASIS{F4ct0R__N_by_it3rat!ng!}
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>ä¾‹ 2<a class="headerlink" href="#id3" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>è¿™é‡Œæˆ‘ä»¬ä»¥SCTF RSA1ä¸ºä¾‹è¿›è¡Œä»‹ç»ï¼Œé¦–å…ˆè§£å‹å‹ç¼©åŒ…åï¼Œå¾—åˆ°å¦‚ä¸‹æ–‡ä»¶</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>âœ  level0 git:(master) âœ— ls -al
æ€»ç”¨é‡ 4
drwxrwxrwx 1 root root    0 7æœˆ  30 16:36 .
drwxrwxrwx 1 root root    0 7æœˆ  30 16:34 ..
-rwxrwxrwx 1 root root  349 5æœˆ   2  2016 level1.passwd.enc
-rwxrwxrwx 1 root root 2337 5æœˆ   6  2016 level1.zip
-rwxrwxrwx 1 root root  451 5æœˆ   2  2016 public.key
</pre></div>
</div>
<p>å°è¯•è§£å‹ç¼©äº†ä¸€ä¸‹level1.zipå‘ç°éœ€è¦å¯†ç ã€‚ç„¶åæ ¹æ®level1.passwd.encå¯çŸ¥ï¼Œåº”è¯¥æ˜¯æˆ‘ä»¬éœ€è¦è§£å¯†è¿™ä¸ªæ–‡ä»¶æ‰èƒ½å¾—åˆ°å¯¹åº”çš„å¯†ç ã€‚æŸ¥çœ‹å…¬é’¥</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>âœ  level0 git:(master) âœ— openssl rsa -pubin -in public.key -text -modulus
Public-Key: (2048 bit)
Modulus:
    00:94:a0:3e:6e:0e:dc:f2:74:10:52:ef:1e:ea:a8:
    89:d6:f9:8d:01:11:51:db:5e:90:92:48:fd:39:0c:
    70:87:24:d8:98:3c:f3:33:1c:ba:c5:61:c2:ce:2c:
    5a:f1:5e:65:b2:b2:46:91:56:b6:19:d5:d3:b2:a6:
    bb:a3:7d:56:93:99:4d:7e:4c:2f:aa:60:7b:3e:c8:
    fc:90:b2:00:62:4b:53:18:5b:a2:30:10:60:a8:21:
    ab:61:57:d7:e7:cc:67:1b:4d:cd:66:4c:7d:f1:1a:
    2a:1d:5e:50:80:c1:5e:45:12:3a:ba:4a:53:64:d8:
    72:1f:84:4a:ae:5c:55:02:e8:8e:56:4d:38:70:a5:
    16:36:d3:bc:14:3e:2f:ae:2f:31:58:ba:00:ab:ac:
    c0:c5:ba:44:3c:29:70:56:01:6b:57:f5:d7:52:d7:
    31:56:0b:ab:0a:e6:8d:ad:08:22:a9:1f:cb:6e:49:
    cc:01:4c:12:d2:ab:a3:a5:97:e5:10:49:19:7f:69:
    d9:3b:c5:53:53:71:00:18:60:cc:69:1a:06:64:3b:
    86:94:70:a9:da:82:fc:54:6b:06:23:43:2d:b0:20:
    eb:b6:1b:91:35:5e:53:a6:e5:d8:9a:84:bb:30:46:
    b8:9f:63:bc:70:06:2d:59:d8:62:a5:fd:5c:ab:06:
    68:81
Exponent: 65537 (0x10001)
Modulus=94A03E6E0EDCF2741052EF1EEAA889D6F98D011151DB5E909248FD390C708724D8983CF3331CBAC561C2CE2C5AF15E65B2B2469156B619D5D3B2A6BBA37D5693994D7E4C2FAA607B3EC8FC90B200624B53185BA2301060A821AB6157D7E7CC671B4DCD664C7DF11A2A1D5E5080C15E45123ABA4A5364D8721F844AAE5C5502E88E564D3870A51636D3BC143E2FAE2F3158BA00ABACC0C5BA443C297056016B57F5D752D731560BAB0AE68DAD0822A91FCB6E49CC014C12D2ABA3A597E51049197F69D93BC5535371001860CC691A06643B869470A9DA82FC546B0623432DB020EBB61B91355E53A6E5D89A84BB3046B89F63BC70062D59D862A5FD5CAB066881
writing RSA key
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAlKA+bg7c8nQQUu8e6qiJ
1vmNARFR216Qkkj9OQxwhyTYmDzzMxy6xWHCzixa8V5lsrJGkVa2GdXTsqa7o31W
k5lNfkwvqmB7Psj8kLIAYktTGFuiMBBgqCGrYVfX58xnG03NZkx98RoqHV5QgMFe
RRI6ukpTZNhyH4RKrlxVAuiOVk04cKUWNtO8FD4vri8xWLoAq6zAxbpEPClwVgFr
V/XXUtcxVgurCuaNrQgiqR/LbknMAUwS0qujpZflEEkZf2nZO8VTU3EAGGDMaRoG
ZDuGlHCp2oL8VGsGI0MtsCDrthuRNV5TpuXYmoS7MEa4n2O8cAYtWdhipf1cqwZo
gQIDAQAB
-----END PUBLIC KEY-----
</pre></div>
</div>
<p>å‘ç°è™½ç„¶è¯´æ˜¯2048ä½ï¼Œä½†æ˜¯æ˜¾ç„¶æ¨¡æ•°æ²¡æœ‰é‚£ä¹ˆé•¿ï¼Œå°è¯•åˆ†è§£ä¸‹ï¼Œå¾—åˆ°</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">=</span><span class="mi">250527704258269</span>
<span class="n">q</span><span class="o">=</span><span class="mi">74891071972884336452892671945839935839027130680745292701175368094445819328761543101567760612778187287503041052186054409602799660254304070752542327616415127619185118484301676127655806327719998855075907042722072624352495417865982621374198943186383488123852345021090112675763096388320624127451586578874243946255833495297552979177208715296225146999614483257176865867572412311362252398105201644557511678179053171328641678681062496129308882700731534684329411768904920421185529144505494827908706070460177001921614692189821267467546120600239688527687872217881231173729468019623441005792563703237475678063375349</span>
</pre></div>
</div>
<p>ç„¶åå°±å¯ä»¥æ„é€ ï¼Œå¹¶ä¸”è§£å¯†ï¼Œä»£ç å¦‚ä¸‹</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="k">import</span> <span class="n">RSA</span>
<span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="k">import</span> <span class="n">b64decode</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">250527704258269</span>
<span class="n">q</span> <span class="o">=</span> <span class="mi">74891071972884336452892671945839935839027130680745292701175368094445819328761543101567760612778187287503041052186054409602799660254304070752542327616415127619185118484301676127655806327719998855075907042722072624352495417865982621374198943186383488123852345021090112675763096388320624127451586578874243946255833495297552979177208715296225146999614483257176865867572412311362252398105201644557511678179053171328641678681062496129308882700731534684329411768904920421185529144505494827908706070460177001921614692189821267467546120600239688527687872217881231173729468019623441005792563703237475678063375349</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>


<span class="k">def</span> <span class="nf">getprivatekey</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="n">phin</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phin</span><span class="p">)</span>
    <span class="n">priviatekey</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">((</span><span class="n">long</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">long</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">long</span><span class="p">(</span><span class="n">d</span><span class="p">)))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;private.pem&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">priviatekey</span><span class="o">.</span><span class="n">exportKey</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">decrypt</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./level1.passwd.enc&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">cipher</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">b64decode</span><span class="p">(</span><span class="n">cipher</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./private.pem&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">importKey</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">key</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">cipher</span><span class="p">)</span>


<span class="c1">#getprivatekey(n, e, p, q)</span>
<span class="n">decrypt</span><span class="p">()</span>
</pre></div>
</div>
<p>å‘ç°ä¸å¯¹</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>âœ  level0 git:(master) âœ— python exp.py
aï¿½*ï¿½Ø Oï¿½=ï¿½MKï¿½&amp;E=ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½)ï¿½
</pre></div>
</div>
<p>ï¿½ï¿½Û±â€™ï¶“ï¿½ï¿½uï¿½ï¿½ï¿½ï¿½BGï¿½0ï¿½6ï¿½&#64;iï¿½ï¿½ï¿½zaï¿½â€™ ï¿½ï¿½ï¿½yï¿½ï¿½ï¿½tÒƒNjï¿½ï¿½ï¿½WKï¿½ï¿½â€™R.Ø                                ï¿½dï¿½ï¿½ï¿½ï¿½ï¿½ï¿½8Şˆï¿½ï¿½ï¿½)}jâ€˜6kGï¿½Dwu&gt;ï¿½Vï¿½ï¿½ï¿½ï¿½?:3oï¿½uï¿½ï¿½Trï¿½ï¿½ï¿½ï¿½ï¿½Fï¿½ï¿½ï¿½lï¿½ï¿½0Bpâ€™Z&lt;ï¿½tbï¿½wï¿½ï¿½eï¿½ï¿½ï¿½y_lNh3Bï¿½ï¿½ï¿½ï¿½fï¿½bT{6ï¿½ï¿½ï¿½ï¿½9!ï¿½z$6</p>
<p>è¿™æ—¶å€™å°±è¦è€ƒè™‘å…¶ä»–æƒ…å†µäº†ï¼Œä¸€èˆ¬æ¥è¯´ç°å®ä¸­å®ç°çš„RSAéƒ½ä¸ä¼šç›´æ¥ç”¨åŸç”Ÿçš„RSAï¼Œéƒ½ä¼šåŠ ä¸€äº›å¡«å……æ¯”å¦‚OAEPï¼Œæˆ‘ä»¬è¿™é‡Œè¯•è¯•ï¼Œä¿®æ”¹ä»£ç </p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">decrypt1</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./level1.passwd.enc&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">cipher</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">b64decode</span><span class="p">(</span><span class="n">cipher</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./private.pem&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">importKey</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">PKCS1_OAEP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">key</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">cipher</span><span class="p">)</span>
</pre></div>
</div>
<p>æœç„¶å¦‚æ­¤ï¼Œå¾—åˆ°</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>âœ  level0 git:(master) âœ— python exp.py
FaC5ori1ati0n_aTTA3k_p_tOO_sma11
</pre></div>
</div>
<p>å¾—åˆ°è§£å‹å¯†ç ã€‚ç»§ç»­ï¼ŒæŸ¥çœ‹level1ä¸­çš„å…¬é’¥</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>âœ  level1 git:(master) âœ— openssl rsa -pubin -in public.key -text -modulus
Public-Key: (2048 bit)
Modulus:
    00:c3:26:59:69:e1:ed:74:d2:e0:b4:9a:d5:6a:7c:
    2f:2a:9e:c3:71:ff:13:4b:10:37:c0:6f:56:19:34:
    c5:cb:1f:6d:c0:e3:57:3b:47:c4:76:3e:21:a3:b0:
    11:11:78:d4:ee:4f:e8:99:2b:15:cb:cb:d7:73:e4:
    f9:a6:28:20:fd:db:8c:ea:16:ed:67:c2:48:12:6e:
    4b:01:53:4a:67:cb:22:23:3b:34:2e:af:13:ef:93:
    45:16:2b:00:9f:e0:4b:d1:90:c9:2c:27:9a:34:c3:
    3f:d7:ee:40:f5:82:50:39:aa:8c:e9:c2:7b:f4:36:
    e3:38:9d:04:50:db:a9:b7:3f:4b:2a:d6:8a:2a:5c:
    87:2a:eb:74:35:98:6a:9c:e4:52:cb:93:78:d2:da:
    39:83:f3:0c:d1:65:1e:66:9c:40:56:06:0d:58:fc:
    41:64:5e:06:da:83:d0:3b:06:42:70:da:38:53:e0:
    54:35:53:ce:de:79:4a:bf:f5:3b:e5:53:7f:6c:18:
    12:67:a9:de:37:7d:44:65:5e:68:0a:78:39:3d:bb:
    00:22:35:0e:a3:94:e6:94:15:1a:3d:39:c7:50:0e:
    b1:64:a5:29:a3:69:41:40:69:94:b0:0d:1a:ea:9a:
    12:27:50:ee:1e:3a:19:b7:29:70:b4:6d:1e:9d:61:
    3e:7d
Exponent: 65537 (0x10001)
Modulus=C3265969E1ED74D2E0B49AD56A7C2F2A9EC371FF134B1037C06F561934C5CB1F6DC0E3573B47C4763E21A3B0111178D4EE4FE8992B15CBCBD773E4F9A62820FDDB8CEA16ED67C248126E4B01534A67CB22233B342EAF13EF9345162B009FE04BD190C92C279A34C33FD7EE40F5825039AA8CE9C27BF436E3389D0450DBA9B73F4B2AD68A2A5C872AEB7435986A9CE452CB9378D2DA3983F30CD1651E669C4056060D58FC41645E06DA83D03B064270DA3853E0543553CEDE794ABFF53BE5537F6C181267A9DE377D44655E680A78393DBB0022350EA394E694151A3D39C7500EB164A529A36941406994B00D1AEA9A122750EE1E3A19B72970B46D1E9D613E7D
writing RSA key
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwyZZaeHtdNLgtJrVanwv
Kp7Dcf8TSxA3wG9WGTTFyx9twONXO0fEdj4ho7AREXjU7k/omSsVy8vXc+T5pigg
/duM6hbtZ8JIEm5LAVNKZ8siIzs0Lq8T75NFFisAn+BL0ZDJLCeaNMM/1+5A9YJQ
OaqM6cJ79DbjOJ0EUNuptz9LKtaKKlyHKut0NZhqnORSy5N40to5g/MM0WUeZpxA
VgYNWPxBZF4G2oPQOwZCcNo4U+BUNVPO3nlKv/U75VN/bBgSZ6neN31EZV5oCng5
PbsAIjUOo5TmlBUaPTnHUA6xZKUpo2lBQGmUsA0a6poSJ1DuHjoZtylwtG0enWE+
fQIDAQAB
-----END PUBLIC KEY-----
</pre></div>
</div>
<p>ä¼¼ä¹è¿˜æ˜¯ä¸æ˜¯å¾ˆå¤§ï¼Œå†æ¬¡åˆ†è§£ï¼Œç„¶åè¯•äº†factordbä¸è¡Œï¼Œè¯•è¯•yafuã€‚ç»“æœåˆ†è§£å‡ºæ¥äº†ã€‚</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">P309</span> <span class="o">=</span> <span class="mi">156956618844706820397012891168512561016172926274406409351605204875848894134762425857160007206769208250966468865321072899370821460169563046304363342283383730448855887559714662438206600780443071125634394511976108979417302078289773847706397371335621757603520669919857006339473738564640521800108990424511408496383</span>

<span class="n">P309</span> <span class="o">=</span> <span class="mi">156956618844706820397012891168512561016172926274406409351605204875848894134762425857160007206769208250966468865321072899370821460169563046304363342283383730448855887559714662438206600780443071125634394511976108979417302078289773847706397371335621757603520669919857006339473738564640521800108990424511408496259</span>
</pre></div>
</div>
<p>å¯ä»¥å‘ç°è¿™ä¸¤ä¸ªæ•°éå¸¸ç›¸è¿‘ï¼Œå¯èƒ½æ˜¯factordbæ²¡æœ‰å®ç°è¿™ç±»åˆ†è§£ã€‚</p>
<p>ç»§è€Œä¸‹é¢çš„æ“ä½œç±»ä¼¼äºlevel0ã€‚åªæ˜¯è¿™æ¬¡æ˜¯ç›´æ¥è§£å¯†å°±å¥½ï¼Œæ²¡å•¥å¡«å……ï¼Œè¯•äº†å¡«å……åè€Œé”™</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>âœ  level1 git:(master) âœ— python exp.py
ï¿½ï¿½XBï¿½8mØï¿½eyï¿½(ï¿½ï¿½ï¿½Kï¿½ï¿½6ï¿½vï¿½.Ï¿Ñ–Dï¿½Sï¿½
H@Ê½ï¿½Í«Hï¿½]&lt;ï¿½9ï¿½65Y3ï¿½ï¿½Iï¿½           ï¿½~Sï¿½`ï¿½Fï¿½ï¿½ï¿½
</pre></div>
</div>
<p>ï¿½ï¿½ï¿½ï¿½â€]ï¿½PXLï¿½ï¿½Hsï¿½ï¿½jï¿½
ï¿½ï¿½ï¿½</p>
<blockquote>
<div>kWeT3ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½X</div></blockquote>
<p>
ï¿½8
idï¿½]Pl.Aï¿½ï¿½ï¿½/ï¿½ï¿½ ï¿½ï¿½ï¿½Nã°ºï¿½ï¿½Drï¿½ï¿½ï¿½ï¿½Ü˜ï¿½fï¿½fï¿½ï¿½ï¿½ï¿½x</p>
<blockquote>
<div>ï¿½ï¿½ï¿½Hâ€(ï¿½ï¿½`ï¿½Ş·Dp   ï¿½#F$ï¿½Lï¿½ggï¿½#</div></blockquote>
<p>mï¿½fA35ORI11TLoN_Att1Ck_cL0sE_PrI8e_4acTorS</p>
<p>å¾—åˆ°å¯†ç fA35ORI11TLoN_Att1Ck_cL0sE_PrI8e_4acTorSã€‚ç»§ç»­ä¸‹ä¸€æ­¥ï¼ŒæŸ¥çœ‹å…¬é’¥</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>âœ  level2 git:(master) âœ— openssl rsa -pubin -in public.key -text -modulus
Public-Key: (1025 bit)
Modulus:
 01:ba:0c:c2:45:b4:5c:e5:b5:f5:6c:d5:ca:a5:90:
 c2:8d:12:3d:8a:6d:7f:b6:47:37:fb:7c:1f:5a:85:
 8c:1e:35:13:8b:57:b2:21:4f:f4:b2:42:24:5f:33:
 f7:2c:2c:0d:21:c2:4a:d4:c5:f5:09:94:c2:39:9d:
 73:e5:04:a2:66:1d:9c:4b:99:d5:38:44:ab:13:d9:
 cd:12:a4:d0:16:79:f0:ac:75:f9:a4:ea:a8:7c:32:
 16:9a:17:d7:7d:80:fd:60:29:64:c7:ea:50:30:63:
 76:59:c7:36:5e:98:d2:ea:5b:b3:3a:47:17:08:2d:
 d5:24:7d:4f:a7:a1:f0:d5:73
Exponent:
 01:00:8e:81:dd:a0:e3:19:28:e8:ee:51:11:08:c7:
 50:5f:61:31:05:d2:e2:ff:9b:83:71:e4:29:c2:dd:
 92:70:65:d4:09:6d:58:c3:76:31:07:f1:d4:fc:cf:
 2d:b3:0a:6d:02:7c:56:61:7c:be:7e:0b:7e:d9:22:
 28:66:9e:fb:3d:2f:2c:20:59:3c:21:ef:ff:31:00:
 6a:fb:a7:68:de:4a:0a:4c:1a:a7:09:d5:48:98:c8:
 1f:cf:fb:dd:f7:9c:ae:ae:0b:15:f4:b2:c7:e0:bc:
 ba:31:4f:5e:07:83:ad:0e:7f:b9:82:a4:d2:01:fa:
 68:29:6d:66:7c:cf:57:b9:4b
Modulus=1BA0CC245B45CE5B5F56CD5CAA590C28D123D8A6D7FB64737FB7C1F5A858C1E35138B57B2214FF4B242245F33F72C2C0D21C24AD4C5F50994C2399D73E504A2661D9C4B99D53844AB13D9CD12A4D01679F0AC75F9A4EAA87C32169A17D77D80FD602964C7EA5030637659C7365E98D2EA5BB33A4717082DD5247D4FA7A1F0D573
writing RSA key
-----BEGIN PUBLIC KEY-----
MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKBgQG6DMJFtFzltfVs1cqlkMKN
Ej2KbX+2Rzf7fB9ahYweNROLV7IhT/SyQiRfM/csLA0hwkrUxfUJlMI5nXPlBKJm
HZxLmdU4RKsT2c0SpNAWefCsdfmk6qh8MhaaF9d9gP1gKWTH6lAwY3ZZxzZemNLq
W7M6RxcILdUkfU+nofDVcwKBgQEAjoHdoOMZKOjuUREIx1BfYTEF0uL/m4Nx5CnC
3ZJwZdQJbVjDdjEH8dT8zy2zCm0CfFZhfL5+C37ZIihmnvs9LywgWTwh7/8xAGr7
p2jeSgpMGqcJ1UiYyB/P+933nK6uCxX0ssfgvLoxT14Hg60Of7mCpNIB+mgpbWZ8
z1e5Sw==
-----END PUBLIC KEY-----
</pre></div>
</div>
<p>å‘ç°ç§é’¥eå’Œnå‡ ä¹ä¸€æ ·å¤§ï¼Œè€ƒè™‘dæ¯”è¾ƒå°ï¼Œä½¿ç”¨Wienerâ€™s
Attackã€‚å¾—åˆ°dï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å†æ¬¡éªŒè¯ä¸€éã€‚</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>âœ  level2 git:(master) âœ— python RSAwienerHacker.py
Testing Wiener Attack
Hacked!
(&#39;hacked_d = &#39;, 29897859398360008828023114464512538800655735360280670512160838259524245332403L)
-------------------------
Hacked!
(&#39;hacked_d = &#39;, 29897859398360008828023114464512538800655735360280670512160838259524245332403L)
-------------------------
Hacked!
(&#39;hacked_d = &#39;, 29897859398360008828023114464512538800655735360280670512160838259524245332403L)
-------------------------
Hacked!
(&#39;hacked_d = &#39;, 29897859398360008828023114464512538800655735360280670512160838259524245332403L)
-------------------------
Hacked!
(&#39;hacked_d = &#39;, 29897859398360008828023114464512538800655735360280670512160838259524245332403L)
-------------------------
</pre></div>
</div>
<p>è¿™æ—¶æˆ‘ä»¬è§£å¯†å¯†æ–‡ï¼Œè§£å¯†ä»£ç å¦‚ä¸‹</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="k">import</span> <span class="n">RSA</span>
<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="k">import</span> <span class="n">PKCS1_v1_5</span><span class="p">,</span> <span class="n">PKCS1_OAEP</span>
<span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="k">import</span> <span class="n">b64decode</span>
<span class="n">d</span> <span class="o">=</span> <span class="mi">29897859398360008828023114464512538800655735360280670512160838259524245332403</span><span class="n">L</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./public.key&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">importKey</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">n</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">e</span>


<span class="k">def</span> <span class="nf">getprivatekey</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">priviatekey</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">((</span><span class="n">long</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">long</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="n">long</span><span class="p">(</span><span class="n">d</span><span class="p">)))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;private.pem&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">priviatekey</span><span class="o">.</span><span class="n">exportKey</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">decrypt</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./level3.passwd.enc&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">cipher</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./private.pem&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">importKey</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">key</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">cipher</span><span class="p">)</span>


<span class="n">getprivatekey</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="n">decrypt</span><span class="p">()</span>
</pre></div>
</div>
<p>è§£å¯†ç»“æœå¦‚ä¸‹</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span>âœ  level2 git:(master) âœ— python exp.py
jï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ibqï¿½[
</pre></div>
</div>
<dl class="docutils">
<dt>ï¿½ï¿½.ï¿½ï¿½i}#</dt>
<dd><dl class="first last docutils">
<dt>sï¿½ï¿½ï¿½ï¿½â€™w+ï¿½ï¿½ï¿½</dt>
<dd>tï¿½ï¿½ï¿½ï¿½ï¿½5ï¿½dCï¿½ï¿½6ï¿½ï¿½ï¿½]ï¿½ï¿½ï¿½Fï¿½ï¿½ï¿½;ï¿½ï¿½,ï¿½ï¿½eï¿½ï¿½lï¿½9Lï¿½qï¿½ï¿½Û‰ï¿½$$xï¿½ï¿½BwIe6ER1s_1TtA3k_e_t00_larg3</dd>
</dl>
</dd>
</dl>
<p>åˆ©ç”¨æœ«å°¾çš„å­—ç¬¦ä¸²è§£å¯†å‹ç¼©åŒ…ï¼Œæ³¨æ„å»æ‰Bã€‚è‡³æ­¤å…¨éƒ¨è§£å¯†ç»“æŸï¼Œå¾—åˆ°flagã€‚</p>
</div>
<div class="section" id="id4">
<h2>ä¾‹3<a class="headerlink" href="#id4" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../knapsack/knapsack_intro.html" class="btn btn-neutral float-right" title="èƒŒåŒ…åŠ å¯†" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rsa_pkcs_attack.html" class="btn btn-neutral" title="Bleichenbacherâ€™s attack" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, CTF Wiki.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>