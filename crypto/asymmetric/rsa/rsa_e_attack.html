


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_CN">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>公钥指数攻击 &#8212; CTF Wiki </title>
    <link rel="stylesheet" href="../../../_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/translations.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../../../_static/cloud.base.js"></script>
    <script type="text/javascript" src="../../../_static/cloud.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="search" title="搜索" href="../../../search.html" />
    <link rel="next" title="私钥 d 攻击" href="rsa_d_attack.html" />
    <link rel="prev" title="模数" href="rsa_module_attack.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../index.html" title="內容目录"
             accesskey="C">toc</a></li>
        <li class="right" >
          <a href="rsa_d_attack.html" title="私钥 d 攻击"
             accesskey="N">下一页</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="rsa_module_attack.html" title="模数"
             accesskey="P">上一页</a> &nbsp; &nbsp;</li>
    <li><a href="../../../index.html">CTF Wiki </a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" >非对称密码</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="rsa_index.html" accesskey="U">RSA</a> &#187;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>公钥指数攻击<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<div class="section" id="id2">
<h2>小公钥指数攻击<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<div class="section" id="id3">
<h3>攻击条件<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<p>e 特别小，比如 e 为 3。</p>
</div>
<div class="section" id="id4">
<h3>攻击原理<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<p>假设用户使用的密钥 <span class="math">\(e=3\)</span> 。考虑到加密关系满足：</p>
<div class="math">
\[c \equiv m^3 \bmod N\]</div>
<p>则：</p>
<div class="math">
\[\begin{split}\begin{align}
m^3 &amp;= c+k\times N\\
m &amp;= \sqrt[3]{c+k\times n}
\end{align}\end{split}\]</div>
<p>攻击者可以从小到大枚举 <span class="math">\(n\)</span> ，依次开三次根，直到开出整数为止。</p>
</div>
<div class="section" id="id5">
<h3>范例<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<p>这里我们以XMan 一期夏令营课堂练习为例进行介绍（Jarvis
oj有复现），附件中有一个 <code class="docutils literal"><span class="pre">flag.enc</span></code> 和
<code class="docutils literal"><span class="pre">pubkey.pem</span></code> ，很明显是密文和公钥了，先用 <code class="docutils literal"><span class="pre">openssl</span></code> 读一下公钥。</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>➜  Jarvis OJ-Extremely hard RSA git:(master) ✗ openssl rsa -pubin -in pubkey.pem -text -modulus
Public-Key: (4096 bit)
Modulus:
    00:b0:be:e5:e3:e9:e5:a7:e8:d0:0b:49:33:55:c6:
    18:fc:8c:7d:7d:03:b8:2e:40:99:51:c1:82:f3:98:
    de:e3:10:45:80:e7:ba:70:d3:83:ae:53:11:47:56:
    56:e8:a9:64:d3:80:cb:15:7f:48:c9:51:ad:fa:65:
    db:0b:12:2c:a4:0e:42:fa:70:91:89:b7:19:a4:f0:
    d7:46:e2:f6:06:9b:af:11:ce:bd:65:0f:14:b9:3c:
    97:73:52:fd:13:b1:ee:a6:d6:e1:da:77:55:02:ab:
    ff:89:d3:a8:b3:61:5f:d0:db:49:b8:8a:97:6b:c2:
    05:68:48:92:84:e1:81:f6:f1:1e:27:08:91:c8:ef:
    80:01:7b:ad:23:8e:36:30:39:a4:58:47:0f:17:49:
    10:1b:c2:99:49:d3:a4:f4:03:8d:46:39:38:85:15:
    79:c7:52:5a:69:98:4f:15:b5:66:7f:34:20:9b:70:
    eb:26:11:36:94:7f:a1:23:e5:49:df:ff:00:60:18:
    83:af:d9:36:fe:41:1e:00:6e:4e:93:d1:a0:0b:0f:
    ea:54:1b:bf:c8:c5:18:6c:b6:22:05:03:a9:4b:24:
    13:11:0d:64:0c:77:ea:54:ba:32:20:fc:8f:4c:c6:
    ce:77:15:1e:29:b3:e0:65:78:c4:78:bd:1b:eb:e0:
    45:89:ef:9a:19:7f:6f:80:6d:b8:b3:ec:d8:26:ca:
    d2:4f:53:24:cc:de:c6:e8:fe:ad:2c:21:50:06:86:
    02:c8:dc:dc:59:40:2c:ca:c9:42:4b:79:00:48:cc:
    dd:93:27:06:80:95:ef:a0:10:b7:f1:96:c7:4b:a8:
    c3:7b:12:8f:9e:14:11:75:16:33:f7:8b:7b:9e:56:
    f7:1f:77:a1:b4:da:ad:3f:c5:4b:5e:7e:f9:35:d9:
    a7:2f:b1:76:75:97:65:52:2b:4b:bc:02:e3:14:d5:
    c0:6b:64:d5:05:4b:7b:09:6c:60:12:36:e6:cc:f4:
    5b:5e:61:1c:80:5d:33:5d:ba:b0:c3:5d:22:6c:c2:
    08:d8:ce:47:36:ba:39:a0:35:44:26:fa:e0:06:c7:
    fe:52:d5:26:7d:cf:b9:c3:88:4f:51:fd:df:df:4a:
    97:94:bc:fe:0e:15:57:11:37:49:e6:c8:ef:42:1d:
    ba:26:3a:ff:68:73:9c:e0:0e:d8:0f:d0:02:2e:f9:
    2d:34:88:f7:6d:eb:62:bd:ef:7b:ea:60:26:f2:2a:
    1d:25:aa:2a:92:d1:24:41:4a:80:21:fe:0c:17:4b:
    98:03:e6:bb:5f:ad:75:e1:86:a9:46:a1:72:80:77:
    0f:12:43:f4:38:74:46:cc:ce:b2:22:2a:96:5c:c3:
    0b:39:29
Exponent: 3 (0x3)
Modulus=B0BEE5E3E9E5A7E8D00B493355C618FC8C7D7D03B82E409951C182F398DEE3104580E7BA70D383AE5311475656E8A964D380CB157F48C951ADFA65DB0B122CA40E42FA709189B719A4F0D746E2F6069BAF11CEBD650F14B93C977352FD13B1EEA6D6E1DA775502ABFF89D3A8B3615FD0DB49B88A976BC20568489284E181F6F11E270891C8EF80017BAD238E363039A458470F1749101BC29949D3A4F4038D463938851579C7525A69984F15B5667F34209B70EB261136947FA123E549DFFF00601883AFD936FE411E006E4E93D1A00B0FEA541BBFC8C5186CB6220503A94B2413110D640C77EA54BA3220FC8F4CC6CE77151E29B3E06578C478BD1BEBE04589EF9A197F6F806DB8B3ECD826CAD24F5324CCDEC6E8FEAD2C2150068602C8DCDC59402CCAC9424B790048CCDD9327068095EFA010B7F196C74BA8C37B128F9E1411751633F78B7B9E56F71F77A1B4DAAD3FC54B5E7EF935D9A72FB176759765522B4BBC02E314D5C06B64D5054B7B096C601236E6CCF45B5E611C805D335DBAB0C35D226CC208D8CE4736BA39A0354426FAE006C7FE52D5267DCFB9C3884F51FDDFDF4A9794BCFE0E1557113749E6C8EF421DBA263AFF68739CE00ED80FD0022EF92D3488F76DEB62BDEF7BEA6026F22A1D25AA2A92D124414A8021FE0C174B9803E6BB5FAD75E186A946A17280770F1243F4387446CCCEB2222A965CC30B3929
writing RSA key
-----BEGIN PUBLIC KEY-----
MIICIDANBgkqhkiG9w0BAQEFAAOCAg0AMIICCAKCAgEAsL7l4+nlp+jQC0kzVcYY
/Ix9fQO4LkCZUcGC85je4xBFgOe6cNODrlMRR1ZW6Klk04DLFX9IyVGt+mXbCxIs
pA5C+nCRibcZpPDXRuL2BpuvEc69ZQ8UuTyXc1L9E7Huptbh2ndVAqv/idOos2Ff
0NtJuIqXa8IFaEiShOGB9vEeJwiRyO+AAXutI442MDmkWEcPF0kQG8KZSdOk9AON
Rjk4hRV5x1JaaZhPFbVmfzQgm3DrJhE2lH+hI+VJ3/8AYBiDr9k2/kEeAG5Ok9Gg
Cw/qVBu/yMUYbLYiBQOpSyQTEQ1kDHfqVLoyIPyPTMbOdxUeKbPgZXjEeL0b6+BF
ie+aGX9vgG24s+zYJsrST1MkzN7G6P6tLCFQBoYCyNzcWUAsyslCS3kASMzdkycG
gJXvoBC38ZbHS6jDexKPnhQRdRYz94t7nlb3H3ehtNqtP8VLXn75NdmnL7F2dZdl
UitLvALjFNXAa2TVBUt7CWxgEjbmzPRbXmEcgF0zXbqww10ibMII2M5HNro5oDVE
JvrgBsf+UtUmfc+5w4hPUf3f30qXlLz+DhVXETdJ5sjvQh26Jjr/aHOc4A7YD9AC
LvktNIj3betive976mAm8iodJaoqktEkQUqAIf4MF0uYA+a7X6114YapRqFygHcP
EkP0OHRGzM6yIiqWXMMLOSkCAQM=
-----END PUBLIC KEY-----
</pre></div>
</div>
<p>看到 <span class="math">\(e=3\)</span> ，很明显是小公钥指数攻击了。这里我们使用Crypto库来读取公钥，使用multiprocessing来加快破解速度。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#/usr/bin/python</span>
<span class="c1"># coding=utf-8</span>
<span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="k">import</span> <span class="n">RSA</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="k">import</span> <span class="n">Pool</span>
<span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./pubkey.pem&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">importKey</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">n</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">e</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag.enc&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cipher</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
    <span class="nb">print</span> <span class="n">j</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">(</span><span class="n">cipher</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">N</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">a</span>
        <span class="nb">print</span> <span class="s1">&#39;</span><span class="si">{:x}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="n">exit</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">SmallE</span><span class="p">():</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">130000000</span><span class="p">)</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">calc</span><span class="p">,</span> <span class="n">inputs</span><span class="p">)</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s1">&#39;start&#39;</span>
    <span class="n">SmallE</span><span class="p">()</span>
</pre></div>
</div>
<p>爆破时间有点长，，拿到 flag</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Didn</span><span class="s1">&#39;t you know RSA padding is really important? Now you see a non-padding message is so dangerous. And you should notice this in future.Fl4g: flag</span><span class="si">{Sm4ll_3xpon3nt_i5_W3ak}</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h3>题目<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h3>
</div>
</div>
<div class="section" id="rsa-rabin">
<h2>RSA 衍生算法——Rabin 算法<a class="headerlink" href="#rsa-rabin" title="永久链接至标题">¶</a></h2>
<div class="section" id="id7">
<h3>攻击条件<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h3>
<p>Rabin 算法的特征在于 <span class="math">\(e=2\)</span> 。</p>
</div>
<div class="section" id="id8">
<h3>攻击原理<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h3>
<p>密文：</p>
<div class="math">
\[c = m^2\bmod n\]</div>
<p>解密：</p>
<ul class="simple">
<li>计算出 <span class="math">\(m_p\)</span> 和 <span class="math">\(m_q\)</span> ：</li>
</ul>
<div class="math">
\[\begin{split}\begin{align}
m_p &amp;= \sqrt{c} \bmod p\\
m_q &amp;= \sqrt{c} \bmod q
\end{align}\end{split}\]</div>
<ul class="simple">
<li>用扩展欧几里得计算出 <span class="math">\(y_p\)</span> 和 <span class="math">\(y_q\)</span> ：</li>
</ul>
<div class="math">
\[y_p \cdot p + y_q \cdot q = 1\]</div>
<ul class="simple">
<li>解出四个明文：</li>
</ul>
<div class="math">
\[\begin{split}\begin{align}
a &amp;= (y_p \cdot p \cdot m_q + y_q \cdot q \cdot m_p) \bmod n\\
b &amp;= n - a\\
c &amp;= (y_p \cdot p \cdot m_q - y_q \cdot q \cdot m_p) \bmod n\\
d &amp;= n - c
\end{align}\end{split}\]</div>
<p>注意：如果 <span class="math">\(p \equiv q \equiv 3 \pmod 4\)</span> ，则</p>
<div class="math">
\[\begin{split}\begin{align}
m_p &amp;= c^{\frac{1}{4}(p + 1)} \bmod p\\
m_q &amp;= c^{\frac{1}{4}(q + 1)} \bmod q
\end{align}\end{split}\]</div>
<p>而一般情况下， <span class="math">\(p \equiv q \equiv 3 \pmod 4\)</span>
是满足的，对于不满足的情况下，请参考相应的算法解决。</p>
</div>
<div class="section" id="id9">
<h3>例子<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<p>这里我们以XMan 一期夏令营课堂练习（Jarvis oj有复现）为例，读一下公钥。</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>➜  Jarvis OJ-hard RSA git:(master) ✗ openssl rsa -pubin -in pubkey.pem -text -modulus
Public-Key: (256 bit)
Modulus:
    00:c2:63:6a:e5:c3:d8:e4:3f:fb:97:ab:09:02:8f:
    1a:ac:6c:0b:f6:cd:3d:70:eb:ca:28:1b:ff:e9:7f:
    be:30:dd
Exponent: 2 (0x2)
Modulus=C2636AE5C3D8E43FFB97AB09028F1AAC6C0BF6CD3D70EBCA281BFFE97FBE30DD
writing RSA key
-----BEGIN PUBLIC KEY-----
MDowDQYJKoZIhvcNAQEBBQADKQAwJgIhAMJjauXD2OQ/+5erCQKPGqxsC/bNPXDr
yigb/+l/vjDdAgEC
-----END PUBLIC KEY-----
</pre></div>
</div>
<p><span class="math">\(e=2\)</span> ，考虑 Rabin 算法。首先我们先分解一下p和q，得到</p>
<div class="code text highlight-default"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">=</span><span class="mi">275127860351348928173285174381581152299</span>
<span class="n">q</span><span class="o">=</span><span class="mi">319576316814478949870590164193048041239</span>
</pre></div>
</div>
<p>编写代码</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># coding=utf-8</span>
<span class="kn">import</span> <span class="nn">gmpy2</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="k">import</span> <span class="n">RSA</span>

<span class="c1"># 读取公钥参数</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;pubkey.pem&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">importKey</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">n</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">e</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag.enc&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">atoi</span><span class="p">(</span><span class="n">cipher</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="c1"># print cipher</span>
<span class="nb">print</span> <span class="s2">&quot;please input p&quot;</span>
<span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">raw_input</span><span class="p">(),</span> <span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span> <span class="s1">&#39;please input q&#39;</span>
<span class="n">q</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">raw_input</span><span class="p">(),</span> <span class="mi">10</span><span class="p">)</span>
<span class="c1"># 计算yp和yq</span>
<span class="n">inv_p</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<span class="n">inv_q</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="c1"># 计算mp和mq</span>
<span class="n">mp</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">cipher</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">mq</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">cipher</span><span class="p">,</span> <span class="p">(</span><span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

<span class="c1"># 计算a,b,c,d</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">inv_p</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="n">mq</span> <span class="o">+</span> <span class="n">inv_q</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">mp</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">inv_p</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="n">mq</span> <span class="o">-</span> <span class="n">inv_q</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">mp</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%x</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">s</span>
    <span class="nb">print</span> <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>拿到 flag。</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>➜  Jarvis OJ-hard RSA git:<span class="o">(</span>master<span class="o">)</span> ✗ python Rabin.py
please input p
<span class="m">275127860351348928173285174381581152299</span>
please input q
<span class="m">319576316814478949870590164193048041239</span>
D�#���P�ޚe�cb�<span class="sb">`</span>ކ�P�/�V��
<span class="o">}</span>�Y¾�S��Zv#�
C<span class="o">]</span>�+��gq<span class="o">=</span>
�<span class="sb">`</span>��8
<span class="o">(</span>�<span class="nv">$X</span>�
</pre></div>
</div>
<dl class="docutils">
<dt>&#64;��i�{Y�=�`���w</dt>
<dd>��
�2�̻`�?</dd>
</dl>
<p>��PCTF{sp3ci4l_rsa}</p>
</div>
<div class="section" id="id10">
<h3>题目<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h3>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>快速搜索</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="转向" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div class="sphinx-toc sphinxglobaltoc">
<h3><a href="../../../index.html">內容目录</a></h3>
<p class="caption"><span class="caption-text">CTF 介绍</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/history.html">CTF 竞赛的历史</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/mode.html">CTF 竞赛模式简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/content.html">CTF 竞赛内容</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/experience.html">线下攻防经验小结</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/cgc.html">CGC 网络超级挑战赛</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/resources.html">学习资源</a></li>
</ul>
<p class="caption"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/about.html">杂项简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/recon.html">信息搜集技术</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/encode/index.html">编码分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/prefix.html">取证隐写</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/picture/index.html">图片分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/traffic/index.html">流量包分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/archive/index.html">压缩包分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/audio/index.html">音频分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/disk_memory/index.html">磁盘 / 内存分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/others.html">其他</a></li>
</ul>
<p class="caption"><span class="caption-text">Crypto</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">密码学简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../classical/index.html">古典密码</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symmetric/index.html">对称加密</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">非对称密码</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="rsa_index.html">RSA</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="rsa_theory.html">RSA 基本介绍</a></li>
<li class="toctree-l3"><a class="reference internal" href="rsa_module_attack.html">模数</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">公钥指数攻击</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">小公钥指数攻击</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id3">攻击条件</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id4">攻击原理</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id5">范例</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id6">题目</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#rsa-rabin">RSA 衍生算法——Rabin 算法</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id7">攻击条件</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id8">攻击原理</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id9">例子</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id10">题目</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rsa_d_attack.html">私钥 d 攻击</a></li>
<li class="toctree-l3"><a class="reference internal" href="rsa_chosen_cipher.html">选择密文攻击</a></li>
<li class="toctree-l3"><a class="reference internal" href="rsa_coppersmith_attack.html">Coppersmith Related Attack</a></li>
<li class="toctree-l3"><a class="reference internal" href="rsa_side_channel.html">侧信道攻击</a></li>
<li class="toctree-l3"><a class="reference internal" href="rsa_pkcs_attack.html">Bleichenbacher’s attack</a></li>
<li class="toctree-l3"><a class="reference internal" href="rsa_complex.html">综合题目</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../knapsack/knapsack_intro.html">背包加密</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discrete_log/discrete_log_intro.html">离散对数相关</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../hash/index.html">哈希函数</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../signature/index.html">数字签名</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../others/others.html">证书格式</a></li>
</ul>
<p class="caption"><span class="caption-text">Web</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../web/index.html">WEB 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/sqli.html">SQL 注入</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/xss.html">XSS 跨站脚本攻击</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/csrf.html">CSRF 跨站请求伪造</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/ssrf.html">SSRF 服务端请求伪造</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/php.html">PHP 代码审计</a></li>
</ul>
<p class="caption"><span class="caption-text">Reverse</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reverse/index.html">Reverse Engineering</a></li>
</ul>
<p class="caption"><span class="caption-text">Pwn</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../pwn/stackoverflow/index.html">栈溢出</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pwn/fmtstr/index.html">格式化字符串漏洞</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pwn/heap/index.html">堆利用</a></li>
</ul>
<p class="caption"><span class="caption-text">Executable</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../executable/elf/index.html">ELF文件</a></li>
</ul>
</div>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../index.html" title="內容目录"
             >toc</a></li>
        <li class="right" >
          <a href="rsa_d_attack.html" title="私钥 d 攻击"
             >下一页</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="rsa_module_attack.html" title="模数"
             >上一页</a> &nbsp; &nbsp;</li>
    <li><a href="../../../index.html">CTF Wiki </a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" >非对称密码</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="rsa_index.html" >RSA</a> &#187;</li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2017, CTF Wiki.
      由 <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.6 创建。
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>