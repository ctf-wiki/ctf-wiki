


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_CN">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>离散对数相关 &#8212; CTF Wiki </title>
    <link rel="stylesheet" href="../../../_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/translations.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../../../_static/cloud.base.js"></script>
    <script type="text/javascript" src="../../../_static/cloud.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="search" title="搜索" href="../../../search.html" />
    <link rel="next" title="哈希函数" href="../../hash/index.html" />
    <link rel="prev" title="背包加密" href="../knapsack/knapsack_intro.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../index.html" title="內容目录"
             accesskey="C">toc</a></li>
        <li class="right" >
          <a href="../../hash/index.html" title="哈希函数"
             accesskey="N">下一页</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../knapsack/knapsack_intro.html" title="背包加密"
             accesskey="P">上一页</a> &nbsp; &nbsp;</li>
    <li><a href="../../../index.html">CTF Wiki </a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">非对称密码</a> &#187;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="id1">
<h1>离散对数相关<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<div class="section" id="elgamal">
<h2>ElGamal<a class="headerlink" href="#elgamal" title="永久链接至标题">¶</a></h2>
<div class="section" id="id2">
<h3>概述<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<p>ElGamal算法的安全性是基于求解离散对数问题的困难性，于1984年提出，也是一种双钥密码体制，既可以用于加密又可用于数字签名。</p>
<p>如果我们假设p是至少是160位的十进制素数， <strong>并且p-1有大素因子</strong> ，此外g是
<span class="math">\(Z_p^*\)</span> 的生成元，并且 <span class="math">\(y \in Z_p^*\)</span>
。那么如何找到一个唯一的整数x( <span class="math">\(0\leq x \leq p-2\)</span> )
，满足 <span class="math">\(g^x \equiv y \bmod p\)</span>
在算法上是困难的，这里将x记为 <span class="math">\(x=log_gy\)</span> 。</p>
</div>
<div class="section" id="id3">
<h3>基本原理<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<p>这里我们假设A要给B发送消息m。</p>
<div class="section" id="id4">
<h4>密钥生成<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h4>
<p>基本步骤如下</p>
<ol class="arabic simple">
<li>选取一个足够大的素数p，以便于在 <span class="math">\(Z_p\)</span>
上求解离散对数问题是困难的。</li>
<li>选取 <span class="math">\(Z_p^*\)</span> 的生成元g。</li>
<li>随机选取整数k, <span class="math">\(0\leq k \leq p-2\)</span>
，并计算 <span class="math">\(g^k \equiv y \bmod p\)</span> 。</li>
</ol>
<p>其中私钥为{k}，公钥为{p,g,y} 。</p>
</div>
<div class="section" id="id5">
<h4>加密<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h4>
<p>A选取随机数 <span class="math">\(r \in Z_{p-1}\)</span>
，对明文加密 <span class="math">\(E_k(m,r)=(y_1,y_2)\)</span>
。其中 <span class="math">\(y_1 \equiv g^r \bmod p\)</span>
， <span class="math">\(y_2 \equiv my^r \bmod p\)</span> 。</p>
</div>
<div class="section" id="id6">
<h4>解密<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h4>
<p><span class="math">\(D_k(y_1,y_2)=y_2(y_1^k)^{-1} bmod p \equiv m(g^k)^r(g^{rk})^{-1} \equiv m \bmod p\)</span>
。</p>
</div>
<div class="section" id="id7">
<h4>难点<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h4>
<p>虽然我们知道了y1,但是我们却没有办法知道其对应的r。</p>
</div>
</div>
<div class="section" id="id8">
<h3>例子<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h3>
<p>这里我们以2015年
MMA-CTF-2015中的Alicegame为例进行介绍。这题最初在没有给出源码的时候却是比较难做，因为这个给一个m，给一个r就得到加密结果，，这太难想。</p>
<p>我们来简单分析一下源码，首先程序最初生成了pk与sk</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">sk</span><span class="p">)</span> <span class="o">=</span> <span class="n">genkey</span><span class="p">(</span><span class="n">PBITS</span><span class="p">)</span>
</pre></div>
</div>
<p>其中genkey函数如下</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">genkey</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">pk</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="n">sk</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">sk</span><span class="p">)</span>
</pre></div>
</div>
<p>p为k位的素数，g为(2,p)范围内的书，x在(1,p-1)范围内。并且计算了 <span class="math">\(h \equiv g^x \bmod p\)</span>
。看到这里，差不多就知道，这应该是一个数域上的ElGamal加密了。其中pk为公钥，sk为私钥。</p>
<p>接下来 程序输出了10次m和r。并且，利用如下函数加密</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="o">=</span> <span class="n">pk</span>
    <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span> <span class="o">%</span> <span class="n">p</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
</pre></div>
</div>
<p>其加密方法确实是ElGamal方式的加密。</p>
<p>最后程序对flag进行了加密。此时的r是由程序自己random的。</p>
<p>分析一下，这里我们在十轮循环中可以控制m和r，并且</p>
<p><span class="math">\(c_1 \equiv g^r \bmod p\)</span></p>
<p><span class="math">\(c_2 \equiv m * h^{r} \bmod p\)</span></p>
<p>如果我们设置</p>
<ol class="arabic simple">
<li>r=1，m=1，那么我们就可以获得 <span class="math">\(c_1=g,c_2=h\)</span> 。</li>
<li>r=1，m=-1，那么我们就可以获得 <span class="math">\(c_1=g, c_2 = p-h\)</span>
。进而我们就可以得到素数p。</li>
</ol>
<p>我们得到素数p有什么用呢?p的位数在201位左右，很大啊。</p>
<p>但是啊，它生成素数p之后，没有进行检查啊。我们在之前说过p-1必须有大素因子，如果有小的素因子的话，那我们就可以攻击了。其攻击主要是使用到了baby
step-giant step 与 Pohlig-Hellman algorithm
算法，有兴趣的可以看看，这里sage本身自带的计算离散对数的函数已经可以处理这样的情况了，参见 <a class="reference external" href="http://doc.sagemath.org/html/en/reference/groups/sage/groups/generic.html">discrete_log</a> 。</p>
<p>具体代码如下，需要注意的是，，这个消耗内存比较大，，不要随便拿虚拟机跑。。。还有就是这尼玛交互让我头疼啊，，，</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sage.all</span> <span class="k">import</span> <span class="o">*</span>


<span class="k">def</span> <span class="nf">get_maxfactor</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">factor</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s1">&#39;factor done&#39;</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">maxnumber</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">70</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s1">&#39;cycle: &#39;</span><span class="p">,</span><span class="n">i</span>
    <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">9999</span><span class="p">))</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
    <span class="c1"># get g,h</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s2">&quot;1n&quot;</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s2">&quot;1n&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">data</span>
    <span class="k">if</span> <span class="s1">&#39;n&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span><span class="n">data</span><span class="p">[:</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># receive m=</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">h</span><span class="p">)</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># get g,p</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s2">&quot;-1n&quot;</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s2">&quot;1n&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="nb">print</span> <span class="n">data</span>
    <span class="k">if</span> <span class="s1">&#39;n&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># receive m=</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
    <span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">+</span><span class="n">h</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">get_maxfactor</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tmp</span><span class="o">&lt;</span><span class="n">maxnumber</span><span class="p">:</span>
        <span class="nb">print</span> <span class="s1">&#39;may be success&#39;</span>
        <span class="c1"># skip the for cycle</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s1">&#39;quitn&#39;</span><span class="p">);</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s1">&#39;receive data: &#39;</span><span class="p">,</span><span class="n">data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">)</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># generate the group</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">Mod</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">Mod</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">Mod</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">Mod</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">discrete_log</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
        <span class="nb">print</span> <span class="s2">&quot;x = &quot;</span><span class="p">,</span> <span class="n">x</span>
        <span class="nb">print</span> <span class="s2">&quot;Flag: &quot;</span><span class="p">,</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">long</span><span class="p">(</span><span class="n">c2</span> <span class="o">/</span> <span class="p">(</span> <span class="n">c1</span> <span class="o">**</span> <span class="n">x</span><span class="p">)))</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="s1">&#39;quitn&#39;</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>最后迫于计算机内存不够，，没计算出来，，，有时候会崩，多运行几次。。</p>
</div>
</div>
<div class="section" id="ecc">
<h2>ECC<a class="headerlink" href="#ecc" title="永久链接至标题">¶</a></h2>
<div class="section" id="id9">
<h3>概述<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<p>ECC全称为椭圆曲线加密，EllipseCurve
Cryptography，是一种基于椭圆曲线数学的公钥密码。与传统的基于大质数因子分解困难性的加密方法不同，ECC依赖于解决椭圆曲线离散对数问题的困难性。它的优势主要在于相对于其它方法，它可以在使用较短秘钥长度的同时保持相同的密码强度。目前椭圆曲线主要采用的有限域有</p>
<ul class="simple">
<li>以素数为模的整数域GF(p)，通常在通用处理器上更为有效。</li>
<li>特征为2的伽罗华域GF（2^m），可以设计专门的硬件。</li>
</ul>
</div>
<div class="section" id="id10">
<h3>基本知识<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h3>
<p>我们首先来了解一下有限域上的椭圆曲线，有限域上的椭圆曲线是指在椭圆曲线的定义式</p>
<p><span class="math">\(y^2+axy+by=x^3+cx^2+dx+e\)</span></p>
<p>中所有的系数都是在某个有限域GF(p)中的元素，其中p为一个大素数。</p>
<p>当然，并不是所有的椭圆曲线都适合于加密，最为常用的方程如下</p>
<p><span class="math">\(y^2=x^3+ax+b\)</span></p>
<p>其中 <span class="math">\(4a^3+27b^2 \bmod p \neq 0\)</span></p>
<p>我们称该方程的所有解(x,y)，( <span class="math">\(x\in Fp , y \in Fp\)</span> )，以及一个称为“无穷远点”(O)组成的集合为定义在Fp上的一个椭圆曲线，记为E(Fp)。</p>
<p>一般定义椭圆曲线密码需要以下条件</p>
<p>假设E(Fp)对于点的运算 <span class="math">\(\oplus\)</span>
形成一个able群（交换群，逆元存在，封闭性等），设 <span class="math">\(p\in E(Fq)\)</span>
，且满足下列条件的t很大</p>
<p><span class="math">\(p \oplus p \oplus ... \oplus p=O\)</span></p>
<p>其中共有t个p参与运算。这里我们称t为p的周期。此外，对于 <span class="math">\(Q\in E(Fq)\)</span>
，定有某个正整数m使得下列式子成立，定义 <span class="math">\(m=log_pq\)</span></p>
<p><span class="math">\(Q=m \cdot p =p \oplus p \oplus ... \oplus p\)</span> （m个p参与运算）</p>
<p>此外，假设G是该 <span class="math">\(E_q (a,b)\)</span>
的生成元，即可以生成其中的所有元素，其阶为满足 <span class="math">\(nG=O\)</span>
的最小正整数n。</p>
</div>
<div class="section" id="eccelgamal">
<h3>ECC中的ElGamal<a class="headerlink" href="#eccelgamal" title="永久链接至标题">¶</a></h3>
<p>这里我们假设用户B要把消息加密后传给用户A。</p>
<div class="section" id="id11">
<h4>秘钥生成<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h4>
<p>用户A先选择一条椭圆曲线 <span class="math">\(E_q (a,b)\)</span>
，然后选择其上的一个生成元G，假设其阶为n，之后再选择一个正整数 <span class="math">\(n_a\)</span> 作为密钥，计算 <span class="math">\(P_a=n_aG\)</span> 。</p>
<p>其中， <span class="math">\(E_q(a,b), q,G\)</span> 都会被公开。</p>
<p>公钥为 <span class="math">\(P_a\)</span> ，私钥为 <span class="math">\(n_a\)</span> 。</p>
</div>
<div class="section" id="id12">
<h4>加密<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h4>
<p>用户B在向用户A发送消息m，这里假设消息m已经被编码为椭圆曲线上的点，其加密步骤如下</p>
<ol class="arabic simple">
<li>查询用户A的公钥 <span class="math">\(E_q(a,b), q, P_a,G\)</span> 。</li>
<li>在(1,q-1) 的区间内选择随机数k 。</li>
<li>根据A的公钥计算点 <span class="math">\((x_1,y_1)=kG\)</span> 。</li>
<li>计算点 <span class="math">\((x_2,y_2)=kP_a\)</span> ，如果为O，则从第二步重新开始。</li>
<li>计算 <span class="math">\(C=m+(x_2,y_2)\)</span></li>
<li>将 <span class="math">\(((x_1,y_1),C)\)</span> 发送给A。</li>
</ol>
</div>
<div class="section" id="id13">
<h4>解密<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h4>
<p>解密步骤如下</p>
<ol class="arabic simple">
<li>利用私钥计算点 <span class="math">\(n_a(x_1,y_1)=n_akG=kP_a=(x_2,y_2)\)</span> 。</li>
<li>计算消息 <span class="math">\(m=C-(x_2,y_2)\)</span> 。</li>
</ol>
</div>
<div class="section" id="id14">
<h4>关键点<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h4>
<p>这里的关键点在于我们即使知道了 <span class="math">\((x_1,y_1)\)</span>
也难以知道k，这是由离散对数的问题的难度决定的。</p>
</div>
</div>
<div class="section" id="id15">
<h3>例子<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h3>
<p>参考： <a class="reference external" href="https://github.com/sonickun/ctf-crypto-writeups/tree/master/2013/seccon-ctf-quals/cryptanalysis">https://github.com/sonickun/ctf-crypto-writeups/tree/master/2013/seccon-ctf-quals/cryptanalysis</a>
。</p>
<p>这里我们以2013年SECCON CTF quals 中的 Cryptanalysis为例，题目如下</p>
<div class="figure">
<img alt="" src="../../../_images/20140127213558.png" />
</div>
<p>这里，我们已知椭圆曲线方程以及对应的生成元base，还知道相应的模数以及公钥以及加密后的结果。</p>
<p>但是可以看出的我们的模数太小，我们暴力枚举获取结果。</p>
<p>这里直接参考github上的sage程序，暴力跑出secret key。之后便可以解密了。</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mi">1234577</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">3213242</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">7654319</span>

<span class="n">E</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">(</span><span class="n">GF</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span>

<span class="n">base</span> <span class="o">=</span> <span class="n">E</span><span class="p">([</span><span class="mi">5234568</span><span class="p">,</span> <span class="mi">2287747</span><span class="p">])</span>
<span class="n">pub</span> <span class="o">=</span> <span class="n">E</span><span class="p">([</span><span class="mi">2366653</span><span class="p">,</span> <span class="mi">1424308</span><span class="p">])</span>

<span class="n">c1</span> <span class="o">=</span> <span class="n">E</span><span class="p">([</span><span class="mi">5081741</span><span class="p">,</span> <span class="mi">6744615</span><span class="p">])</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">E</span><span class="p">([</span><span class="mi">610619</span><span class="p">,</span> <span class="mi">6218</span><span class="p">])</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">base</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">X</span> <span class="o">==</span> <span class="n">pub</span><span class="p">:</span>
        <span class="n">secret</span> <span class="o">=</span> <span class="n">i</span>
        <span class="nb">print</span> <span class="s2">&quot;[+] secret:&quot;</span><span class="p">,</span> <span class="n">i</span>
        <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">base</span>
        <span class="nb">print</span> <span class="n">i</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">c2</span> <span class="o">-</span> <span class="p">(</span><span class="n">c1</span> <span class="o">*</span> <span class="n">secret</span><span class="p">)</span>

<span class="nb">print</span> <span class="s2">&quot;[+] x:&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span> <span class="s2">&quot;[+] y:&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span> <span class="s2">&quot;[+] x+y:&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>暴力跑出结果</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">secret</span><span class="p">:</span> <span class="mi">1584718</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">x</span><span class="p">:</span> <span class="mi">2171002</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">y</span><span class="p">:</span> <span class="mi">3549912</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">:</span> <span class="mi">5720914</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>快速搜索</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="转向" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<div class="sphinx-toc sphinxglobaltoc">
<h3><a href="../../../index.html">內容目录</a></h3>
<p class="caption"><span class="caption-text">CTF 介绍</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/history.html">CTF 竞赛的历史</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/mode.html">CTF 竞赛模式简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/content.html">CTF 竞赛内容</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/experience.html">线下攻防经验小结</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/cgc.html">CGC 网络超级挑战赛</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/resources.html">学习资源</a></li>
</ul>
<p class="caption"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/about.html">杂项简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/recon.html">信息搜集技术</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/encode/index.html">编码分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/prefix.html">取证隐写</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/picture/index.html">图片分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/traffic/index.html">流量包分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/archive/index.html">压缩包分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/audio/index.html">音频分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/disk_memory/index.html">磁盘 / 内存分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/others.html">其他</a></li>
</ul>
<p class="caption"><span class="caption-text">Crypto</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">密码学简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../classical/index.html">古典密码</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symmetric/index.html">对称加密</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">非对称密码</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../rsa/rsa_index.html">RSA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../knapsack/knapsack_intro.html">背包加密</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">离散对数相关</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#elgamal">ElGamal</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">概述</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">基本原理</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id4">密钥生成</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id5">加密</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id6">解密</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id7">难点</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id8">例子</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ecc">ECC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id9">概述</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">基本知识</a></li>
<li class="toctree-l4"><a class="reference internal" href="#eccelgamal">ECC中的ElGamal</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id11">秘钥生成</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id12">加密</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id13">解密</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id14">关键点</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id15">例子</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../hash/index.html">哈希函数</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../signature/index.html">数字签名</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../others/others.html">证书格式</a></li>
</ul>
<p class="caption"><span class="caption-text">Web</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../web/index.html">WEB 简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/sqli.html">SQL 注入</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/xss.html">XSS 跨站脚本攻击</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/csrf.html">CSRF 跨站请求伪造</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/ssrf.html">SSRF 服务端请求伪造</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/php.html">PHP 代码审计</a></li>
</ul>
<p class="caption"><span class="caption-text">Reverse</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reverse/index.html">Reverse Engineering</a></li>
</ul>
<p class="caption"><span class="caption-text">Pwn</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../pwn/stackoverflow/index.html">栈溢出</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pwn/fmtstr/index.html">格式化字符串漏洞</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pwn/heap/index.html">堆利用</a></li>
</ul>
<p class="caption"><span class="caption-text">Executable</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../executable/elf/index.html">ELF文件</a></li>
</ul>
</div>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../index.html" title="內容目录"
             >toc</a></li>
        <li class="right" >
          <a href="../../hash/index.html" title="哈希函数"
             >下一页</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../knapsack/knapsack_intro.html" title="背包加密"
             >上一页</a> &nbsp; &nbsp;</li>
    <li><a href="../../../index.html">CTF Wiki </a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" >非对称密码</a> &#187;</li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2017, CTF Wiki.
      由 <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7 创建。
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>